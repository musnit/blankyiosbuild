/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
* @license SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

// Rivets.js
// version: 0.7.1
// author: Michael Richards
// license: MIT

!function(){var t,e,i;!function(n){function s(t,e){return b.call(t,e)}function r(t,e){var i,n,s,r,o,a,u,h,c,l,p,d=e&&e.split("/"),f=v.map,m=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=t.split("/"),o=t.length-1,v.nodeIdCompat&&w.test(t[o])&&(t[o]=t[o].replace(w,"")),t=d.concat(t),c=0;c<t.length;c+=1)if(p=t[c],"."===p)t.splice(c,1),c-=1;else if(".."===p){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||m)&&f){for(i=t.split("/"),c=i.length;c>0;c-=1){if(n=i.slice(0,c).join("/"),d)for(l=d.length;l>0;l-=1)if(s=f[d.slice(0,l).join("/")],s&&(s=s[n])){r=s,a=c;break}if(r)break;!u&&m&&m[n]&&(u=m[n],h=c)}!r&&u&&(r=u,a=h),r&&(i.splice(0,a,r),t=i.join("/"))}return t}function o(t,e){return function(){return d.apply(n,x.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return r(e,t)}}function u(t){return function(e){_[t]=e}}function h(t){if(s(g,t)){var e=g[t];delete g[t],y[t]=!0,p.apply(n,e)}if(!s(_,t)&&!s(y,t))throw new Error("No "+t);return _[t]}function c(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function l(t){return function(){return v&&v.config&&v.config[t]||{}}}var p,d,f,m,_={},g={},v={},y={},b=Object.prototype.hasOwnProperty,x=[].slice,w=/\.js$/;f=function(t,e){var i,n=c(t),s=n[0];return t=n[1],s&&(s=r(s,e),i=h(s)),s?t=i&&i.normalize?i.normalize(t,a(e)):r(t,e):(t=r(t,e),n=c(t),s=n[0],t=n[1],s&&(i=h(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},m={require:function(t){return o(t)},exports:function(t){var e=_[t];return"undefined"!=typeof e?e:_[t]={}},module:function(t){return{id:t,uri:"",exports:_[t],config:l(t)}}},p=function(t,e,i,r){var a,c,l,p,d,v,b=[],x=typeof i;if(r=r||t,"undefined"===x||"function"===x){for(e=!e.length&&i.length?["require","exports","module"]:e,d=0;d<e.length;d+=1)if(p=f(e[d],r),c=p.f,"require"===c)b[d]=m.require(t);else if("exports"===c)b[d]=m.exports(t),v=!0;else if("module"===c)a=b[d]=m.module(t);else if(s(_,c)||s(g,c)||s(y,c))b[d]=h(c);else{if(!p.p)throw new Error(t+" missing "+c);p.p.load(p.n,o(r,!0),u(c),{}),b[d]=_[c]}l=i?i.apply(_[t],b):void 0,t&&(a&&a.exports!==n&&a.exports!==_[t]?_[t]=a.exports:l===n&&v||(_[t]=l))}else t&&(_[t]=i)},t=e=d=function(t,e,i,s,r){if("string"==typeof t)return m[t]?m[t](e):h(f(t,e).f);if(!t.splice){if(v=t,v.deps&&d(v.deps,v.callback),!e)return;e.splice?(t=e,e=i,i=null):t=n}return e=e||function(){},"function"==typeof i&&(i=s,s=r),s?p(n,t,e,i):setTimeout(function(){p(n,t,e,i)},4),d},d.config=function(t){return d(t)},t._defined=_,i=function(t,e,i){e.splice||(i=e,e=[]),s(_,t)||s(g,t)||(g[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("almond",function(){}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof i&&i.amd)i("famous",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.famous=t()}}(function(){return function t(i,n,s){function r(a,u){if(!n[a]){if(!i[a]){var h="function"==typeof e&&e;if(!u&&h)return h(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};i[a][0].call(l.exports,function(t){var e=i[a][1][t];return r(e?e:t)},l,l.exports,t,i,n,s)}return n[a].exports}for(var o="function"==typeof e&&e,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(t,e){function i(t){n.call(this,t);var e=t.getAlign();this._x.set(e[0]),this._y.set(e[1]),this._z.set(e[2])}var n=t("./Position");i.prototype.toString=function(){return"Align"},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){this._node.setAlign(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"./Position":7}],2:[function(t,e){function i(t){this._node=t,this._projectionType=i.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this._requestingUpdate=!1,this._id=t.addComponent(this),this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._viewDirty=!1,this._perspectiveDirty=!1,this.setFlat()}i.FRUSTUM_PROJECTION=0,i.PINHOLE_PROJECTION=1,i.ORTHOGRAPHIC_PROJECTION=2,i.prototype.toString=function(){return"Camera"},i.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,focalDepth:this._focalDepth,near:this._near,far:this._far}},i.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.projectionType,t.focalDepth,t.near,t.far),!0):!1},i.prototype.set=function(t,e,i,n){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._projectionType=t,this._focalDepth=e,this._near=i,this._far=n},i.prototype.setDepth=function(t){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=i.PINHOLE_PROJECTION,this._focalDepth=t,this._near=0,this._far=0,this},i.prototype.setFrustum=function(t,e){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=i.FRUSTUM_PROJECTION,this._focalDepth=0,this._near=t,this._far=e,this},i.prototype.setFlat=function(){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=i.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this},i.prototype.onUpdate=function(){this._requestingUpdate=!1;var t=this._node.getLocation();if(this._node.sendDrawCommand("WITH").sendDrawCommand(t),this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case i.FRUSTUM_PROJECTION:this._node.sendDrawCommand("FRUSTUM_PROJECTION"),this._node.sendDrawCommand(this._near),this._node.sendDrawCommand(this._far);break;case i.PINHOLE_PROJECTION:this._node.sendDrawCommand("PINHOLE_PROJECTION"),this._node.sendDrawCommand(this._focalDepth);break;case i.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand("ORTHOGRAPHIC_PROJECTION")}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand("CHANGE_VIEW_TRANSFORM"),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))},i.prototype.onTransformChange=function(t){var e=t;this._viewDirty=!0,this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],_=e[14],g=e[15],v=i*a-n*o,y=i*u-s*o,b=i*h-r*o,x=n*u-s*a,w=n*h-r*a,E=s*h-r*u,S=c*m-l*f,T=c*_-p*f,C=c*g-d*f,A=l*_-p*m,P=l*g-d*m,O=p*g-d*_,R=1/(v*O-y*P+b*A+x*C-w*T+E*S);this._viewTransform[0]=(a*O-u*P+h*A)*R,this._viewTransform[1]=(s*P-n*O-r*A)*R,this._viewTransform[2]=(m*E-_*w+g*x)*R,this._viewTransform[3]=(p*w-l*E-d*x)*R,this._viewTransform[4]=(u*C-o*O-h*T)*R,this._viewTransform[5]=(i*O-s*C+r*T)*R,this._viewTransform[6]=(_*b-f*E-g*y)*R,this._viewTransform[7]=(c*E-p*b+d*y)*R,this._viewTransform[8]=(o*P-a*C+h*S)*R,this._viewTransform[9]=(n*C-i*P-r*S)*R,this._viewTransform[10]=(f*w-m*b+g*v)*R,this._viewTransform[11]=(l*b-c*w-d*v)*R,this._viewTransform[12]=(a*T-o*A-u*S)*R,this._viewTransform[13]=(i*A-n*T+s*S)*R,this._viewTransform[14]=(m*y-f*x-_*v)*R,this._viewTransform[15]=(c*x-l*y+p*v)*R},e.exports=i},{}],3:[function(t,e){function i(t,e){this.node=t,this.id=t.addComponent(this),this._events=new a,this.last1=new u,this.last2=new u,this.delta1=new u,this.delta2=new u,this.velocity1=new u,this.velocity2=new u,this.dist=0,this.diff12=new u,this.center=new u,this.centerDelta=new u,this.centerVelocity=new u,this.pointer1={position:this.last1,delta:this.delta1,velocity:this.velocity1},this.pointer2={position:this.last2,delta:this.delta2,velocity:this.velocity2},this.event={status:null,time:0,pointers:[],center:this.center,centerDelta:this.centerDelta,centerVelocity:this.centerVelocity,points:0,current:0},this.trackedPointerIDs=[-1,-1],this.timeOfPointer=0,this.multiTap=0,this.mice=[],this.gestures=[],this.options={},this.trackedGestures={};var i,n;if(e)for(i=0,n=e.length;n>i;i++)this.on(e[i],e[i].callback);t.addUIEvent("touchstart"),t.addUIEvent("mousedown"),t.addUIEvent("touchmove"),t.addUIEvent("mousemove"),t.addUIEvent("touchend"),t.addUIEvent("mouseup"),t.addUIEvent("mouseleave")}function n(t){var e;if(t.targetTouches?e=t.targetTouches:(this.mice[0]=t,e=this.mice,t.identifier=1),!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){this.event.time=Date.now();var i,n;this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i?this.event.taps++:this.event.taps=1,this.timeOfPointer=this.event.time,this.multiTap=1),this.event.current=1,this.event.points=1,n=e[0].identifier,this.trackedPointerIDs[0]=n,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear(),this.event.pointers.push(this.pointer1)),e[1]&&this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i&&(this.multiTap=2)),this.event.current=2,this.event.points=2,n=e[1].identifier,this.trackedPointerIDs[1]=n,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length(),this.trackedGestures.pinch&&(this.event.scale=this.event.scale||1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=this.event.rotation||0,this.event.rotationDelta=0,this.event.rotationVelocity=0),this.event.pointers.push(this.pointer2)),this.event.status="start",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.clear(),this.centerVelocity.clear(),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function s(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice[0]=t,e=this.mice,t.identifier=1}var i=Date.now(),n=i-this.event.time;if(0!==n){var s=1e3/n;if(this.event.time=i,this.event.current=1,this.event.points=1,this.trackedPointerIDs[0]===e[0].identifier&&(h.set(e[0].pageX,e[0].pageY),u.subtract(h,this.last1,this.delta1),u.scale(this.delta1,s,this.velocity1),this.last1.copy(h)),e[1]){if(this.event.current=2,this.event.points=2,h.set(e[1].pageX,e[1].pageY),u.subtract(h,this.last2,this.delta2),u.scale(this.delta2,s,this.velocity2),this.last2.copy(h),u.add(this.last1,this.last2,h).scale(.5),u.subtract(h,this.center,this.centerDelta),u.add(this.velocity1,this.velocity2,this.centerVelocity).scale(.5),this.center.copy(h),u.subtract(this.last2,this.last1,h),this.trackedGestures.rotate){var r=h.dot(this.diff12),o=h.cross(this.diff12),a=-Math.atan2(o,r);this.event.rotation+=a,this.event.rotationDelta=a,this.event.rotationVelocity=a*s}var c=h.length(),l=c/this.dist;this.diff12.copy(h),this.dist=c,this.trackedGestures.pinch&&(this.event.scale*=l,l-=1,this.event.scaleDelta=l,this.event.scaleVelocity=l*s)}this.event.status="move",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.copy(this.delta1),this.centerVelocity.copy(this.velocity1),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function r(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice.pop(),e=this.mice}if(!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){var i;if(this.event.status="end",!e[0])return this.event.current=0,this.trackedPointerIDs[0]=-1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.pointers.pop(),void this.event.pointers.pop();this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedPointerIDs[0]=-1,i=e[0].identifier,this.trackedPointerIDs[0]=i,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear()),e[1]?this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedPointerIDs[1]=-1,this.event.points=2,i=e[1].identifier,this.trackedPointerIDs[1]=i,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length()):(this.event.current=1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.points=1,this.event.pointers.pop())}}function o(){this.event.current&&(this.event.status="end",this.event.current=0,this.trackedPointerIDs[0]=-1,this.triggerGestures(),this.event.pointers.pop())}var a=t("../utilities/CallbackStore"),u=t("../math/Vec2"),h=new u,c={drag:!0,tap:!0,rotate:!0,pinch:!0};i.prototype.onReceive=function(t,e){switch(t){case"touchstart":case"mousedown":n.call(this,e);break;case"touchmove":case"mousemove":s.call(this,e);break;case"touchend":case"mouseup":r.call(this,e);break;case"mouseleave":o.call(this,e)}},i.prototype.toString=function(){return"GestureHandler"},i.prototype.on=function(t,e){var i=t.event||t;c[i]&&(this.trackedGestures[i]=!0,this.gestures.push(i),t.event&&(this.options[i]=t),this._events.on(i,e))},i.prototype.triggerGestures=function(){for(var t=this.event,e=0,i=this.gestures.length;i>e;e++){var n=this.gestures[e];switch(n){case"rotate":case"pinch":2===t.points&&this.trigger(n,t);break;case"tap":if("start"===t.status)if(this.options.tap){var s=this.options.tap.points||1;this.multiTap>=s&&t.points>=s&&this.trigger(n,t)}else this.trigger(n,t);break;default:this.trigger(n,t)}}},i.prototype.trigger=function(t,e){this._events.trigger(t,e)},e.exports=i},{"../math/Vec2":43,"../utilities/CallbackStore":90}],4:[function(t,e){function i(t){n.call(this,t);var e=t.getMountPoint();this._x.set(e[0]),this._y.set(e[1]),this._z.set(e[2])}var n=t("./Position");i.prototype.toString=function(){return"MountPoint"},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){this._node.setMountPoint(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"./Position":7}],5:[function(t,e){function i(t){this._node=t,this._id=t.addComponent(this),this._value=new n(1),this._requestingUpdate=!1}var n=t("../transitions/Transitionable");i.prototype.toString=function(){return"Opacity"},i.prototype.getValue=function(){return{component:this.toString(),value:this._value.get()}},i.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.value),!0):!1},i.prototype.set=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._value.set(t,e,i),this},i.prototype.get=function(){return this._value.get()},i.prototype.halt=function(){return this._value.halt(),this},i.prototype.isActive=function(){return this._value.isActive()},i.prototype.update=function(){this._node.setOpacity(this._value.get()),this._value.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"../transitions/Transitionable":88}],6:[function(t,e){function i(t){n.call(this,t);var e=t.getOrigin();this._x.set(e[0]),this._y.set(e[1]),this._z.set(e[2])}var n=t("./Position");i.prototype.toString=function(){return"Origin"},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){this._node.setOrigin(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"./Position":7}],7:[function(t,e){function i(t){this._node=t,this._id=t.addComponent(this),this._requestingUpdate=!1;var e=t.getPosition();this._x=new n(e[0]),this._y=new n(e[1]),this._z=new n(e[2])}var n=t("../transitions/Transitionable");i.prototype.toString=function(){return"Position"},i.prototype.getValue=function(){return{component:this.toString(),x:this._x.get(),y:this._y.get(),z:this._z.get()}},i.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.x,t.y,t.z),!0):!1},i.prototype.getX=function(){return this._x.get()},i.prototype.getY=function(){return this._y.get()},i.prototype.getZ=function(){return this._z.get()},i.prototype.isActive=function(){return this._x.isActive()||this._y.isActive()||this._z.isActive()},i.prototype._checkUpdate=function(){this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1},i.prototype.update=function(){this._node.setPosition(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,i.prototype.setX=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._x.set(t,e,i),this},i.prototype.setY=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._y.set(t,e,i),this},i.prototype.setZ=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._z.set(t,e,i),this},i.prototype.set=function(t,e,i,n,s){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var r,o,a;return null!=i?a=s:null!=e?o=s:null!=t&&(r=s),null!=t&&this._x.set(t,n,r),null!=e&&this._y.set(e,n,o),null!=i&&this._z.set(i,n,a),this},i.prototype.halt=function(){return this._x.halt(),this._y.halt(),this._z.halt(),this},e.exports=i},{"../transitions/Transitionable":88}],8:[function(t,e){function i(t){n.call(this,t);var e=t.getRotation(),i=e[0],s=e[1],r=e[2],o=e[3],a=i*i,u=s*s,h=r*r,c=2*(i*r+s*o);c=-1>c?-1:c>1?1:c;var l=Math.atan2(2*(i*o-s*r),1-2*(a+u)),p=Math.asin(c),d=Math.atan2(2*(r*o-i*s),1-2*(u+h));this._x.set(l),this._y.set(p),this._z.set(d)}var n=t("./Position");i.prototype.toString=function(){return"Rotation"},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){this._node.setRotation(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"./Position":7}],9:[function(t,e){function i(t){n.call(this,t),this._x.set(1),this._y.set(1),this._z.set(1)}var n=t("./Position");i.prototype.toString=function(){return"Scale"},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.update=function(){this._node.setScale(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},i.prototype.onUpdate=i.prototype.update,e.exports=i},{"./Position":7}],10:[function(t,e){function i(t){this._node=t,this._id=t.addComponent(this),this._requestingUpdate=!1;var e=t.getProportionalSize(),i=t.getDifferentialSize(),s=t.getAbsoluteSize();this._proportional={x:new n(e[0]),y:new n(e[1]),z:new n(e[2])},this._differential={x:new n(i[0]),y:new n(i[1]),z:new n(i[2])},this._absolute={x:new n(s[0]),y:new n(s[1]),z:new n(s[2])}}var n=t("../transitions/Transitionable");i.RELATIVE=0,i.ABSOLUTE=1,i.RENDER=2,i.DEFAULT=i.RELATIVE,i.prototype.setMode=function(t,e,i){return this._node.setSizeMode(t,e,i),this},i.prototype.toString=function(){return"Size"},i.prototype.getValue=function(){return{sizeMode:this._node.value.sizeMode,absolute:{x:this._absolute.x.get(),y:this._absolute.y.get(),z:this._absolute.z.get()},differential:{x:this._differential.x.get(),y:this._differential.y.get(),z:this._differential.z.get()},proportional:{x:this._proportional.x.get(),y:this._proportional.y.get(),z:this._proportional.z.get()}}},i.prototype.setValue=function(t){return this.toString()===t.component&&(this.setMode.apply(this,t.sizeMode),t.absolute&&this.setAbsolute(t.absolute.x,t.absolute.y,t.absolute.z),t.differential&&this.setAbsolute(t.differential.x,t.differential.y,t.differential.z),t.proportional&&this.setAbsolute(t.proportional.x,t.proportional.y,t.proportional.z)),!1},i.prototype._isActive=function(t){return t.x.isActive()||t.y.isActive()||t.z.isActive()},i.prototype.isActive=function(){return this._isActive(this._absolute)||this._isActive(this._proportional)||this._isActive(this._differential)},i.prototype.onUpdate=function(){var t=this._absolute;this._node.setAbsoluteSize(t.x.get(),t.y.get(),t.z.get());var e=this._proportional,i=this._differential;this._node.setProportionalSize(e.x.get(),e.y.get(),e.z.get()),this._node.setDifferentialSize(i.x.get(),i.y.get(),i.z.get()),this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1},i.prototype.setAbsolute=function(t,e,i,n,s){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var r,o,a;null!=i?a=s:null!=e?o=s:null!=t&&(r=s);var u=this._absolute;null!=t&&u.x.set(t,n,r),null!=e&&u.y.set(e,n,o),null!=i&&u.z.set(i,n,a)},i.prototype.setProportional=function(t,e,i,n,s){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var r,o,a;null!=i?a=s:null!=e?o=s:null!=t&&(r=s);var u=this._proportional;return null!=t&&u.x.set(t,n,r),null!=e&&u.y.set(e,n,o),null!=i&&u.z.set(i,n,a),this},i.prototype.setDifferential=function(t,e,i,n,s){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var r,o,a;null!=i?a=s:null!=e?o=s:null!=t&&(r=s);var u=this._differential;return null!=t&&u.x.set(t,n,r),null!=e&&u.y.set(e,n,o),null!=i&&u.z.set(i,n,a),this},i.prototype.get=function(){return this._node.getSize()},i.prototype.halt=function(){return this._proportional.x.halt(),this._proportional.y.halt(),this._proportional.z.halt(),this._differential.x.halt(),this._differential.y.halt(),this._differential.z.halt(),this._absolute.x.halt(),this._absolute.y.halt(),this._absolute.z.halt(),this},e.exports=i},{"../transitions/Transitionable":88}],11:[function(t,e){function i(t,e,i,n){this._transform=n,this._dirty=!1,this.x=new r(t),this.y=new r(e),this.z=new r(i),this._values={x:t,y:e,z:i}}function n(t,e,i,n,s){this._transform=s,this._dirty=!1,this._t=new r([t,e,i,n])}function s(t){this._node=t,this._id=t.addComponent(this),this.origin=null,this.mountPoint=null,this.align=null,this.scale=null,this.position=null,this.rotation=null,this._dirty=!1}var r=t("../transitions/Transitionable"),o=t("../math/Quaternion"),a=new o,u=new o;i.prototype.get=function(){return this._values.x=this.x.get(),this._values.y=this.y.get(),this._values.z=this.z.get(),this._values},i.prototype.set=function(t,e,i,n,s){this._transform._dirty||(this._transform._node.requestUpdate(this._transform._id),this._transform._dirty=!0),this._dirty=!0;var r=null,o=null,a=null;return null!=i?a=s:null!=e?o=s:null!=t&&(r=s),null!=t&&this.x.set(t,n,r),null!=e&&this.y.set(e,n,o),null!=i&&this.z.set(i,n,a),this},i.prototype.isActive=function(){return this.x.isActive()||this.y.isActive()||this.z.isActive()},i.prototype.pause=function(){return this.x.pause(),this.y.pause(),this.z.pause(),this},i.prototype.resume=function(){return this.x.resume(),this.y.resume(),this.z.resume(),this},i.prototype.halt=function(){return this.x.halt(),this.y.halt(),this.z.halt(),this},n.prototype.get=function(){return this._t.get()},n.prototype.set=function(t,e,i,n,s,r){this._transform._dirty||(this._transform._node.requestUpdate(this._transform._id),this._transform._dirty=!0),this._dirty=!0,s.method="slerp",this._t.set([t,e,i,n],s,r)},n.prototype.isActive=function(){return this._t.isActive()},n.prototype.pause=function(){return this._t.pause(),this},n.prototype.resume=function(){return this._t.resume(),this},n.prototype.halt=function(){return this._dirty=!1,this._t.halt(),this},s.prototype.toString=function(){return"Transform"},s.prototype.getValue=function(){return{component:this.toString(),origin:this.origin&&this.origin.get(),mountPoint:this.mountPoint&&this.mountPoint.get(),align:this.align&&this.align.get(),scale:this.scale&&this.scale.get(),position:this.position&&this.position.get(),rotation:this.rotation&&this.rotation.get()}},s.prototype.setState=function(t){return this.toString()===t.component?(t.origin&&this.setOrigin(t.origin.x,t.origin.y,t.origin.z),t.mountPoint&&this.setMountPoint(t.mountPoint.x,t.mountPoint.y,t.mountPoint.z),t.align&&this.setAlign(t.align.x,t.align.y,t.align.z),t.scale&&this.setScale(t.scale.x,t.scale.y,t.scale.z),t.position&&this.setPosition(t.position.x,t.position.y,t.position.z),t.rotation&&this.setRotation(t.rotation.x,t.rotation.y,t.rotation.z,t.rotation.w),!0):!1},s.prototype.setOrigin=function(t,e,n,s,r){if(!this.origin){var o=this._node.getOrigin();this.origin=new i(o[0],o[1],o[2],this)}return this.origin.set(t,e,n,s,r),this},s.prototype.setMountPoint=function(t,e,n,s,r){if(!this.mountPoint){var o=this._node.getMountPoint();this.mountPoint=new i(o[0],o[1],o[2],this)}return this.mountPoint.set(t,e,n,s,r),this},s.prototype.setAlign=function(t,e,n,s,r){if(!this.align){var o=this._node.getAlign();this.align=new i(o[0],o[1],o[2],this)}return this.align.set(t,e,n,s,r),this},s.prototype.setScale=function(t,e,n,s,r){if(!this.scale){var o=this._node.getScale();this.scale=new i(o[0],o[1],o[2],this)}return this.scale.set(t,e,n,s,r),this},s.prototype.setPosition=function(t,e,n,s,r){if(!this.position){var o=this._node.getPosition();this.position=new i(o[0],o[1],o[2],this)}return this.position.set(t,e,n,s,r),this},s.prototype.translate=function(t,e,n,s,r){if(!this.position){var o=this._node.getPosition();this.position=new i(o[0],o[1],o[2],this)}var a=this.position,u=a.x._queue,h=a.y._queue,c=a.z._queue,l=null==t?null:t+(u.length>0?u[u.length-5]:a.x._state),p=null==e?null:e+(h.length>0?h[h.length-5]:a.y._state),d=null==n?null:n+(c.length>0?c[c.length-5]:a.z._state);return this.position.set(l,p,d,s,r),this},s.prototype.setRotation=function(t,e,i,s,r,o){if(!this.rotation){var u=this._node.getRotation();this.rotation=new n(u[0],u[1],u[2],u[3],this)}var h=a;return"number"==typeof s?h.set(s,t,e,i):(h.fromEuler(t,e,i),o=r,r=s),this.rotation.set(h.x,h.y,h.z,h.w,r,o),this},s.prototype.rotate=function(t,e,i,s,r,o){if(!this.rotation){var h=this._node.getRotation();this.rotation=new n(h[0],h[1],h[2],h[3],this)}var c,l,p=this.rotation._t._queue,d=p.length;l=0!==d?p[d-5]:this.rotation._t._state,c=u.set(l[3],l[0],l[1],l[2]);var f=a;"number"==typeof s?f.set(s,t,e,i):(f.fromEuler(t,e,i),o=r,r=s);var m=c.multiply(f);return this.rotation.set(m.x,m.y,m.z,m.w,r,o),this},s.prototype.clean=function(){var t,e=this._node,i=!1;if((t=this.origin)&&t._dirty&&(e.setOrigin(t.x.get(),t.y.get(),t.z.get()),t._dirty=t.isActive(),i=i||t._dirty),(t=this.mountPoint)&&t._dirty&&(e.setMountPoint(t.x.get(),t.y.get(),t.z.get()),t._dirty=t.isActive(),i=i||t._dirty),(t=this.align)&&t._dirty&&(e.setAlign(t.x.get(),t.y.get(),t.z.get()),t._dirty=t.isActive(),i=i||t._dirty),(t=this.scale)&&t._dirty&&(e.setScale(t.x.get(),t.y.get(),t.z.get()),t._dirty=t.isActive(),i=i||t._dirty),(t=this.position)&&t._dirty&&(e.setPosition(t.x.get(),t.y.get(),t.z.get()),t._dirty=t.isActive(),i=i||t._dirty),(t=this.rotation)&&t._dirty){var n=t.get();e.setRotation(n[0],n[1],n[2],n[3]),t._dirty=t.isActive(),i=i||t._dirty}i?this._node.requestUpdateOnNextTick(this._id):this._dirty=!1},s.prototype.onUpdate=s.prototype.clean,e.exports=s},{"../math/Quaternion":42,"../transitions/Transitionable":88}],12:[function(t,e){e.exports={Align:t("./Align"),Camera:t("./Camera"),GestureHandler:t("./GestureHandler"),MountPoint:t("./MountPoint"),Opacity:t("./Opacity"),Origin:t("./Origin"),Position:t("./Position"),Rotation:t("./Rotation"),Scale:t("./Scale"),Size:t("./Size"),Transform:t("./Transform")}},{"./Align":1,"./Camera":2,"./GestureHandler":3,"./MountPoint":4,"./Opacity":5,"./Origin":6,"./Position":7,"./Rotation":8,"./Scale":9,"./Size":10,"./Transform":11}],13:[function(t,e){function i(){"undefined"!=typeof self&&self.window!==self&&this._enterWorkerMode()}i.prototype._enterWorkerMode=function(){this._workerMode=!0;var t=this;self.addEventListener("message",function(e){t.onMessage(e.data)})},i.prototype.onMessage=null,i.prototype.sendMessage=function(t){this._workerMode?self.postMessage(t):this.onmessage(t)},i.prototype.onmessage=null,i.prototype.postMessage=function(t){return this.onMessage(t)},e.exports=i},{}],14:[function(t,e){function i(){this._time=0,this._frame=0,this._timerQueue=[],this._updatingIndex=0,this._scale=1,this._scaledTime=this._time}i.prototype.setScale=function(t){return this._scale=t,this},i.prototype.getScale=function(){return this._scale},i.prototype.step=function(t){this._frame++,this._scaledTime=this._scaledTime+(t-this._time)*this._scale,this._time=t;for(var e=0;e<this._timerQueue.length;e++)this._timerQueue[e](this._scaledTime)&&this._timerQueue.splice(e,1);return this},i.prototype.now=function(){return this._scaledTime},i.prototype.getTime=i.prototype.now,i.prototype.getFrame=function(){return this._frame},i.prototype.setTimeout=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,s=function(s){return s-n>=e?(t.apply(null,i),!0):!1};return this._timerQueue.push(s),s},i.prototype.setInterval=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,s=function(s){return s-n>=e&&(t.apply(null,i),n=s),!1};return this._timerQueue.push(s),s},i.prototype.clearTimer=function(t){var e=this._timerQueue.indexOf(t);return-1!==e&&this._timerQueue.splice(e,1),this},e.exports=i},{}],15:[function(t,e){function i(t){if(!t)throw new Error("Dispatch needs to be instantiated on a node");this._context=t,this._queue=[]}function n(t,e){e.length=0;var i,n=0,s=t.length;for(i=0;s>i;i++)"/"===t[i]&&(e.push(t.substring(n,i)),n=i+1);return i-n>0&&e.push(t.substring(n,i)),e}var s=t("./Event");i.prototype.lookupNode=function(t){if(!t)throw new Error("lookupNode must be called with a path");var e=this._queue;if(n(t,e),e[0]!==this._context.getSelector())return void 0;var i,s=this._context.getChildren(),r=1;for(e[0]=this._context;r<e.length;){if(i=s[e[r]],e[r]=i,!i)return void 0;s=i.getChildren(),r++}return i},i.prototype.dispatch=function(t,e){if(!t)throw new Error("dispatch requires an event name as it's first argument");var i,n,s,r,o=this._queue;for(o.length=0,o.push(this._context);o.length;)for(i=o.shift(),i.onReceive&&i.onReceive(t,e),r=i.getChildren(),n=0,s=r.length;s>n;n++)o.push(r[n])},i.prototype.dispatchUIEvent=function(t,e,i){if(!t)throw new Error("dispatchUIEvent needs a valid path to dispatch to");if(!e)throw new Error("dispatchUIEvent needs an event name as its second argument");var n,r=this._queue;for(s.call(i),i.node=this.lookupNode(t);r.length&&(n=r.pop(),n.onReceive&&n.onReceive(e,i),!i.propagationStopped););},e.exports=i},{"./Event":16}],16:[function(t,e){function i(){this.propagationStopped=!1,this.stopPropagation=n}function n(){this.propagationStopped=!0}e.exports=i},{}],17:[function(t,e){function i(){this._updateQueue=[],this._nextUpdateQueue=[],this._scenes={},this._messages=l,this._inUpdate=!1,this._clock=new n,this._channel=new r,this._channel.onMessage=this.handleMessage.bind(this)}var n=t("./Clock"),s=t("./Scene"),r=t("./Channel"),o=t("../renderers/UIManager"),a=t("../renderers/Compositor"),u=t("../render-loops/RequestAnimationFrameLoop"),h=["ENGINE","START"],c=["ENGINE","STOP"],l=["TIME",null];
i.prototype.init=function(t){return this.compositor=t&&t.compositor||new a,this.renderLoop=t&&t.renderLoop||new u,this.uiManager=new o(this.getChannel(),this.compositor,this.renderLoop),this},i.prototype.setChannel=function(t){return this._channel=t,this},i.prototype.getChannel=function(){return this._channel},i.prototype._update=function(){this._inUpdate=!0;var t,e=this._clock.now(),i=this._nextUpdateQueue,n=this._updateQueue;for(this._messages[1]=e;i.length;)n.unshift(i.pop());for(;n.length;)t=n.shift(),t&&t.onUpdate&&t.onUpdate(e);this._inUpdate=!1},i.prototype.requestUpdate=function(t){if(!t)throw new Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(t):this._updateQueue.push(t)},i.prototype.requestUpdateOnNextTick=function(t){this._nextUpdateQueue.push(t)},i.prototype.handleMessage=function(t){if(!t)throw new Error("onMessage must be called with an array of messages");for(var e;t.length>0;)switch(e=t.shift()){case"WITH":this.handleWith(t);break;case"FRAME":this.handleFrame(t);break;default:throw new Error("received unknown command: "+e)}return this},i.prototype.handleWith=function(t){var e=t.shift(),i=t.shift();switch(i){case"TRIGGER":var n=t.shift(),s=t.shift();this.getContext(e).getDispatch().dispatchUIEvent(e,n,s);break;default:throw new Error("received unknown command: "+i)}return this},i.prototype.handleFrame=function(t){if(!t)throw new Error("handleFrame must be called with an array of messages");if(!t.length)throw new Error("FRAME must be sent with a time");return this.step(t.shift()),this},i.prototype.step=function(t){if(null==t)throw new Error("step must be called with a time");return this._clock.step(t),this._update(),this._messages.length&&(this._channel.sendMessage(this._messages),this._messages.length=2),this},i.prototype.getContext=function(t){if(!t)throw new Error("getContext must be called with a selector");var e=t.indexOf("/");return t=-1===e?t:t.substring(0,e),this._scenes[t]},i.prototype.getClock=function(){return this._clock},i.prototype.message=function(t){return this._messages.push(t),this},i.prototype.createScene=function(t){return t=t||"body",this._scenes[t]&&this._scenes[t].dismount(),this._scenes[t]=new s(t,this),this._scenes[t]},i.prototype.startEngine=function(){return this._channel.sendMessage(h),this},i.prototype.stopEngine=function(){return this._channel.sendMessage(c),this},e.exports=new i},{"../render-loops/RequestAnimationFrameLoop":79,"../renderers/Compositor":82,"../renderers/UIManager":84,"./Channel":13,"./Clock":14,"./Scene":19}],18:[function(t,e){function i(){this._calculatedValues={transform:new Float32Array(a),size:new Float32Array(3)},this._requestingUpdate=!1,this._inUpdate=!1,this._updateQueue=[],this._nextUpdateQueue=[],this._freedComponentIndicies=[],this._components=[],this._freedChildIndicies=[],this._children=[],this._parent=null,this._globalUpdater=null,this._lastEulerX=0,this._lastEulerY=0,this._lastEulerZ=0,this._lastEuler=!1,this.value=new i.Spec}var n=t("./Transform"),s=t("./Size"),r=new n,o=new s,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[1,1,1],h=[0,0,0,1];i.RELATIVE_SIZE=s.RELATIVE,i.ABSOLUTE_SIZE=s.ABSOLUTE,i.RENDER_SIZE=s.RENDER,i.DEFAULT_SIZE=s.DEFAULT,i.Spec=function(){this.location=null,this.showState={mounted:!1,shown:!1,opacity:1},this.offsets={mountPoint:new Float32Array(3),align:new Float32Array(3),origin:new Float32Array(3)},this.vectors={position:new Float32Array(3),rotation:new Float32Array(h),scale:new Float32Array(u)},this.size={sizeMode:new Float32Array([s.RELATIVE,s.RELATIVE,s.RELATIVE]),proportional:new Float32Array(u),differential:new Float32Array(3),absolute:new Float32Array(3),render:new Float32Array(3)},this.UIEvents=[]},i.prototype.getLocation=function(){return this.value.location},i.prototype.getId=i.prototype.getLocation,i.prototype.emit=function(t,e){for(var i=this;i!==i.getParent();)i=i.getParent();return i.getDispatch().dispatch(t,e),this},i.prototype.sendDrawCommand=function(t){return this._globalUpdater.message(t),this},i.prototype.getValue=function(){for(var t=this._children.length,e=this._components.length,i=0,n={location:this.value.location,spec:this.value,components:new Array(e),children:new Array(t)};t>i;i++)this._children[i]&&this._children[i].getValue&&(n.children[i]=this._children[i].getValue());for(i=0;e>i;i++)this._components[i]&&this._components[i].getValue&&(n.components[i]=this._components[i].getValue());return n},i.prototype.getComputedValue=function(){for(var t=this._children.length,e={location:this.value.location,computedValues:this._calculatedValues,children:new Array(t)},i=0;t>i;i++)e.children[i]=this._children[i].getComputedValue();return e},i.prototype.getChildren=function(){return this._children},i.prototype.getParent=function(){return this._parent},i.prototype.requestUpdate=function(t){return this._inUpdate||!this.isMounted()?this.requestUpdateOnNextTick(t):(this._updateQueue.push(t),this._requestingUpdate||this._requestUpdate(),this)},i.prototype.requestUpdateOnNextTick=function(t){return this._nextUpdateQueue.push(t),this},i.prototype.getUpdater=function(){return this._globalUpdater},i.prototype.isMounted=function(){return this.value.showState.mounted},i.prototype.isShown=function(){return this.value.showState.shown},i.prototype.getOpacity=function(){return this.value.showState.opacity},i.prototype.getMountPoint=function(){return this.value.offsets.mountPoint},i.prototype.getAlign=function(){return this.value.offsets.align},i.prototype.getOrigin=function(){return this.value.offsets.origin},i.prototype.getPosition=function(){return this.value.vectors.position},i.prototype.getRotation=function(){return this.value.vectors.rotation},i.prototype.getScale=function(){return this.value.vectors.scale},i.prototype.getSizeMode=function(){return this.value.size.sizeMode},i.prototype.getProportionalSize=function(){return this.value.size.proportional},i.prototype.getDifferentialSize=function(){return this.value.size.differential},i.prototype.getAbsoluteSize=function(){return this.value.size.absolute},i.prototype.getRenderSize=function(){return this.value.size.render},i.prototype.getSize=function(){return this._calculatedValues.size},i.prototype.getTransform=function(){return this._calculatedValues.transform},i.prototype.getUIEvents=function(){return this.value.UIEvents},i.prototype.addChild=function(t){var e=t?this._children.indexOf(t):-1;if(t=t?t:new i,-1===e&&(e=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[e]=t,this.isMounted()&&t.onMount)){var n=this.getId(),s=n+"/"+e;t.onMount(this,s)}return t},i.prototype.removeChild=function(t){var e=this._children.indexOf(t),i=-1!==e;return i&&(this._freedChildIndicies.push(e),this._children[e]=null,this.isMounted()&&t.onDismount&&t.onDismount()),i},i.prototype.addComponent=function(t){var e=this._components.indexOf(t);return-1===e&&(e=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length,this._components[e]=t,this.isMounted()&&t.onMount&&t.onMount(this,e),this.isShown()&&t.onShow&&t.onShow()),e},i.prototype.getComponent=function(t){return this._components[t]},i.prototype.removeComponent=function(t){var e=this._components.indexOf(t);return-1!==e&&(this._freedComponentIndicies.push(e),this.isShown()&&t.onHide&&t.onHide(),this.isMounted()&&t.onDismount&&t.onDismount(),this._components[e]=null),t},i.prototype.addUIEvent=function(t){var e,i=this.getUIEvents(),n=this._components,s=-1!==i.indexOf(t);if(!s){i.push(t);for(var r=0,o=n.length;o>r;r++)e=n[r],e&&e.onAddUIEvent&&e.onAddUIEvent(t)}},i.prototype._requestUpdate=function(t){(t||!this._requestingUpdate&&this._globalUpdater)&&(this._globalUpdater.requestUpdate(this),this._requestingUpdate=!0)},i.prototype._vecOptionalSet=function(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,this._requestingUpdate||this._requestUpdate(),!0):!1},i.prototype.show=function(){var t,e=0,i=this._components,n=i.length;for(this.value.showState.shown=!0;n>e;e++)t=i[e],t&&t.onShow&&t.onShow();for(e=0,i=this._children,n=i.length;n>e;e++)t=i[e],t&&t.onParentShow&&t.onParentShow();return this},i.prototype.hide=function(){var t,e=0,i=this._components,n=i.length;for(this.value.showState.shown=!1;n>e;e++)t=i[e],t&&t.onHide&&t.onHide();for(e=0,i=this._children,n=i.length;n>e;e++)t=i[e],t&&t.onParentHide&&t.onParentHide();return this},i.prototype.setAlign=function(t,e,i){var n=this.value.offsets.align,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,null!=i&&(s=this._vecOptionalSet(n,2,i-.5)||s),s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onAlignChange&&r.onAlignChange(t,e,i)}return this},i.prototype.setMountPoint=function(t,e,i){var n=this.value.offsets.mountPoint,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,null!=i&&(s=this._vecOptionalSet(n,2,i-.5)||s),s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onMountPointChange&&r.onMountPointChange(t,e,i)}return this},i.prototype.setOrigin=function(t,e,i){var n=this.value.offsets.origin,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,null!=i&&(s=this._vecOptionalSet(n,2,i-.5)||s),s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onOriginChange&&r.onOriginChange(t,e,i)}return this},i.prototype.setPosition=function(t,e,i){var n=this.value.vectors.position,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,s=this._vecOptionalSet(n,2,i)||s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onPositionChange&&r.onPositionChange(t,e,i)}return this},i.prototype.setRotation=function(t,e,i,n){var s,r,o,a,u=this.value.vectors.rotation,h=!1;if(null!=n)s=t,r=e,o=i,a=n,this._lastEulerX=null,this._lastEulerY=null,this._lastEulerZ=null,this._lastEuler=!1;else{if(null==t||null==e||null==i)if(this._lastEuler)t=null==t?this._lastEulerX:t,e=null==e?this._lastEulerY:e,i=null==i?this._lastEulerZ:i;else{var c=-2*(u[1]*u[2]-u[3]*u[0]);Math.abs(c)>.99999?(e=null==e?.5*Math.PI*c:e,t=null==t?Math.atan2(-u[0]*u[2]+u[3]*u[1],.5-u[1]*u[1]-u[2]*u[2]):t,i=null==i?0:i):(e=null==e?Math.asin(c):e,t=null==t?Math.atan2(u[0]*u[2]+u[3]*u[1],.5-u[0]*u[0]-u[1]*u[1]):t,i=null==i?Math.atan2(u[0]*u[1]+u[3]*u[2],.5-u[0]*u[0]-u[2]*u[2]):i)}var l=.5*t,p=.5*e,d=.5*i,f=Math.sin(l),m=Math.sin(p),_=Math.sin(d),g=Math.cos(l),v=Math.cos(p),y=Math.cos(d),b=m*_,x=v*_,w=m*y,E=v*y;s=f*E+g*b,r=g*w-f*x,o=g*x+f*w,a=g*E-f*b,this._lastEuler=!0,this._lastEulerX=t,this._lastEulerY=e,this._lastEulerZ=i}if(h=this._vecOptionalSet(u,0,s)||h,h=this._vecOptionalSet(u,1,r)||h,h=this._vecOptionalSet(u,2,o)||h,h=this._vecOptionalSet(u,3,a)||h){var S,T=0,C=this._components,A=C.length;for(t=u[0],e=u[1],i=u[2],n=u[3];A>T;T++)S=C[T],S&&S.onRotationChange&&S.onRotationChange(t,e,i,n)}return this},i.prototype.setScale=function(t,e,i){var n=this.value.vectors.scale,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,s=this._vecOptionalSet(n,2,i)||s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onScaleChange&&r.onScaleChange(t,e,i)}return this},i.prototype.setOpacity=function(t){if(t!==this.value.showState.opacity){this.value.showState.opacity=t,this._requestingUpdate||this._requestUpdate();for(var e,i=0,n=this._components,s=n.length;s>i;i++)e=n[i],e&&e.onOpacityChange&&e.onOpacityChange(t)}return this},i.prototype.setSizeMode=function(t,e,i){var n=this.value.size.sizeMode,s=!1;if(null!=t&&(s=this._resolveSizeMode(n,0,t)||s),null!=e&&(s=this._resolveSizeMode(n,1,e)||s),null!=i&&(s=this._resolveSizeMode(n,2,i)||s),s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onSizeModeChange&&r.onSizeModeChange(t,e,i)}return this},i.prototype._resolveSizeMode=function(t,e,i){if(i.constructor!==String)return this._vecOptionalSet(t,e,i);switch(i.toLowerCase()){case"relative":case"default":return this._vecOptionalSet(t,e,0);case"absolute":return this._vecOptionalSet(t,e,1);case"render":return this._vecOptionalSet(t,e,2);default:throw new Error("unknown size mode: "+i)}},i.prototype.setProportionalSize=function(t,e,i){var n=this.value.size.proportional,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,s=this._vecOptionalSet(n,2,i)||s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onProportionalSizeChange&&r.onProportionalSizeChange(t,e,i)}return this},i.prototype.setDifferentialSize=function(t,e,i){var n=this.value.size.differential,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,s=this._vecOptionalSet(n,2,i)||s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onDifferentialSizeChange&&r.onDifferentialSizeChange(t,e,i)}return this},i.prototype.setAbsoluteSize=function(t,e,i){var n=this.value.size.absolute,s=!1;if(s=this._vecOptionalSet(n,0,t)||s,s=this._vecOptionalSet(n,1,e)||s,s=this._vecOptionalSet(n,2,i)||s){var r,o=0,a=this._components,u=a.length;for(t=n[0],e=n[1],i=n[2];u>o;o++)r=a[o],r&&r.onAbsoluteSizeChange&&r.onAbsoluteSizeChange(t,e,i)}return this},i.prototype._transformChanged=function(t){for(var e,i=0,n=this._components,s=n.length;s>i;i++)e=n[i],e&&e.onTransformChange&&e.onTransformChange(t);for(i=0,n=this._children,s=n.length;s>i;i++)e=n[i],e&&e.onParentTransformChange&&e.onParentTransformChange(t)},i.prototype._sizeChanged=function(t){for(var e,i=0,n=this._components,s=n.length;s>i;i++)e=n[i],e&&e.onSizeChange&&e.onSizeChange(t);for(i=0,n=this._children,s=n.length;s>i;i++)e=n[i],e&&e.onParentSizeChange&&e.onParentSizeChange(t)},i.prototype.getFrame=function(){return this._globalUpdater.getFrame()},i.prototype.getComponents=function(){return this._components},i.prototype.update=function(t){this._inUpdate=!0;for(var e,i=this._nextUpdateQueue,n=this._updateQueue;i.length;)n.unshift(i.pop());for(;n.length;)e=this._components[n.shift()],e&&e.onUpdate&&e.onUpdate(t);var s=this.getSize(),a=this.getTransform(),u=this.getParent(),h=u.getSize(),c=u.getTransform(),l=o.fromSpecWithParent(h,this,s),p=r.fromSpecWithParent(c,this.value,s,h,a);return p&&this._transformChanged(a),l&&this._sizeChanged(s),this._inUpdate=!1,this._requestingUpdate=!1,this.isMounted()?this._nextUpdateQueue.length&&(this._globalUpdater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):(this._parent=null,this.value.location=null,this._globalUpdater=null),this},i.prototype.mount=function(t,e){if(this.isMounted())return this;var i,n=0,s=this._components,r=s.length;for(this._parent=t,this._globalUpdater=t.getUpdater(),this.value.location=e,this.value.showState.mounted=!0;r>n;n++)i=s[n],i&&i.onMount&&i.onMount(this,n);for(n=0,s=this._children,r=s.length;r>n;n++)i=s[n],i&&i.onParentMount&&i.onParentMount(this,e,n);return this._requestingUpdate||this._requestUpdate(!0),this},i.prototype.dismount=function(){if(!this.isMounted())return this;var t,e=0,i=this._components,n=i.length;for(this.value.showState.mounted=!1,this._parent.removeChild(this);n>e;e++)t=i[e],t&&t.onDismount&&t.onDismount();for(e=0,i=this._children,n=i.length;n>e;e++)t=i[e],t&&t.onParentDismount&&t.onParentDismount();return this._requestingUpdate||this._requestUpdate(),this},i.prototype.onParentMount=function(t,e,i){return this.mount(t,e+"/"+i)},i.prototype.onParentDismount=function(){return this.dismount()},i.prototype.receive=function(t,e){for(var i,n=0,s=this._components,r=s.length;r>n;n++)i=s[n],i&&i.onReceive&&i.onReceive(t,e);return this},i.prototype._requestUpdateWithoutArgs=function(){this._requestingUpdate||this._requestUpdate()},i.prototype.onUpdate=i.prototype.update,i.prototype.onParentShow=i.prototype.show,i.prototype.onParentHide=i.prototype.hide,i.prototype.onParentTransformChange=i.prototype._requestUpdateWithoutArgs,i.prototype.onParentSizeChange=i.prototype._requestUpdateWithoutArgs,i.prototype.onShow=i.prototype.show,i.prototype.onHide=i.prototype.hide,i.prototype.onMount=i.prototype.mount,i.prototype.onDismount=i.prototype.dismount,i.prototype.onReceive=i.prototype.receive,e.exports=i},{"./Size":20,"./Transform":21}],19:[function(t,e){function i(t,e){if(!t)throw new Error("Scene needs to be created with a DOM selector");if(!e)throw new Error("Scene needs to be created with a class like Famous");s.call(this),this._updater=e,this._dispatch=new n(this),this._selector=t,this.onMount(this,t),this._updater.message("NEED_SIZE_FOR").message(t),this.show()}var n=t("./Dispatch"),s=t("./Node"),r=t("./Size");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,i.prototype.getUpdater=function(){return this._updater},i.prototype.getSelector=function(){return this._selector},i.prototype.getDispatch=function(){return this._dispatch},i.prototype.onReceive=function(t,e){if("CONTEXT_RESIZE"===t){if(e.length<2)throw new Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode(r.ABSOLUTE,r.ABSOLUTE,r.ABSOLUTE),this.setAbsoluteSize(e[0],e[1],e[2]?e[2]:0)}},e.exports=i},{"./Dispatch":15,"./Node":18,"./Size":20}],20:[function(t,e){function i(){this._size=new Float32Array(3)}i.RELATIVE=0,i.ABSOLUTE=1,i.RENDER=2,i.DEFAULT=i.RELATIVE,i.prototype.fromSpecWithParent=function(t,e,n){for(var s,r,o=e.getValue().spec,a=e.getComponents(),u=o.size.sizeMode,h=!1,c=a.length,l=0;3>l;l++){switch(u[l]){case i.RELATIVE:s=n[l],n[l]=t[l]*o.size.proportional[l]+o.size.differential[l];break;case i.ABSOLUTE:s=n[l],n[l]=o.size.absolute[l];break;case i.RENDER:var p;for(r=0;c>r;r++)a[r].getRenderSize&&(p=a[r].getRenderSize()[l],s=n[l],n[l]=n[l]<p||0===n[l]?p:n[l])}h=h||s!==n[l]}return h},e.exports=i},{}],21:[function(t,e){function i(){this._matrix=new Float32Array(16)}i.prototype.get=function(){return this._matrix},i.prototype.fromSpecWithParent=function(t,e,i,n,s){s=s?s:this._matrix;var r=s[0],o=s[1],a=s[2],u=s[4],h=s[5],c=s[6],l=s[8],p=s[9],d=s[10],f=s[12],m=s[13],_=s[14],g=t[0],v=t[1],y=t[2],b=t[4],x=t[5],w=t[6],E=t[8],S=t[9],T=t[10],C=t[12],A=t[13],P=t[14],O=e.vectors.position[0],R=e.vectors.position[1],I=e.vectors.position[2],M=e.vectors.rotation[0],D=e.vectors.rotation[1],L=e.vectors.rotation[2],j=e.vectors.rotation[3],N=e.vectors.scale[0],U=e.vectors.scale[1],k=e.vectors.scale[2],z=e.offsets.align[0]*n[0],F=e.offsets.align[1]*n[1],q=e.offsets.align[2]*n[2],V=e.offsets.mountPoint[0]*i[0],G=e.offsets.mountPoint[1]*i[1],H=e.offsets.mountPoint[2]*i[2],B=e.offsets.origin[0]*i[0],W=e.offsets.origin[1]*i[1],K=e.offsets.origin[2]*i[2],Q=j*M,X=j*D,Y=j*L,J=M*M,$=D*D,Z=L*L,te=M*D,ee=M*L,ie=D*L,ne=(1-2*($+Z))*N,se=2*(te+Y)*N,re=2*(ee-X)*N,oe=2*(te-Y)*U,ae=(1-2*(J+Z))*U,ue=2*(ie+Q)*U,he=2*(ee+X)*k,ce=2*(ie-Q)*k,le=(1-2*(J+$))*k,pe=z+O-V+B-(ne*B+oe*W+he*K),de=F+R-G+W-(se*B+ae*W+ce*K),fe=q+I-H+K-(re*B+ue*W+le*K);return s[0]=g*ne+b*se+E*re,s[1]=v*ne+x*se+S*re,s[2]=y*ne+w*se+T*re,s[3]=0,s[4]=g*oe+b*ae+E*ue,s[5]=v*oe+x*ae+S*ue,s[6]=y*oe+w*ae+T*ue,s[7]=0,s[8]=g*he+b*ce+E*le,s[9]=v*he+x*ce+S*le,s[10]=y*he+w*ce+T*le,s[11]=0,s[12]=g*pe+b*de+E*fe+C,s[13]=v*pe+x*de+S*fe+A,s[14]=y*pe+w*de+T*fe+P,s[15]=1,r!==s[0]||o!==s[1]||a!==s[2]||u!==s[4]||h!==s[5]||c!==s[6]||l!==s[8]||p!==s[9]||d!==s[10]||f!==s[12]||m!==s[13]||_!==s[14]},e.exports=i},{}],22:[function(t,e){e.exports={Clock:t("./Clock"),Event:t("./Event"),Scene:t("./Scene"),FamousEngine:t("./FamousEngine"),Dispatch:t("./Dispatch"),Node:t("./Node"),Size:t("./Size"),Transform:t("./Transform")}},{"./Clock":14,"./Dispatch":15,"./Event":16,"./FamousEngine":17,"./Node":18,"./Scene":19,"./Size":20,"./Transform":21}],23:[function(t,e){function i(t,e){if(!t)throw new Error("DOMElement must be instantiated on a node");if(this._node=t,this._parent=null,this._children=[],this._requestingUpdate=!1,this._renderSized=!1,this._requestRenderSize=!1,this._changeQueue=[],this._UIEvents=t.getUIEvents().slice(0),this._classes=["famous-dom-element"],this._requestingEventListeners=[],this._styles={},this.setProperty("display",t.isShown()?"none":"block"),this.onOpacityChange(t.getOpacity()),this._attributes={},this._content="",this._tagName=e&&e.tagName?e.tagName:"div",this._id=t?t.addComponent(this):null,this._renderSize=[0,0,0],this._callbacks=new n,e){var i,s;if(e.classes)for(i=0;i<e.classes.length;i++)this.addClass(e.classes[i]);if(e.attributes)for(s in e.attributes)this.setAttribute(s,e.attributes[s]);if(e.properties)for(s in e.properties)this.setProperty(s,e.properties[s]);e.id&&this.setId(e.id),e.content&&this.setContent(e.content),e.cutout===!1&&this.setCutoutState(e.cutout)}}var n=t("../utilities/CallbackStore"),s=2;i.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}},i.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue,i=e.length;if(i&&t){for(t.sendDrawCommand("WITH"),t.sendDrawCommand(t.getLocation());i--;)t.sendDrawCommand(e.shift());this._requestRenderSize&&(t.sendDrawCommand("DOM_RENDER_SIZE"),t.sendDrawCommand(t.getLocation()),this._requestRenderSize=!1)}this._requestingUpdate=!1},i.prototype._setParent=function(t){if(!this._node)throw new Error("_setParent called on an Element that isn't in the scene graph");var e=this._node.getLocation();if(e===t||-1===e.indexOf(t))throw new Error("The given path isn't an ancestor");this._parent=t},i.prototype._addChild=function(t){if(!this._node)throw new Error("_addChild called on an Element that isn't in the scene graph");var e=this._node.getLocation();if(t===e||-1===t.indexOf(e))throw new Error("The given path isn't a descendent");if(-1!==this._children.indexOf(t))throw new Error("The given path is already a child of this element");this._children.push(t)},i.prototype._getParent=function(){return this._parent},i.prototype._getChildren=function(){return this._children},i.prototype.onMount=function(t,e){this._node=t,this._id=e,this._UIEvents=t.getUIEvents().slice(0),this.draw(),this.setAttribute("data-fa-path",t.getLocation())},i.prototype.onDismount=function(){this.setProperty("display","none"),this.setAttribute("data-fa-path",""),this._initialized=!1},i.prototype.onShow=function(){this.setProperty("display","block")},i.prototype.onHide=function(){this.setProperty("display","none")},i.prototype.setCutoutState=function(t){this._changeQueue.push("GL_CUTOUT_STATE",t),this._initialized&&this._requestUpdate()},i.prototype.onTransformChange=function(t){this._changeQueue.push("CHANGE_TRANSFORM");for(var e=0,i=t.length;i>e;e++)this._changeQueue.push(t[e]);this.onUpdate()},i.prototype.onSizeChange=function(t){var e=this._node.getSizeMode(),i=e[0]!==s,n=e[1]!==s;return this._initialized&&this._changeQueue.push("CHANGE_SIZE",i?t[0]:i,n?t[1]:n),this._requestingUpdate||this._requestUpdate(),this},i.prototype.onOpacityChange=function(t){return this.setProperty("opacity",t)},i.prototype.onAddUIEvent=function(t){return-1===this._UIEvents.indexOf(t)?(this._subscribe(t),this._UIEvents.push(t)):this._inDraw&&this._subscribe(t),this},i.prototype._subscribe=function(t){this._initialized&&this._changeQueue.push("SUBSCRIBE",t,!0),this._requestingUpdate||this._requestUpdate(),this._requestingUpdate||this._requestUpdate()},i.prototype.onSizeModeChange=function(t,e,i){(t===s||e===s||i===s)&&(this._renderSized=!0,this._requestRenderSize=!0),this.onSizeChange(this._node.getSize())},i.prototype.getRenderSize=function(){return this._renderSize},i.prototype._requestUpdate=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},i.prototype.init=function(){this._changeQueue.push("INIT_DOM",this._tagName),this._initialized=!0,this.onTransformChange(this._node.getTransform()),this.onSizeChange(this._node.getSize()),this._requestingUpdate||this._requestUpdate()},i.prototype.setId=function(t){return this.setAttribute("id",t),this},i.prototype.addClass=function(t){return this._classes.indexOf(t)<0?(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._classes.push(t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this):(this._inDraw&&(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._requestingUpdate||this._requestUpdate()),this)},i.prototype.removeClass=function(t){var e=this._classes.indexOf(t);return 0>e?this:(this._changeQueue.push("REMOVE_CLASS",t),this._classes.splice(e,1),this._requestingUpdate||this._requestUpdate(),this)},i.prototype.hasClass=function(t){return-1!==this._classes.indexOf(t)},i.prototype.setAttribute=function(t,e){return(this._attributes[t]!==e||this._inDraw)&&(this._attributes[t]=e,this._initialized&&this._changeQueue.push("CHANGE_ATTRIBUTE",t,e),this._requestUpdate||this._requestUpdate()),this},i.prototype.setProperty=function(t,e){return(this._styles[t]!==e||this._inDraw)&&(this._styles[t]=e,this._initialized&&this._changeQueue.push("CHANGE_PROPERTY",t,e),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},i.prototype.setContent=function(t){return(this._content!==t||this._inDraw)&&(this._content=t,this._initialized&&this._changeQueue.push("CHANGE_CONTENT",t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},i.prototype.on=function(t,e){return this._callbacks.on(t,e)},i.prototype.onReceive=function(t,e){"resize"===t&&(this._renderSize[0]=e.val[0],this._renderSize[1]=e.val[1],this._requestingUpdate||this._requestUpdate()),this._callbacks.trigger(t,e)},i.prototype.draw=function(){var t,e,i;for(this._inDraw=!0,this.init(),e=0,i=this._classes.length;i>e;e++)this.addClass(this._classes[e]);this._content&&this.setContent(this._content);for(t in this._styles)this._styles[t]&&this.setProperty(t,this._styles[t]);for(t in this._attributes)this._attributes[t]&&this.setAttribute(t,this._attributes[t]);for(e=0,i=this._UIEvents.length;i>e;e++)this.onAddUIEvent(this._UIEvents[e]);this._inDraw=!1},e.exports=i},{"../utilities/CallbackStore":90}],24:[function(t,e){e.exports={DOMElement:t("./DOMElement")}},{"./DOMElement":23}],25:[function(t,e){function i(t,e,i){t.classList.add("famous-dom-renderer"),u=u||o("transform"),this._compositor=i,this._target=null,this._parent=null,this._path=null,this._children=[],this._root=new s(t,e),this._boundTriggerEvent=this._triggerEvent.bind(this),this._selector=e,this._elements={},this._elements[e]=this._root,this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._size=[null,null]}function n(t){for(var e=[],i=t.target;i!==document.body;)e.push(i),i=i.parentNode;return e}var s=t("./ElementCache"),r=t("./Math"),o=t("../utilities/vendorPrefix"),a=t("./events/EventMap"),u=null;i.prototype.subscribe=function(t,e){if(this._assertTargetLoaded(),this._target.preventDefault[t]=e,this._target.subscribe[t]=!0,!this._target.listeners[t]&&!this._root.listeners[t]){var i=a[t][1]?this._root:this._target;i.listeners[t]=this._boundTriggerEvent,i.element.addEventListener(t,this._boundTriggerEvent)}},i.prototype._triggerEvent=function(t){for(var e=t.path?t.path:n(t),i=0;i<e.length;i++)if(e[i].dataset){var s=e[i].dataset.faPath;if(s&&this._elements[s].subscribe[t.type]){t.stopPropagation(),this._elements[s].preventDefault[t.type]&&t.preventDefault();var r=a[t.type][0];this._compositor.sendEvent(s,t.type,new r(t));break}}},i.prototype.getSizeOf=function(t){var e=this._elements[t];if(!e)return null;var i={val:e.size};return this._compositor.sendEvent(t,"resize",i),i},i.prototype.getSize=function(){return this._size[0]=this._root.element.offsetWidth,this._size[1]=this._root.element.offsetHeight,this._size},i.prototype._getSize=i.prototype.getSize,i.prototype.draw=function(t){t.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=t.perspectiveTransform[0],this.perspectiveTransform[1]=t.perspectiveTransform[1],this.perspectiveTransform[2]=t.perspectiveTransform[2],this.perspectiveTransform[3]=t.perspectiveTransform[3],this.perspectiveTransform[4]=t.perspectiveTransform[4],this.perspectiveTransform[5]=t.perspectiveTransform[5],this.perspectiveTransform[6]=t.perspectiveTransform[6],this.perspectiveTransform[7]=t.perspectiveTransform[7],this.perspectiveTransform[8]=t.perspectiveTransform[8],this.perspectiveTransform[9]=t.perspectiveTransform[9],this.perspectiveTransform[10]=t.perspectiveTransform[10],this.perspectiveTransform[11]=t.perspectiveTransform[11],this.perspectiveTransform[12]=t.perspectiveTransform[12],this.perspectiveTransform[13]=t.perspectiveTransform[13],this.perspectiveTransform[14]=t.perspectiveTransform[14],this.perspectiveTransform[15]=t.perspectiveTransform[15]),(t.viewDirty||t.perspectiveDirty)&&(r.multiply(this._VPtransform,this.perspectiveTransform,t.viewTransform),this._root.element.style[u]=this._stringifyMatrix(this._VPtransform))},i.prototype._assertPathLoaded=function(){if(!this._path)throw new Error("path not loaded")},i.prototype._assertParentLoaded=function(){if(!this._parent)throw new Error("parent not loaded")},i.prototype._assertChildrenLoaded=function(){if(!this._children)throw new Error("children not loaded")},i.prototype._assertTargetLoaded=function(){if(!this._target)throw new Error("No target loaded")},i.prototype.findParent=function(){this._assertPathLoaded();for(var t,e=this._path;!t&&e.length;)e=e.substring(0,e.lastIndexOf("/")),t=this._elements[e];return this._parent=t,t},i.prototype.findChildren=function(t){this._assertPathLoaded();var e,i=this._path+"/",n=Object.keys(this._elements),s=0;for(t=t?t:this._children,this._children.length=0;s<n.length;)-1===n[s].indexOf(i)||n[s]===i?n.splice(s,1):s++;var r,o=0;for(s=0;s<n.length;s++)for(r=n[s],o=0;o<n.length;o++)s!==o&&-1!==n[o].indexOf(r)&&(n.splice(o,1),s--);for(s=0,e=n.length;e>s;s++)t[s]=this._elements[n[s]];return t},i.prototype.findTarget=function(){return this._target=this._elements[this._path],this._target},i.prototype.loadPath=function(t){return this._path=t,this._path},i.prototype.insertEl=function(t){if(!this._target||this._target.element.tagName.toLowerCase()===t.toLowerCase()){this.findParent(),this.findChildren(),this._assertParentLoaded(),this._assertChildrenLoaded(),this._target&&this._parent.element.removeChild(this._target.element),this._target=new s(document.createElement(t),this._path),this._parent.element.appendChild(this._target.element),this._elements[this._path]=this._target;for(var e=0,i=this._children.length;i>e;e++)this._target.element.appendChild(this._children[e].element)}},i.prototype.setProperty=function(t,e){this._assertTargetLoaded(),this._target.element.style[t]=e},i.prototype.setSize=function(t,e){this._assertTargetLoaded(),this.setWidth(t),this.setHeight(e)},i.prototype.setWidth=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitWidth=!0,e&&(e.style.width=""),t=e?e.offsetWidth:0,this._target.element.style.width=t+"px"):(this._target.explicitWidth=!1,e&&(e.style.width=t+"px"),this._target.element.style.width=t+"px"),this._target.size[0]=t},i.prototype.setHeight=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitHeight=!0,e&&(e.style.height=""),t=e?e.offsetHeight:0,this._target.element.style.height=t+"px"):(this._target.explicitHeight=!1,e&&(e.style.height=t+"px"),this._target.element.style.height=t+"px"),this._target.size[1]=t},i.prototype.setAttribute=function(t,e){this._assertTargetLoaded(),this._target.element.setAttribute(t,e)},i.prototype.setContent=function(t){this._assertTargetLoaded(),this.findChildren(),this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=t,this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?!1:this._target.size[1])},i.prototype.setMatrix=function(t){this._assertTargetLoaded(),this.findParent();
var e,i,n=this._target.worldTransform,s=!1;if(t)for(e=0,i=16;i>e;e++)s=s?s:n[e]===t[e],n[e]=t[e];else s=!0;if(s){r.invert(this._target.invertedParent,this._parent.worldTransform),r.multiply(this._target.finalTransform,this._target.invertedParent,n);var o=this.findChildren([]),a=this._path,h=this._target;for(e=0,i=o.length;i>e;e++)this._target=o[e],this._path=this._target.path,this.setMatrix();this._path=a,this._target=h}this._target.element.style[u]=this._stringifyMatrix(this._target.finalTransform)},i.prototype.addClass=function(t){this._assertTargetLoaded(),this._target.element.classList.add(t)},i.prototype.removeClass=function(t){this._assertTargetLoaded(),this._target.element.classList.remove(t)},i.prototype._stringifyMatrix=function(t){var e="matrix3d(";return e+=t[0]<1e-6&&t[0]>-1e-6?"0,":t[0]+",",e+=t[1]<1e-6&&t[1]>-1e-6?"0,":t[1]+",",e+=t[2]<1e-6&&t[2]>-1e-6?"0,":t[2]+",",e+=t[3]<1e-6&&t[3]>-1e-6?"0,":t[3]+",",e+=t[4]<1e-6&&t[4]>-1e-6?"0,":t[4]+",",e+=t[5]<1e-6&&t[5]>-1e-6?"0,":t[5]+",",e+=t[6]<1e-6&&t[6]>-1e-6?"0,":t[6]+",",e+=t[7]<1e-6&&t[7]>-1e-6?"0,":t[7]+",",e+=t[8]<1e-6&&t[8]>-1e-6?"0,":t[8]+",",e+=t[9]<1e-6&&t[9]>-1e-6?"0,":t[9]+",",e+=t[10]<1e-6&&t[10]>-1e-6?"0,":t[10]+",",e+=t[11]<1e-6&&t[11]>-1e-6?"0,":t[11]+",",e+=t[12]<1e-6&&t[12]>-1e-6?"0,":t[12]+",",e+=t[13]<1e-6&&t[13]>-1e-6?"0,":t[13]+",",e+=t[14]<1e-6&&t[14]>-1e-6?"0,":t[14]+",",e+=t[15]+")"},e.exports=i},{"../utilities/vendorPrefix":100,"./ElementCache":26,"./Math":27,"./events/EventMap":30}],26:[function(t,e){function i(t,e){this.element=t,this.path=e,this.content=null,this.size=new Int16Array(3),this.explicitHeight=!1,this.explicitWidth=!1,this.worldTransform=new Float32Array(n),this.invertedParent=new Float32Array(n),this.finalTransform=new Float32Array(n),this.postRenderSize=new Float32Array(2),this.listeners={},this.preventDefault={},this.subscribe={}}var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.exports=i},{}],27:[function(t,e){function i(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],_=e[14],g=e[15],v=i*a-n*o,y=i*u-s*o,b=i*h-r*o,x=n*u-s*a,w=n*h-r*a,E=s*h-r*u,S=c*m-l*f,T=c*_-p*f,C=c*g-d*f,A=l*_-p*m,P=l*g-d*m,O=p*g-d*_,R=v*O-y*P+b*A+x*C-w*T+E*S;return R?(R=1/R,t[0]=(a*O-u*P+h*A)*R,t[1]=(s*P-n*O-r*A)*R,t[2]=(m*E-_*w+g*x)*R,t[3]=(p*w-l*E-d*x)*R,t[4]=(u*C-o*O-h*T)*R,t[5]=(i*O-s*C+r*T)*R,t[6]=(_*b-f*E-g*y)*R,t[7]=(c*E-p*b+d*y)*R,t[8]=(o*P-a*C+h*S)*R,t[9]=(n*C-i*P-r*S)*R,t[10]=(f*w-m*b+g*v)*R,t[11]=(l*b-c*w-d*v)*R,t[12]=(a*T-o*A-u*S)*R,t[13]=(i*A-n*T+s*S)*R,t[14]=(m*y-f*x-_*v)*R,t[15]=(c*x-l*y+p*v)*R,t):null}function n(t,e,i){var n,s,r,o,a=e[0],u=e[1],h=e[2],c=e[3],l=e[4],p=e[5],d=e[6],f=e[7],m=e[8],_=e[9],g=e[10],v=e[11],y=e[12],b=e[13],x=e[14],w=e[15],E=i[0],S=i[1],T=i[2],C=i[3],A=i[4],P=i[5],O=i[6],R=i[7],I=i[8],M=i[9],D=i[10],L=i[11],j=i[12],N=i[13],U=i[14],k=i[15],z=!1;return n=E*a+S*l+T*m+C*y,s=E*u+S*p+T*_+C*b,r=E*h+S*d+T*g+C*x,o=E*c+S*f+T*v+C*w,z=z?z:n===t[0]||s===t[1]||r===t[2]||o===t[3],t[0]=n,t[1]=s,t[2]=r,t[3]=o,E=A,S=P,T=O,C=R,n=E*a+S*l+T*m+C*y,s=E*u+S*p+T*_+C*b,r=E*h+S*d+T*g+C*x,o=E*c+S*f+T*v+C*w,z=z?z:n===t[4]||s===t[5]||r===t[6]||o===t[7],t[4]=n,t[5]=s,t[6]=r,t[7]=o,E=I,S=M,T=D,C=L,n=E*a+S*l+T*m+C*y,s=E*u+S*p+T*_+C*b,r=E*h+S*d+T*g+C*x,o=E*c+S*f+T*v+C*w,z=z?z:n===t[8]||s===t[9]||r===t[10]||o===t[11],t[8]=n,t[9]=s,t[10]=r,t[11]=o,E=j,S=N,T=U,C=k,n=E*a+S*l+T*m+C*y,s=E*u+S*p+T*_+C*b,r=E*h+S*d+T*g+C*x,o=E*c+S*f+T*v+C*w,z=z?z:n===t[12]||s===t[13]||r===t[14]||o===t[15],t[12]=n,t[13]=s,t[14]=r,t[15]=o,t}e.exports={multiply:n,invert:i}},{}],28:[function(t,e){function i(t){n.call(this,t),this.data=t.data}var n=t("./UIEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"CompositionEvent"},e.exports=i},{"./UIEvent":36}],29:[function(t,e){function i(t){this.type=t.type,this.defaultPrevented=t.defaultPrevented,this.timeStamp=t.timeStamp;var e=t.target.constructor;(e===HTMLInputElement||e===HTMLTextAreaElement||e===HTMLSelectElement)&&(this.value=t.target.value)}i.prototype.toString=function(){return"Event"},e.exports=i},{}],30:[function(t,e){var i=t("./CompositionEvent"),n=t("./Event"),s=t("./FocusEvent"),r=t("./InputEvent"),o=t("./KeyboardEvent"),a=t("./MouseEvent"),u=t("./TouchEvent"),h=t("./UIEvent"),c=t("./WheelEvent"),l={change:[n,!0],submit:[n,!0],abort:[n,!1],beforeinput:[r,!0],blur:[s,!1],click:[a,!0],compositionend:[i,!0],compositionstart:[i,!0],compositionupdate:[i,!0],dblclick:[a,!0],focus:[s,!1],focusin:[s,!0],focusout:[s,!0],input:[r,!0],keydown:[o,!0],keyup:[o,!0],load:[n,!1],mousedown:[a,!0],mouseenter:[a,!1],mouseleave:[a,!1],mousemove:[a,!1],mouseout:[a,!0],mouseover:[a,!0],mouseup:[a,!0],resize:[h,!1],scroll:[h,!1],select:[n,!0],unload:[n,!1],wheel:[c,!0],touchcancel:[u,!0],touchend:[u,!0],touchmove:[u,!0],touchstart:[u,!0]};e.exports=l},{"./CompositionEvent":28,"./Event":29,"./FocusEvent":31,"./InputEvent":32,"./KeyboardEvent":33,"./MouseEvent":34,"./TouchEvent":35,"./UIEvent":36,"./WheelEvent":37}],31:[function(t,e){function i(t){n.call(this,t)}var n=t("./UIEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"FocusEvent"},e.exports=i},{"./UIEvent":36}],32:[function(t,e){function i(t){n.call(this,t),this.inputType=t.inputType,this.data=t.data,this.isComposing=t.isComposing,this.targetRange=t.targetRange}var n=t("./UIEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"InputEvent"},e.exports=i},{"./UIEvent":36}],33:[function(t,e){function i(t){n.call(this,t),this.DOM_KEY_LOCATION_STANDARD=0,this.DOM_KEY_LOCATION_LEFT=1,this.DOM_KEY_LOCATION_RIGHT=2,this.DOM_KEY_LOCATION_NUMPAD=3,this.key=t.key,this.code=t.code,this.location=t.location,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.repeat=t.repeat,this.isComposing=t.isComposing,this.keyCode=t.keyCode}var n=t("./UIEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"KeyboardEvent"},e.exports=i},{"./UIEvent":36}],34:[function(t,e){function i(t){n.call(this,t),this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.button=t.button,this.buttons=t.buttons,this.pageX=t.pageX,this.pageY=t.pageY,this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY}var n=t("./UIEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"MouseEvent"},e.exports=i},{"./UIEvent":36}],35:[function(t,e){function i(t){this.identifier=t.identifier,this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY}function n(t){if(!t)return o;for(var e=[],n=0;n<t.length;n++)e[n]=new i(t[n]);return e}function s(t){r.call(this,t),this.touches=n(t.touches),this.targetTouches=n(t.targetTouches),this.changedTouches=n(t.changedTouches),this.altKey=t.altKey,this.metaKey=t.metaKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey}var r=t("./UIEvent"),o=[];s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"TouchEvent"},e.exports=s},{"./UIEvent":36}],36:[function(t,e){function i(t){n.call(this,t),this.detail=t.detail}var n=t("./Event");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"UIEvent"},e.exports=i},{"./Event":29}],37:[function(t,e){function i(t){n.call(this,t),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.deltaMode=t.deltaMode}var n=t("./MouseEvent");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return"WheelEvent"},e.exports=i},{"./MouseEvent":34}],38:[function(t,e){e.exports={CompositionEvent:t("./CompositionEvent"),Event:t("./Event"),EventMap:t("./EventMap"),FocusEvent:t("./FocusEvent"),InputEvent:t("./InputEvent"),KeyboardEvent:t("./KeyboardEvent"),MouseEvent:t("./MouseEvent"),TouchEvent:t("./TouchEvent"),UIEvent:t("./UIEvent"),WheelEvent:t("./WheelEvent")}},{"./CompositionEvent":28,"./Event":29,"./EventMap":30,"./FocusEvent":31,"./InputEvent":32,"./KeyboardEvent":33,"./MouseEvent":34,"./TouchEvent":35,"./UIEvent":36,"./WheelEvent":37}],39:[function(t,e){e.exports={DOMRenderer:t("./DOMRenderer"),ElementCache:t("./ElementCache"),Events:t("./events"),Math:t("./Math")}},{"./DOMRenderer":25,"./ElementCache":26,"./Math":27,"./events":38}],40:[function(t,e){e.exports={components:t("./components"),core:t("./core"),renderLoops:t("./render-loops"),domRenderables:t("./dom-renderables"),domRenderers:t("./dom-renderers"),math:t("./math"),physics:t("./physics"),renderers:t("./renderers"),transitions:t("./transitions"),utilities:t("./utilities"),webglRenderables:t("./webgl-renderables"),webglRenderers:t("./webgl-renderers"),webglGeometries:t("./webgl-geometries"),webglMaterials:t("./webgl-materials"),webglShaders:t("./webgl-shaders"),polyfills:t("./polyfills")}},{"./components":12,"./core":22,"./dom-renderables":24,"./dom-renderers":39,"./math":45,"./physics":75,"./polyfills":77,"./render-loops":80,"./renderers":85,"./transitions":89,"./utilities":96,"./webgl-geometries":105,"./webgl-materials":119,"./webgl-renderables":121,"./webgl-renderers":134,"./webgl-shaders":136}],41:[function(t,e){function i(t){this.values=t||[1,0,0,0,1,0,0,0,1]}i.prototype.get=function(){return this.values},i.prototype.set=function(t){return this.values=t,this},i.prototype.copy=function(t){var e=this.values,i=t.values;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},i.prototype.vectorMultiply=function(t,e){var i=this.values,n=t.x,s=t.y,r=t.z;return e.x=i[0]*n+i[1]*s+i[2]*r,e.y=i[3]*n+i[4]*s+i[5]*r,e.z=i[6]*n+i[7]*s+i[8]*r,e},i.prototype.multiply=function(t){var e=this.values,i=t.values,n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],p=i[0],d=i[1],f=i[2],m=i[3],_=i[4],g=i[5],v=i[6],y=i[7],b=i[8];return e[0]=n*p+s*m+r*v,e[1]=n*d+s*_+r*y,e[2]=n*f+s*g+r*b,e[3]=o*p+a*m+u*v,e[4]=o*d+a*_+u*y,e[5]=o*f+a*g+u*b,e[6]=h*p+c*m+l*v,e[7]=h*d+c*_+l*y,e[8]=h*f+c*g+l*b,this},i.prototype.transpose=function(){var t=this.values,e=t[1],i=t[2],n=t[3],s=t[5],r=t[6],o=t[7];return t[1]=n,t[2]=r,t[3]=e,t[5]=o,t[6]=i,t[7]=s,this},i.prototype.getDeterminant=function(){var t=this.values,e=t[3],i=t[4],n=t[5],s=t[6],r=t[7],o=t[8],a=t[0]*(i*o-n*r)-t[1]*(e*o-n*s)+t[2]*(e*r-i*s);return a},i.prototype.inverse=function(){var t=this.values,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],u=t[7],h=t[8],c=e*(r*h-o*u)-i*(s*h-o*a)+n*(s*u-r*a);return Math.abs(c)<1e-40?null:(c=1/c,t[0]=(r*h-o*u)*c,t[3]=(-s*h+o*a)*c,t[6]=(s*u-r*a)*c,t[1]=(-i*h+n*u)*c,t[4]=(e*h-n*a)*c,t[7]=(-e*u+i*a)*c,t[2]=(i*o-n*r)*c,t[5]=(-e*o+n*s)*c,t[8]=(e*r-i*s)*c,this)},i.clone=function(t){return new i(t.values.slice())},i.inverse=function(t,e){var i=t.values,n=e.values,s=i[0],r=i[1],o=i[2],a=i[3],u=i[4],h=i[5],c=i[6],l=i[7],p=i[8],d=s*(u*p-h*l)-r*(a*p-h*c)+o*(a*l-u*c);return Math.abs(d)<1e-40?null:(d=1/d,n[0]=(u*p-h*l)*d,n[3]=(-a*p+h*c)*d,n[6]=(a*l-u*c)*d,n[1]=(-r*p+o*l)*d,n[4]=(s*p-o*c)*d,n[7]=(-s*l+r*c)*d,n[2]=(r*h-o*u)*d,n[5]=(-s*h+o*a)*d,n[8]=(s*u-r*a)*d,e)},i.transpose=function(t,e){var i=t.values,n=e.values,s=i[0],r=i[1],o=i[2],a=i[3],u=i[4],h=i[5],c=i[6],l=i[7],p=i[8];return n[0]=s,n[1]=a,n[2]=c,n[3]=r,n[4]=u,n[5]=l,n[6]=o,n[7]=h,n[8]=p,e},i.add=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],u=n[2],h=n[3],c=n[4],l=n[5],p=n[6],d=n[7],f=n[8],m=s[0],_=s[1],g=s[2],v=s[3],y=s[4],b=s[5],x=s[6],w=s[7],E=s[8];return r[0]=o+m,r[1]=a+_,r[2]=u+g,r[3]=h+v,r[4]=c+y,r[5]=l+b,r[6]=p+x,r[7]=d+w,r[8]=f+E,i},i.subtract=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],u=n[2],h=n[3],c=n[4],l=n[5],p=n[6],d=n[7],f=n[8],m=s[0],_=s[1],g=s[2],v=s[3],y=s[4],b=s[5],x=s[6],w=s[7],E=s[8];return r[0]=o-m,r[1]=a-_,r[2]=u-g,r[3]=h-v,r[4]=c-y,r[5]=l-b,r[6]=p-x,r[7]=d-w,r[8]=f-E,i},i.multiply=function(t,e,i){var n=t.values,s=e.values,r=i.values,o=n[0],a=n[1],u=n[2],h=n[3],c=n[4],l=n[5],p=n[6],d=n[7],f=n[8],m=s[0],_=s[1],g=s[2],v=s[3],y=s[4],b=s[5],x=s[6],w=s[7],E=s[8];return r[0]=o*m+a*v+u*x,r[1]=o*_+a*y+u*w,r[2]=o*g+a*b+u*E,r[3]=h*m+c*v+l*x,r[4]=h*_+c*y+l*w,r[5]=h*g+c*b+l*E,r[6]=p*m+d*v+f*x,r[7]=p*_+d*y+f*w,r[8]=p*g+d*b+f*E,i},e.exports=i},{}],42:[function(t,e){function i(t,e,i,n){this.w=t||1,this.x=e||0,this.y=i||0,this.z=n||0}var n=Math.sin,s=Math.cos,r=Math.asin,o=Math.acos,a=Math.atan2,u=Math.sqrt;i.prototype.multiply=function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.x,o=t.y,a=t.z,u=t.w||0;return this.w=s*u-e*r-i*o-n*a,this.x=e*u+r*s+o*n-i*a,this.y=i*u+o*s+e*a-r*n,this.z=n*u+a*s+r*i-e*o,this},i.prototype.leftMultiply=function(t){var e=t.x,i=t.y,n=t.z,s=t.w||0,r=this.x,o=this.y,a=this.z,u=this.w;return this.w=s*u-e*r-i*o-n*a,this.x=e*u+r*s+o*n-i*a,this.y=i*u+o*s+e*a-r*n,this.z=n*u+a*s+r*i-e*o,this},i.prototype.rotateVector=function(t,e){var i=this.w,n=-this.x,s=-this.y,r=-this.z,o=t.x,a=t.y,u=t.z,h=-n*o-s*a-r*u,c=o*i+a*r-s*u,l=a*i+n*u-o*r,p=u*i+o*s-n*a,d=i,f=-n,m=-s,_=-r;return e.x=c*d+f*h+m*p-l*_,e.y=l*d+m*h+c*_-f*p,e.z=p*d+_*h+f*l-c*m,e},i.prototype.invert=function(){return this.w=-this.w,this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.length=function(){var t=this.w,e=this.x,i=this.y,n=this.z;return u(t*t+e*e+i*i+n*n)},i.prototype.normalize=function(){var t=this.w,e=this.x,i=this.y,n=this.z,s=u(t*t+e*e+i*i+n*n);return 0===s?this:(s=1/s,this.w*=s,this.x*=s,this.y*=s,this.z*=s,this)},i.prototype.set=function(t,e,i,n){return null!=t&&(this.w=t),null!=e&&(this.x=e),null!=i&&(this.y=i),null!=n&&(this.z=n),this},i.prototype.copy=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},i.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.slerp=function(t,e,i){var s,r,a,u,h,c=this.w,l=this.x,p=this.y,d=this.z,f=t.w,m=t.x,_=t.y,g=t.z;return r=c*f+l*m+p*_+d*g,1-r>1e-5?(s=o(r),a=n(s),u=n((1-e)*s)/a,h=n(e*s)/a):(u=1-e,h=e),i.w=c*u+f*h,i.x=l*u+m*h,i.y=p*u+_*h,i.z=d*u+g*h,i},i.prototype.toMatrix=function(t){var e=this.w,i=this.x,n=this.y,s=this.z,r=i*i,o=n*n,a=s*s,u=i*n,h=i*s,c=n*s;return t.set([1-2*(o+a),2*(u-e*s),2*(h+e*n),2*(u+e*s),1-2*(r+a),2*(c-e*i),2*(h-e*n),2*(c+e*i),1-2*(r+o)])},i.prototype.toEuler=function(t){var e=this.w,i=this.x,n=this.y,s=this.z,o=i*i,u=n*n,h=s*s,c=2*(i*s+n*e);return c=-1>c?-1:c>1?1:c,t.x=a(2*(i*e-n*s),1-2*(o+u)),t.y=r(c),t.z=a(2*(s*e-i*n),1-2*(u+h)),t},i.prototype.fromEuler=function(t,e,i){var r=.5*t,o=.5*e,a=.5*i,u=n(r),h=n(o),c=n(a),l=s(r),p=s(o),d=s(a);return this.w=l*p*d-u*h*c,this.x=u*p*d+l*h*c,this.y=l*h*d-u*p*c,this.z=l*p*c+u*h*d,this},i.prototype.fromAngleAxis=function(t,e,i,r){var o=u(e*e+i*i+r*r);if(0===o)this.w=1,this.x=this.y=this.z=0;else{o=1/o;var a=.5*t,h=n(a);this.w=s(a),this.x=h*e*o,this.y=h*i*o,this.z=h*r*o}return this},i.multiply=function(t,e,i){var n=t.w||0,s=t.x,r=t.y,o=t.z,a=e.w||0,u=e.x,h=e.y,c=e.z;return i.w=n*a-s*u-r*h-o*c,i.x=s*a+u*n+h*o-r*c,i.y=r*a+h*n+s*c-u*o,i.z=o*a+c*n+u*r-s*h,i},i.normalize=function(t,e){var i=t.w,n=t.x,s=t.y,r=t.z,o=u(i*i+n*n+s*s+r*r);return 0===o?this:(o=1/o,e.w*=o,e.x*=o,e.y*=o,e.z*=o,e)},i.conjugate=function(t,e){return e.w=t.w,e.x=-t.x,e.y=-t.y,e.z=-t.z,e},i.clone=function(t){return new i(t.w,t.x,t.y,t.z)},i.dot=function(t,e){return t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z},e.exports=i},{}],43:[function(t,e){var i=function(t,e){t instanceof Array||t instanceof Float32Array?(this.x=t[0]||0,this.y=t[1]||0):(this.x=t||0,this.y=e||0)};i.prototype.set=function(t,e){return null!=t&&(this.x=t),null!=e&&(this.y=e),this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return t instanceof i?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},i.prototype.rotate=function(t){var e=this.x,i=this.y,n=Math.cos(t),s=Math.sin(t);return this.x=e*n-i*s,this.y=e*s+i*n,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},i.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this},i.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clear=function(){return this.x=0,this.y=0,this},i.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0},i.prototype.toArray=function(){return[this.x,this.y]},i.normalize=function(t,e){var i=t.x,n=t.y,s=Math.sqrt(i*i+n*n)||1;return s=1/s,e.x=t.x*s,e.y=t.y*s,e},i.clone=function(t){return new i(t.x,t.y)},i.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},i.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},i.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},e.exports=i},{}],44:[function(t,e){var i=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};i.prototype.set=function(t,e,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=i&&(this.z=i),this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.rotateX=function(t){var e=this.y,i=this.z,n=Math.cos(t),s=Math.sin(t);return this.y=e*n-i*s,this.z=e*s+i*n,this},i.prototype.rotateY=function(t){var e=this.x,i=this.z,n=Math.cos(t),s=Math.sin(t);return this.x=i*s+e*n,this.z=i*n-e*s,this},i.prototype.rotateZ=function(t){var e=this.x,i=this.y,n=Math.cos(t),s=Math.sin(t);return this.x=e*n-i*s,this.y=e*s+i*n,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z;return this.x=i*o-n*r,this.y=n*s-e*o,this.z=e*r-i*s,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this},i.prototype.length=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},i.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,n=Math.sqrt(t*t+e*e+i*i)||1;return n=1/n,this.x*=n,this.y*=n,this.z*=n,this},i.prototype.applyRotation=function(t){var e=t.w,i=-t.x,n=-t.y,s=-t.z,r=this.x,o=this.y,a=this.z,u=-i*r-n*o-s*a,h=r*e+o*s-n*a,c=o*e+i*a-r*s,l=a*e+r*n-i*o,p=e,d=-i,f=-n,m=-s;return this.x=h*p+d*u+f*l-c*m,this.y=c*p+f*u+h*m-d*l,this.z=l*p+m*u+d*c-h*f,this},i.prototype.applyMatrix=function(t){var e=t.get(),i=this.x,n=this.y,s=this.z;return this.x=e[0]*i+e[1]*n+e[2]*s,this.y=e[3]*i+e[4]*n+e[5]*s,this.z=e[6]*i+e[7]*n+e[8]*s,this},i.normalize=function(t,e){var i=t.x,n=t.y,s=t.z,r=Math.sqrt(i*i+n*n+s*s)||1;return r=1/r,e.x=i*r,e.y=n*r,e.z=s*r,e},i.applyRotation=function(t,e,i){var n=e.w,s=-e.x,r=-e.y,o=-e.z,a=t.x,u=t.y,h=t.z,c=-s*a-r*u-o*h,l=a*n+u*o-r*h,p=u*n+s*h-a*o,d=h*n+a*r-s*u,f=n,m=-s,_=-r,g=-o;return i.x=l*f+m*c+_*d-p*g,i.y=p*f+_*c+l*g-m*d,i.z=d*f+g*c+m*p-l*_,i},i.clone=function(t){return new i(t.x,t.y,t.z)},i.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i},i.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i},i.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,u=e.z;return i.x=s*u-r*a,i.y=r*o-n*u,i.z=n*a-s*o,i},i.project=function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,u=e.z,h=n*o+s*a+r*u;return h/=o*o+a*a+u*u,i.x=o*h,i.y=a*h,i.z=u*h,i},e.exports=i},{}],45:[function(t,e){e.exports={Mat33:t("./Mat33"),Quaternion:t("./Quaternion"),Vec2:t("./Vec2"),Vec3:t("./Vec3")}},{"./Mat33":41,"./Quaternion":42,"./Vec2":43,"./Vec3":44}],46:[function(t,e){function i(){throw new Error("You should bundle your code using `glslify` as a transform.")}e.exports=i},{}],47:[function(t,e){function i(t,e,i,n){return{vertex:t,fragment:e,uniforms:i,attributes:n}}e.exports=i},{}],48:[function(t,e){function i(t,e,i){var n=_;return l.cross(t,e,n),l.cross(n,i,n),n}function n(t,e){for(var i,n,s,r,o=-(1/0),a=0;a<t.length;a++)s=t[a],n=l.dot(s,e),n>o&&(i=s,o=n,r=a);return{vertex:i,index:r}}function s(t,e,i){this.distance=t,this.normal=e,this.vertexIndices=i}function r(){this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]}}function o(t,e,i,n){for(var s=t[i].vertex,r=t[n].vertex,o=0,a=e.length;a>o;o++){var u=e[o];if(u){var h=t[u[0]].vertex,c=t[u[1]].vertex;if(s===h&&r===c||s===c&&r===h)return void(e[o]=null)}}e.push([i,n])}function a(t,e){e=e||1e3;var i,n,s=u(t,e),r=[];for(i=0,n=s.features.length;n>i;i++){var o=s.features[i];o&&r.push(o.vertexIndices)}var a=c(s.vertices,r),h=a.centroid,p=[];for(i=0,n=s.vertices.length;n>i;i++)p.push(l.subtract(s.vertices[i].vertex,h,new l));var d=[];for(i=0,n=p.length;n>i;i++)d.push(l.normalize(p[i],new l));var f={},m={};for(i=0;i<r.length;i++){var _=r[i][0],g=r[i][1],v=r[i][2];m[_]=m[_]||{},m[g]=m[g]||{},m[v]=m[v]||{},f[_]=f[_]||[],f[g]=f[g]||[],f[v]=f[v]||[],m[_][g]||(m[_][g]=1,f[_].push(g)),m[_][v]||(m[_][v]=1,f[_].push(v)),m[g][_]||(m[g][_]=1,f[g].push(_)),m[g][v]||(m[g][v]=1,f[g].push(v)),m[v][_]||(m[v][_]=1,f[v].push(_)),m[v][g]||(m[v][g]=1,f[v].push(g))}this.indices=r,this.vertices=p,this.normals=d,this.polyhedralProperties=a,this.graph=f}function u(t,e){var s=new r;s.addVertex(n(t,new l(1,0,0))),s.addVertex(n(t,new l(-1,0,0)));var o,a,u,h,c,p,d=s.vertices[0].vertex,f=s.vertices[1].vertex,m=l.subtract(f,d,b),_=-(1/0);for(c=0;c<t.length;c++)if(a=t[c],a!==d&&a!==f){var v=l.subtract(a,d,g);o=l.dot(v,i(m,v,m)),o=0>o?-1*o:o,o>_&&(_=o,u=a,h=c)}s.addVertex({vertex:u,index:h});var y=u,T=l.subtract(y,d,x),C=l.cross(m,T,new l);for(C.normalize(),_=-(1/0),c=0;c<t.length;c++)a=t[c],a!==d&&a!==f&&a!==y&&(o=l.dot(l.subtract(a,d,g),C),o=0>o?-1*o:o,o>_&&(_=o,u=a,h=c));s.addVertex({vertex:u,index:h});var A=u,P=l.subtract(A,d,w),O=l.subtract(y,f,E),R=l.subtract(A,f,S),I=l.cross(T,P,new l),M=l.cross(m,P,new l),D=l.cross(O,R,new l);I.normalize(),M.normalize(),D.normalize(),l.dot(C,P)>0&&C.invert(),l.dot(I,m)>0&&I.invert(),l.dot(M,T)>0&&M.invert(),l.dot(D,m)<0&&D.invert();var L=0,j=1,N=2,U=3;s.addFeature(null,C,[L,j,N]),s.addFeature(null,I,[L,N,U]),s.addFeature(null,M,[L,j,U]),s.addFeature(null,D,[j,N,U]);var k={};for(c=0,p=s.vertices.length;p>c;c++)k[s.vertices[c].index]=!0;var z=d.x+f.x+y.x+A.x,F=d.y+f.y+y.y+A.y,q=d.z+f.z+y.z+A.z,V=new l(z,F,q);V.scale(.25);for(var G=s.features,H=0;H++<e;){var B=null;for(c=0,p=G.length;p>c;c++)if(G[c]&&!G[c].done){B=G[c],u=null,h=null,d=s.vertices[B.vertexIndices[0]].vertex;var W=n(t,B.normal);u=W.vertex,h=W.index;var K=l.dot(l.subtract(u,d,g),B.normal);.001>K||k[h]?B.done=!0:(k[h]=!0,s.addVertex(W),s.reshape(V))}if(null===B)break}return s}function h(t,e,i,n,s){var r=t+e;n[0]=r+i;var o=t*t,a=o+e*r;n[1]=a+i*n[0],n[2]=t*o+e*a+i*n[1],s[0]=n[1]+t*(n[0]+t),s[1]=n[1]+e*(n[0]+e),s[2]=n[1]+i*(n[0]+i)}function c(t,e){var i,n,s=[0,0,0,0,0,0,0,0,0,0],r=[],o=[],a=[],u=[],c=[],d=[];for(i=0,n=e.length;n>i;i++){var f=t[e[i][0]].vertex,m=t[e[i][1]].vertex,_=t[e[i][2]].vertex,g=l.subtract(m,f,b),v=l.subtract(_,f,x),y=g.cross(v);l.dot(f,y)<0&&y.invert();var w=y.x,E=y.y,S=y.z,T=f.x,C=f.y,A=f.z,P=m.x,O=m.y,R=m.z,I=_.x,M=_.y,D=_.z;h(T,P,I,r,u),h(C,O,M,o,c),h(A,R,D,a,d),s[0]+=w*r[0],s[1]+=w*r[1],s[2]+=E*o[1],s[3]+=S*a[1],s[4]+=w*r[2],s[5]+=E*o[2],s[6]+=S*a[2],s[7]+=w*(C*u[0]+O*u[1]+M*u[2]),s[8]+=E*(A*c[0]+R*c[1]+D*c[2]),s[9]+=S*(T*d[0]+P*d[1]+I*d[2])}s[0]/=6,s[1]/=24,s[2]/=24,s[3]/=24,s[4]/=60,s[5]/=60,s[6]/=60,s[7]/=120,s[8]/=120,s[9]/=120;var L=1/0,j=-(1/0),N=1/0,U=-(1/0),k=1/0,z=-(1/0);for(i=0,n=t.length;n>i;i++){var F=t[i].vertex;F.x<L&&(L=F.x),F.x>j&&(j=F.x),F.y<N&&(N=F.y),F.y>U&&(U=F.y),F.z<k&&(k=F.z),F.z>z&&(z=F.z)}var q=[j-L,U-N,z-k],V=s[0],G=new l(s[1],s[2],s[3]);G.scale(1/V);var H=new p([s[4],s[7],s[9],s[7],s[5],s[8],s[9],s[8],s[6]]);return{size:q,volume:V,centroid:G,eulerTensor:H}}var l=t("../math/Vec3"),p=t("../math/Mat33"),d=t("../utilities/ObjectManager");d.register("DynamicGeometry",r),d.register("DynamicGeometryFeature",s);var f=d.requestDynamicGeometryFeature,m=d.freeDynamicGeometryFeature,_=new l,g=new l,v=new l,y=new l,b=new l,x=new l,w=new l,E=new l,S=new l;s.prototype.reset=function(t,e,i){return this.distance=t,this.normal=e,this.vertexIndices=i,this},r.prototype.reset=function(){return this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]},this},r.prototype.addVertex=function(t){var e=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[e]=t,this.lastVertexIndex=e,this.numVertices++},r.prototype.removeVertex=function(t){var e=this.vertices[t];return this.vertices[t]=null,this._IDPool.vertices.push(t),this.numVertices--,e},r.prototype.addFeature=function(t,e,i){var n=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[n]=f().reset(t,e,i),this.numFeatures++},r.prototype.removeFeature=function(t){var e=this.features[t];this.features[t]=null,this._IDPool.features.push(t),this.numFeatures--,m(e)},r.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]},r.prototype.getFeatureClosestToOrigin=function(){for(var t=1/0,e=null,i=this.features,n=0,s=i.length;s>n;n++){var r=i[n];r&&r.distance<t&&(t=r.distance,e=r)}return e},r.prototype.reshape=function(t){var e,i,n,s,r,a=this.vertices,u=this.getLastVertex().vertex,h=this.features,c=[];for(n=0,r=h.length;r>n;n++)h[n]&&(i=h[n].vertexIndices,e=a[i[0]].vertex,l.dot(h[n].normal,l.subtract(u,e,v))>-.001&&(o(a,c,i[0],i[1]),o(a,c,i[1],i[2]),o(a,c,i[2],i[0]),this.removeFeature(n)));var p=u,d=this.lastVertexIndex;for(s=0,r=c.length;r>s;s++)if(c[s]){var f=c[s][0],m=c[s][1],_=a[f].vertex,y=a[m].vertex,w=l.subtract(_,p,b),E=l.subtract(y,p,x),S=l.cross(w,E,new l);if(S.normalize(),t){var T=l.subtract(t,p,g);l.dot(S,T)>-.001&&S.invert(),this.addFeature(null,S,[d,f,m])}else{var C=l.dot(S,p);0>C&&(S.invert(),C*=-1),this.addFeature(C,S,[d,f,m])}}},r.prototype.simplexContainsOrigin=function(t,e){var n=this.vertices.length,s=this.lastVertexIndex,r=s-1,o=s-2,a=s-3;r=0>r?r+n:r,o=0>o?o+n:o,a=0>a?a+n:a;var u,h,c,p,d,f,m,_,g,v,T,C,A,P=this.vertices[s].vertex,O=this.vertices[r].vertex,R=this.vertices[o].vertex,I=this.vertices[a].vertex,M=l.scale(P,-1,y),D=l.subtract(O,P,b);if(4===n){if(u=l.subtract(R,P,x),h=l.subtract(I,P,w),d=l.cross(D,u,new l),f=l.cross(u,h,new l),m=l.cross(D,h,new l),d.normalize(),f.normalize(),m.normalize(),l.dot(d,h)>0&&d.invert(),l.dot(f,D)>0&&f.invert(),l.dot(m,u)>0&&m.invert(),g=l.dot(d,M),v=l.dot(f,M),T=l.dot(m,M),.001>g&&.001>T&&.001>v)return c=l.subtract(R,O,E),p=l.subtract(I,O,S),_=l.cross(c,p,new l),_.normalize(),l.dot(_,D)<=0&&_.invert(),C=-1*l.dot(_,O),this.addFeature(-g,d,[s,r,o]),this.addFeature(-v,f,[s,o,a]),this.addFeature(-T,m,[s,a,r]),this.addFeature(-C,_,[r,o,a]),!0;g>=.001?(A=this.removeVertex(a),t.copy(d)):v>=.001?(A=this.removeVertex(r),t.copy(f)):(A=this.removeVertex(o),t.copy(m))}else 3===n?(u=l.subtract(R,P,x),l.cross(D,u,t),l.dot(t,M)<=0&&t.invert()):t.copy(i(D,M,D));return A&&e&&e(A),!1},e.exports={DynamicGeometry:r,ConvexHull:a}},{"../math/Mat33":41,"../math/Vec3":44,"../utilities/ObjectManager":93}],49:[function(t,e){function i(t){this.events=new c,t=t||{},this.bodies=[],this.forces=[],this.constraints=[],this.step=t.step||1e3/60,this.iterations=t.iterations||10,this._indexPools={bodies:[],forces:[],constraints:[]},this._entityMaps={bodies:{},forces:{},constraints:{}},this.speed=t.speed||1,this.time=0,this.delta=0,this.origin=t.origin||new l,this.orientation=t.orientation?t.orientation.normalize():new p,this.frameDependent=t.frameDependent||!1,this.transformBuffers={position:[0,0,0],rotation:[0,0,0,1]}}function n(t,e,i){var n=t._entityMaps[i];if(null==n[e._ID]){var s=t[i],r=t._indexPools[i];n[e._ID]=r.length?r.pop():s.length,s[n[e._ID]]=e}}function s(t,e,i){var n=t._entityMaps[i],s=n[e._ID];null!=s&&(t._indexPools[i].push(s),t[i][s]=null,n[e._ID]=null)}function r(t,e){t.momentum.add(l.scale(t.force,e,m)),t.angularMomentum.add(l.scale(t.torque,e,m)),l.scale(t.momentum,t.inverseMass,t.velocity),t.inverseInertia.vectorMultiply(t.angularMomentum,t.angularVelocity),t.force.clear(),t.torque.clear()}function o(t,e){if(0!==t.restrictions){var i=t.restrictions,n=null,s=null,r=null,o=null,a=null,u=null;32&i&&(n=0),16&i&&(s=0),8&i&&(r=0),4&i&&(o=0),2&i&&(a=0),1&i&&(u=0),(null!==n||null!==s||null!==r)&&t.setVelocity(n,s,r),(null!==o||null!==a||null!==u)&&t.setAngularVelocity(o,a,u)}t.position.add(l.scale(t.velocity,e,m));var h=t.angularVelocity,c=t.orientation,p=h.x,d=h.y,f=h.z,_=c.w,g=c.x,v=c.y,y=c.z,b=.5*e;c.w+=(-p*g-d*v-f*y)*b,c.x+=(p*_+d*y-f*v)*b,c.y+=(d*_+f*g-p*y)*b,c.z+=(f*_+p*v-d*g)*b,c.normalize(),t.updateInertia()}var a=t("./bodies/Particle"),u=t("./constraints/Constraint"),h=t("./forces/Force"),c=t("../utilities/CallbackStore"),l=t("../math/Vec3"),p=t("../math/Quaternion"),d=new l,f=new p,m=new l;i.prototype.on=function(t,e){return this.events.on(t,e),this},i.prototype.off=function(t,e){return this.events.off(t,e),this},i.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},i.prototype.setOrigin=function(t,e,i){return this.origin.set(t,e,i),this},i.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this},i.prototype.add=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,s=i.length;s>n;n++){var r=i[n];this.add(r)}else i instanceof a?this.addBody(i):i instanceof u?this.addConstraint(i):i instanceof h&&this.addForce(i)}return this},i.prototype.remove=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,s=i.length;s>n;n++){var r=i[n];this.add(r)}else i instanceof a?this.removeBody(i):i instanceof u?this.removeConstraint(i):i instanceof h&&this.removeForce(i)}return this},i.prototype.addBody=function(t){n(this,t,"bodies")},i.prototype.addForce=function(t){n(this,t,"forces")},i.prototype.addConstraint=function(t){n(this,t,"constraints")},i.prototype.removeBody=function(t){s(this,t,"bodies")},i.prototype.removeForce=function(t){s(this,t,"forces")},i.prototype.removeConstraint=function(t){s(this,t,"constraints")},i.prototype.update=function(t){0===this.time&&(this.time=t);var e=this.bodies,i=this.forces,n=this.constraints,s=this.frameDependent,a=this.step,u=.001*a,h=this.speed,c=this.delta;c+=(t-this.time)*h,this.time=t;for(var l,p,d,f,m;c>a;){for(this.events.trigger("prestep",t),l=0,p=i.length;p>l;l++)d=i[l],null!==d&&d.update(t,u);for(l=0,p=e.length;p>l;l++)f=e[l],null!==f&&r(f,u);for(l=0,p=n.length;p>l;l++)m=n[l],null!==m&&m.update(t,u);for(var _=0,g=this.iterations;g>_;_++)for(l=0,p=n.length;p>l;l++)m=n[l],null!==m&&m.resolve(t,u);for(l=0,p=e.length;p>l;l++)f=e[l],null!==f&&o(f,u);this.events.trigger("poststep",t),s?c=0:c-=a}this.delta=c},i.prototype.getTransform=function(t){var e=this.origin,i=this.orientation,n=this.transformBuffers,s=t.position,r=t.orientation,o=r,a=s;return 1!==i.w&&(o=p.multiply(r,i,f),a=i.rotateVector(s,d)),n.position[0]=e.x+a.x,n.position[1]=e.y+a.y,n.position[2]=e.z+a.z,n.rotation[0]=o.x,n.rotation[1]=o.y,n.rotation[2]=o.z,n.rotation[3]=o.w,n
},e.exports=i},{"../math/Quaternion":42,"../math/Vec3":44,"../utilities/CallbackStore":90,"./bodies/Particle":51,"./constraints/Constraint":58,"./forces/Force":69}],50:[function(t,e){function i(t){r.call(this,t),this.normals=[new n(0,1,0),new n(1,0,0),new n(0,0,1)],this.type=2}var n=t("../../math/Vec3"),s=t("./convexBodyFactory"),r=s([new n(-100,-100,-100),new n(100,-100,-100),new n(-100,-100,100),new n(100,-100,100),new n(-100,100,-100),new n(100,100,-100),new n(-100,100,100),new n(100,100,100)]);i.prototype=Object.create(r.prototype),i.prototype.constructor=i,e.exports=i},{"../../math/Vec3":44,"./convexBodyFactory":54}],51:[function(t,e){function i(t){this.events=new o,t=t||{},this.position=t.position||new n,this.orientation=t.orientation||new s,this.velocity=new n,this.momentum=new n,this.angularVelocity=new n,this.angularMomentum=new n,this.mass=t.mass||1,this.inverseMass=1/this.mass,this.force=new n,this.torque=new n,this.restitution=null!=t.restitution?t.restitution:.4,this.friction=null!=t.friction?t.friction:.2,this.inverseInertia=new r([0,0,0,0,0,0,0,0,0]),this.localInertia=new r([0,0,0,0,0,0,0,0,0]),this.localInverseInertia=new r([0,0,0,0,0,0,0,0,0]),this.size=t.size||[0,0,0];var e=t.velocity;e&&this.setVelocity(e.x,e.y,e.z),this.restrictions=0,this.setRestrictions.apply(this,t.restrictions||[]),this.collisionMask=t.collisionMask||1,this.collisionGroup=t.collisionGroup||1,this.type=1,this._ID=h++}var n=t("../../math/Vec3"),s=t("../../math/Quaternion"),r=t("../../math/Mat33"),o=t("../../utilities/CallbackStore"),a=new n,u=new r,h=0;i.prototype.on=function(t,e){return this.events.on(t,e),this},i.prototype.off=function(t,e){return this.events.off(t,e),this},i.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},i.prototype.getRestrictions=function(){var t="",e="",i=this.restrictions;return 32&i&&(t+="x"),16&i&&(t+="y"),8&i&&(t+="z"),4&i&&(e+="x"),2&i&&(e+="y"),1&i&&(e+="z"),[t,e]},i.prototype.setRestrictions=function(t,e){return t=t||"",e=e||"",this.restrictions=0,t.indexOf("x")>-1&&(this.restrictions|=32),t.indexOf("y")>-1&&(this.restrictions|=16),t.indexOf("z")>-1&&(this.restrictions|=8),e.indexOf("x")>-1&&(this.restrictions|=4),e.indexOf("y")>-1&&(this.restrictions|=2),e.indexOf("z")>-1&&(this.restrictions|=1),this},i.prototype.getMass=function(){return this.mass},i.prototype.setMass=function(t){return this.mass=t,this.inverseMass=1/t,this},i.prototype.getInverseMass=function(){return this.inverseMass},i.prototype.updateLocalInertia=function(){return this.localInertia.set([0,0,0,0,0,0,0,0,0]),this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]),this},i.prototype.updateInertia=function(){var t=this.localInverseInertia,e=this.orientation;if(t[0]===t[4]&&t[4]===t[8]||1===e.w)return this;var i=e.toMatrix(u);return r.multiply(i,this.inverseInertia,this.inverseInertia),r.multiply(this.localInverseInertia,i.transpose(),this.inverseInertia),this},i.prototype.getPosition=function(){return this.position},i.prototype.setPosition=function(t,e,i){return this.position.set(t,e,i),this},i.prototype.getVelocity=function(){return this.velocity},i.prototype.setVelocity=function(t,e,i){return this.velocity.set(t,e,i),n.scale(this.velocity,this.mass,this.momentum),this},i.prototype.getMomentum=function(){return this.momentum},i.prototype.setMomentum=function(t,e,i){return this.momentum.set(t,e,i),n.scale(this.momentum,this.inverseMass,this.velocity),this},i.prototype.getOrientation=function(){return this.orientation},i.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this.updateInertia(),this},i.prototype.getAngularVelocity=function(){return this.angularVelocity},i.prototype.setAngularVelocity=function(t,e,i){this.angularVelocity.set(t,e,i);var n=r.inverse(this.inverseInertia,u);return n?n.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear(),this},i.prototype.getAngularMomentum=function(){return this.angularMomentum},i.prototype.setAngularMomentum=function(t,e,i){return this.angularMomentum.set(t,e,i),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},i.prototype.getForce=function(){return this.force},i.prototype.setForce=function(t,e,i){return this.force.set(t,e,i),this},i.prototype.getTorque=function(){return this.torque},i.prototype.setTorque=function(t,e,i){return this.torque.set(t,e,i),this},i.prototype.applyForce=function(t){return this.force.add(t),this},i.prototype.applyTorque=function(t){return this.torque.add(t),this},i.prototype.applyImpulse=function(t){return this.momentum.add(t),n.scale(this.momentum,this.inverseMass,this.velocity),this},i.prototype.applyAngularImpulse=function(t){return this.angularMomentum.add(t),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},i.prototype.support=function(){return a},i.prototype.updateShape=function(){},e.exports=i},{"../../math/Mat33":41,"../../math/Quaternion":42,"../../math/Vec3":44,"../../utilities/CallbackStore":90}],52:[function(t,e){function i(t){n.call(this,t);var e=t.radius||1;this.radius=e,this.size=[2*e,2*e,2*e],this.updateLocalInertia(),this.inverseInertia.copy(this.localInverseInertia);var i=t.angularVelocity;i&&this.setAngularVelocity(i.x,i.y,i.z),this.type=4}var n=t("./Particle"),s=t("../../math/Vec3"),r=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.getRadius=function(){return this.radius},i.prototype.setRadius=function(t){return this.radius=t,this.size=[2*this.radius,2*this.radius,2*this.radius],this},i.prototype.updateLocalInertia=function(){var t=this.mass,e=this.radius,i=t*e*e;this.localInertia.set([.4*i,0,0,0,.4*i,0,0,0,.4*i]),this.localInverseInertia.set([2.5/i,0,0,0,2.5/i,0,0,0,2.5/i])},i.prototype.support=function(t){return s.scale(t,this.radius,r)},e.exports=i},{"../../math/Vec3":44,"./Particle":51}],53:[function(t,e){function i(t){n.call(this,t);var e=this.normal=new s,r=this.direction=t.direction;switch(r){case i.DOWN:e.set(0,1,0);break;case i.UP:e.set(0,-1,0);break;case i.LEFT:e.set(-1,0,0);break;case i.RIGHT:e.set(1,0,0);break;case i.FORWARD:e.set(0,0,-1);break;case i.BACKWARD:e.set(0,0,1)}this.invNormal=s.clone(e,new s).invert(),this.mass=1/0,this.inverseMass=0,this.type=8}var n=t("./Particle"),s=t("../../math/Vec3");i.DOWN=0,i.UP=1,i.LEFT=2,i.RIGHT=3,i.FORWARD=4,i.BACKWARD=5,i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},{"../../math/Vec3":44,"./Particle":51}],54:[function(t,e){function i(t){function e(e){s.call(this,e);var i=t.polyhedralProperties.size,a=e.size||i,u=a[0]/i[0],h=a[1]/i[1],c=a[2]/i[2];this._scale=[u,h,c];var l=new r([u,0,0,0,h,0,0,0,c]);this.hull=t,this.vertices=[];for(var p=0,d=t.vertices.length;d>p;p++)this.vertices.push(l.vectorMultiply(t.vertices[p],new o));n.call(this,l),this.inverseInertia.copy(this.localInverseInertia),this.updateInertia();var f=e.angularVelocity;f&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(t instanceof u)){if(!(t instanceof Array))throw new Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");t=new u(t)}return e.prototype=Object.create(s.prototype),e.prototype.constructor=e,e.prototype.setSize=function(e,i,n){var s=t.polyhedralProperties.size;this.size[0]=e,this.size[1]=i,this.size[2]=n;var o=e/s[0],a=i/s[1],u=n/s[2];this._scale=[o,a,u];for(var h=new r([o,0,0,0,a,0,0,0,u]),c=this.vertices,l=0,p=t.vertices.length;p>l;l++)h.vectorMultiply(t.vertices[l],c[l]);return this},e.prototype.updateLocalInertia=function(){var t=this._scale[0],e=this._scale[1],i=this._scale[2],s=new r([t,0,0,0,e,0,0,0,i]);return n.call(this,s),this},e.prototype.support=function(t){for(var e,i,n,s=this.vertices,r=-(1/0),a=0,u=s.length;u>a;a++)e=s[a],i=o.dot(e,t),i>r&&(n=e,r=i);return n},e.prototype.updateShape=function(){for(var t=this.vertices,e=this.orientation,i=this.hull.vertices,n=this._scale[0],s=this._scale[1],r=this._scale[2],a=h,u=0,c=t.length;c>u;u++)a.copy(i[u]),a.x*=n,a.y*=s,a.z*=r,o.applyRotation(a,e,t[u]);return this},e}function n(t){var e=this.hull.polyhedralProperties,i=t.get(),n=i[0]*i[4]*i[8],s=e.eulerTensor,o=new r;r.multiply(t,s,o),r.multiply(o,t,o);var a=o.get(),u=a[0],h=a[4],c=a[8],l=a[1],p=a[7],d=a[2],f=e.volume*n,m=this.mass,_=m/f,g=h+c,v=u+c,y=u+h,b=-l,x=-p,w=-d,E=e.centroid;g-=f*(E.y*E.y+E.z*E.z),v-=f*(E.z*E.z+E.x*E.x),y-=f*(E.x*E.x+E.y*E.y),b+=f*E.x*E.y,x+=f*E.y*E.z,w+=f*E.z*E.x,g*=_*n,v*=_*n,y*=_*n,b*=_*n,x*=_*n,w*=_*n;var S=[g,b,w,b,v,x,w,x,y];this.localInertia.set(S),r.inverse(this.localInertia,this.localInverseInertia)}var s=t("./Particle"),r=t("../../math/Mat33"),o=t("../../math/Vec3"),a=t("../Geometry"),u=a.ConvexHull,h=new o;e.exports=i},{"../../math/Mat33":41,"../../math/Vec3":44,"../Geometry":48,"./Particle":51}],55:[function(t,e){function i(t,e,i){this.a=t,this.b=e,n.call(this,i),this.effectiveInertia=new r,this.angularImpulse=new s,this.error=0}var n=t("./Constraint"),s=t("../../math/Vec3"),r=t("../../math/Mat33"),o=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)},i.prototype.update=function(){var t=this.a,e=this.b,i=t.orientation,n=e.orientation,s=i.dot(n),o=2*(s-this.cosAngle);this.error=o;var a=this.angularImpulse;e.applyAngularImpulse(a),t.applyAngularImpulse(a.invert()),r.add(t.inverseInertia,e.inverseInertia,this.effectiveInertia),this.effectiveInertia.inverse(),a.clear()},i.prototype.resolve=function(){var t=this.a,e=this.b,i=o,n=t.angularVelocity,r=e.angularVelocity;s.subtract(n,r,i),i.scale(1+this.error);var a=i.applyMatrix(this.effectiveInertia);e.applyAngularImpulse(a),t.applyAngularImpulse(a.invert()),a.invert(),this.angularImpulse.add(a)},e.exports=i},{"../../math/Mat33":41,"../../math/Vec3":44,"./Constraint":58}],56:[function(t,e){function i(t,e,i){this.a=t,this.b=e,n.call(this,i),this.impulse=new s,this.angImpulseA=new s,this.angImpulseB=new s,this.error=new s,this.effMassMatrix=new r}var n=t("./Constraint"),s=t("../../math/Vec3"),r=t("../../math/Mat33"),o=t("../../math/Quaternion"),a=new s,u=new s,h=new s,c=new s,l=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){var t=this.anchor,e=this.a,i=this.b,n=o.conjugate(e.orientation,new o),r=o.conjugate(i.orientation,new o);this.rA=s.subtract(t,e.position,new s),this.rB=s.subtract(t,i.position,new s),this.bodyRA=n.rotateVector(this.rA,new s),this.bodyRB=r.rotateVector(this.rB,new s)},i.prototype.update=function(t,e){var i=this.a,n=this.b,o=i.orientation.rotateVector(this.bodyRA,this.rA),a=n.orientation.rotateVector(this.bodyRB,this.rB),h=new r([0,o.z,-o.y,-o.z,0,o.x,o.y,-o.x,0]),c=new r([0,a.z,-a.y,-a.z,0,a.x,a.y,-a.x,0]),l=r.multiply(h,i.inverseInertia,new r).multiply(h.transpose()),p=r.multiply(c,n.inverseInertia,new r).multiply(c.transpose()),d=r.add(l,p,l),f=s.add(i.position,this.rA,this.anchor),m=s.add(n.position,this.rB,u);s.subtract(m,f,this.error),this.error.scale(.2/e);var _=i.inverseMass,g=n.inverseMass,v=new r([_+g,0,0,0,_+g,0,0,0,_+g]);r.add(d,v,this.effMassMatrix),this.effMassMatrix.inverse();var y=this.impulse,b=this.angImpulseA,x=this.angImpulseB;n.applyImpulse(y),n.applyAngularImpulse(x),y.invert(),i.applyImpulse(y),i.applyAngularImpulse(b),y.clear(),b.clear(),x.clear()},i.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,r=s.add(t.velocity,s.cross(t.angularVelocity,i,l),h),o=s.add(e.velocity,s.cross(e.angularVelocity,n,l),c),p=r.subtract(o).subtract(this.error).applyMatrix(this.effMassMatrix),d=s.cross(n,p,a),f=s.cross(i,p,u).invert();e.applyImpulse(p),e.applyAngularImpulse(d),p.invert(),t.applyImpulse(p),t.applyAngularImpulse(f),p.invert(),this.impulse.add(p),this.angImpulseA.add(f),this.angImpulseB.add(d)},e.exports=i},{"../../math/Mat33":41,"../../math/Quaternion":42,"../../math/Vec3":44,"./Constraint":58}],57:[function(t,e){function i(t,e,i){return e>t?e:t>i?i:t}function n(t,e,i,n,s,r){this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=s,this.localContactB=r}function s(t,e){this.targets=[],t&&(this.targets=this.targets.concat(t)),c.call(this,e)}function r(t,e,i){var n=e.position,s=i.position,r=h.subtract(s,n,new h),o=r.length(),a=e.radius+i.radius,u=r.scale(1/o),c=a-o;if(!(0>c)){var l=h.scale(u,e.radius,new h),p=h.scale(u,-i.radius,new h),d=h.add(n,l,new h),f=h.add(s,p,new h),m=v().reset(c,u,d,f,l,p);t.contactManifoldTable.registerContact(e,i,m)}}function o(t,e,n){if(e.type===w){var s=n;n=e,e=s}var r=e.position,o=n.position,a=h.subtract(o,r,y),u=e.orientation,c=n.radius,l=e.size,p=.5*l[0],d=.5*l[1],f=.5*l[2],m=e.normals,_=u.rotateVector(m[1],new h),g=u.rotateVector(m[0],new h),b=u.rotateVector(m[2],new h),x=new h;x.x=i(h.dot(a,_),-p,p),x.y=i(h.dot(a,g),-d,d),x.z=i(h.dot(a,b),-f,f),x.applyRotation(u);var E=h.add(r,x,new h),S=h.subtract(E,o,E),T=S.length(),C=c-T;if(!(0>C)){var A=h.scale(S,-1/T,new h),P=x,O=S,R=h.add(r,P,new h),I=h.add(o,O,new h),M=v().reset(C,A,R,I,P,O);t.contactManifoldTable.registerContact(e,n,M)}}function a(t,e,i){var n=f(e,i);if(n){var s=m(e,i,n);null!==s&&t.contactManifoldTable.registerContact(e,i,s)}}function u(t,e,i){if(e.type===E){var n=i;i=e,e=n}var s=e.position,r=i.position,o=i.normal,a=i.invNormal,u=e.support(a),c=h.add(s,u,new h),l=h.subtract(c,r,y),p=h.dot(l,a);if(!(0>p)){var d=h.scale(o,p,new h).add(c),f=h.subtract(d,i.position,new h),m=v().reset(p,a,c,d,u,f);t.contactManifoldTable.registerContact(e,i,m)}}var h=t("../../math/Vec3"),c=t("./Constraint"),l=t("./collision/SweepAndPrune"),p=t("./collision/BruteForce"),d=t("./collision/ConvexCollisionDetection"),f=d.gjk,m=d.epa,_=t("./collision/ContactManifold"),g=t("../../utilities/ObjectManager");g.register("CollisionData",n);var v=g.requestCollisionData,y=new h;n.prototype.reset=function(t,e,i,n,s,r){return this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=s,this.localContactB=r,this},s.prototype=Object.create(c.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.broadPhase){var t=this.broadphase;t instanceof Function&&(this.broadPhase=new t(this.targets))}else this.broadPhase=new l(this.targets);this.contactManifoldTable=this.contactManifoldTable||new _},s.prototype.update=function(t,e){if(this.contactManifoldTable.update(e),0!==this.targets.length){var i,n;for(i=0,n=this.targets.length;n>i;i++)this.targets[i].updateShape();var s,r=this.broadPhase.update();for(i=0,n=r.length;n>i;i++)s=r[i],s&&this.applyNarrowPhase(s);this.contactManifoldTable.prepContacts(e)}},s.prototype.resolve=function(t,e){this.contactManifoldTable.resolveManifolds(e)},s.prototype.addTarget=function(t){this.targets.push(t),this.broadPhase.add(t)},s.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||(this.targets.splice(e,1),this.broadPhase.remove(t))};var b=1,x=2,w=4,E=8,S=b|b,T=x|x,C=x|b,A=w|w,P=x|w,O=b|w,R=b|E,I=x|E,M=w|E,D={};D[S]=a,D[T]=a,D[C]=a,D[O]=a,D[A]=r,D[P]=o,D[R]=u,D[I]=u,D[M]=u,s.prototype.applyNarrowPhase=function(t){for(var e=0,i=t.length;i>e;e++)for(var n=e+1;i>n;n++){var s=t[e],r=t[n];if(0!==(s.collisionMask&r.collisionGroup&&s.collisionGroup&r.collisionMask)){var o=s.type|r.type;D[o]&&D[o](this,s,r)}}},s.SweepAndPrune=l,s.BruteForce=p.BruteForce,s.BruteForceAABB=p.BruteForceAABB,e.exports=s},{"../../math/Vec3":44,"../../utilities/ObjectManager":93,"./Constraint":58,"./collision/BruteForce":64,"./collision/ContactManifold":65,"./collision/ConvexCollisionDetection":66,"./collision/SweepAndPrune":67}],58:[function(t,e){function i(t){t=t||{},this.setOptions(t),this._ID=n++}var n=0;i.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},i.prototype.init=function(){},i.prototype.update=function(){},i.prototype.resolve=function(){},e.exports=i},{}],59:[function(t,e){function i(t,e){this.targets=t?t instanceof Array?t:[t]:[],n.call(this,e),this.impulses={},this.normals={},this.velocityBiases={},this.divisors={}}var n=t("./Constraint"),s=t("../../math/Vec3"),r=new s,o=new s,a=1e-7,u=Math.PI;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){this.equation1=this.equation1||function(){return 0},this.equation2=this.equation2||function(t,e,i){return i},this.period=this.period||1,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*u*u/(this.period*this.period),this.damping=4*u*this.dampingRatio/this.period},i.prototype.update=function(t,e){for(var i=this.targets,n=this.normals,u=this.velocityBiases,h=this.divisors,c=this.impulses,l=r,p=o,d=this.equation1,f=this.equation2,m=this.damping,_=this.stiffness,g=0,v=i.length;v>g;g++){var y=i[g],b=y._ID;if(!y.immune){var x,w,E=y.position,S=y.mass;if(0===this.period)x=0,w=1;else{var T=m*S,C=_*S;x=1/(e*(T+e*C)),w=e*C/(T+e*C)}var A=E.x,P=E.y,O=E.z,R=d(A,P,O),I=(d(A+a,P,O)-R)/a,M=(d(A,P+a,O)-R)/a,D=(d(A,P,O+a)-R)/a,L=f(A,P,O),j=(f(A+a,P,O)-L)/a,N=(f(A,P+a,O)-L)/a,U=(f(A,P,O+a)-L)/a;p.set(I+j,M+N,D+U),p.normalize();var k=w*(R+L)/e,z=x+1/S,F=c[b]||0;s.scale(p,F,l),y.applyImpulse(l),n[b]=n[b]||new s,n[b].copy(p),u[b]=k,h[b]=z,c[b]=0}}},i.prototype.resolve=function(){for(var t=this.targets,e=this.normals,i=this.velocityBiases,n=this.divisors,o=this.impulses,a=r,u=0,h=t.length;h>u;u++){var c=t[u],l=c._ID;if(!c.immune){var p=c.velocity,d=e[l],f=-(s.dot(d,p)+i[l])/n[l];s.scale(d,f,a),c.applyImpulse(a),o[l]+=f}}},e.exports=i},{"../../math/Vec3":44,"./Constraint":58}],60:[function(t,e){function i(t,e,i){this.a=t,this.b=e,n.call(this,i),this.impulse=0,this.distance=0,this.normal=new s,this.velocityBias=0,this.divisor=0}var n=t("./Constraint"),s=t("../../math/Vec3"),r=new s,o=new s,a=new s,u=new s,h=new s,c=Math.PI;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){this.direction=this.direction||s.subtract(this.b.position,this.a.position,new s),this.direction.normalize(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*c*c/(this.period*this.period),this.damping=4*c*this.dampingRatio/this.period},i.prototype.update=function(t,e){var i=this.a,n=this.b,a=r,c=u,l=o,p=h,d=i.position,f=i.inverseMass,m=n.position,_=n.inverseMass,g=this.direction;s.subtract(m,d,c),s.scale(g,s.dot(g,c),p);var v=p.add(d);s.subtract(m,v,a);var y=a.length();a.normalize();var b,x,w=f+_,E=1/w;if(0===this.period)b=0,x=1;else{var S=this.damping*E,T=this.stiffness*E;b=1/(e*(S+e*T)),x=e*T/(S+e*T)}var C=x*y/e,A=b+w,P=this.impulse;s.scale(a,P,l),n.applyImpulse(l),i.applyImpulse(l.invert()),this.normal.copy(a),this.distance=y,this.velocityBias=C,this.divisor=A,this.impulse=0},i.prototype.resolve=function(){var t=this.a,e=this.b,i=o,n=a,r=this.minLength,u=this.distance;if(!(Math.abs(u)<r)){var h=t.velocity,c=e.velocity,l=this.normal;s.subtract(c,h,n);var p=-(s.dot(l,n)+this.velocityBias)/this.divisor;s.scale(l,p,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=p}},e.exports=i},{"../../math/Vec3":44,"./Constraint":58}],61:[function(t,e){function i(t,e,i){this.a=t,this.b=e,n.call(this,i),this.impulse=0,this.distance=0,this.normal=new s,this.velocityBias=0,this.divisor=0}var n=t("./Constraint"),s=t("../../math/Vec3"),r=new s,o=new s,a=new s,u=new s,h=Math.PI;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){this.length=this.length||s.subtract(this.b.position,this.a.position,u).length(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*h*h/(this.period*this.period),this.damping=4*h*this.dampingRatio/this.period},i.prototype.update=function(t,e){var i=this.a,n=this.b,a=r,h=u,c=o,l=this.length,p=i.position,d=i.inverseMass,f=n.position,m=n.inverseMass;s.subtract(f,p,h);var _=h.length();s.scale(h,1/_,a);var g,v,y=_-l,b=d+m,x=1/b;if(0===this.period)g=0,v=1;else{var w=this.damping*x,E=this.stiffness*x;g=1/(e*(w+e*E)),v=e*E/(w+e*E)}var S=v*y/e,T=g+b,C=this.impulse;s.scale(a,C,c),n.applyImpulse(c),i.applyImpulse(c.invert()),this.normal.copy(a),this.distance=y,this.velocityBias=S,this.divisor=T,this.impulse=0},i.prototype.resolve=function(){var t=this.a,e=this.b,i=o,n=a,r=this.minLength,u=this.distance;if(!(Math.abs(u)<r)){var h=t.getVelocity(),c=e.getVelocity(),l=this.normal;s.subtract(c,h,n);var p=-(s.dot(l,n)+this.velocityBias)/this.divisor;s.scale(l,p,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=p}},e.exports=i},{"../../math/Vec3":44,"./Constraint":58}],62:[function(t,e){function i(t,e,i){this.a=t,this.b=e,n.call(this,i),this.impulse=new s,this.angImpulseA=new s,this.angImpulseB=new s,this.error=new s,this.errorRot=[0,0],this.effMassMatrix=new r,this.effMassMatrixRot=[]}var n=t("./Constraint"),s=t("../../math/Vec3"),r=t("../../math/Mat33"),o=t("../../math/Quaternion"),a=new s,u=new s,h=new s,c=new s,l=new s,p=new s,d=new s,f=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){var t=this.anchor,e=this.axis.normalize(),i=this.a,n=this.b,r=o.conjugate(i.orientation,new o),a=o.conjugate(n.orientation,new o);this.rA=s.subtract(t,i.position,new s),this.rB=s.subtract(t,n.position,new s),this.bodyRA=r.rotateVector(this.rA,new s),this.bodyRB=a.rotateVector(this.rB,new s),this.axisA=s.clone(e),this.axisB=s.clone(e),this.axisBTangent1=new s,this.axisBTangent2=new s,this.t1xA=new s,this.t2xA=new s,this.bodyAxisA=r.rotateVector(e,new s),this.bodyAxisB=a.rotateVector(e,new s)},i.prototype.update=function(t,e){var i=this.a,n=this.b,o=i.orientation.rotateVector(this.bodyAxisA,this.axisA),l=n.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(l);var p=l,d=this.axisBTangent1,f=this.axisBTangent2;p.x>=.57735?d.set(p.y,-p.x,0):d.set(0,p.z,-p.y),d.normalize(),s.cross(p,d,f);var m=s.cross(d,o,this.t1xA),_=s.cross(f,o,this.t2xA),g=i.orientation.rotateVector(this.bodyRA,this.rA),v=n.orientation.rotateVector(this.bodyRB,this.rB),y=new r([0,g.z,-g.y,-g.z,0,g.x,g.y,-g.x,0]),b=new r([0,v.z,-v.y,-v.z,0,v.x,v.y,-v.x,0]),x=r.multiply(y,i.inverseInertia,new r).multiply(y.transpose()),w=r.multiply(b,n.inverseInertia,new r).multiply(b.transpose()),E=r.add(x,w,x),S=s.add(i.position,this.rA,this.anchor),T=s.add(n.position,this.rB,a),C=1/e;s.subtract(T,S,this.error),this.error.scale(.2*C);var A=i.inverseMass,P=n.inverseMass,O=new r([A+P,0,0,0,A+P,0,0,0,A+P]);r.add(E,O,this.effMassMatrix),this.effMassMatrix.inverse();var R=i.inverseInertia.vectorMultiply(m,a),I=i.inverseInertia.vectorMultiply(_,u),M=n.inverseInertia.vectorMultiply(m,h),D=n.inverseInertia.vectorMultiply(_,c),L=s.dot(m,R)+s.dot(m,M),j=s.dot(m,I)+s.dot(m,D),N=s.dot(_,R)+s.dot(_,M),U=s.dot(_,I)+s.dot(_,D),k=1/(L*U-j*N);this.effMassMatrixRot[0]=U*k,this.effMassMatrixRot[1]=-N*k,this.effMassMatrixRot[2]=-j*k,this.effMassMatrixRot[3]=L*k,this.errorRot[0]=.2*s.dot(o,d)*C,this.errorRot[1]=.2*s.dot(o,f)*C;var z=this.impulse.scale(.5),F=this.angImpulseA.scale(.5),q=this.angImpulseB.scale(.5);n.applyImpulse(z),n.applyAngularImpulse(q),z.invert(),i.applyImpulse(z),i.applyAngularImpulse(F),z.clear(),F.clear(),q.clear()},i.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,r=this.t1xA,o=this.t2xA,m=t.angularVelocity,_=e.angularVelocity,g=s.add(t.velocity,s.cross(m,i,d),l),v=s.add(e.velocity,s.cross(_,n,d),p),y=g.subtract(v).subtract(this.error).applyMatrix(this.effMassMatrix),b=s.subtract(_,m,f),x=this.errorRot,w=s.dot(r,b)+x[0],E=s.dot(o,b)+x[1],S=this.effMassMatrixRot,T=-(S[0]*w+S[1]*E),C=-(S[2]*w+S[3]*E),A=s.scale(r,T,u).add(s.scale(o,C,h)),P=s.cross(n,y,a).add(A),O=s.cross(i,y,c).invert().subtract(A);e.applyImpulse(y),e.applyAngularImpulse(P),y.invert(),t.applyImpulse(y),t.applyAngularImpulse(O),y.invert(),this.impulse.add(y),this.angImpulseA.add(O),this.angImpulseB.add(P)},e.exports=i},{"../../math/Mat33":41,"../../math/Quaternion":42,"../../math/Vec3":44,"./Constraint":58}],63:[function(t,e){function i(t){this._body=t,this._ID=t._ID,this.position=null,this.vertices={x:[],y:[],z:[]},this.update()}var n=4,s=8,r=0,o=1,a=2,u=3,h=4,c=5;i.prototype.update=function(){var t=this._body,e=this.position=t.position,i=1/0,l=-(1/0),p=1/0,d=-(1/0),f=1/0,m=-(1/0),_=t.type;if(_===n)l=d=m=t.radius,i=p=f=-t.radius;else if(_===s){var g=t.direction;switch(l=d=m=1e6,i=p=f=-1e6,g){case r:d=25,p=-1e3;break;case o:d=1e3,p=-25;break;case a:l=25,i=-1e3;break;case u:l=1e3,i=-25;break;case h:m=25,f=-1e3;break;case c:m=1e3,f=-25}}else if(t.vertices)for(var v=t.vertices,y=0,b=v.length;b>y;y++){var x=v[y];x.x<i&&(i=x.x),x.x>l&&(l=x.x),x.y<p&&(p=x.y),x.y>d&&(d=x.y),x.z<f&&(f=x.z),x.z>m&&(m=x.z)}else l=d=m=25,i=p=f=-25;var w=this.vertices;w.x[0]=i+e.x,w.x[1]=l+e.x,w.y[0]=p+e.y,w.y[1]=d+e.y,w.z[0]=f+e.z,w.z[1]=m+e.z},i.checkOverlap=function(t,e){var i=t.vertices,n=e.vertices,s=i.x[0],r=i.x[1],o=n.x[0],a=n.x[1];if(s>=o&&a>=s||o>=s&&r>=o){var u=i.y[0],h=i.y[1],c=n.y[0],l=n.y[1];if(u>=c&&l>=u||c>=u&&h>=c){var p=i.z[0],d=i.z[1],f=n.z[0],m=n.z[1];if(p>=f&&m>=p||f>=p&&d>=f)return!0}}return!1},i.vertexThreshold=100,e.exports=i},{}],64:[function(t,e){function i(t){this._volumes=[],this._entityRegistry={};for(var e=0;e<t.length;e++)this.add(t[e])}function n(t){this.targets=t}var s=t("./AABB");i.prototype.add=function(t){var e=new s(t);this._entityRegistry[t._ID]=t,this._volumes.push(e)},i.prototype.update=function(){for(var t=this._volumes,e=this._entityRegistry,i=0,n=t.length;n>i;i++)t[i].update();for(var r=[],o=0,a=t.length;a>o;o++)for(var u=o+1;a>u;u++)s.checkOverlap(t[o],t[u])&&r.push([e[o],e[u]]);return r},n.prototype.add=function(t){this.targets.push(t)},n.prototype.update=function(){return[this.targets]},e.exports.BruteForceAABB=i,e.exports.BruteForce=n},{"./AABB":63}],65:[function(t,e){function i(t,e,i){return e>t?e:t>i?i:t}function n(){this.manifolds=[],this.collisionMatrix={},this._IDPool=[]}function s(t,e,i,n){this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0}function r(t,e,i){this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse=new o,this.angImpulseA=new o,this.angImpulseB=new o,i&&this.init()}var o=t("../../../math/Vec3"),a=t("../../../utilities/ObjectManager");a.register("Manifold",s),a.register("Contact",r);var u=a.requestManifold,h=a.requestContact,c=a.freeManifold,l=a.freeContact,p=new o,d=new o,f=new o,m=new o,_=new o,g=new o,v=new o,y=new o,b=new o,x=new o,w=new o,E=new o,S=new o,T=new o,C=new o;n.prototype.addManifold=function(t,e,i,n){var s=this.collisionMatrix;s[t]=s[t]||{};var r=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[t][e]=r;var o=u().reset(t,e,i,n);return this.manifolds[r]=o,o},n.prototype.removeManifold=function(t,e){var i=this.collisionMatrix;this.manifolds[e]=null,i[t.lowID][t.highID]=null,this._IDPool.push(e),c(t)},n.prototype.update=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var s=e[i];if(s){var r=s.update(t);r||(this.removeManifold(s,i),s.bodyA.events.trigger("collision:end",s),s.bodyB.events.trigger("collision:end",s))}}},n.prototype.prepContacts=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var s=e[i];if(s)for(var r=s.contacts,o=0,a=r.length;a>o;o++){var u=r[o];u&&u.update(t)}}},n.prototype.resolveManifolds=function(){for(var t=this.manifolds,e=0,i=t.length;i>e;e++){var n=t[e];n&&n.resolveContacts()}},n.prototype.registerContact=function(t,e,i){var n,s;t._ID<e._ID?(n=t._ID,s=e._ID):(n=e._ID,s=t._ID);var r,o=this.manifolds,a=this.collisionMatrix;a[n]&&null!=a[n][s]?(r=o[a[n][s]],r.contains(i),r.addContact(t,e,i)):(r=this.addManifold(n,s,t,e),r.addContact(t,e,i),t.events.trigger("collision:start",r),e.events.trigger("collision:start",r))};var A=10;s.prototype.reset=function(t,e,i,n){return this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0,this},s.prototype.addContact=function(t,e,i){var n=this.lru;this.contacts[n]&&this.removeContact(this.contacts[n],n),this.contacts[n]=h().reset(t,e,i),this.lru=(this.lru+1)%4,this.numContacts++},s.prototype.removeContact=function(t,e){this.contacts[e]=null,this.numContacts--,a.freeCollisionData(t.data),t.data=null,l(t)},s.prototype.contains=function(t){for(var e=t.worldContactA,i=t.worldContactB,n=this.contacts,s=0,r=n.length;r>s;s++){var a=n[s];if(a){var u=a.data,h=o.subtract(u.worldContactA,e,T).length(),c=o.subtract(u.worldContactB,i,C).length();if(A>h||A>c)return this.removeContact(a,s),!0}}return!1},s.prototype.update=function(){for(var t=this.contacts,e=this.bodyA,i=this.bodyB,n=e.position,s=i.position,r=0,a=t.length;a>r;r++){var u=t[r];if(u){var h=u.data,c=h.normal,l=h.localContactA,p=h.localContactB,d=h.worldContactA,f=h.worldContactB,m=o.add(n,l,w),_=o.add(s,p,E),g=o.dot(o.subtract(_,m,S),c)>0,v=o.subtract(d,m,T),y=o.subtract(f,_,C);(v.length()>=A||y.length()>=A||g)&&this.removeContact(u,r)}}return this.numContacts?!0:!1},s.prototype.resolveContacts=function(){for(var t=this.contacts,e=0,i=t.length;i>e;e++)t[e]&&t[e].resolve()},r.prototype.reset=function(t,e,i){return this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse.clear(),this.angImpulseA.clear(),this.angImpulseB.clear(),this.init(),this},r.prototype.init=function(){var t=this.data,e=t.normal,i=new o;e.x>=.57735?i.set(e.y,-e.x,0):i.set(0,e.z,-e.y),i.normalize();var n=o.cross(e,i,new o);this.tangent1=i,this.tangent2=n;var s=this.bodyA,r=this.bodyB,a=t.localContactA,u=t.localContactB,h=s.inverseMass+r.inverseMass,c=o.cross(a,e,g),l=o.cross(u,e,v);this.effNormalMass=1/(h+o.dot(c,s.inverseInertia.vectorMultiply(c,p))+o.dot(l,r.inverseInertia.vectorMultiply(l,p)));var d=o.cross(a,i,g),f=o.cross(u,i,v);this.effTangentialMass1=1/(h+o.dot(d,s.inverseInertia.vectorMultiply(d,p))+o.dot(f,r.inverseInertia.vectorMultiply(f,p)));var m=o.cross(a,n,g),_=o.cross(u,n,v);this.effTangentialMass2=1/(h+o.dot(m,s.inverseInertia.vectorMultiply(m,p))+o.dot(_,r.inverseInertia.vectorMultiply(_,p))),this.restitution=Math.min(s.restitution,r.restitution),this.friction=s.friction*r.friction},r.prototype.update=function(t){var e=this.data,i=this.bodyA,n=this.bodyB,s=e.localContactA,r=e.localContactB,a=e.normal,u=o.add(i.velocity,o.cross(i.angularVelocity,s,_),f),h=o.add(n.velocity,o.cross(n.angularVelocity,r,_),m),c=h.subtract(u),l=o.dot(c,a),p=.15,d=1.5,g=20,v=Math.abs(l)<g?0:this.restitution;this.velocityBias=-p*Math.max(e.penetration-d,0)/t,this.velocityBias+=v*l;var y=this.impulse.scale(.25),b=this.angImpulseA.scale(.25),x=this.angImpulseB.scale(.25);n.applyImpulse(y),n.applyAngularImpulse(x),y.invert(),i.applyImpulse(y),i.applyAngularImpulse(b),this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,y.clear(),b.clear(),x.clear()},r.prototype.resolve=function(){var t=this.data,e=this.bodyA,n=this.bodyB,s=t.localContactA,r=t.localContactB,a=t.normal,u=this.tangent1,h=this.tangent2,c=o.add(e.velocity,o.cross(e.angularVelocity,s,_),f),l=o.add(n.velocity,o.cross(n.angularVelocity,r,_),m),g=l.subtract(c),v=-(o.dot(g,a)+this.velocityBias)*this.effNormalMass,w=Math.max(this.normalImpulse+v,0);v=w-this.normalImpulse;var E=this.friction*w,S=-o.dot(g,u)*this.effTangentialMass1,T=i(this.tangentImpulse1+S,-E,E);S=T-this.tangentImpulse1;var C=-o.dot(g,h)*this.effTangentialMass2,A=i(this.tangentImpulse2+C,-E,E);C=A-this.tangentImpulse2;var P=o.scale(a,v,y),O=o.scale(u,S,b),R=o.scale(h,C,x);P.add(O).add(R);var I=o.cross(r,P,p),M=o.cross(s,P,d).invert();n.applyImpulse(P),n.applyAngularImpulse(I),P.invert(),e.applyImpulse(P),e.applyAngularImpulse(M),this.normalImpulse=w,this.tangentImpulse1=T,this.tangentImpulse2=A,this.impulse.add(P),this.angImpulseA.add(M),this.angImpulseB.add(I)},e.exports=n},{"../../../math/Vec3":44,"../../../utilities/ObjectManager":93}],66:[function(t,e){function i(t,e,i){this.vertex=t,this.worldVertexA=e,this.worldVertexB=i}function n(t){var e,i=t.vertices;for(e=i.length;e--;){var n=i.pop();null!==n&&l(n)}t.numVertices=0;var s=t.features;for(e=s.length;e--;){var r=s.pop();null!==r&&d(r)}t.numFeatures=0,p(t)
}function s(t,e,i){var n=a.scale(i,-1,y),s=a.add(t.support(i),t.position,new a),r=a.add(e.support(n),e.position,new a);return h().reset(a.subtract(s,r,new a),s,r)}function r(t,e){var i=s,r=a.subtract(e.position,t.position,v).normalize(),o=c();o.addVertex(i(t,e,r)),r.invert();for(var u=0,h=1e3;u++<h&&(0!==r.x||0!==r.y||0!==r.z)&&(o.addVertex(i(t,e,r)),!(a.dot(o.getLastVertex().vertex,r)<0));)if(o.simplexContainsOrigin(r,l))return o;return n(o),!1}function o(t,e,i){for(var r=s,o=1/0,h=0,c=1e3;h++<c;){var p=i.getFeatureClosestToOrigin();if(null===p)return null;var d=p.normal,v=r(t,e,d);if(o=Math.min(o,a.dot(v.vertex,d)),o-p.distance<=.01){var y=i.vertices[p.vertexIndices[0]],b=i.vertices[p.vertexIndices[1]],x=i.vertices[p.vertexIndices[2]],w=y.vertex,E=b.vertex,S=x.vertex,T=a.scale(d,p.distance,f),C=a.subtract(E,w,m),A=a.subtract(S,w,_),P=a.subtract(T,w,g),O=a.dot(C,C),R=a.dot(C,A),I=a.dot(A,A),M=a.dot(P,C),D=a.dot(P,A),L=O*I-R*R,j=(I*M-R*D)/L,N=(O*D-R*M)/L,U=1-j-N,k=y.worldVertexA.scale(U).add(b.worldVertexA.scale(j)).add(x.worldVertexA.scale(N)),z=y.worldVertexB.scale(U).add(b.worldVertexB.scale(j)).add(x.worldVertexB.scale(N)),F=a.subtract(k,t.position,new a),q=a.subtract(z,e.position,new a);return n(i),l(v),u.requestCollisionData().reset(p.distance,d,k,z,F,q)}i.addVertex(v),i.reshape()}throw new Error("EPA failed to terminate in allotted iterations.")}var a=t("../../../math/Vec3"),u=t("../../../utilities/ObjectManager");u.register("GJK_EPASupportPoint",i);var h=u.requestGJK_EPASupportPoint,c=u.requestDynamicGeometry,l=u.freeGJK_EPASupportPoint,p=u.freeDynamicGeometry,d=u.freeDynamicGeometryFeature,f=new a,m=new a,_=new a,g=new a,v=new a,y=new a;i.prototype.reset=function(t,e,i){return this.vertex=t,this.worldVertexA=e,this.worldVertexB=i,this},e.exports.gjk=r,e.exports.epa=o},{"../../../math/Vec3":44,"../../../utilities/ObjectManager":93}],67:[function(t,e){function i(t){this._sweepVolumes=[],this._entityRegistry={},this._boundingVolumeRegistry={},this.endpoints={x:[],y:[],z:[]},this.overlaps=[],this.overlapsMatrix={},this._IDPool=[],t=t||[];for(var e=0;e<t.length;e++)this.add(t[e])}function n(t){this._boundingVolume=t,this._ID=t._ID,this.points={x:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],y:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],z:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}]},this.update()}var s=t("./AABB"),r=["x","y","z"];i.prototype.add=function(t){var e=new s(t),i=new n(e);this._entityRegistry[t._ID]=t,this._boundingVolumeRegistry[t._ID]=e,this._sweepVolumes.push(i);for(var o=0;3>o;o++){var a=r[o];this.endpoints[a].push(i.points[a][0]),this.endpoints[a].push(i.points[a][1])}},i.prototype.remove=function(t){this._entityRegistry[t._ID]=null,this._boundingVolumeRegistry[t._ID]=null;var e,i,n;for(e=0,i=this._sweepVolumes.length;i>e;e++)if(this._sweepVolumes[e]._ID===t._ID){n=e;break}this._sweepVolumes.splice(n,1);var s,r=this.endpoints,o=[];for(e=0,i=r.x.length;i>e;e++)s=r.x[e],s._ID!==t._ID&&o.push(s);var a=[];for(e=0,i=r.y.length;i>e;e++)s=r.y[e],s._ID!==t._ID&&a.push(s);var u=[];for(e=0,i=r.z.length;i>e;e++)s=r.z[e],s._ID!==t._ID&&u.push(s);r.x=o,r.y=a,r.z=u},i.prototype.update=function(){var t,e,i,n,o=this._sweepVolumes,a=this._entityRegistry,u=this._boundingVolumeRegistry;for(e=0,n=o.length;n>e;e++)o[e].update();var h=this.endpoints,c=this.overlaps,l=this.overlapsMatrix,p=this._IDPool;for(i=0;3>i;i++){var d=r[i],f=h[d];for(e=1,n=f.length;n>e;e++){var m,_,g,v,y,b,x,w=f[e],E=w.value;for(t=e-1;t>=0&&(m=f[t]).value>E;)b=w._ID,x=m._ID,x>b?(v=b,y=x):(v=x,y=b),~w.side&m.side?s.checkOverlap(u[b],u[x])&&(_=l[v]=l[v]||{},g=_[y]=p.length?p.pop():c.length,c[g]=[a[v],a[y]]):w.side&~m.side&&(_=l[v])&&null!=_[y]&&(g=_[y],c[g]=null,_[y]=null,p.push(g)),f[t+1]=m,t--;f[t+1]=w}}return c},n.prototype.update=function(){var t=this._boundingVolume;t.update();for(var e=this.points,i=0;3>i;i++){var n=r[i];e[n][0].value=t.vertices[n][0],e[n][1].value=t.vertices[n][1]}},e.exports=i},{"./AABB":63}],68:[function(t,e){function i(t,e){n.call(this,t,e)}var n=t("./Force"),s=t("../../math/Vec3"),r=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.QUADRATIC=function(t){return t*t},i.LINEAR=function(t){return t},i.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||i.LINEAR},i.prototype.update=function(){for(var t=this.targets,e=this.type,i=r,n=this.max,o=this.strength,a=0,u=t.length;u>a;a++){var h=t[a],c=h.velocity,l=c.length(),p=l?1/l:0,d=-o*e(l);s.scale(c,(-n>d?-n:d)*p,i),h.applyForce(i)}},e.exports=i},{"../../math/Vec3":44,"./Force":69}],69:[function(t,e){function i(t,e){this.targets=t?t instanceof Array?t:[t]:[],e=e||{},this.setOptions(e),this._ID=n++}var n=0;i.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},i.prototype.addTarget=function(t){this.targets.push(t)},i.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||this.targets.splice(e,1)},i.prototype.init=function(){},i.prototype.update=function(){},e.exports=i},{}],70:[function(t,e){function i(t,e){n.call(this,t,e)}var n=t("./Force"),s=t("../../math/Vec3"),r=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DOWN=0,i.UP=1,i.LEFT=2,i.RIGHT=3,i.FORWARD=4,i.BACKWARD=5,i.prototype.init=function(t){if(this.max=this.max||1/0,t.acceleration)return this.strength=this.acceleration.length(),void(this.direction=-1);var e=this.acceleration=new s,n=this.direction=this.direction||i.DOWN,r=this.strength=this.strength||200;switch(n){case i.DOWN:e.set(0,r,0);break;case i.UP:e.set(0,-1*r,0);break;case i.LEFT:e.set(-1*r,0,0);break;case i.RIGHT:e.set(r,0,0);break;case i.FORWARD:e.set(0,0,-1*r);break;case i.BACKWARD:e.set(0,0,r)}},i.prototype.update=function(){for(var t=this.targets,e=r,i=this.max,n=this.acceleration,o=n.length(),a=o?1/o:0,u=0,h=t.length;h>u;u++){var c=t[u],l=o*c.mass;s.scale(n,(l>i?i:l)*a,e),c.applyForce(e)}},e.exports=i},{"../../math/Vec3":44,"./Force":69}],71:[function(t,e){function i(t,e,i){this.source=t||null,n.call(this,e,i)}var n=t("./Force"),s=t("../../math/Vec3"),r=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||200},i.prototype.update=function(){for(var t=this.source,e=this.targets,i=r,n=this.strength,o=this.max,a=this.anchor||t.position,u=this.anchor?1:t.mass,h=0,c=e.length;c>h;h++){var l=e[h];s.subtract(a,l.position,i);var p=i.length(),d=p?1/p:0,f=n*u*l.mass*d*d;f=0>f?-o>f?-o:f:f>o?o:f,i.scale(f*d),l.applyForce(i),t&&t.applyForce(i.invert())}},e.exports=i},{"../../math/Vec3":44,"./Force":69}],72:[function(t,e){function i(t,e){n.call(this,t,e)}var n=t("./Force"),s=t("../../math/Vec3"),r=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.QUADRATIC=function(t){return t.length()},i.LINEAR=function(){return 1},i.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||i.LINEAR},i.prototype.update=function(){for(var t=this.targets,e=this.type,i=r,n=this.max,o=this.strength,a=0,u=t.length;u>a;a++){var h=t[a],c=h.angularVelocity,l=-o*e(c);s.scale(c,-n>l?-n:l,i),h.applyTorque(i)}},e.exports=i},{"../../math/Vec3":44,"./Force":69}],73:[function(t,e){function i(t,e,i){this.source=t||null,n.call(this,e,i)}var n=t("./Force"),s=t("../../math/Vec3"),r=t("../../math/Mat33"),o=t("../../math/Quaternion"),a=new o,u=new s,h=new s,c=new r,l=Math.PI;i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.init=function(t){this.source||(this.anchor=this.anchor?this.anchor.normalize():new o(1,0,0,0)),t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*l/this.period,this.stiffness*=this.stiffness,this.damping=4*l*this.dampingRatio/this.period)},i.prototype.update=function(){for(var t=this.source,e=this.targets,i=a,n=u,l=h,p=c,d=this.max,f=this.stiffness,m=this.damping,_=this.anchor||t.orientation,g=this.anchor?null:t.inverseInertia,v=0,y=e.length;y>v;v++){var b=e[v],x=b.orientation;if(o.conjugate(x,i),i.multiply(_),!(i.w>=1)){var w=Math.acos(i.w),E=Math.sqrt(1-i.w*i.w),S=l.copy(i).scale(2*w/E);S.scale(f),null!==g?r.add(g,b.inverseInertia,p).inverse():r.inverse(b.inverseInertia,p),0!==m&&S.add(t?s.subtract(b.angularVelocity,t.angularVelocity,n).scale(-m):s.scale(b.angularVelocity,-m,n));var T=S.applyMatrix(p),C=T.length();C>d&&T.scale(d/C),b.applyTorque(T),t&&t.applyTorque(T.invert())}}},e.exports=i},{"../../math/Mat33":41,"../../math/Quaternion":42,"../../math/Vec3":44,"./Force":69}],74:[function(t,e){function i(t,e,i){this.source=t||null,n.call(this,e,i)}var n=t("./Force"),s=t("../../math/Vec3"),r=new s,o=new s;i.prototype=Object.create(n.prototype),i.prototype.constructor=i;var a=Math.PI;i.FENE=function(t,e){var i=.99*e,n=Math.max(Math.min(t,i),-i);return n/(1-n*n/(e*e))},i.HOOKE=function(t){return t},i.prototype.init=function(t){this.max=this.max||1/0,this.length=this.length||0,this.type=this.type||i.HOOKE,this.maxLength=this.maxLength||1/0,t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*a/this.period,this.stiffness*=this.stiffness,this.damping=4*a*this.dampingRatio/this.period)},i.prototype.update=function(){for(var t=this.source,e=this.targets,i=r,n=o,a=this.max,u=this.stiffness,h=this.damping,c=this.length,l=this.maxLength,p=this.anchor||t.position,d=this.anchor?0:t.inverseMass,f=this.type,m=0,_=e.length;_>m;m++){var g=e[m];s.subtract(p,g.position,i);var v=i.length(),y=v-c;if(!(Math.abs(y)<1e-6)){var b=1/(g.inverseMass+d);null!==this.period&&(u*=b,h*=b),i.scale(u*f(y,l)/y),0!==h&&i.add(t?s.subtract(g.velocity,t.velocity,n).scale(-h):s.scale(g.velocity,-h,n));var x=i.length(),w=x?1/x:0;s.scale(i,(x>a?a:x)*w,i),g.applyForce(i),t&&t.applyForce(i.invert())}}},e.exports=i},{"../../math/Vec3":44,"./Force":69}],75:[function(t,e){e.exports={Particle:t("./bodies/Particle"),convexBodyFactory:t("./bodies/convexBodyFactory"),Box:t("./bodies/Box"),Sphere:t("./bodies/Sphere"),Wall:t("./bodies/Wall"),Constraint:t("./constraints/Constraint"),Angle:t("./constraints/Angle"),Collision:t("./constraints/Collision"),Direction:t("./constraints/Direction"),Distance:t("./constraints/Distance"),Curve:t("./constraints/Curve"),Hinge:t("./constraints/Hinge"),BallAndSocket:t("./constraints/BallAndSocket"),Force:t("./forces/Force"),Drag:t("./forces/Drag"),RotationalDrag:t("./forces/RotationalDrag"),Gravity1D:t("./forces/Gravity1D"),Gravity3D:t("./forces/Gravity3D"),Spring:t("./forces/Spring"),RotationalSpring:t("./forces/RotationalSpring"),PhysicsEngine:t("./PhysicsEngine"),Geometry:t("./Geometry")}},{"./Geometry":48,"./PhysicsEngine":49,"./bodies/Box":50,"./bodies/Particle":51,"./bodies/Sphere":52,"./bodies/Wall":53,"./bodies/convexBodyFactory":54,"./constraints/Angle":55,"./constraints/BallAndSocket":56,"./constraints/Collision":57,"./constraints/Constraint":58,"./constraints/Curve":59,"./constraints/Direction":60,"./constraints/Distance":61,"./constraints/Hinge":62,"./forces/Drag":68,"./forces/Force":69,"./forces/Gravity1D":70,"./forces/Gravity3D":71,"./forces/RotationalDrag":72,"./forces/RotationalSpring":73,"./forces/Spring":74}],76:[function(t,e){var i,n,s=0,r=["ms","moz","webkit","o"];if("object"==typeof window){i=window.requestAnimationFrame,n=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(var o=0;o<r.length&&!i;++o)i=window[r[o]+"RequestAnimationFrame"],n=window[r[o]+"CancelRequestAnimationFrame"]||window[r[o]+"CancelAnimationFrame"];i&&!n&&(i=null)}if(!i){var a=Date.now?Date.now:function(){return(new Date).getTime()};i=function(t){var e=a(),i=Math.max(0,16-(e-s)),n=setTimeout(function(){t(e+i)},i);return s=e+i,n},n=function(t){clearTimeout(t)}}var u={requestAnimationFrame:i,cancelAnimationFrame:n};e.exports=u},{}],77:[function(t,e){e.exports={requestAnimationFrame:t("./animationFrame").requestAnimationFrame,cancelAnimationFrame:t("./animationFrame").cancelAnimationFrame}},{"./animationFrame":76}],78:[function(t,e){function i(){this._updates=[],this._stoppedAt=n(),this._sleep=0,this.start();var t=this;window.addEventListener("message",function(e){t._onWindowMessage(e)})}var n=t("./now");i.prototype._onWindowMessage=function(t){this._running&&t.data.constructor===Array&&"FRAME"===t.data[0]&&this.step(t.data[1]-this._sleep)},i.prototype.start=function(){return this._running=!0,this._sleep+=n()-this._stoppedAt,this},i.prototype.stop=function(){return this._running=!1,this._stoppedAt=n(),this},i.prototype.isRunning=function(){return this._running},i.prototype.step=function(t){for(var e=0,i=this._updates.length;i>e;e++)this._updates[e].update(t);return this},i.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},i.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},e.exports=i},{"./now":81}],79:[function(t,e){function i(){var t=this;this._updates=[],this._looper=function(e){t.loop(e)},this._time=0,this._stoppedAt=0,this._sleep=0,this._startOnVisibilityChange=!0,this._rAF=null,this._sleepDiff=!0,this.start(),o&&document.addEventListener(u,function(){t._onVisibilityChange()})}var n=t("../polyfills"),s=n.requestAnimationFrame,r=n.cancelAnimationFrame,o="undefined"!=typeof document;if(o){var a,u;"undefined"!=typeof document.hidden?(a="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",u="webkitvisibilitychange")}i.prototype._onVisibilityChange=function(){document[a]?this._onUnfocus():this._onFocus()},i.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()},i.prototype._onUnfocus=function(){this._stop()},i.prototype.start=function(){return this._running||(this._startOnVisibilityChange=!0,this._start()),this},i.prototype._start=function(){this._running=!0,this._sleepDiff=!0,this._rAF=s(this._looper)},i.prototype.stop=function(){return this._running&&(this._startOnVisibilityChange=!1,this._stop()),this},i.prototype._stop=function(){this._running=!1,this._stoppedAt=this._time,r(this._rAF)},i.prototype.isRunning=function(){return this._running},i.prototype.step=function(t){this._time=t,this._sleepDiff&&(this._sleep+=t-this._stoppedAt,this._sleepDiff=!1);for(var e=t-this._sleep,i=0,n=this._updates.length;n>i;i++)this._updates[i].update(e);return this},i.prototype.loop=function(t){return this.step(t),this._rAF=s(this._looper),this},i.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},i.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},e.exports=i},{"../polyfills":77}],80:[function(t,e){e.exports={RequestAnimationFrameLoop:t("./RequestAnimationFrameLoop"),ContainerLoop:t("./ContainerLoop"),now:t("./now")}},{"./ContainerLoop":78,"./RequestAnimationFrameLoop":79,"./now":81}],81:[function(t,e){var i=window.performance&&window.performance.now?function(){return window.performance.now()}:Date.now;e.exports=i},{}],82:[function(t,e){function i(){s(),this._contexts={},this._outCommands=[],this._inCommands=[],this._time=null,this._resized=!1;var t=this;window.addEventListener("resize",function(){t._resized=!0})}var n=t("./Context"),s=t("./inject-css");i.prototype.getTime=function(){return this._time},i.prototype.sendEvent=function(t,e,i){this._outCommands.push("WITH",t,"TRIGGER",e,i)},i.prototype.sendResize=function(t,e){this.sendEvent(t,"CONTEXT_RESIZE",e)},i.prototype.handleWith=function(t,e){var i=e[t],n=i.split("/"),s=this.getOrSetContext(n.shift());return s.receive(i,e,t)},i.prototype.getOrSetContext=function(t){if(this._contexts[t])return this._contexts[t];var e=new n(t,this);return this._contexts[t]=e,e},i.prototype.giveSizeFor=function(t,e){var i=e[t],n=this.getOrSetContext(i).getRootSize();this.sendResize(i,n)},i.prototype.drawCommands=function(){for(var t=this._inCommands,e=0,i=t[e];i;){switch(i){case"TIME":this._time=t[++e];break;case"WITH":e=this.handleWith(++e,t);break;case"NEED_SIZE_FOR":this.giveSizeFor(++e,t)}i=t[++e]}for(var n in this._contexts)this._contexts[n].draw();return this._resized&&this.updateSize(),this._outCommands},i.prototype.updateSize=function(){for(var t in this._contexts)this._contexts[t].updateSize()},i.prototype.receiveCommands=function(t){for(var e=t.length,i=0;e>i;i++)this._inCommands.push(t[i])},i.prototype.clearCommands=function(){this._inCommands.length=0,this._outCommands.length=0,this._resized=!1},e.exports=i},{"./Context":83,"./inject-css":86}],83:[function(t,e){function i(t,e){this._compositor=e,this._rootEl=document.querySelector(t),this._selector=t;var i=document.createElement("div");this._rootEl.appendChild(i),this.DOMRenderer=new r(i,t,e),this.WebGLRenderer=null,this.canvas=null,this._renderState={projectionType:s.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1},this._size=[],this._children={},this._elementHash={},this._meshTransform=[],this._meshSize=[0,0,0]}var n=t("../webgl-renderers/WebGLRenderer"),s=t("../components/Camera"),r=t("../dom-renderers/DOMRenderer");i.prototype.updateSize=function(){var t=this.DOMRenderer.getSize();this._compositor.sendResize(this._selector,t);var e=t[0],i=t[1];return this._size[0]=e,this._size[1]=i,this._size[2]=e>i?e:i,this.canvas&&(this.canvas.width=e,this.canvas.height=i),this.WebGLRenderer&&this.WebGLRenderer.updateSize(this._size),this},i.prototype.draw=function(){this.DOMRenderer.draw(this._renderState),this.WebGLRenderer&&this.WebGLRenderer.draw(this._renderState),this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1),this._renderState.viewDirty&&(this._renderState.viewDirty=!1)},i.prototype.getRootSize=function(){return this.DOMRenderer.getSize()},i.prototype.initWebGL=function(){this.canvas=document.createElement("canvas"),this._rootEl.appendChild(this.canvas),this.WebGLRenderer=new n(this.canvas,this._compositor),this.updateSize()},i.prototype.receive=function(t,e,i){var n=i,r=e[++n];for(this.DOMRenderer.loadPath(t),this.DOMRenderer.findTarget();r;){switch(r){case"INIT_DOM":this.DOMRenderer.insertEl(e[++n]);break;case"DOM_RENDER_SIZE":this.DOMRenderer.getSizeOf(e[++n]);break;case"CHANGE_TRANSFORM":for(var o=0;16>o;o++)this._meshTransform[o]=e[++n];this.DOMRenderer.setMatrix(this._meshTransform),this.WebGLRenderer&&this.WebGLRenderer.setCutoutUniform(t,"u_transform",this._meshTransform);break;case"CHANGE_SIZE":var a=e[++n],u=e[++n];this.DOMRenderer.setSize(a,u),this.WebGLRenderer&&(this._meshSize[0]=a,this._meshSize[1]=u,this.WebGLRenderer.setCutoutUniform(t,"u_size",this._meshSize));break;case"CHANGE_PROPERTY":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setProperty(e[++n],e[++n]);break;case"CHANGE_CONTENT":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setContent(e[++n]);break;case"CHANGE_ATTRIBUTE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setAttribute(e[++n],e[++n]);break;case"ADD_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.addClass(e[++n]);break;case"REMOVE_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.removeClass(e[++n]);break;case"SUBSCRIBE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.subscribe(e[++n],e[++n]);break;case"GL_SET_DRAW_OPTIONS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshOptions(t,e[++n]);break;case"GL_AMBIENT_LIGHT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setAmbientLightColor(t,e[++n],e[++n],e[++n]);break;case"GL_LIGHT_POSITION":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightPosition(t,e[++n],e[++n],e[++n]);break;case"GL_LIGHT_COLOR":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightColor(t,e[++n],e[++n],e[++n]);break;case"MATERIAL_INPUT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.handleMaterialInput(t,e[++n],e[++n]);break;case"GL_SET_GEOMETRY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setGeometry(t,e[++n],e[++n],e[++n]);break;case"GL_UNIFORMS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshUniform(t,e[++n],e[++n]);break;case"GL_BUFFER_DATA":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.bufferData(t,e[++n],e[++n],e[++n],e[++n],e[++n]);break;case"GL_CUTOUT_STATE":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setCutoutState(t,e[++n]);break;case"GL_MESH_VISIBILITY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshVisibility(t,e[++n]);break;case"GL_REMOVE_MESH":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.removeMesh(t);break;case"PINHOLE_PROJECTION":this._renderState.projectionType=s.PINHOLE_PROJECTION,this._renderState.perspectiveTransform[11]=-1/e[++n],this._renderState.perspectiveDirty=!0;break;case"ORTHOGRAPHIC_PROJECTION":this._renderState.projectionType=s.ORTHOGRAPHIC_PROJECTION,this._renderState.perspectiveTransform[11]=0,this._renderState.perspectiveDirty=!0;break;case"CHANGE_VIEW_TRANSFORM":this._renderState.viewTransform[0]=e[++n],this._renderState.viewTransform[1]=e[++n],this._renderState.viewTransform[2]=e[++n],this._renderState.viewTransform[3]=e[++n],this._renderState.viewTransform[4]=e[++n],this._renderState.viewTransform[5]=e[++n],this._renderState.viewTransform[6]=e[++n],this._renderState.viewTransform[7]=e[++n],this._renderState.viewTransform[8]=e[++n],this._renderState.viewTransform[9]=e[++n],this._renderState.viewTransform[10]=e[++n],this._renderState.viewTransform[11]=e[++n],this._renderState.viewTransform[12]=e[++n],this._renderState.viewTransform[13]=e[++n],this._renderState.viewTransform[14]=e[++n],this._renderState.viewTransform[15]=e[++n],this._renderState.viewDirty=!0;break;case"WITH":return n-1}r=e[++n]}return n},e.exports=i},{"../components/Camera":2,"../dom-renderers/DOMRenderer":25,"../webgl-renderers/WebGLRenderer":131}],84:[function(t,e){function i(t,e,i){this._thread=t,this._compositor=e,this._renderLoop=i,this._renderLoop.update(this);var n=this;this._thread.onmessage=function(t){var e=t.data?t.data:t;if("ENGINE"===e[0])switch(e[1]){case"START":n._renderLoop.start();break;case"STOP":n._renderLoop.stop();break;default:console.error('Unknown ENGINE command "'+e[1]+'"')}else n._compositor.receiveCommands(e)},this._thread.onerror=function(t){console.error(t)}}i.prototype.getThread=function(){return this._thread},i.prototype.getCompositor=function(){return this._compositor},i.prototype.getEngine=function(){return this._renderLoop},i.prototype.update=function(t){this._thread.postMessage(["FRAME",t]);var e=this._compositor.drawCommands();this._thread.postMessage(e),this._compositor.clearCommands()},e.exports=i},{}],85:[function(t,e){e.exports={Compositor:t("./Compositor"),Context:t("./Context"),UIManager:t("./UIManager"),injectCSS:t("./inject-css")}},{"./Compositor":82,"./Context":83,"./UIManager":84,"./inject-css":86}],86:[function(t,e){function i(){if(!s)if(s=!0,document.createStyleSheet){var t=document.createStyleSheet();t.cssText=n}else{var e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),(e?e:document.documentElement).appendChild(i)}}var n=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform: translateZ(1000000px);transform: translateZ(1000000px)pointer-events:none;position:absolute;z-index:1;top:0;left:0;}",s="undefined"==typeof document;e.exports=i},{}],87:[function(t,e){var i={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t},inQuad:function(t){return t*t},outQuad:function(t){return-(t-=1)*t+1},inOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},inQuart:function(t){return t*t*t*t},outQuart:function(t){return-(--t*t*t*t-1)},inOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return--t*t*t*t*t+1},inOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},inSine:function(t){return-1*Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1- --t*t)},inOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)))},outElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/i)+1)},inOutElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:2===(t/=.5)?1:(i||(i=.3*1.5),e=i/(2*Math.PI)*Math.asin(1/n),1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i):n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)*.5+1)},inBack:function(t,e){return void 0===e&&(e=1.70158),t*t*((e+1)*t-e)},outBack:function(t,e){return void 0===e&&(e=1.70158),--t*t*((e+1)*t+e)+1},inOutBack:function(t,e){return void 0===e&&(e=1.70158),(t/=.5)<1?.5*t*t*(((e*=1.525)+1)*t-e):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},inBounce:function(t){return 1-i.outBounce(1-t)},outBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*i.inBounce(2*t):.5*i.outBounce(2*t-1)+.5},flat:function(){return 0}};e.exports=i},{}],88:[function(t,e){function i(t){this._queue=[],this._from=null,this._state=null,this._startedAt=null,this._pausedAt=null,null!=t&&this.from(t)}var n=t("./Curves"),s=t("../core/FamousEngine");i.Clock=s.getClock(),i.prototype.to=function(t,e,i,s,r){return e=null!=e&&e.constructor===String?n[e]:e,0===this._queue.length&&(this._startedAt=this.constructor.Clock.now(),this._pausedAt=null),this._queue.push(t,null!=e?e:n.linear,null!=i?i:100,s,r),this},i.prototype.from=function(t){return this._state=t,this._from=this._sync(null,this._state),this._queue.length=0,this._startedAt=this.constructor.Clock.now(),this._pausedAt=null,this},i.prototype.delay=function(t,e){var i=this._queue.length>0?this._queue[this._queue.length-5]:this._state;return this.to(i,n.flat,t,e)},i.prototype.override=function(t,e,i,s,r){return this._queue.length>0&&(null!=t&&(this._queue[0]=t),null!=e&&(this._queue[1]=e.constructor===String?n[e]:e),null!=i&&(this._queue[2]=i),null!=s&&(this._queue[3]=s),null!=r&&(this._queue[4]=r)),this},i.prototype._interpolate=function(t,e,i,n,s){if(i instanceof Object)if("slerp"===s){var r,o,a,u,h,c,l,p,d,f,m,_,g;if(r=e[0],o=e[1],a=e[2],u=e[3],h=i[0],c=i[1],l=i[2],p=i[3],1===n)return t[0]=h,t[1]=c,t[2]=l,t[3]=p,t;f=u*p+r*h+o*c+a*l,1-f>1e-5?(d=Math.acos(f),m=Math.sin(d),_=Math.sin((1-n)*d)/m,g=Math.sin(n*d)/m):(_=1-n,g=n),t[0]=r*_+h*g,t[1]=o*_+c*g,t[2]=a*_+l*g,t[3]=u*_+p*g}else if(i instanceof Array)for(var v=0,y=i.length;y>v;v++)t[v]=this._interpolate(t[v],e[v],i[v],n,s);else for(var b in i)t[b]=this._interpolate(t[b],e[b],i[b],n,s);else t=e+n*(i-e);return t},i.prototype._sync=function r(t,e){if("number"==typeof e)t=e;else if(e instanceof Array){null==t&&(t=[]);for(var i=0,n=e.length;n>i;i++)t[i]=r(t[i],e[i])}else if(e instanceof Object){null==t&&(t={});for(var s in e)t[s]=r(t[s],e[s])}return t},i.prototype.get=function(t){if(0===this._queue.length)return this._state;t=this._pausedAt?this._pausedAt:t,t=t?t:this.constructor.Clock.now();var e=(t-this._startedAt)/this._queue[2];this._state=this._interpolate(this._state,this._from,this._queue[0],this._queue[1](e>1?1:e),this._queue[4]);var i=this._state;if(e>=1){this._startedAt=this._startedAt+this._queue[2],this._from=this._sync(this._from,this._state),this._queue.shift(),this._queue.shift(),this._queue.shift();var n=this._queue.shift();this._queue.shift(),n&&n()}return e>1?this.get():i},i.prototype.isActive=function(){return this._queue.length>0},i.prototype.halt=function(){return this.from(this.get())},i.prototype.pause=function(){return this._pausedAt=this.constructor.Clock.now(),this},i.prototype.isPaused=function(){return!!this._pausedAt},i.prototype.resume=function(){var t=this._pausedAt-this._startedAt;return this._startedAt=this.constructor.Clock.now()-t,this._pausedAt=null,this},i.prototype.reset=function(t){return this.from(t)},i.prototype.set=function(t,e,i){return null==e?(this.from(t),i&&i()):this.to(t,e.curve,e.duration,i,e.method),this},e.exports=i},{"../core/FamousEngine":17,"./Curves":87}],89:[function(t,e){e.exports={Curves:t("./Curves"),Transitionable:t("./Transitionable")}},{"./Curves":87,"./Transitionable":88}],90:[function(t,e){function i(){this._events={}}i.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];return i.push(e),function(){i.splice(i.indexOf(e),1)}},i.prototype.off=function(t,e){var i=this._events[t];return i&&i.splice(i.indexOf(e),1),this},i.prototype.trigger=function(t,e){var i=this._events[t];if(i)for(var n=0,s=i.length;s>n;n++)i[n](e);return this},e.exports=i},{}],91:[function(t,e){function i(t,e,i){this._r=new n(0),this._g=new n(0),this._b=new n(0),this._opacity=new n(1),t&&this.set(t,e,i)}var n=t("../transitions/Transitionable");i.prototype.toString=function(){return"Color"},i.prototype.set=function(t,e,n){switch(i.determineType(t)){case"hex":return this.setHex(t,e,n);case"colorName":return this.setColor(t,e,n);case"instance":return this.changeTo(t,e,n);case"rgb":return this.setRGB(t[0],t[1],t[2],e,n)}return this},i.prototype.isActive=function(){return this._r.isActive()||this._g.isActive()||this._b.isActive()||this._opacity.isActive()},i.prototype.halt=function(){return this._r.halt(),this._g.halt(),this._b.halt(),this._opacity.halt(),this},i.prototype.changeTo=function(t,e,n){if(i.isColorInstance(t)){var s=t.getRGB();this.setRGB(s[0],s[1],s[2],e,n)}return this},i.prototype.setColor=function(t,e,i){return s[t]&&this.setHex(s[t],e,i),this},i.prototype.getColor=function(t){return i.isString(t)&&(t=t.toLowerCase()),"hex"===t?this.getHex():this.getRGB()},i.prototype.setR=function(t,e,i){return this._r.set(t,e,i),this},i.prototype.setG=function(t,e,i){return this._g.set(t,e,i),this},i.prototype.setB=function(t,e,i){return this._b.set(t,e,i),this},i.prototype.setOpacity=function(t,e,i){return this._opacity.set(t,e,i),this},i.prototype.setRGB=function(t,e,i,n,s){return this.setR(t,n),this.setG(e,n),this.setB(i,n,s),this
},i.prototype.getR=function(){return this._r.get()},i.prototype.getG=function(){return this._g.get()},i.prototype.getB=function(){return this._b.get()},i.prototype.getOpacity=function(){return this._opacity.get()},i.prototype.getRGB=function(){return[this.getR(),this.getG(),this.getB()]},i.prototype.getNormalizedRGB=function(){var t=this.getR()/255,e=this.getG()/255,i=this.getB()/255;return[t,e,i]},i.prototype.getNormalizedRGBA=function(){var t=this.getR()/255,e=this.getG()/255,i=this.getB()/255,n=this.getOpacity();return[t,e,i,n]},i.prototype.getHex=function(){var t=i.toHex(this.getR()),e=i.toHex(this.getG()),n=i.toHex(this.getB());return"#"+t+e+n},i.prototype.setHex=function(t,e,i){if(t="#"===t.charAt(0)?t.substring(1,t.length):t,3===t.length){var n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(n,function(t,e,i,n){return e+e+i+i+n+n})}var s=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);return this.setRGB(s,r,o,e,i),this},i.toHex=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},i.determineType=function(t){return i.isColorInstance(t)?"instance":s[t]?"colorName":i.isHex(t)?"hex":Array.isArray(t)?"rgb":void 0},i.isString=function(t){return"string"==typeof t},i.isHex=function(t){return i.isString(t)?"#"===t[0]:!1},i.isColorInstance=function(t){return!!t.getColor};var s={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};e.exports=i},{"../transitions/Transitionable":88}],92:[function(t,e){e.exports={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,UP_ARROW:38,DOWN_ARROW:40,SPACE:32,SHIFT:16,TAB:9}},{}],93:[function(t,e){function i(t,e){return function(){return 0!==t.length?t.pop():new e}}function n(t){return function(e){t.push(e)}}var s={};s.pools={},s.register=function(t,e){var s=this.pools[t]=[];this["request"+t]=i(s,e),this["free"+t]=n(s)},s.disposeOf=function(t){for(var e=this.pools[t],i=e.length;i--;)e.pop()},e.exports=s},{}],94:[function(t,e){function i(t,e,i){return e>t?e:t>i?i:t}e.exports=i},{}],95:[function(t,e){var i=function n(t){var e;if("object"==typeof t){e=t instanceof Array?[]:{};for(var i in t)if("object"==typeof t[i]&&null!==t[i])if(t[i]instanceof Array){e[i]=new Array(t[i].length);for(var s=0;s<t[i].length;s++)e[i][s]=n(t[i][s])}else e[i]=n(t[i]);else e[i]=t[i]}else e=t;return e};e.exports=i},{}],96:[function(t,e){e.exports={CallbackStore:t("./CallbackStore"),clamp:t("./clamp"),clone:t("./clone"),Color:t("./Color"),KeyCodes:t("./KeyCodes"),keyValueToArrays:t("./keyValueToArrays"),loadURL:t("./loadURL"),ObjectManager:t("./ObjectManager"),strip:t("./strip"),vendorPrefix:t("./vendorPrefix")}},{"./CallbackStore":90,"./Color":91,"./KeyCodes":92,"./ObjectManager":93,"./clamp":94,"./clone":95,"./keyValueToArrays":97,"./loadURL":98,"./strip":99,"./vendorPrefix":100}],97:[function(t,e){e.exports=function(t){var e=[],i=[],n=0;for(var s in t)t.hasOwnProperty(s)&&(e[n]=s,i[n]=t[s],n++);return{keys:e,values:i}}},{}],98:[function(t,e){var i=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&e&&e(this.responseText)},i.open("GET",t),i.send()};e.exports=i},{}],99:[function(t,e){function i(t){switch(t){case null:case void 0:return t}switch(t.constructor){case Boolean:case Number:case String:return t;case Object:for(var e in t){var n=i(t[e],!0);t[e]=n}return t;default:return null}}e.exports=i},{}],100:[function(t,e){function i(t){for(var e=0;e<n.length;e++){var i=n[e]+t;if(""===document.documentElement.style[i])return i}return t}var n=["","-ms-","-webkit-","-moz-","-o-"];e.exports=i},{}],101:[function(t,e){function i(t){n.call(this,t),this.spec.dynamic=!0}var n=t("./Geometry");i.prototype.getLength=function(){return this.getVertexPositions().length},i.prototype.getVertexBuffer=function(t){if(!t)throw"getVertexBuffer requires a name";var e=this.spec.bufferNames.indexOf(t);if(~e)return this.spec.bufferValues[e];throw"buffer does not exist"},i.prototype.setVertexBuffer=function(t,e,i){var n=this.spec.bufferNames.indexOf(t);return-1===n&&(n=this.spec.bufferNames.push(t)-1),this.spec.bufferValues[n]=e||[],this.spec.bufferSpacings[n]=i||this.DEFAULT_BUFFER_SIZE,-1===this.spec.invalidations.indexOf(n)&&this.spec.invalidations.push(n),this},i.prototype.fromGeometry=function(t){for(var e=t.spec.bufferNames.length,i=0;e>i;i++)this.setVertexBuffer(t.spec.bufferNames[i],t.spec.bufferValues[i],t.spec.bufferSpacings[i]);return this},i.prototype.setVertexPositions=function(t){return this.setVertexBuffer("a_pos",t,3)},i.prototype.setNormals=function(t){return this.setVertexBuffer("a_normals",t,3)},i.prototype.setTextureCoords=function(t){return this.setVertexBuffer("a_texCoord",t,2)},i.prototype.setIndices=function(t){return this.setVertexBuffer("indices",t,1)},i.prototype.setDrawType=function(t){return this.spec.type=t.toUpperCase(),this},i.prototype.getVertexPositions=function(){return this.getVertexBuffer("a_pos")},i.prototype.getNormals=function(){return this.getVertexBuffer("a_normals")},i.prototype.getTextureCoords=function(){return this.getVertexBuffer("a_texCoord")},e.exports=i},{"./Geometry":102}],102:[function(t,e){function i(t){if(this.options=t||{},this.DEFAULT_BUFFER_SIZE=3,this.spec={id:n++,dynamic:!1,type:this.options.type||"TRIANGLES",bufferNames:[],bufferValues:[],bufferSpacings:[],invalidations:[]},this.options.buffers)for(var e=this.options.buffers.length,i=0;e>i;)this.spec.bufferNames.push(this.options.buffers[i].name),this.spec.bufferValues.push(this.options.buffers[i].data),this.spec.bufferSpacings.push(this.options.buffers[i].size||this.DEFAULT_BUFFER_SIZE),this.spec.invalidations.push(i++)}var n=0;e.exports=i},{}],103:[function(t,e){function i(t,e){return-(e+(t-e)/2)}function n(t,e){return 1/((t-e)/2)}var s=t("../math/Vec3"),r=t("../math/Vec2"),o=[new s,new s,new s,new r,new r],a={};a.generateParametric=function(t,e,i,n){var s,r,o,a,u=[],h=n?Math.PI+Math.PI/(t-1):Math.PI,c=[];for(s=0;t+1>s;s++)for(r=s*h/t,a=0;e>a;a++)o=2*a*h/e,i(r,o,c),u.push(c[0],c[1],c[2]);var l,p=[],d=0;for(s=0;t>s;s++){for(a=0;e>a;a++)l=(a+1)%e,p.push(d+a,d+a+e,d+l),p.push(d+l,d+a+e,d+l+e);d+=e}return{vertices:u,indices:p}},a.computeNormals=function(t,e,i){var n,s,r,a,u,h,c,l,p,d,f=i||[],m=e.length/3;for(h=0;m>h;h++)s=3*e[3*h+0],n=3*e[3*h+1],r=3*e[3*h+2],o[0].set(t[n],t[n+1],t[n+2]),o[1].set(t[s],t[s+1],t[s+2]),o[2].set(t[r],t[r+1],t[r+2]),a=o[2].subtract(o[0]).cross(o[1].subtract(o[0])).normalize(),f[n+0]=(f[n+0]||0)+a.x,f[n+1]=(f[n+1]||0)+a.y,f[n+2]=(f[n+2]||0)+a.z,f[s+0]=(f[s+0]||0)+a.x,f[s+1]=(f[s+1]||0)+a.y,f[s+2]=(f[s+2]||0)+a.z,f[r+0]=(f[r+0]||0)+a.x,f[r+1]=(f[r+1]||0)+a.y,f[r+2]=(f[r+2]||0)+a.z;for(h=0;h<f.length;h+=3)for(c=f[h],l=f[h+1],p=f[h+2],d=Math.sqrt(c*c+l*l+p*p),u=0;3>u;u++)f[h+u]/=d;return f},a.subdivide=function(t,e,i){for(var n,a,u,h,c,l,p=t.length/3;p--;)n=t.slice(3*p,3*p+3),c=n.map(function(t){return new s(e[3*t],e[3*t+1],e[3*t+2])}),e.push.apply(e,s.scale(s.add(c[0],c[1],o[0]),.5,o[1]).toArray()),e.push.apply(e,s.scale(s.add(c[1],c[2],o[0]),.5,o[1]).toArray()),e.push.apply(e,s.scale(s.add(c[0],c[2],o[0]),.5,o[1]).toArray()),i&&(l=n.map(function(t){return new r(i[2*t],i[2*t+1])}),i.push.apply(i,r.scale(r.add(l[0],l[1],o[3]),.5,o[4]).toArray()),i.push.apply(i,r.scale(r.add(l[1],l[2],o[3]),.5,o[4]).toArray()),i.push.apply(i,r.scale(r.add(l[0],l[2],o[3]),.5,o[4]).toArray())),a=e.length-3,u=a+1,h=a+2,t.push(a,u,h),t.push(n[0],a,h),t.push(a,n[1],u),t[p]=h,t[p+1]=u,t[p+2]=n[2]},a.getUniqueFaces=function(t,e){for(var i,n=e.length/3,s=[];n--;)for(var r=0;3>r;r++)i=e[3*n+r],s[i]?(t.push(t[3*i],t[3*i+1],t[3*i+2]),e[3*n+r]=t.length/3-1):s[i]=!0},a.subdivideSpheroid=function(t,e){for(var i,n,r,a,u,h=e.length/3;h--;)n=e.slice(3*h,3*h+3),i=n.map(function(e){return new s(t[3*e],t[3*e+1],t[3*e+2])}),t.push.apply(t,s.normalize(s.add(i[0],i[1],o[0]),o[1]).toArray()),t.push.apply(t,s.normalize(s.add(i[1],i[2],o[0]),o[1]).toArray()),t.push.apply(t,s.normalize(s.add(i[0],i[2],o[0]),o[1]).toArray()),r=t.length/3-3,a=r+1,u=r+2,e.push(r,a,u),e.push(n[0],r,u),e.push(r,n[1],a),e[3*h]=u,e[3*h+1]=a,e[3*h+2]=n[2]},a.getSpheroidNormals=function(t,e){e=e||[];for(var i,n=t.length/3,r=0;n>r;r++)i=new s(t[3*r+0],t[3*r+1],t[3*r+2]).normalize().toArray(),e[3*r+0]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2];return e},a.getSpheroidUV=function(t,e){e=e||[];for(var i,n=t.length/3,s=[],r=0;n>r;r++)i=o[0].set(t[3*r],t[3*r+1],t[3*r+2]).normalize().toArray(),s[0]=.5*this.getAzimuth(i)/Math.PI+.5,s[1]=this.getAltitude(i)/Math.PI+.5,e.push.apply(e,s);return e},a.normalizeAll=function(t,e){e=e||[];for(var i=t.length/3,n=0;i>n;n++)Array.prototype.push.apply(e,new s(t[3*n],t[3*n+1],t[3*n+2]).normalize().toArray());return e},a.normalizeVertices=function(t,e){e=e||[];var r,o,a,u,h,c,l,p,d=t.length/3,f=[];for(p=0;d>p;p++)l=f[p]=new s(t[3*p],t[3*p+1],t[3*p+2]),(null==r||l.x<r)&&(r=l.x),(null==o||l.x>o)&&(o=l.x),(null==a||l.y<a)&&(a=l.y),(null==u||l.y>u)&&(u=l.y),(null==h||l.z<h)&&(h=l.z),(null==c||l.z>c)&&(c=l.z);var m=new s(i(o,r),i(u,a),i(c,h)),_=Math.min(n(o+m.x,r+m.x),n(u+m.y,a+m.y),n(c+m.z,h+m.z));for(p=0;p<f.length;p++)e.push.apply(e,f[p].add(m).scale(_).toArray());return e},a.getAzimuth=function(t){return Math.atan2(t[2],-t[0])},a.getAltitude=function(t){return Math.atan2(-t[1],Math.sqrt(t[0]*t[0]+t[2]*t[2]))},a.trianglesToLines=function(t,e){var i=t.length/3;e=e||[];var n;for(n=0;i>n;n++)e.push(t[3*n+0],t[3*n+1]),e.push(t[3*n+1],t[3*n+2]),e.push(t[3*n+2],t[3*n+0]);return e},a.addBackfaceTriangles=function(t,e){for(var i=e.length/3,n=0,s=e.length;s--;)e[s]>n&&(n=e[s]);for(n++,s=0;i>s;s++){var r=e[3*s],o=e[3*s+1],a=e[3*s+2];e.push(r+n,a+n,o+n)}var u=t.length;for(s=0;u>s;s++)t.push(t[s])},e.exports=a},{"../math/Vec2":43,"../math/Vec3":44}],104:[function(t,e){function i(t,e){t=s(t);var i=t.split("\n"),r=[];e=e||{};for(var o,a,u,h,c,l,p=[],d=[],f=[],m=[],_=[],g=[],v=i.length,y=0;v>y;y++)l=i[y],c=i[y].split(" "),-1!==l.indexOf("v ")?g.push([parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])]):-1!==l.indexOf("vt ")?_.push([parseFloat(c[1]),parseFloat(c[2])]):-1!==l.indexOf("vn ")?m.push([parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])]):-1!==l.indexOf("f ")?-1!==c[1].indexOf("//")?(o=c[1].split("//"),a=c[2].split("//"),u=c[3].split("//"),d.push([parseFloat(o[0])-1,parseFloat(a[0])-1,parseFloat(u[0])-1]),f.push([parseFloat(o[1])-1,parseFloat(a[1])-1,parseFloat(u[1])-1]),c[4]&&(h=c[4].split("//"),d.push([parseFloat(o[0])-1,parseFloat(u[0])-1,parseFloat(h[0])-1]),f.push([parseFloat(o[2])-1,parseFloat(u[2])-1,parseFloat(h[2])-1]))):-1!==c[1].indexOf("/")?(o=c[1].split("/"),a=c[2].split("/"),u=c[3].split("/"),d.push([parseFloat(o[0])-1,parseFloat(a[0])-1,parseFloat(u[0])-1]),p.push([parseFloat(o[1])-1,parseFloat(a[1])-1,parseFloat(u[1])-1]),f.push([parseFloat(o[2])-1,parseFloat(a[2])-1,parseFloat(u[2])-1]),c[4]&&(h=c[4].split("/"),d.push([parseFloat(o[0])-1,parseFloat(u[0])-1,parseFloat(h[0])-1]),p.push([parseFloat(o[1])-1,parseFloat(u[1])-1,parseFloat(h[1])-1]),f.push([parseFloat(o[2])-1,parseFloat(u[2])-1,parseFloat(h[2])-1]))):(d.push([parseFloat(c[1])-1,parseFloat(c[2])-1,parseFloat(c[3])-1]),p.push([parseFloat(c[1])-1,parseFloat(c[2])-1,parseFloat(c[3])-1]),f.push([parseFloat(c[1])-1,parseFloat(c[2])-1,parseFloat(c[3])-1]),c[4]&&(d.push([parseFloat(c[1])-1,parseFloat(c[3])-1,parseFloat(c[4])-1]),p.push([parseFloat(c[1])-1,parseFloat(c[3])-1,parseFloat(c[4])-1]),f.push([parseFloat(c[1])-1,parseFloat(c[3])-1,parseFloat(c[4])-1]))):-1!==l.indexOf("g ")&&(d.length&&r.push(n(g,m,_,d,f,p,e)),d.length=0,p.length=0,f.length=0);return r.push(n(g,m,_,d,f,p,e)),r}function n(t,e,i,n,s,a,h){var c=r(t,e,i,n,s,a);return c.vertices=o(c.vertices),c.normals=o(c.normals),c.texCoords=o(c.texCoords),c.indices=o(c.indices),h.normalize&&(c.vertices=u.normalizeVertices(c.vertices)),h.computeNormals&&(c.normals=u.computeNormals(c.vertices,c.indices)),{vertices:c.vertices,normals:c.normals,textureCoords:c.texCoords,indices:c.indices}}function s(t){return t.replace(/ +(?= )/g,"").replace(/\s+$/g,"")}function r(t,e,i,n,s,r){for(var o,a,u,h,c,l=[],p=[],d=[],f=[],m={},_=0,g=n.length,v=s.length,y=r.length,b=0;g>b;b++){f[b]=[],h=n[b].length;for(var x=0;h>x;x++)y&&(u=r[b][x]),v&&(a=s[b][x]),o=n[b][x],c=m[o+","+a+","+u],void 0===c&&(c=_++,p.push(t[o]),v&&l.push(e[a]),y&&d.push(i[u]),m[o+","+a+","+u]=c),f[b].push(c)}return{vertices:p,normals:l,texCoords:d,indices:f}}function o(t){for(var e=t.length,i=[],n=0;e>n;n++)i.push.apply(i,t[n]);return i}var a=t("../utilities/loadURL"),u=t("./GeometryHelper"),h={cached:{},requests:{},formatText:i};h.load=function(t,e,i){this.cached[t]?e(this.cached[t]):this.requests[t]?this.requests[t].push(e):(this.requests[t]=[e],a(t,this._onsuccess.bind(this,t,i)))},h._onsuccess=function(t,e,n){var s=i.call(this,n,e||{});this.cached[t]=s;for(var r=0;r<this.requests[t].length;r++)this.requests[t][r](s);this.requests[t]=null},e.exports=h},{"../utilities/loadURL":98,"./GeometryHelper":103}],105:[function(t,e){e.exports={Box:t("./primitives/Box"),Circle:t("./primitives/Circle"),Cylinder:t("./primitives/Cylinder"),GeodesicSphere:t("./primitives/GeodesicSphere"),Icosahedron:t("./primitives/Icosahedron"),ParametricCone:t("./primitives/ParametricCone"),Plane:t("./primitives/Plane"),Sphere:t("./primitives/Sphere"),Tetrahedron:t("./primitives/Tetrahedron"),Torus:t("./primitives/Torus"),Triangle:t("./primitives/Triangle"),GeometryHelper:t("./GeometryHelper"),DynamicGeometry:t("./DynamicGeometry"),Geometry:t("./Geometry"),OBJLoader:t("./OBJLoader")}},{"./DynamicGeometry":101,"./Geometry":102,"./GeometryHelper":103,"./OBJLoader":104,"./primitives/Box":106,"./primitives/Circle":107,"./primitives/Cylinder":108,"./primitives/GeodesicSphere":109,"./primitives/Icosahedron":110,"./primitives/ParametricCone":111,"./primitives/Plane":112,"./primitives/Sphere":113,"./primitives/Tetrahedron":114,"./primitives/Torus":115,"./primitives/Triangle":116}],106:[function(t,e){function i(t){return[2*(1&t)-1,(2&t)-1,(4&t)/2-1]}function n(t){t=t||{};var e,n,o,a,u,h=[],c=[],l=[],p=[];for(a=0;a<r.length;a++){for(e=r[a],o=4*a,u=0;4>u;u++){n=e[u];var d=i(n);h.push(d[0],d[1],d[2]),c.push(1&u,(2&u)/2),l.push(e[4],e[5],e[6])}p.push(o,o+1,o+2),p.push(o+2,o+1,o+3)}return new s({buffers:[{name:"a_pos",data:h},{name:"a_texCoord",data:c,size:2},{name:"a_normals",data:l},{name:"indices",data:p,size:1}]})}var s=t("../Geometry"),r=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];e.exports=n},{"../Geometry":102}],107:[function(t,e){function i(t){t=t||{};var e=t.detail||30,i=s(e,!0);t.backface!==!1&&o.addBackfaceTriangles(i.vertices,i.indices);var a=n(i.vertices),u=o.computeNormals(i.vertices,i.indices);return new r({buffers:[{name:"a_pos",data:i.vertices},{name:"a_texCoord",data:a,size:2},{name:"a_normals",data:u},{name:"indices",data:i.indices,size:1}]})}function n(t){for(var e=[],i=t.length/3,n=0;i>n;n++){var s=t[3*n],r=t[3*n+1];e.push(.5+.5*s,.5+.5*-r)}return e}function s(t){for(var e,i,n,s=[0,0,0],r=[],o=1,a=0;t+1>a;a++)e=a/t*Math.PI*2,i=Math.cos(e),n=Math.sin(e),s.push(i,n,0),a>0&&r.push(0,o,++o);return{vertices:s,indices:r}}var r=t("../Geometry"),o=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],108:[function(t,e){function i(t){t=t||{};var e,r=t.radius||1,o=t.detail||15;return e=s.generateParametric(o,o,i.generator.bind(null,r)),t.backface!==!1&&s.addBackfaceTriangles(e.vertices,e.indices),new n({buffers:[{name:"a_pos",data:e.vertices},{name:"a_texCoord",data:s.getSpheroidUV(e.vertices),size:2},{name:"a_normals",data:s.computeNormals(e.vertices,e.indices)},{name:"indices",data:e.indices,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");i.generator=function(t,e,i,n){n[1]=t*Math.sin(i),n[0]=t*Math.cos(i),n[2]=t*(-1+e/Math.PI*2)},e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],109:[function(t,e){function i(t){var e=.5*(1+Math.sqrt(5)),i=[-1,e,0,1,e,0,-1,-e,0,1,-e,0,0,-1,-e,0,1,-e,0,-1,e,0,1,e,e,0,1,e,0,-1,-e,0,1,-e,0,-1],r=[0,5,11,0,1,5,0,7,1,0,10,7,0,11,10,1,9,5,5,4,11,11,2,10,10,6,7,7,8,1,3,4,9,3,2,4,3,6,2,3,8,6,3,9,8,4,5,9,2,11,4,6,10,2,8,7,6,9,1,8];i=s.normalizeAll(i),t=t||{};for(var o=t.detail||3;--o;)s.subdivideSpheroid(i,r);s.getUniqueFaces(i,r);var a=s.computeNormals(i,r),u=s.getSpheroidUV(i);return new n({buffers:[{name:"a_pos",data:i},{name:"a_texCoord",data:u,size:2},{name:"a_normals",data:a},{name:"indices",data:r,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],110:[function(t,e){function i(){var t=(1+Math.sqrt(5))/2,e=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,-t,0,1,-t,0,-1,t,0,1,t,t,0,1,t,0,-1,-t,0,1,-t,0,-1],i=[0,5,11,0,1,5,0,7,1,0,10,7,0,11,10,1,9,5,5,4,11,11,2,10,10,6,7,7,8,1,3,4,9,3,2,4,3,6,2,3,8,6,3,9,8,4,5,9,2,11,4,6,10,2,8,7,6,9,1,8];s.getUniqueFaces(e,i);var r=s.computeNormals(e,i),o=s.getSpheroidUV(e);return e=s.normalizeAll(e),new n({buffers:[{name:"a_pos",data:e},{name:"a_texCoord",data:o,size:2},{name:"a_normals",data:r},{name:"indices",data:i,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],111:[function(t,e){function i(t){t=t||{};var e=t.detail||15,r=t.radius||1/Math.PI,o=s.generateParametric(e,e,i.generator.bind(null,r));return t.backface!==!1&&s.addBackfaceTriangles(o.vertices,o.indices),new n({buffers:[{name:"a_pos",data:o.vertices},{name:"a_texCoord",data:s.getSpheroidUV(o.vertices),size:2},{name:"a_normals",data:s.computeNormals(o.vertices,o.indices)},{name:"indices",data:o.indices,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");i.generator=function(t,e,i,n){n[0]=-t*e*Math.cos(i),n[1]=t*e*Math.sin(i),n[2]=-e/(Math.PI/2)+1},e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],112:[function(t,e){function i(t){t=t||{};for(var e,i=t.detailX||t.detail||1,r=t.detailY||t.detail||1,o=[],a=[],u=[],h=[],c=0;r>=c;c++)for(var l=c/r,p=0;i>=p;p++){var d=p/i;o.push(2*(d-.5),2*(l-.5),0),a.push(d,1-l),i>p&&r>c&&(e=p+c*(i+1),h.push(e,e+1,e+i+1),h.push(e+i+1,e+1,e+i+2))}if(t.backface!==!1){s.addBackfaceTriangles(o,h);var f=a.length;for(e=0;f>e;e++)a.push(a[e])}return u=s.computeNormals(o,h),new n({buffers:[{name:"a_pos",data:o},{name:"a_texCoord",data:a,size:2},{name:"a_normals",data:u},{name:"indices",data:h,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],113:[function(t,e){function i(t){t=t||{};var e=t.detail||10,r=t.detailX||e,o=t.detailY||e,a=s.generateParametric(r,o,i.generator,!0);return s.getUniqueFaces(a.vertices,a.indices),new n({buffers:[{name:"a_pos",data:a.vertices},{name:"a_texCoord",data:s.getSpheroidUV(a.vertices),size:2},{name:"a_normals",data:s.getSpheroidNormals(a.vertices)},{name:"indices",data:a.indices,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");i.generator=function(t,e,i){var n=Math.sin(t)*Math.cos(e),s=Math.cos(t),r=-Math.sin(t)*Math.sin(e);i[0]=n,i[1]=s,i[2]=r},e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],114:[function(t,e){function i(t){var e,i,r=[],o=[],a=Math.sqrt(3),u=[1,-1,-1/a,-1,-1,-1/a,0,1,0,0,1,0,0,-1,a-1/a,1,-1,-1/a,0,1,0,-1,-1,-1/a,0,-1,a-1/a,0,-1,a-1/a,-1,-1,-1/a,1,-1,-1/a],h=[0,1,2,3,4,5,6,7,8,9,10,11];for(i=0;4>i;i++)r.push(0,0,.5,1,1,0);for(t=t||{};--e;)s.subdivide(h,u,r);return o=s.computeNormals(u,h),new n({buffers:[{name:"a_pos",data:u},{name:"a_texCoord",data:r,size:2},{name:"a_normals",data:o},{name:"indices",data:h,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],115:[function(t,e){function i(t){t=t||{};var e=t.detail||30,r=t.holeRadius||.8,o=t.tubeRadius||.2,a=s.generateParametric(e,e,i.generator.bind(null,r,o));return new n({buffers:[{name:"a_pos",data:a.vertices},{name:"a_texCoord",data:s.getSpheroidUV(a.vertices),size:2},{name:"a_normals",data:s.computeNormals(a.vertices,a.indices)},{name:"indices",data:a.indices,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");i.generator=function(t,e,i,n,s){s[0]=(t+e*Math.cos(2*n))*Math.sin(2*i),s[1]=-(t+e*Math.cos(2*n))*Math.cos(2*i),s[2]=e*Math.sin(2*n)},e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],116:[function(t,e){function i(t){t=t||{};for(var e=t.detail||1,i=[],r=[0,0,.5,1,1,0],o=[0,1,2],a=[-1,-1,0,0,1,0,1,-1,0];--e;)s.subdivide(o,a,r);return t.backface!==!1&&s.addBackfaceTriangles(a,o),i=s.computeNormals(a,o),new n({buffers:[{name:"a_pos",data:a},{name:"a_texCoord",data:r,size:2},{name:"a_normals",data:i},{name:"indices",data:o,size:1}]})}var n=t("../Geometry"),s=t("../GeometryHelper");e.exports=i},{"../Geometry":102,"../GeometryHelper":103}],117:[function(t,e){function i(t,e,s,r){r=r||{},this.name=t,this.chunk=e,this.inputs=s?Array.isArray(s)?s:[s]:[],this.uniforms=r.uniforms||{},this.varyings=r.varyings,this.attributes=r.attributes,r.texture&&(this.texture=r.texture.__isATexture__?r.texture:n.register(null,r.texture)),this._id=i.id++,this.invalidations=[],this.__isAMaterial__=!0}var n=t("./TextureRegistry"),s={},r={abs:{glsl:"abs(%1);",output:{4:4,3:3,2:2,1:1}},sign:{glsl:"sign(%1);",output:{4:4,3:3,2:2,1:1}},floor:{glsl:"floor(%1);",output:{4:4,3:3,2:2,1:1}},ceiling:{glsl:"ceil(%1);",output:{4:4,3:3,2:2,1:1}},mod:{glsl:"mod(%1, %2);"},min:{glsl:"min(%1, %2);",output:{4:4,3:3,2:2,1:1}},max:{glsl:"max(%1, %2);",output:{4:4,3:3,2:2,1:1}},clamp:{glsl:"clamp(%1, %2, %3);",output:{"4,1,1":4,"3,1,1":3,"2,1,1":2,"1,1,1":1}},mix:{glsl:"mix(%1, %2, %3);",output:{"4,4,1":4,"3,3,1":3,"2,2,1":2,"1,1,1":1}},step:{glsl:"step(%1, %2, %3);",output:{"1,1":1,"1,2":2,"1,3":3,"1,4":4}},smoothstep:{glsl:"smoothstep(%1);",output:{"1,1,1":1,"2,2,2":2,"3,3,3":3,"4,4,4":4}},fragCoord:{glsl:"gl_FragColor;",output:4},sin:{glsl:"sin(%1);",output:{1:1,2:2,3:3,4:4}},cos:{glsl:"cos(%1);",output:{1:1,2:2,3:3,4:4}},pow:{glsl:"pow(%1, %2);",output:{"1,1":1,"2,2":2,"3,3":3,"1,4":4}},sqrt:{glsl:"sqrt(%1);",output:{"1,1":1,"2,2":2,"3,3":3,"1,4":4}},time:{glsl:"time;",output:1},add:{glsl:"%1 + %2;",output:{"1,1":1,"2,2":2,"3,3":3,"4,4":4,"2,1":2,"3,1":3,"4,1":4}},subtract:{glsl:"%1 - %2;",output:{"1,1":1,"2,2":2,"3,3":3,"4,4":4,"2,1":2,"3,1":3,"4,1":4}},multiply:{glsl:"%1 * %2;",output:{"1,1":1,"2,2":2,"3,3":3,"4,4":4,"2,1":2,"3,1":3,"4,1":4}},normal:{glsl:"vec4((v_normal + 1.0) * 0.5, 1.0);",output:4},uv:{glsl:"v_textureCoordinate;",output:2},meshPosition:{glsl:"(v_position + 1.0) * 0.5;",output:3},normalize:{glsl:"normalize(%1)",output:{1:1,2:2,3:3,4:4}},dot:{glsl:"dot(%1, %2);",output:{"1,1":1,"2,2":1,"3,3":1,"4,4":1}},image:{glsl:"texture2D($TEXTURE, v_textureCoordinate);",output:4},constant:{glsl:"%1;"},parameter:{uniforms:{parameter:1},glsl:"parameter;"},vec3:{glsl:"vec3(%1);",output:3},vec2:{glsl:"vec2(%1);",output:2}};s.registerExpression=function(t,e){this[t]=function(n,s){return new i(t,e,n,s)}};for(var o in r)s.registerExpression(o,r[o]);i.id=2,i.prototype.setUniform=function(t,e){this.uniforms[t]=e,this.invalidations.push(t)},e.exports=s,s.Material=i,s.Texture=function(t){return"undefined"==typeof window?console.error("Texture constructor cannot be run inside of a worker"):s.image([],{texture:t})},s.Custom=function(t,e,n){return new i("custom",{glsl:t,output:1,uniforms:n||{}},e)}},{"./TextureRegistry":118}],118:[function(t,e){var i={registry:{},textureIds:1};i.register=function(t,e,i){return t?(this.registry[t]={id:this.textureIds++,__isATexture__:!0,data:e,options:i},this.registry[t]):{id:this.textureIds++,data:e,__isATexture__:!0,options:i}},i.get=function(t){if(this.registry[t])return this.registry[t];throw'Texture "'+t+'" not found!'},e.exports=i},{}],119:[function(t,e){e.exports={Material:t("./Material"),TextureRegistry:t("./TextureRegistry")}},{"./Material":117,"./TextureRegistry":118}],120:[function(t,e){function i(t,e){this._node=t,this._changeQueue=[],this._initialized=!1,this._requestingUpdate=!1,this._inDraw=!1,this.value={drawOptions:{},color:null,expressions:{},geometry:null,flatShading:null,glossiness:null,positionOffset:null,normals:null},e&&this.setDrawOptions(e),this._id=t.addComponent(this)}var n=t("../webgl-geometries");i.prototype.setDrawOptions=function(t){return this._changeQueue.push("GL_SET_DRAW_OPTIONS"),this._changeQueue.push(t),this},i.prototype.getDrawOptions=function(){return this.value.drawOptions},i.prototype.setGeometry=function(t,e){if("string"==typeof t){if(!n[t])throw'Invalid geometry: "'+t+'".';t=new n[t](e)}if((this.value.geometry!==t||this._inDraw)&&(this._initialized&&(this._changeQueue.push("GL_SET_GEOMETRY"),this._changeQueue.push(t.spec.id),this._changeQueue.push(t.spec.type),this._changeQueue.push(t.spec.dynamic)),this._requestUpdate(),this.value.geometry=t),this._initialized&&this._node){for(var i=this.value.geometry.spec.invalidations.length;i--;)this.value.geometry.spec.invalidations.pop(),this._changeQueue.push("GL_BUFFER_DATA"),this._changeQueue.push(this.value.geometry.spec.id),this._changeQueue.push(this.value.geometry.spec.bufferNames[i]),this._changeQueue.push(this.value.geometry.spec.bufferValues[i]),this._changeQueue.push(this.value.geometry.spec.bufferSpacings[i]),this._changeQueue.push(this.value.geometry.spec.dynamic);i&&this._requestUpdate()}return this},i.prototype.getGeometry=function(){return this.value.geometry},i.prototype.setBaseColor=function(t){var e,i=t.__isAMaterial__,n=!!t.getNormalizedRGBA;return i?(this.value.color=null,this.value.expressions.baseColor=t,e=t):n&&(this.value.expressions.baseColor=null,this.value.color=t,e=t.getNormalizedRGBA()),this._initialized&&(i?this._changeQueue.push("MATERIAL_INPUT"):n&&this._changeQueue.push("GL_UNIFORMS"),this._changeQueue.push("u_baseColor"),this._changeQueue.push(e)),this._requestUpdate(),this},i.prototype.getBaseColor=function(){return this.value.expressions.baseColor||this.value.color},i.prototype.setFlatShading=function(t){return(this._inDraw||this.value.flatShading!==t)&&(this.value.flatShading=t,this._initialized&&(this._changeQueue.push("GL_UNIFORMS"),this._changeQueue.push("u_flatShading"),this._changeQueue.push(t?1:0)),this._requestUpdate()),this},i.prototype.getFlatShading=function(){return this.value.flatShading},i.prototype.setNormals=function(t){var e=t.__isAMaterial__;return e&&(this.value.expressions.normals=t),this._initialized&&(this._changeQueue.push(e?"MATERIAL_INPUT":"UNIFORM_INPUT"),this._changeQueue.push("u_normals"),this._changeQueue.push(t)),this._requestUpdate(),this},i.prototype.getNormals=function(){return this.value.expressions.normals},i.prototype.setGlossiness=function(t,e){var i=t.__isAMaterial__,n=!!t.getNormalizedRGB;return i?(this.value.glossiness=[null,null],this.value.expressions.glossiness=t):n&&(this.value.expressions.glossiness=null,this.value.glossiness=[t,e||20],t=t?t.getNormalizedRGB():[0,0,0],t.push(e||20)),this._initialized&&(this._changeQueue.push(i?"MATERIAL_INPUT":"GL_UNIFORMS"),this._changeQueue.push("u_glossiness"),this._changeQueue.push(t)),this._requestUpdate(),this},i.prototype.getGlossiness=function(){return this.value.expressions.glossiness||this.value.glossiness},i.prototype.setPositionOffset=function(t){var e,i=t.__isAMaterial__;return i?(this.value.expressions.positionOffset=t,e=t):(this.value.expressions.positionOffset=null,this.value.positionOffset=t,e=this.value.positionOffset),this._initialized&&(this._changeQueue.push(i?"MATERIAL_INPUT":"GL_UNIFORMS"),this._changeQueue.push("u_positionOffset"),this._changeQueue.push(e)),this._requestUpdate(),this},i.prototype.getPositionOffset=function(){return this.value.expressions.positionOffset||this.value.positionOffset},i.prototype.getMaterialExpressions=function(){return this.value.expressions},i.prototype.getValue=function(){return this.value},i.prototype._pushInvalidations=function(t){var e,i=this.value.expressions[t];if(i)for(var n=i.invalidations.length;n--;)e=i.invalidations.pop(),this._node.sendDrawCommand("GL_UNIFORMS"),this._node.sendDrawCommand(e),this._node.sendDrawCommand(i.uniforms[e]);return this},i.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue;if(t){if(t.sendDrawCommand("WITH"),t.sendDrawCommand(t.getLocation()),this.value.color&&this.value.color.isActive()&&(this._node.sendDrawCommand("GL_UNIFORMS"),this._node.sendDrawCommand("u_baseColor"),this._node.sendDrawCommand(this.value.color.getNormalizedRGBA()),this._node.requestUpdateOnNextTick(this._id)),this.value.glossiness&&this.value.glossiness[0]&&this.value.glossiness[0].isActive()){this._node.sendDrawCommand("GL_UNIFORMS"),this._node.sendDrawCommand("u_glossiness");var i=this.value.glossiness[0].getNormalizedRGB();i.push(this.value.glossiness[1]),this._node.sendDrawCommand(i),this._node.requestUpdateOnNextTick(this._id)}else this._requestingUpdate=!1;this._pushInvalidations("baseColor"),this._pushInvalidations("positionOffset");for(var n=0;n<e.length;n++)t.sendDrawCommand(e[n]);e.length=0}},i.prototype.onMount=function(t,e){this._node=t,this._id=e,this.draw()
},i.prototype.onDismount=function(){this._initialized=!1,this._changeQueue.push("GL_REMOVE_MESH"),this._requestUpdate()},i.prototype.onShow=function(){this._changeQueue.push("GL_MESH_VISIBILITY",!0),this._requestUpdate()},i.prototype.onHide=function(){this._changeQueue.push("GL_MESH_VISIBILITY",!1),this._requestUpdate()},i.prototype.onTransformChange=function(t){this._initialized&&(this._changeQueue.push("GL_UNIFORMS"),this._changeQueue.push("u_transform"),this._changeQueue.push(t)),this._requestUpdate()},i.prototype.onSizeChange=function(t){this._initialized&&(this._changeQueue.push("GL_UNIFORMS"),this._changeQueue.push("u_size"),this._changeQueue.push(t)),this._requestUpdate()},i.prototype.onOpacityChange=function(t){this._initialized&&(this._changeQueue.push("GL_UNIFORMS"),this._changeQueue.push("u_opacity"),this._changeQueue.push(t)),this._requestUpdate()},i.prototype.onAddUIEvent=function(){},i.prototype._requestUpdate=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},i.prototype.init=function(){this._initialized=!0,this.onTransformChange(this._node.getTransform()),this.onSizeChange(this._node.getSize()),this.onOpacityChange(this._node.getOpacity()),this._requestUpdate()},i.prototype.draw=function(){this._inDraw=!0,this.init();var t=this.getValue();null!=t.geometry&&this.setGeometry(t.geometry),null!=t.color&&this.setBaseColor(t.color),null!=t.glossiness&&this.setGlossiness.apply(this,t.glossiness),null!=t.drawOptions&&this.setDrawOptions(t.drawOptions),null!=t.flatShading&&this.setFlatShading(t.flatShading),null!=t.expressions.normals&&this.setNormals(t.expressions.normals),null!=t.expressions.baseColor&&this.setBaseColor(t.expressions.baseColor),null!=t.expressions.glossiness&&this.setGlossiness(t.expressions.glossiness),null!=t.expressions.positionOffset&&this.setPositionOffset(t.expressions.positionOffset),this._inDraw=!1},e.exports=i},{"../webgl-geometries":105}],121:[function(t,e){e.exports={Mesh:t("./Mesh"),PointLight:t("./lights/PointLight"),AmbientLight:t("./lights/AmbientLight")}},{"./Mesh":120,"./lights/AmbientLight":122,"./lights/PointLight":124}],122:[function(t,e){function i(t){n.call(this,t),this.commands.color="GL_AMBIENT_LIGHT"}var n=t("./Light");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},{"./Light":123}],123:[function(t,e){function i(t){this._node=t,this._id=t.addComponent(this),this._requestingUpdate=!1,this.queue=[],this._color=null,this.commands={color:"GL_LIGHT_COLOR"}}i.prototype.setColor=function(t){if(!t.getNormalizedRGB)return!1;this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._color=t,this.queue.push(this.commands.color);var e=this._color.getNormalizedRGB();return this.queue.push(e[0]),this.queue.push(e[1]),this.queue.push(e[2]),this},i.prototype.getColor=function(){return this._color},i.prototype.onUpdate=function(){var t=this._node.getLocation();this._node.sendDrawCommand("WITH").sendDrawCommand(t);for(var e=this.queue.length;e--;)this._node.sendDrawCommand(this.queue.shift());if(this._color&&this._color.isActive()){this._node.sendDrawCommand(this.commands.color);var i=this._color.getNormalizedRGB();this._node.sendDrawCommand(i[0]),this._node.sendDrawCommand(i[1]),this._node.sendDrawCommand(i[2]),this._node.requestUpdateOnNextTick(this._id)}else this._requestingUpdate=!1},e.exports=i},{}],124:[function(t,e){function i(t){n.call(this,t),this.commands.position="GL_LIGHT_POSITION",this.onTransformChange(t.getTransform())}var n=t("./Light");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.onTransformChange=function(t){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this.queue.push(this.commands.position),this.queue.push(t[12]),this.queue.push(t[13]),this.queue.push(t[14])},e.exports=i},{"./Light":123}],125:[function(t,e){function i(t,e,i){this.buffer=null,this.target=t,this.type=e,this.data=[],this.gl=i}i.prototype.subData=function(){for(var t=this.gl,e=[],i=0,n=1e4;i<this.data.length;i+=n)e=Array.prototype.concat.apply(e,this.data.slice(i,i+n));this.buffer=this.buffer||t.createBuffer(),t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(e),t.STATIC_DRAW)},e.exports=i},{}],126:[function(t,e){function i(t){this.gl=t,this.registry={},this._dynamicBuffers=[],this._staticBuffers=[],this._arrayBufferMax=3e4,this._elementBufferMax=3e4}var n="indices",s=t("./Buffer");i.prototype.allocate=function(t,e,i,r,o){var a,u,h,c,l=this.registry[t]||(this.registry[t]={keys:[],values:[],spacing:[],offset:[],length:[]}),p=l.keys.indexOf(e),d=e===n,f=!1,m=0;if(-1===p){if(p=l.keys.length,u=d?i.length:Math.floor(i.length/r),o)h=new s(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:h,offset:i.length,isIndex:d});else{for(c=0;c<this._staticBuffers.length;c++)if(d===this._staticBuffers[c].isIndex&&(a=this._staticBuffers[c].offset+i.length,!d&&a<this._arrayBufferMax||d&&a<this._elementBufferMax)){h=this._staticBuffers[c].buffer,m=this._staticBuffers[c].offset,this._staticBuffers[c].offset+=i.length,f=!0;break}f||(h=new s(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:h,offset:i.length,isIndex:d}))}l.keys.push(e),l.values.push(h),l.spacing.push(r),l.offset.push(m),l.length.push(u)}var _=i.length;for(c=0;_>c;c++)l.values[p].data[m+c]=i[c];l.values[p].subData()},e.exports=i},{"./Buffer":125}],127:[function(t,e){function i(t,e){return function(){var i=t.apply(this,arguments);return e.apply(this,arguments),i}}function n(t,e){var i="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}",n=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(n),n.textContent=i;var s=document.createElement("ul");s.setAttribute("id","shaderReport"),document.body.appendChild(s);for(var r,o=/ERROR: [\d]+:([\d]+): (.+)/gim,a=e.split("\n");null!=(r=o.exec(t));){r.index===o.lastIndex&&o.lastIndex++;var u=document.createElement("li"),h='<p><span>ERROR</span> "'+r[2]+'" in line '+r[1]+"</p>";h+="<p><b>"+a[r[1]-1].replace(/^[ \t]+/g,"")+"</b></p>",u.innerHTML=h,s.appendChild(u)}}e.exports=function(){return i(this.gl.compileShader,function(t){if(!this.getShaderParameter(t,this.COMPILE_STATUS)){var e=this.getShaderInfoLog(t),i=this.getShaderSource(t);n(e,i)}})}},{}],128:[function(t,e){function i(t,e){this.gl=t,this.textureSlots=1,this.options=e||{},this.registeredMaterials={},this.flaggedUniforms=[],this.cachedUniforms={},this.uniformTypes=[],this.definitionVec4=[],this.definitionVec3=[],this.definitionFloat=[],this.applicationVec3=[],this.applicationVec4=[],this.applicationFloat=[],this.applicationVert=[],this.definitionVert=[],this.resetProgram()}var n=t("../utilities/clone"),s=t("../utilities/keyValueToArrays"),r=t("../webgl-shaders").vertex,o=t("../webgl-shaders").fragment,a=t("./Debug"),u=35633,h=35632,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l="precision mediump float;\n",p={undefined:"float ",1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},d={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},f={vert:1,vec3:2,vec4:4,"float":8},m=s({u_perspective:c,u_view:c,u_resolution:[0,0,0],u_transform:c,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:c,u_lightColor:c,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),_=s({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,0,0]}),g=s({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});i.prototype.registerMaterial=function(t,e){var i=e,n=d[t],s=f[n];if((this.registeredMaterials[e._id]&s)===s)return this;var r;for(r in i.uniforms)-1===m.keys.indexOf(r)&&(m.keys.push(r),m.values.push(i.uniforms[r]));for(r in i.varyings)-1===g.keys.indexOf(r)&&(g.keys.push(r),g.values.push(i.varyings[r]));for(r in i.attributes)-1===_.keys.indexOf(r)&&(_.keys.push(r),_.values.push(i.attributes[r]));return this.registeredMaterials[e._id]|=s,"float"===n&&(this.definitionFloat.push(e.defines),this.definitionFloat.push("float fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+e._id+") return fa_"+e._id+"();")),"vec3"===n&&(this.definitionVec3.push(e.defines),this.definitionVec3.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vec4"===n&&(this.definitionVec4.push(e.defines),this.definitionVec4.push("vec4 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vert"===n&&(this.definitionVert.push(e.defines),this.definitionVert.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),this.resetProgram()},i.prototype.resetProgram=function(){var t,e,i,s,a,c,d=[l],f=[l];for(this.uniformLocations=[],this.attributeLocations={},this.uniformTypes={},this.attributeNames=n(_.keys),this.attributeValues=n(_.values),this.varyingNames=n(g.keys),this.varyingValues=n(g.values),this.uniformNames=n(m.keys),this.uniformValues=n(m.values),this.flaggedUniforms=[],this.cachedUniforms={},f.push("uniform sampler2D u_textures[7];\n"),this.applicationVert.length&&d.push("uniform sampler2D u_textures[7];\n"),c=0;c<this.uniformNames.length;c++)s=this.uniformNames[c],a=this.uniformValues[c],d.push("uniform "+p[a.length]+s+";\n"),f.push("uniform "+p[a.length]+s+";\n");for(c=0;c<this.attributeNames.length;c++)s=this.attributeNames[c],a=this.attributeValues[c],d.push("attribute "+p[a.length]+s+";\n");for(c=0;c<this.varyingNames.length;c++)s=this.varyingNames[c],a=this.varyingValues[c],d.push("varying "+p[a.length]+s+";\n"),f.push("varying "+p[a.length]+s+";\n");e=d.join("")+r.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n")),t=f.join("")+o.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n")),i=this.gl.createProgram(),this.gl.attachShader(i,this.compileShader(this.gl.createShader(u),e)),this.gl.attachShader(i,this.compileShader(this.gl.createShader(h),t)),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.program=i,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(i)),this.program=null),this.setUniforms(this.uniformNames,this.uniformValues);var v=this.gl.getUniformLocation(this.program,"u_textures[0]");return this.gl.uniform1iv(v,[0,1,2,3,4,5,6]),this},i.prototype.uniformIsCached=function(t,e){if(null==this.cachedUniforms[t])return this.cachedUniforms[t]=e.length?new Float32Array(e):e,!1;if(e.length){for(var i=e.length;i--;)if(e[i]!==this.cachedUniforms[t][i]){for(i=e.length;i--;)this.cachedUniforms[t][i]=e[i];return!1}}else if(this.cachedUniforms[t]!==e)return this.cachedUniforms[t]=e,!1;return!0},i.prototype.setUniforms=function(t,e){var i,n,s,r,o,a=this.gl;if(!this.program)return this;for(r=t.length,o=0;r>o;o++)if(s=t[o],n=e[o],i=this.uniformLocations[s]||a.getUniformLocation(this.program,s),i&&(this.uniformLocations[s]=i,!this.uniformIsCached(s,n)))switch(this.uniformTypes[s]||(this.uniformTypes[s]=this.getUniformTypeFromValue(n)),this.uniformTypes[s]){case"uniform4fv":a.uniform4fv(i,n);break;case"uniform3fv":a.uniform3fv(i,n);break;case"uniform2fv":a.uniform2fv(i,n);break;case"uniform1fv":a.uniform1fv(i,n);break;case"uniform1f":a.uniform1f(i,n);break;case"uniformMatrix3fv":a.uniformMatrix3fv(i,!1,n);break;case"uniformMatrix4fv":a.uniformMatrix4fv(i,!1,n)}return this},i.prototype.getUniformTypeFromValue=function(t){if(Array.isArray(t)||t instanceof Float32Array)switch(t.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(t))&&isFinite(t))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(t)},i.prototype.compileShader=function(t,e){var i=1;return this.options.debug&&(this.gl.compileShader=a.call(this)),this.gl.shaderSource(t,e),this.gl.compileShader(t),this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(t)),console.error("1: "+e.replace(/\n/g,function(){return"\n"+(i+=1)+": "}))),t},e.exports=i},{"../utilities/clone":95,"../utilities/keyValueToArrays":97,"../webgl-shaders":136,"./Debug":127}],129:[function(t,e){function i(t,e){e=e||{},this.id=t.createTexture(),this.width=e.width||0,this.height=e.height||0,this.mipmap=e.mipmap,this.format=e.format||"RGBA",this.type=e.type||"UNSIGNED_BYTE",this.gl=t,this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[e.magFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[e.minFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e.wrapS]||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[e.wrapT]||t.CLAMP_TO_EDGE)}i.prototype.bind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this},i.prototype.unbind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},i.prototype.setImage=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],t),this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this},i.prototype.setArray=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],t),this},i.prototype.readBack=function(t,e,i,n){var s,r=this.gl;t=t||0,e=e||0,i=i||this.width,n=n||this.height;var o=r.createFramebuffer();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.id,0),r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(i*n*4),r.readPixels(t,e,i,n,r.RGBA,r.UNSIGNED_BYTE,s)),s},e.exports=i},{}],130:[function(t,e){function i(t){this.registry=[],this._needsResample=[],this._activeTexture=0,this._boundTexture=null,this._checkerboard=r(),this.gl=t}function n(t,e){var i=("string"==typeof t?new Image:t)||{};return i.crossOrigin="anonymous",i.src||(i.src=t),i.complete?e(i):i.onload=function(){e(i)},i}var s=t("./Texture"),r=t("./createCheckerboard");i.prototype.update=function(t){for(var e=this.registry.length,i=1;e>i;i++){var n=this.registry[i];n&&n.isLoaded&&n.resampleRate&&(!n.lastResample||t-n.lastResample>n.resampleRate)&&(this._needsResample[n.id]||(this._needsResample[n.id]=!0,n.lastResample=t))}},i.prototype.register=function(t,e){var i,r=t.data,o=t.id,a=t.options||{},u=this.registry[o];return u||(u=new s(this.gl,a),u.setImage(this._checkerboard),i=this.registry[o]={resampleRate:a.resampleRate||null,lastResample:null,isLoaded:!1,texture:u,source:r,id:o,slot:e},Array.isArray(r)||r instanceof Uint8Array||r instanceof Float32Array?(this.bindTexture(o),u.setArray(r),i.isLoaded=!0):window&&r instanceof window.HTMLVideoElement?r.addEventListener("loadeddata",function(){this.bindTexture(o),u.setImage(r),i.isLoaded=!0,i.source=r}.bind(this)):"string"==typeof r&&n(r,function(t){this.bindTexture(o),u.setImage(t),i.isLoaded=!0,i.source=t}.bind(this))),o},i.prototype.bindTexture=function(t){var e=this.registry[t];this._activeTexture!==e.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+e.slot),this._activeTexture=e.slot),this._boundTexture!==t&&(this._boundTexture=t,e.texture.bind()),this._needsResample[e.id]&&(e.texture.setImage(e.source),this._needsResample[e.id]=!1)},e.exports=i},{"./Texture":129,"./createCheckerboard":133}],131:[function(t,e){function i(t,e){t.classList.add("famous-webgl-renderer"),this.canvas=t,this.compositor=e;for(var i in this.constructor.DEFAULT_STYLES)this.canvas.style[i]=this.constructor.DEFAULT_STYLES[i];var o=this.gl=this.getWebGLContext(this.canvas);o.clearColor(0,0,0,0),o.polygonOffset(.1,.1),o.enable(o.POLYGON_OFFSET_FILL),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.depthFunc(o.LEQUAL),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.enable(o.CULL_FACE),o.cullFace(o.BACK),this.meshRegistry={},this.meshRegistryKeys=[],this.cutoutRegistry={},this.cutoutRegistryKeys=[],this.numLights=0,this.ambientLightColor=[0,0,0],this.lightRegistry={},this.lightRegistryKeys=[],this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.textureManager=new u(o),this.texCache={},this.bufferRegistry=new s(o),this.program=new n(o,{debug:!0}),this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]},this.resolutionName=["u_resolution"],this.resolutionValues=[],this.cachedSize=[],this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1e-6,0,-1,1,0,1];var a=this.cutoutGeometry=new r;this.bufferRegistry.allocate(a.spec.id,"a_pos",a.spec.bufferValues[0],3),this.bufferRegistry.allocate(a.spec.id,"a_texCoord",a.spec.bufferValues[1],2),this.bufferRegistry.allocate(a.spec.id,"a_normals",a.spec.bufferValues[2],3),this.bufferRegistry.allocate(a.spec.id,"indices",a.spec.bufferValues[3],1)}var n=t("./Program"),s=t("./BufferRegistry"),r=t("../webgl-geometries/primitives/Plane"),o=t("./radixSort"),a=t("../utilities/keyValueToArrays"),u=t("./TextureManager"),h=t("./compileMaterial"),c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=a({u_numLights:0,u_ambientLight:new Array(3),u_lightPosition:new Array(3),u_lightColor:new Array(3),u_perspective:new Array(16),u_time:0,u_view:new Array(16)});i.prototype.getWebGLContext=function(t){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,n=0;n<e.length;n++){try{i=t.getContext(e[n])}catch(t){var s="Error creating WebGL context: "+t.prototype.toString();console.error(s)}if(i)break}return i?i:!1},i.prototype.createLight=function(t){return this.numLights++,this.lightRegistryKeys.push(t),this.lightRegistry[t]={color:[0,0,0],position:[0,0,0]},this.lightRegistry[t]},i.prototype.createMesh=function(t){this.meshRegistryKeys.push(t);var e=a({u_opacity:1,u_transform:c,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});return this.meshRegistry[t]={depth:null,uniformKeys:e.keys,uniformValues:e.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0},this.meshRegistry[t]},i.prototype.setCutoutState=function(t,e){var i=this.getOrSetCutout(t);i.visible=e},i.prototype.getOrSetCutout=function(t){if(this.cutoutRegistry[t])return this.cutoutRegistry[t];var e=a({u_opacity:0,u_transform:c.slice(),u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});return this.cutoutRegistryKeys.push(t),this.cutoutRegistry[t]={uniformKeys:e.keys,uniformValues:e.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0},this.cutoutRegistry[t]},i.prototype.setMeshVisibility=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);i.visible=e},i.prototype.removeMesh=function(t){var e=this.meshRegistryKeys.indexOf(t);this.meshRegistryKeys.splice(e,1),this.meshRegistry[t]=null},i.prototype.setCutoutUniform=function(t,e,i){var n=this.getOrSetCutout(t),s=n.uniformKeys.indexOf(e);if(Array.isArray(i))for(var r=0,o=i.length;o>r;r++)n.uniformValues[s][r]=i[r];else n.uniformValues[s]=i},i.prototype.setMeshOptions=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);return i.options=e,this},i.prototype.setAmbientLightColor=function(t,e,i,n){return this.ambientLightColor[0]=e,this.ambientLightColor[1]=i,this.ambientLightColor[2]=n,this},i.prototype.setLightPosition=function(t,e,i,n){var s=this.lightRegistry[t]||this.createLight(t);return s.position[0]=e,s.position[1]=i,s.position[2]=n,this},i.prototype.setLightColor=function(t,e,i,n){var s=this.lightRegistry[t]||this.createLight(t);return s.color[0]=e,s.color[1]=i,s.color[2]=n,this},i.prototype.handleMaterialInput=function(t,e,i){var n=this.meshRegistry[t]||this.createMesh(t);i=h(i,n.textures.length),n.uniformValues[n.uniformKeys.indexOf(e)][0]=-i._id;for(var s=i.textures.length;s--;)n.textures.push(this.textureManager.register(i.textures[s],n.textures.length+s));return this.program.registerMaterial(e,i),this.updateSize()},i.prototype.setGeometry=function(t,e,i,n){var s=this.meshRegistry[t]||this.createMesh(t);return s.geometry=e,s.drawType=i,s.dynamic=n,this},i.prototype.setMeshUniform=function(t,e,i){var n=this.meshRegistry[t]||this.createMesh(t),s=n.uniformKeys.indexOf(e);-1===s?(n.uniformKeys.push(e),n.uniformValues.push(i)):n.uniformValues[s]=i},i.prototype.bufferData=function(t,e,i,n,s,r){return this.bufferRegistry.allocate(e,i,n,s,r),this},i.prototype.draw=function(t){var e=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.textureManager.update(e),this.meshRegistryKeys=o(this.meshRegistryKeys,this.meshRegistry),this.setGlobalUniforms(t),this.drawCutouts(),this.drawMeshes()},i.prototype.drawMeshes=function(){for(var t,e,i=this.gl,n=0;n<this.meshRegistryKeys.length;n++)if(e=this.meshRegistry[this.meshRegistryKeys[n]],t=this.bufferRegistry.registry[e.geometry],e.visible&&(e.uniformValues[0]<1?(i.depthMask(!1),i.enable(i.BLEND)):(i.depthMask(!0),i.disable(i.BLEND)),t)){for(var s=e.textures.length;s--;)this.textureManager.bindTexture(e.textures[s]);e.options&&this.handleOptions(e.options,e),this.program.setUniforms(e.uniformKeys,e.uniformValues),this.drawBuffers(t,e.drawType,e.geometry),e.options&&this.resetOptions(e.options)}},i.prototype.drawCutouts=function(){var t,e,i=this.cutoutRegistryKeys.length;i&&(this.gl.enable(this.gl.BLEND),this.gl.depthMask(!0));for(var n=0;i>n;n++)t=this.cutoutRegistry[this.cutoutRegistryKeys[n]],e=this.bufferRegistry.registry[t.geometry],t.visible&&(this.program.setUniforms(t.uniformKeys,t.uniformValues),this.drawBuffers(e,t.drawType,t.geometry))},i.prototype.setGlobalUniforms=function(t){for(var e,i,n=0,s=this.lightRegistryKeys.length;s>n;n++)e=this.lightRegistry[this.lightRegistryKeys[n]],i=4*n,this.lightPositions[0+i]=e.position[0],this.lightPositions[1+i]=e.position[1],this.lightPositions[2+i]=e.position[2],this.lightColors[0+i]=e.color[0],this.lightColors[1+i]=e.color[1],this.lightColors[2+i]=e.color[2];l.values[0]=this.numLights,l.values[1]=this.ambientLightColor,l.values[2]=this.lightPositions,l.values[3]=this.lightColors,this.projectionTransform[0]=1/(.5*this.cachedSize[0]),this.projectionTransform[5]=-1/(.5*this.cachedSize[1]),this.projectionTransform[11]=t.perspectiveTransform[11],l.values[4]=this.projectionTransform,l.values[5]=.001*this.compositor.getTime(),l.values[6]=t.viewTransform,this.program.setUniforms(l.keys,l.values)},i.prototype.drawBuffers=function(t,e,i){var n,s,r,o,a,u,h,c,l=this.gl,p=0;for(u=t.keys.length,c=0;u>c;c++)n=t.keys[c],"indices"!==n?(s=this.program.attributeLocations[n],-1!==s&&(void 0!==s||(s=l.getAttribLocation(this.program.program,n),this.program.attributeLocations[n]=s,-1!==s))&&(this.state.enabledAttributes[n]||(l.enableVertexAttribArray(s),this.state.enabledAttributes[n]=!0,this.state.enabledAttributesKeys.push(n)),a=t.values[c],r=t.spacing[c],o=t.offset[c],p=t.length[c],this.state.boundArrayBuffer!==a&&(l.bindBuffer(a.target,a.buffer),this.state.boundArrayBuffer=a),this.state.lastDrawn!==i&&l.vertexAttribPointer(s,r,l.FLOAT,l.FALSE,0,4*o))):h=c;var d=this.state.enabledAttributesKeys.length;for(c=0;d>c;c++){var f=this.state.enabledAttributesKeys[c];this.state.enabledAttributes[f]&&-1===t.keys.indexOf(f)&&(l.disableVertexAttribArray(this.program.attributeLocations[f]),this.state.enabledAttributes[f]=!1)}p&&(void 0!==h?(a=t.values[h],o=t.offset[h],r=t.spacing[h],p=t.length[h],this.state.boundElementBuffer!==a&&(l.bindBuffer(a.target,a.buffer),this.state.boundElementBuffer=a),l.drawElements(l[e],p,l.UNSIGNED_SHORT,2*o)):l.drawArrays(l[e],0,p)),this.state.lastDrawn=i},i.prototype.updateSize=function(t){return t&&(this.cachedSize[0]=t[0],this.cachedSize[1]=t[1],this.cachedSize[2]=t[0]>t[1]?t[0]:t[1]),this.gl.viewport(0,0,this.cachedSize[0],this.cachedSize[1]),this.resolutionValues[0]=this.cachedSize,this.program.setUniforms(this.resolutionName,this.resolutionValues),this},i.prototype.handleOptions=function(t,e){var i=this.gl;t&&("double"===t.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[e.geometry],e.drawType,e.geometry),this.gl.cullFace(this.gl.BACK)),t.blending&&i.blendFunc(i.SRC_ALPHA,i.ONE),"back"===t.side&&i.cullFace(i.FRONT))},i.prototype.resetOptions=function(t){var e=this.gl;t&&(t.blending&&e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),"back"===t.side&&e.cullFace(e.BACK))},i.DEFAULT_STYLES={pointerEvents:"none",position:"absolute",zIndex:1,top:"0px",left:"0px"},e.exports=i},{"../utilities/keyValueToArrays":97,"../webgl-geometries/primitives/Plane":112,"./BufferRegistry":126,"./Program":128,"./TextureManager":130,"./compileMaterial":132,"./radixSort":135}],132:[function(t,e){function i(t,e){var i="",u={},c={},l={},p=[],d=[];return n(t,function(t){if(t.chunk){var n=h[s(t)],f=o(t),m=r(t.chunk.glsl,t.inputs,d.length+e);i+=n+f+" = "+m+"\n ",t.uniforms&&a(u,t.uniforms),t.varyings&&a(c,t.varyings),t.attributes&&a(l,t.attributes),t.chunk.defines&&p.push(t.chunk.defines),t.texture&&d.push(t.texture)}}),{_id:t._id,glsl:i+"return "+o(t)+";",defines:p.join("\n"),uniforms:u,varyings:c,attributes:l,textures:d}}function n(t,e){for(var i=t.inputs,s=i&&i.length,r=-1;++r<s;)n(i[r],e);return e(t),t}function s(t){if("number"==typeof t)return 1;if(Array.isArray(t))return t.length;var e=t.chunk.output;if("number"==typeof e)return e;var i=t.inputs.map(function(t){return s(t)}).join(",");return e[i]}function r(t,e,i){return t.replace(/%\d/g,function(t){return o(e[t[1]-1])}).replace(/\$TEXTURE/,"u_textures["+i+"]")}function o(t){return Array.isArray(t)?u(t):"object"==typeof t?"fa_"+t._id:t.toFixed(6)}function a(t,e){for(var i in e)t[i]=e[i]}function u(t){var e=t.length;return"vec"+e+"("+t.join(",")+")"}var h={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};e.exports=i},{}],133:[function(t,e){function i(){var t=document.createElement("canvas").getContext("2d");t.canvas.width=t.canvas.height=128;for(var e=0;e<t.canvas.height;e+=16)for(var i=0;i<t.canvas.width;i+=16)t.fillStyle=16&(i^e)?"#FFF":"#DDD",t.fillRect(i,e,16,16);return t.canvas}e.exports=i},{}],134:[function(t,e){e.exports={Buffer:t("./Buffer"),BufferRegistry:t("./BufferRegistry"),createCheckerboard:t("./createCheckerboard"),Program:t("./Program"),WebGLRenderer:t("./WebGLRenderer"),Texture:t("./Texture")}},{"./Buffer":125,"./BufferRegistry":126,"./Program":128,"./Texture":129,"./WebGLRenderer":131,"./createCheckerboard":133}],135:[function(t,e){function i(t,e,i){var n=t[i],s=e[n];return(s.depth?s.depth:e[n].uniformValues[1][14])+_}function n(t,e,i,n){var s=t[i];return e[s].depth=o(n)-_,s}function s(t,e,i){e[t[i]].depth=null}function r(t){return v[0]=t,y[0]}function o(t){return y[0]=t,v[0]}function a(t,e){var o,a,p,_,g,v,y,b,x,w,E,S=0,T=[];for(f=32/u+.999999999999999|0,o=0,_=h*f;_>o;o++)l[o]=0;for(o=0,_=t.length;_>o;o++){for(g=r(i(t,e,o)),g^=g>>31|2147483648,a=0,p=0;m>a;a+=h,p+=u)l[a+(g>>>p&c)]++;l[a+(g>>>p&d)]++}for(a=0;m>=a;a+=h)for(b=a,x=0;a+h>b;b++)w=l[b]+x,l[b]=x-1,x=w;if(--f){for(o=0,_=t.length;_>o;o++)g=r(i(t,e,o)),T[++l[g&c]]=n(t,e,o,g^=g>>31|2147483648);for(y=T,T=t,t=y;++S<f;){for(o=0,_=t.length,v=S*h,E=S*u;_>o;o++)g=r(i(t,e,o)),T[++l[v+(g>>>E&c)]]=t[o];y=T,T=t,t=y}}for(o=0,_=t.length,v=S*h,E=S*u;_>o;o++)g=r(i(t,e,o)),T[++l[v+(g>>>E&d)]]=n(t,e,o,g^(~g>>31|2147483648)),s(t,e,o);return T}var u=11,h=1<<u,c=h-1,l=new Array(h*Math.ceil(64/u)),p=1<<31%u,d=(p<<1)-1,f=32/u+.999999999999999|0,m=h*(f-1),_=Math.pow(20,6),g=new ArrayBuffer(4),v=new Float32Array(g,0,1),y=new Int32Array(g,0,1);e.exports=a},{}],136:[function(t,e){var i=(t("glslify"),t("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nmat3 a_x_getNormalMatrix(in mat4 t) {\n  mat3 matNorm;\n  mat4 a = t;\n  float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3], a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3], a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3], a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  det = 1.0 / det;\n  matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return matNorm;\n}\nfloat b_x_inverse(float m) {\n  return 1.0 / m;\n}\nmat2 b_x_inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\nmat3 b_x_inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11), b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10), b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\nmat4 b_x_inverse(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  return mat4(a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07, a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06, a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00, a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\nfloat c_x_transpose(float m) {\n  return m;\n}\nmat2 c_x_transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0], m[0][1], m[1][1]);\n}\nmat3 c_x_transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0], m[0][1], m[1][1], m[2][1], m[0][2], m[1][2], m[2][2]);\n}\nmat4 c_x_transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0], m[0][1], m[1][1], m[2][1], m[3][1], m[0][2], m[1][2], m[2][2], m[3][2], m[0][3], m[1][3], m[2][3], m[3][3]);\n}\nvec4 applyTransform(vec4 pos) {\n  mat4 MVMatrix = u_view * u_transform;\n  pos.x += 1.0;\n  pos.y -= 1.0;\n  pos.xyz *= u_size * 0.5;\n  pos.y *= -1.0;\n  v_position = (MVMatrix * pos).xyz;\n  v_eyeVector = (u_resolution * 0.5) - v_position;\n  pos = u_perspective * MVMatrix * pos;\n  return pos;\n}\n#vert_definitions\n\nvec3 calculateOffset(vec3 ID) {\n  \n  #vert_applications\n  return vec3(0.0);\n}\nvoid main() {\n  v_textureCoordinate = a_texCoord;\n  vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n  invertedNormals.y *= -1.0;\n  v_normal = c_x_transpose(mat3(b_x_inverse(u_transform))) * invertedNormals;\n  vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n  gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}","\n#define GLSLIFY 1\n\n#float_definitions\n\nfloat a_x_applyMaterial(float ID) {\n  \n  #float_applications\n  return 1.;\n}\n#vec3_definitions\n\nvec3 a_x_applyMaterial(vec3 ID) {\n  \n  #vec3_applications\n  return vec3(0);\n}\n#vec4_definitions\n\nvec4 a_x_applyMaterial(vec4 ID) {\n  \n  #vec4_applications\n  return vec4(0);\n}\nvec4 b_x_applyLight(in vec4 baseColor, in vec3 normal, in vec4 glossiness) {\n  int numLights = int(u_numLights);\n  vec3 ambientColor = u_ambientLight * baseColor.rgb;\n  vec3 eyeVector = normalize(v_eyeVector);\n  vec3 diffuse = vec3(0.0);\n  bool hasGlossiness = glossiness.a > 0.0;\n  bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n  for(int i = 0; i < 4; i++) {\n    if(i >= numLights)\n      break;\n    vec3 lightDirection = normalize(u_lightPosition[i].xyz - v_position);\n    float lambertian = max(dot(lightDirection, normal), 0.0);\n    if(lambertian > 0.0) {\n      diffuse += u_lightColor[i].rgb * baseColor.rgb * lambertian;\n      if(hasGlossiness) {\n        vec3 halfVector = normalize(lightDirection + eyeVector);\n        float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n        vec3 specularColor = hasSpecularColor ? glossiness.rgb : u_lightColor[i].rgb;\n        diffuse += specularColor * specularWeight * lambertian;\n      }\n    }\n  }\n  return vec4(ambientColor + diffuse, baseColor.a);\n}\nvoid main() {\n  vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : a_x_applyMaterial(u_baseColor);\n  bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n  vec3 normal = normalize(v_normal);\n  vec4 glossiness = u_glossiness.x < 0.0 ? a_x_applyMaterial(u_glossiness) : u_glossiness;\n  vec4 color = lightsEnabled ? b_x_applyLight(material, normalize(v_normal), glossiness) : material;\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}",[],[]));
e.exports=i},{glslify:46,"glslify/simple-adapter.js":47}]},{},[40])(40)}),i("helpers/StatsTimer",["require","exports","module"],function(t,e,i){function n(){}n.prototype.createTimer=function(){var t=function(){var t=Date.now(),e=t,i=0,n=1/0,s=0,r=0,o=1/0,a=0,u=0,h=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(t){t.preventDefault(),v(++h%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(l);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",l.appendChild(p);var d=document.createElement("div");for(d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(d);74>d.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(m);var _=document.createElement("div");_.id="msText",_.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",_.innerHTML="MS",m.appendChild(_);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(g);74>g.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(f);var v=function(t){switch(h=t){case 0:l.style.display="block",m.style.display="none";break;case 1:l.style.display="none",m.style.display="block"}};return{REVISION:12,domElement:c,setMode:v,begin:function(){t=Date.now()},end:function(){var h=Date.now();i=h-t,n=Math.min(n,i),s=Math.max(s,i),_.textContent=i+" MS ("+n+"-"+s+")";var c=Math.min(30,30-30*(i/200));return g.appendChild(g.firstChild).style.height=c+"px",u++,h>e+1e3&&(r=Math.round(1e3*u/(h-e)),o=Math.min(o,r),a=Math.max(a,r),p.textContent=r+" FPS ("+o+"-"+a+")",c=Math.min(30,30-30*(r/100)),d.appendChild(d.firstChild).style.height=c+"px",e=h,u=0),h},update:function(){t=this.end()}}};"object"==typeof i&&(i.exports=t);var e=new t;return e.setMode(0),e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.body.appendChild(e.domElement),e},i.exports=n}),i("helpers/OrientationController",["require","exports","module"],function(t,e,i){function n(){}n.prototype.constructor=n,n.prototype.reset=function(){this.started=!1,this.baseOrientation=void 0,this.orientationDifference=[0,0,0],this.lastValue={orientationDifference:this.orientationDifference,timeStamp:0},this.orientationDifferenceAt=function(){return this.lastValue.orientationDifference}},n.prototype.interpolate=function(t,e,i,n){var s=function(s){return e+(n-e)*((s-t)/(i-t))};return s.m=(n-e)/(i-t),s.text="y = "+s.m+"x",s},n.prototype.setTimeKeeper=function(t){this.timeKeeper=t,this.reset()},n.prototype.makeOrientationFunction=function(t){var e=this,i=this.lastValue,n=t,s=[void 0,void 0,void 0];s=s.map(function(t,s){var r=i.timeStamp,o=i.orientationDifference[s],a=n.timeStamp,u=n.orientationDifference[s],h=e.interpolate(r,o,a,u);return h}),window.watchh=s;var r=function(t){var e;return e=t>=n.timeStamp?n.orientationDifference:[s[0](t),s[1](t),s[2](t)],this.lastValue={orientationDifference:e,timeStamp:t},e};return r},n.prototype.reInterpolate=function(t,e,i,n){var s=function(s){return e+(n-e)*((s-t)/(i-t))};return s},n.prototype.normalize=function(t){return t[0]=-t[0],t},n.prototype.startListening=function(){var t=this;window.DeviceOrientationEvent&&(t.started=!0,window.addEventListener("deviceorientation",function(e){var i=[e.gamma,e.beta,e.alpha],n=t.normalize(i);t.baseOrientation||(t.baseOrientation=n);var s=n.map(function(t){return t>30?30:-30>t?-30:t}),r={orientationDifference:s,timeStamp:this.timeKeeper.timePassed+50};t.orientationDifferenceAt=t.makeOrientationFunction(r)}))},i.exports=n}),this.createjs=this.createjs||{},function(){var t=createjs.SoundJS=createjs.SoundJS||{};t.version="NEXT",t.buildDate="Tue, 19 May 2015 17:26:59 GMT"}(),this.createjs=this.createjs||{},createjs.extend=function(t,e){function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i},this.createjs=this.createjs||{},createjs.promote=function(t,e){var i=t.prototype,n=Object.getPrototypeOf&&Object.getPrototypeOf(i)||i.__proto__;if(n){i[(e+="_")+"constructor"]=n.constructor;for(var s in n)i.hasOwnProperty(s)&&"function"==typeof n[s]&&(i[e+s]=n[s])}return t},this.createjs=this.createjs||{},createjs.indexOf=function(t,e){for(var i=0,n=t.length;n>i;i++)if(e===t[i])return i;return-1},this.createjs=this.createjs||{},function(){createjs.proxy=function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,Array.prototype.slice.call(arguments,0).concat(i))}}}(),this.createjs=this.createjs||{},function(){function t(){throw"BrowserDetect cannot be instantiated"}var e=t.agent=window.navigator.userAgent;t.isWindowPhone=e.indexOf("IEMobile")>-1||e.indexOf("Windows Phone")>-1,t.isFirefox=e.indexOf("Firefox")>-1,t.isOpera=null!=window.opera,t.isChrome=e.indexOf("Chrome")>-1,t.isIOS=(e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&!t.isWindowPhone,t.isAndroid=e.indexOf("Android")>-1&&!t.isWindowPhone,t.isBlackberry=e.indexOf("Blackberry")>-1,createjs.BrowserDetect=t}(),this.createjs=this.createjs||{},function(){function t(){this._listeners=null,this._captureListeners=null}var e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e.addEventListener=function(t,e,i){var n;n=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var s=n[t];return s&&this.removeEventListener(t,e,i),s=n[t],s?s.push(e):n[t]=[e],e},e.on=function(t,e,i,n,s,r){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,s),n&&t.remove()},r)},e.removeEventListener=function(t,e,i){var n=i?this._captureListeners:this._listeners;if(n){var s=n[t];if(s)for(var r=0,o=s.length;o>r;r++)if(s[r]==e){1==o?delete n[t]:s.splice(r,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t){if("string"==typeof t){var e=this._listeners;if(!e||!e[t])return!1;t=new createjs.Event(t)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(i){}if(t.bubbles&&this.parent){for(var n=this,s=[n];n.parent;)s.push(n=n.parent);var r,o=s.length;for(r=o-1;r>=0&&!t.propagationStopped;r--)s[r]._dispatchEvent(t,1+(0==r));for(r=1;o>r&&!t.propagationStopped;r++)s[r]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,n=1==e?this._captureListeners:this._listeners;if(t&&n){var s=n[t.type];if(!s||!(i=s.length))return;try{t.currentTarget=this}catch(r){}try{t.eventPhase=e}catch(r){}t.removed=!1,s=s.slice();for(var o=0;i>o&&!t.immediatePropagationStopped;o++){var a=s[o];a.handleEvent?a.handleEvent(t):a(t),t.removed&&(this.off(t.type,a,1==e),t.removed=!1)}}},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.type=t,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!e,this.cancelable=!!i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var e=t.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.Event_constructor("error"),this.title=t,this.message=e,this.data=i}var e=createjs.extend(t,createjs.Event);e.clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(t,"Event")}(),this.createjs=this.createjs||{},function(){function t(t,e){this.Event_constructor("progress"),this.loaded=t,this.total=null==e?1:e,this.progress=0==e?0:this.loaded/this.total}var e=createjs.extend(t,createjs.Event);e.clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(t,"Event")}(window),this.createjs=this.createjs||{},function(){function t(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.LoadItem.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=i.LOAD_TIMEOUT_DEFAULT}var e=t.prototype={},i=t;i.LOAD_TIMEOUT_DEFAULT=8e3,i.create=function(e){if("string"==typeof e){var n=new t;return n.src=e,n}if(e instanceof i)return e;if(e instanceof Object&&e.src)return null==e.loadTimeout&&(e.loadTimeout=i.LOAD_TIMEOUT_DEFAULT),e;throw new Error("Type not recognized.")},e.set=function(t){for(var e in t)this[e]=t[e];return this},createjs.LoadItem=i}(),function(){var t={};t.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i,t.RELATIVE_PATT=/^[./]*?\//i,t.EXTENSION_PATT=/\/?[^/]+\.(\w{1,5})$/i,t.parseURI=function(e){var i={absolute:!1,relative:!1};if(null==e)return i;var n=e.indexOf("?");n>-1&&(e=e.substr(0,n));var s;return t.ABSOLUTE_PATT.test(e)?i.absolute=!0:t.RELATIVE_PATT.test(e)&&(i.relative=!0),(s=e.match(t.EXTENSION_PATT))&&(i.extension=s[1].toLowerCase()),i},t.formatQueryString=function(t,e){if(null==t)throw new Error("You must specify data.");var i=[];for(var n in t)i.push(n+"="+escape(t[n]));return e&&(i=i.concat(e)),i.join("&")},t.buildPath=function(t,e){if(null==e)return t;var i=[],n=t.indexOf("?");if(-1!=n){var s=t.slice(n+1);i=i.concat(s.split("&"))}return-1!=n?t.slice(0,n)+"?"+this._formatQueryString(e,i):t+"?"+this._formatQueryString(e,i)},t.isCrossDomain=function(t){var e=document.createElement("a");e.href=t.src;var i=document.createElement("a");i.href=location.href;var n=""!=e.hostname&&(e.port!=i.port||e.protocol!=i.protocol||e.hostname!=i.hostname);return n},t.isLocal=function(t){var e=document.createElement("a");return e.href=t.src,""==e.hostname&&"file:"==e.protocol},t.isBinary=function(t){switch(t){case createjs.AbstractLoader.IMAGE:case createjs.AbstractLoader.BINARY:return!0;default:return!1}},t.isImageTag=function(t){return t instanceof HTMLImageElement},t.isAudioTag=function(t){return window.HTMLAudioElement?t instanceof HTMLAudioElement:!1},t.isVideoTag=function(t){return window.HTMLVideoElement?t instanceof HTMLVideoElement:!1},t.isText=function(t){switch(t){case createjs.AbstractLoader.TEXT:case createjs.AbstractLoader.JSON:case createjs.AbstractLoader.MANIFEST:case createjs.AbstractLoader.XML:case createjs.AbstractLoader.CSS:case createjs.AbstractLoader.SVG:case createjs.AbstractLoader.JAVASCRIPT:case createjs.AbstractLoader.SPRITESHEET:return!0;default:return!1}},t.getTypeByExtension=function(t){if(null==t)return createjs.AbstractLoader.TEXT;switch(t.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.AbstractLoader.IMAGE;case"ogg":case"mp3":case"webm":return createjs.AbstractLoader.SOUND;case"mp4":case"webm":case"ts":return createjs.AbstractLoader.VIDEO;case"json":return createjs.AbstractLoader.JSON;case"xml":return createjs.AbstractLoader.XML;case"css":return createjs.AbstractLoader.CSS;case"js":return createjs.AbstractLoader.JAVASCRIPT;case"svg":return createjs.AbstractLoader.SVG;default:return createjs.AbstractLoader.TEXT}},createjs.RequestUtils=t}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=i,this.resultFormatter=null,this._item=t?createjs.LoadItem.create(t):null,this._preferXHR=e,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var e=createjs.extend(t,createjs.EventDispatcher),i=t;i.POST="POST",i.GET="GET",i.BINARY="binary",i.CSS="css",i.IMAGE="image",i.JAVASCRIPT="javascript",i.JSON="json",i.JSONP="jsonp",i.MANIFEST="manifest",i.SOUND="sound",i.VIDEO="video",i.SPRITESHEET="spritesheet",i.SVG="svg",i.TEXT="text",i.XML="xml",e.getItem=function(){return this._item},e.getResult=function(t){return t?this._rawResult:this._result},e.getTag=function(){return this._tag},e.setTag=function(t){this._tag=t},e.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var t=new createjs.Event("initialize");t.loader=this._request,this.dispatchEvent(t),this._request.load()},e.cancel=function(){this.canceled=!0,this.destroy()},e.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},e.getLoadedItems=function(){return this._loadedItems},e._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},e._createTag=function(){return null},e._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},e._sendProgress=function(t){if(!this._isCanceled()){var e=null;"number"==typeof t?(this.progress=t,e=new createjs.ProgressEvent(this.progress)):(e=t,this.progress=t.loaded/t.total,e.progress=this.progress,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(e)}},e._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var t=new createjs.Event("complete");t.rawResult=this._rawResult,null!=this._result&&(t.result=this._result),this.dispatchEvent(t)}},e._sendError=function(t){!this._isCanceled()&&this.hasEventListener("error")&&(null==t&&(t=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(t))},e._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},e.resultFormatter=null,e.handleEvent=function(t){switch(t.type){case"complete":this._rawResult=t.target._response;var e=this.resultFormatter&&this.resultFormatter(this),i=this;e instanceof Function?e(function(t){i._result=t,i._sendComplete()}):(this._result=e||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(t);break;case"error":this._sendError(t);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(t.type)}},e.buildPath=function(t,e){return createjs.RequestUtils.buildPath(t,e)},e.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.AbstractLoader_constructor(t,e,i),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src"}var e=createjs.extend(t,createjs.AbstractLoader);e.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},e._createTag=function(){},e._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},e._formatResult=function(t){return this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR&&(t.getTag().src=t.getResult(!0)),t.getTag()},createjs.AbstractMediaLoader=createjs.promote(t,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){var t=function(t){this._item=t},e=createjs.extend(t,createjs.EventDispatcher);e.load=function(){},e.destroy=function(){},e.cancel=function(){},createjs.AbstractRequest=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.AbstractRequest_constructor(t),this._tag=e,this._tagSrcAttribute=i,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1,this._startTagVisibility=null}var e=createjs.extend(t,createjs.AbstractRequest);e.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var t=new createjs.Event("initialize");t.loader=this._tag,this.dispatchEvent(t),this._hideTag(),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(window.document.body.appendChild(this._tag),this._addedToDOM=!0)},e.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},e._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var t=this._tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleTagComplete()},e._handleError=function(){this._clean(),this.dispatchEvent("error")},e._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this._showTag(),this.dispatchEvent("complete")},e._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},e._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},e._hideTag=function(){this._startTagVisibility=this._tag.style.visibility,this._tag.style.visibility="hidden"},e._showTag=function(){this._tag.style.visibility=this._startTagVisibility},e._handleStalled=function(){},createjs.TagRequest=createjs.promote(t,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){function t(t,e,i){this.AbstractRequest_constructor(t),this._tag=e,this._tagSrcAttribute=i,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var e=createjs.extend(t,createjs.TagRequest);e.load=function(){var t=createjs.proxy(this._handleStalled,this);this._stalledCallback=t;var e=createjs.proxy(this._handleProgress,this);this._handleProgress=e,this._tag.addEventListener("stalled",t),this._tag.addEventListener("progress",e),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},e._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var t=this._tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleTagComplete()},e._handleStalled=function(){},e._handleProgress=function(t){if(t&&!(t.loaded>0&&0==t.total)){var e=new createjs.ProgressEvent(t.loaded,t.total);this.dispatchEvent(e)}},e._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(t,"TagRequest")}(),this.createjs=this.createjs||{},function(){function t(t){this.AbstractRequest_constructor(t),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),!this._createXHR(t)}var e=createjs.extend(t,createjs.AbstractRequest);t.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],e.getResult=function(t){return t&&this._rawResponse?this._rawResponse:this._response},e.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},e.load=function(){if(null==this._request)return void this._handleError();this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values&&this._item.method!=createjs.AbstractLoader.GET?this._item.method==createjs.AbstractLoader.POST&&this._request.send(createjs.RequestUtils.formatQueryString(this._item.values)):this._request.send()}catch(t){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,t))}},e.setResponseType=function(t){this._request.responseType=t},e.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},e.getResponseHeader=function(t){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(t):null},e._handleProgress=function(t){if(t&&!(t.loaded>0&&0==t.total)){var e=new createjs.ProgressEvent(t.loaded,t.total);this.dispatchEvent(e)}},e._handleLoadStart=function(){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},e._handleAbort=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,t))},e._handleError=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(t.message))},e._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},e._handleLoad=function(){if(!this.loaded){this.loaded=!0;var t=this._checkError();if(t)return void this._handleError(t);this._response=this._getResponse(),this._clean(),this.dispatchEvent(new createjs.Event("complete"))}},e._handleTimeout=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,t))},e._checkError=function(){var t=parseInt(this._request.status);switch(t){case 404:case 0:return new Error(t)}return null},e._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(t){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(t){}return null},e._createXHR=function(t){var e=createjs.RequestUtils.isCrossDomain(t),i={},n=null;if(window.XMLHttpRequest)n=new XMLHttpRequest,e&&void 0===n.withCredentials&&window.XDomainRequest&&(n=new XDomainRequest);else{for(var r=0,o=s.ACTIVEX_VERSIONS.length;o>r;r++){s.ACTIVEX_VERSIONS[r];try{n=new ActiveXObject(axVersions);break}catch(a){}}if(null==n)return!1}null==t.mimeType&&createjs.RequestUtils.isText(t.type)&&(t.mimeType="text/plain; charset=utf-8"),t.mimeType&&n.overrideMimeType&&n.overrideMimeType(t.mimeType),this._xhrLevel="string"==typeof n.responseType?2:1;var u=null;if(u=t.method==createjs.AbstractLoader.GET?createjs.RequestUtils.buildPath(t.src,t.values):t.src,n.open(t.method||createjs.AbstractLoader.GET,u,!0),e&&n instanceof XMLHttpRequest&&1==this._xhrLevel&&(i.Origin=location.origin),t.values&&t.method==createjs.AbstractLoader.POST&&(i["Content-Type"]="application/x-www-form-urlencoded"),e||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),t.headers)for(var h in t.headers)i[h]=t.headers[h];for(h in i)n.setRequestHeader(h,i[h]);return n instanceof XMLHttpRequest&&void 0!==t.withCredentials&&(n.withCredentials=t.withCredentials),this._request=n,!0},e._clean=function(){clearTimeout(this._loadTimeout),this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)},e.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(t,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){function t(t,e){this.AbstractMediaLoader_constructor(t,e,createjs.AbstractLoader.SOUND),createjs.RequestUtils.isAudioTag(t)?this._tag=t:createjs.RequestUtils.isAudioTag(t.src)?this._tag=t:createjs.RequestUtils.isAudioTag(t.tag)&&(this._tag=createjs.RequestUtils.isAudioTag(t)?t:t.src),null!=this._tag&&(this._preferXHR=!1)}var e=createjs.extend(t,createjs.AbstractMediaLoader),i=t;i.canLoadItem=function(t){return t.type==createjs.AbstractLoader.SOUND},e._createTag=function(t){var e=document.createElement("audio");return e.autoplay=!1,e.preload="none",e.src=t,e},createjs.SoundLoader=createjs.promote(t,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){var t=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},e=t.prototype={},i=t;i.create=function(t){if(t instanceof i||t instanceof Object){var e=new createjs.PlayPropsConfig;return e.set(t),e}throw new Error("Type not recognized.")},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=i}(),this.createjs=this.createjs||{},function(){function t(){throw"Sound cannot be instantiated"}function e(t,e){this.init(t,e)}var i=t;i.INTERRUPT_ANY="any",i.INTERRUPT_EARLY="early",i.INTERRUPT_LATE="late",i.INTERRUPT_NONE="none",i.PLAY_INITED="playInited",i.PLAY_SUCCEEDED="playSucceeded",i.PLAY_INTERRUPTED="playInterrupted",i.PLAY_FINISHED="playFinished",i.PLAY_FAILED="playFailed",i.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],i.EXTENSION_MAP={m4a:"mp4"},i.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,i.defaultInterruptBehavior=i.INTERRUPT_NONE,i.alternateExtensions=[],i.activePlugin=null,i._masterVolume=1,Object.defineProperty(i,"volume",{get:function(){return this._masterVolume},set:function(t){if(null==Number(t))return!1;if(t=Math.max(0,Math.min(1,t)),i._masterVolume=t,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(t))for(var e=this._instances,n=0,s=e.length;s>n;n++)e[n].setMasterVolume(t)}}),i._masterMute=!1,Object.defineProperty(i,"muted",{get:function(){return this._masterMute},set:function(t){if(null==t)return!1;if(this._masterMute=t,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(t))for(var e=this._instances,i=0,n=e.length;n>i;i++)e[i].setMasterMute(t);return!0}}),Object.defineProperty(i,"capabilities",{get:function(){return null==i.activePlugin?null:i.activePlugin._capabilities},set:function(){return!1}}),i._pluginsRegistered=!1,i._lastID=0,i._instances=[],i._idHash={},i._preloadHash={},i._defaultPlayPropsHash={},i.addEventListener=null,i.removeEventListener=null,i.removeAllEventListeners=null,i.dispatchEvent=null,i.hasEventListener=null,i._listeners=null,createjs.EventDispatcher.initialize(i),i.getPreloadHandlers=function(){return{callback:createjs.proxy(i.initLoad,i),types:["sound"],extensions:i.SUPPORTED_EXTENSIONS}},i._handleLoadComplete=function(t){var e=t.target.getItem().src;if(i._preloadHash[e])for(var n=0,s=i._preloadHash[e].length;s>n;n++){var r=i._preloadHash[e][n];if(i._preloadHash[e][n]=!0,i.hasEventListener("fileload")){var t=new createjs.Event("fileload");t.src=r.src,t.id=r.id,t.data=r.data,t.sprite=r.sprite,i.dispatchEvent(t)}}},i._handleLoadError=function(t){var e=t.target.getItem().src;if(i._preloadHash[e])for(var n=0,s=i._preloadHash[e].length;s>n;n++){var r=i._preloadHash[e][n];if(i._preloadHash[e][n]=!1,i.hasEventListener("fileerror")){var t=new createjs.Event("fileerror");t.src=r.src,t.id=r.id,t.data=r.data,t.sprite=r.sprite,i.dispatchEvent(t)}}},i._registerPlugin=function(t){return t.isSupported()?(i.activePlugin=new t,!0):!1},i.registerPlugins=function(t){i._pluginsRegistered=!0;for(var e=0,n=t.length;n>e;e++)if(i._registerPlugin(t[e]))return!0;return!1},i.initializeDefaultPlugins=function(){return null!=i.activePlugin?!0:i._pluginsRegistered?!1:i.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},i.isReady=function(){return null!=i.activePlugin},i.getCapabilities=function(){return null==i.activePlugin?null:i.activePlugin._capabilities},i.getCapability=function(t){return null==i.activePlugin?null:i.activePlugin._capabilities[t]},i.initLoad=function(t){return i._registerSound(t)},i._registerSound=function(t){if(!i.initializeDefaultPlugins())return!1;var n;if(t.src instanceof Object?(n=i._parseSrc(t.src),n.src=t.path+n.src):n=i._parsePath(t.src),null==n)return!1;t.src=n.src,t.type="sound";var s=t.data,r=null;if(null!=s&&(isNaN(s.channels)?isNaN(s)||(r=parseInt(s)):r=parseInt(s.channels),s.audioSprite))for(var o,a=s.audioSprite.length;a--;)o=s.audioSprite[a],i._idHash[o.id]={src:t.src,startTime:parseInt(o.startTime),duration:parseInt(o.duration)},o.defaultPlayProps&&(i._defaultPlayPropsHash[o.id]=createjs.PlayPropsConfig.create(o.defaultPlayProps));null!=t.id&&(i._idHash[t.id]={src:t.src});var u=i.activePlugin.register(t);return e.create(t.src,r),null!=s&&isNaN(s)?t.data.channels=r||e.maxPerChannel():t.data=r||e.maxPerChannel(),u.type&&(t.type=u.type),t.defaultPlayProps&&(i._defaultPlayPropsHash[t.src]=createjs.PlayPropsConfig.create(t.defaultPlayProps)),u},i.registerSound=function(t,e,n,s,r){var o={src:t,id:e,data:n,defaultPlayProps:r};t instanceof Object&&t.src&&(s=e,o=t),o=createjs.LoadItem.create(o),o.path=s,null==s||o.src instanceof Object||(o.src=s+t);var a=i._registerSound(o);if(!a)return!1;if(i._preloadHash[o.src]||(i._preloadHash[o.src]=[]),i._preloadHash[o.src].push(o),1==i._preloadHash[o.src].length)a.on("complete",createjs.proxy(this._handleLoadComplete,this)),a.on("error",createjs.proxy(this._handleLoadError,this)),i.activePlugin.preload(a);else if(1==i._preloadHash[o.src][0])return!0;return o},i.registerSounds=function(t,e){var i=[];t.path&&(e?e+=t.path:e=t.path,t=t.manifest);for(var n=0,s=t.length;s>n;n++)i[n]=createjs.Sound.registerSound(t[n].src,t[n].id,t[n].data,e,t[n].defaultPlayProps);return i},i.removeSound=function(t,n){if(null==i.activePlugin)return!1;t instanceof Object&&t.src&&(t=t.src);
var s;if(t instanceof Object?s=i._parseSrc(t):(t=i._getSrcById(t).src,s=i._parsePath(t)),null==s)return!1;t=s.src,null!=n&&(t=n+t);for(var r in i._idHash)i._idHash[r].src==t&&delete i._idHash[r];return e.removeSrc(t),delete i._preloadHash[t],i.activePlugin.removeSound(t),!0},i.removeSounds=function(t,e){var i=[];t.path&&(e?e+=t.path:e=t.path,t=t.manifest);for(var n=0,s=t.length;s>n;n++)i[n]=createjs.Sound.removeSound(t[n].src,e);return i},i.removeAllSounds=function(){i._idHash={},i._preloadHash={},e.removeAll(),i.activePlugin&&i.activePlugin.removeAllSounds()},i.loadComplete=function(t){if(!i.isReady())return!1;var e=i._parsePath(t);return t=e?i._getSrcById(e.src).src:i._getSrcById(t).src,void 0==i._preloadHash[t]?!1:1==i._preloadHash[t][0]},i._parsePath=function(t){"string"!=typeof t&&(t=t.toString());var e=t.match(i.FILE_PATTERN);if(null==e)return!1;for(var n=e[4],s=e[5],r=i.capabilities,o=0;!r[s];)if(s=i.alternateExtensions[o++],o>i.alternateExtensions.length)return null;t=t.replace("."+e[5],"."+s);var a={name:n,src:t,extension:s};return a},i._parseSrc=function(t){var e={name:void 0,src:void 0,extension:void 0},n=i.capabilities;for(var s in t)if(t.hasOwnProperty(s)&&n[s]){e.src=t[s],e.extension=s;break}if(!e.src)return!1;var r=e.src.lastIndexOf("/");return e.name=-1!=r?e.src.slice(r+1):e.src,e},i.play=function(t,e,n,s,r,o,a,u,h){var c;c=createjs.PlayPropsConfig.create(e instanceof Object||e instanceof createjs.PlayPropsConfig?e:{interrupt:e,delay:n,offset:s,loop:r,volume:o,pan:a,startTime:u,duration:h});var l=i.createInstance(t,c.startTime,c.duration),p=i._playInstance(l,c);return p||l._playFailed(),l},i.createInstance=function(t,n,s){if(!i.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(t,n,s);var r=i._defaultPlayPropsHash[t];t=i._getSrcById(t);var o=i._parsePath(t.src),a=null;return null!=o&&null!=o.src?(e.create(o.src),null==n&&(n=t.startTime),a=i.activePlugin.create(o.src,n,s||t.duration),r=r||i._defaultPlayPropsHash[o.src],r&&a.applyPlayProps(r)):a=new createjs.DefaultSoundInstance(t,n,s),a.uniqueId=i._lastID++,a},i.stop=function(){for(var t=this._instances,e=t.length;e--;)t[e].stop()},i.setVolume=function(t){if(null==Number(t))return!1;if(t=Math.max(0,Math.min(1,t)),i._masterVolume=t,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(t))for(var e=this._instances,n=0,s=e.length;s>n;n++)e[n].setMasterVolume(t)},i.getVolume=function(){return this._masterVolume},i.setMute=function(t){if(null==t)return!1;if(this._masterMute=t,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(t))for(var e=this._instances,i=0,n=e.length;n>i;i++)e[i].setMasterMute(t);return!0},i.getMute=function(){return this._masterMute},i.setDefaultPlayProps=function(t,e){t=i._getSrcById(t),i._defaultPlayPropsHash[i._parsePath(t.src).src]=createjs.PlayPropsConfig.create(e)},i.getDefaultPlayProps=function(t){return t=i._getSrcById(t),i._defaultPlayPropsHash[i._parsePath(t.src).src]},i._playInstance=function(t,e){var n=i._defaultPlayPropsHash[t.src]||{};if(null==e.interrupt&&(e.interrupt=n.interrupt||i.defaultInterruptBehavior),null==e.delay&&(e.delay=n.delay||0),null==e.offset&&(e.offset=t.getPosition()),null==e.loop&&(e.loop=t.loop),null==e.volume&&(e.volume=t.volume),null==e.pan&&(e.pan=t.pan),0==e.delay){var s=i._beginPlaying(t,e);if(!s)return!1}else{var r=setTimeout(function(){i._beginPlaying(t,e)},e.delay);t.delayTimeoutId=r}return this._instances.push(t),!0},i._beginPlaying=function(t,i){if(!e.add(t,i.interrupt))return!1;var n=t._beginPlaying(i);if(!n){var s=createjs.indexOf(this._instances,t);return s>-1&&this._instances.splice(s,1),!1}return!0},i._getSrcById=function(t){return i._idHash[t]||{src:t}},i._playFinished=function(t){e.remove(t);var i=createjs.indexOf(this._instances,t);i>-1&&this._instances.splice(i,1)},createjs.Sound=t,e.channels={},e.create=function(t,i){var n=e.get(t);return null==n?(e.channels[t]=new e(t,i),!0):!1},e.removeSrc=function(t){var i=e.get(t);return null==i?!1:(i._removeAll(),delete e.channels[t],!0)},e.removeAll=function(){for(var t in e.channels)e.channels[t]._removeAll();e.channels={}},e.add=function(t,i){var n=e.get(t.src);return null==n?!1:n._add(t,i)},e.remove=function(t){var i=e.get(t.src);return null==i?!1:(i._remove(t),!0)},e.maxPerChannel=function(){return n.maxDefault},e.get=function(t){return e.channels[t]};var n=e.prototype;n.constructor=e,n.src=null,n.max=null,n.maxDefault=100,n.length=0,n.init=function(t,e){this.src=t,this.max=e||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},n._get=function(t){return this._instances[t]},n._add=function(t,e){return this._getSlot(e,t)?(this._instances.push(t),this.length++,!0):!1},n._remove=function(t){var e=createjs.indexOf(this._instances,t);return-1==e?!1:(this._instances.splice(e,1),this.length--,!0)},n._removeAll=function(){for(var t=this.length-1;t>=0;t--)this._instances[t].stop()},n._getSlot=function(e){var i,n;if(e!=t.INTERRUPT_NONE&&(n=this._get(0),null==n))return!0;for(var s=0,r=this.max;r>s;s++){if(i=this._get(s),null==i)return!0;if(i.playState==t.PLAY_FINISHED||i.playState==t.PLAY_INTERRUPTED||i.playState==t.PLAY_FAILED){n=i;break}e!=t.INTERRUPT_NONE&&(e==t.INTERRUPT_EARLY&&i.getPosition()<n.getPosition()||e==t.INTERRUPT_LATE&&i.getPosition()>n.getPosition())&&(n=i)}return null!=n?(n._interrupt(),this._remove(n),!0):!1},n.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){var t=function(t,e,i,n){this.EventDispatcher_constructor(),this.src=t,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this._pan=0,Object.defineProperty(this,"pan",{get:this.getPan,set:this.setPan}),this._startTime=Math.max(0,e||0),Object.defineProperty(this,"startTime",{get:this.getStartTime,set:this.setStartTime}),this._duration=Math.max(0,i||0),Object.defineProperty(this,"duration",{get:this.getDuration,set:this.setDuration}),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this.getPlaybackResource,set:this.setPlaybackResource}),n!==!1&&n!==!0&&this.setPlaybackResource(n),this._position=0,Object.defineProperty(this,"position",{get:this.getPosition,set:this.setPosition}),this._loop=0,Object.defineProperty(this,"loop",{get:this.getLoop,set:this.setLoop}),this._muted=!1,Object.defineProperty(this,"muted",{get:this.getMuted,set:this.setMuted}),this._paused=!1,Object.defineProperty(this,"paused",{get:this.getPaused,set:this.setPaused})},e=createjs.extend(t,createjs.EventDispatcher);e.play=function(t,e,i,n,s,r){var o;return o=createjs.PlayPropsConfig.create(t instanceof Object||t instanceof createjs.PlayPropsConfig?t:{interrupt:t,delay:e,offset:i,loop:n,volume:s,pan:r}),this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(o),void(this._paused&&this.setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,o),this)},e.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},e.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},e.applyPlayProps=function(t){return null!=t.offset&&this.setPosition(t.offset),null!=t.loop&&this.setLoop(t.loop),null!=t.volume&&this.setVolume(t.volume),null!=t.pan&&this.setPan(t.pan),null!=t.startTime&&(this.setStartTime(t.startTime),this.setDuration(t.duration)),this},e.toString=function(){return"[AbstractSoundInstance]"},e.getPaused=function(){return this._paused},e.setPaused=function(t){return t!==!0&&t!==!1||this._paused==t||1==t&&this.playState!=createjs.Sound.PLAY_SUCCEEDED?void 0:(this._paused=t,t?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this)},e.setVolume=function(t){return t==this._volume?this:(this._volume=Math.max(0,Math.min(1,t)),this._muted||this._updateVolume(),this)},e.getVolume=function(){return this._volume},e.setMuted=function(t){return t===!0||t===!1?(this._muted=t,this._updateVolume(),this):void 0},e.getMuted=function(){return this._muted},e.setPan=function(t){return t==this._pan?this:(this._pan=Math.max(-1,Math.min(1,t)),this._updatePan(),this)},e.getPan=function(){return this._pan},e.getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},e.setPosition=function(t){return this._position=Math.max(0,t),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},e.getStartTime=function(){return this._startTime},e.setStartTime=function(t){return t==this._startTime?this:(this._startTime=Math.max(0,t||0),this._updateStartTime(),this)},e.getDuration=function(){return this._duration},e.setDuration=function(t){return t==this._duration?this:(this._duration=Math.max(0,t||0),this._updateDuration(),this)},e.setPlaybackResource=function(t){return this._playbackResource=t,0==this._duration&&this._setDurationFromSource(),this},e.getPlaybackResource=function(){return this._playbackResource},e.getLoop=function(){return this._loop},e.setLoop=function(t){null!=this._playbackResource&&(0!=this._loop&&0==t?this._removeLooping(t):0==this._loop&&0!=t&&this._addLooping(t)),this._loop=t},e._sendEvent=function(t){var e=new createjs.Event(t);this.dispatchEvent(e)},e._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},e._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},e._beginPlaying=function(t){return this.setPosition(t.offset),this.setLoop(t.loop),this.setVolume(t.volume),this.setPan(t.pan),null!=t.startTime&&(this.setStartTime(t.startTime),this.setDuration(t.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},e._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},e._handleSoundComplete=function(){return this._position=0,0!=this._loop?(this._loop--,this._handleLoop(),void this._sendEvent("loop")):(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,void this._sendEvent("complete"))},e._handleSoundReady=function(){},e._updateVolume=function(){},e._updatePan=function(){},e._updateStartTime=function(){},e._updateDuration=function(){},e._setDurationFromSource=function(){},e._calculateCurrentPosition=function(){},e._updatePosition=function(){},e._removeLooping=function(){},e._addLooping=function(){},e._pause=function(){},e._resume=function(){},e._handleStop=function(){},e._handleCleanUp=function(){},e._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(t,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){var t=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},e=t.prototype;t._capabilities=null,t.isSupported=function(){return!0},e.register=function(t){var e=this._loaders[t.src];return e&&!e.canceled?this._loaders[t.src]:(this._audioSources[t.src]=!0,this._soundInstances[t.src]=[],e=new this._loaderClass(t),e.on("complete",createjs.proxy(this._handlePreloadComplete,this)),this._loaders[t.src]=e,e)},e.preload=function(t){t.on("error",createjs.proxy(this._handlePreloadError,this)),t.load()},e.isPreloadStarted=function(t){return null!=this._audioSources[t]},e.isPreloadComplete=function(t){return!(null==this._audioSources[t]||1==this._audioSources[t])},e.removeSound=function(t){if(this._soundInstances[t]){for(var e=this._soundInstances[t].length;e--;){var i=this._soundInstances[t][e];i.destroy()}delete this._soundInstances[t],delete this._audioSources[t],this._loaders[t]&&this._loaders[t].destroy(),delete this._loaders[t]}},e.removeAllSounds=function(){for(var t in this._audioSources)this.removeSound(t)},e.create=function(t,e,i){this.isPreloadStarted(t)||this.preload(this.register(t));var n=new this._soundInstanceClass(t,e,i,this._audioSources[t]);return this._soundInstances[t].push(n),n},e.setVolume=function(t){return this._volume=t,this._updateVolume(),!0},e.getVolume=function(){return this._volume},e.setMute=function(){return this._updateVolume(),!0},e.toString=function(){return"[AbstractPlugin]"},e._handlePreloadComplete=function(t){var e=t.target.getItem().src;this._audioSources[e]=t.result;for(var i=0,n=this._soundInstances[e].length;n>i;i++){var s=this._soundInstances[e][i];s.setPlaybackResource(this._audioSources[e])}},e._handlePreloadError=function(){},e._updateVolume=function(){},createjs.AbstractPlugin=t}(),this.createjs=this.createjs||{},function(){function t(t){this.AbstractLoader_constructor(t,!0,createjs.AbstractLoader.SOUND)}var e=createjs.extend(t,createjs.AbstractLoader);t.context=null,e.toString=function(){return"[WebAudioLoader]"},e._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},e._sendComplete=function(){t.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},e._handleAudioDecoded=function(t){this._result=t,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(t,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){function t(t,e,n,s){this.AbstractSoundInstance_constructor(t,e,n,s),this.gainNode=i.context.createGain(),this.panNode=i.context.createPanner(),this.panNode.panningModel=i._panningModel,this.panNode.connect(this.gainNode),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var e=createjs.extend(t,createjs.AbstractSoundInstance),i=t;i.context=null,i.destinationNode=null,i._panningModel="equalpower",e.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},e.toString=function(){return"[WebAudioSoundInstance]"},e._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},e._removeLooping=function(){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},e._addLooping=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},e._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},e._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},e._cleanUpAudioNode=function(t){return t&&(t.stop(0),t.disconnect(0),t=null),t},e._handleSoundReady=function(){this.gainNode.connect(i.destinationNode);var t=.001*this._duration,e=.001*this._position;e>t&&(e=t),this.sourceNode=this._createAndPlayAudioNode(i.context.currentTime-t,e),this._playbackStartTime=this.sourceNode.startTime-e,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(t-e)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},e._createAndPlayAudioNode=function(t,e){var n=i.context.createBufferSource();n.buffer=this.playbackResource,n.connect(this.panNode);var s=.001*this._duration;return n.startTime=t+s,n.start(n.startTime,e+.001*this._startTime,s-e),n},e._pause=function(){this._position=1e3*(i.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},e._resume=function(){this._handleSoundReady()},e._updateVolume=function(){var t=this._muted?0:this._volume;t!=this.gainNode.gain.value&&(this.gainNode.gain.value=t)},e._calculateCurrentPosition=function(){return 1e3*(i.context.currentTime-this._playbackStartTime)},e._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},e._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},e._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(t,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){function t(){this.AbstractPlugin_constructor(),this._panningModel=i._panningModel,this.context=i.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=i._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var e=createjs.extend(t,createjs.AbstractPlugin),i=t;i._capabilities=null,i._panningModel="equalpower",i.context=null,i.isSupported=function(){var t=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return"file:"!=location.protocol||t||this._isFileXHRSupported()?(i._generateCapabilities(),null==i.context?!1:!0):!1},i.playEmptySound=function(){if(null!=i.context){var t=i.context.createBufferSource();t.buffer=i.context.createBuffer(1,1,22050),t.connect(i.context.destination),t.start(0,0,0)}},i._isFileXHRSupported=function(){var t=!0,e=new XMLHttpRequest;try{e.open("GET","WebAudioPluginTest.fail",!1)}catch(i){return t=!1}e.onerror=function(){t=!1},e.onload=function(){t=404==this.status||200==this.status||0==this.status&&""!=this.response};try{e.send()}catch(i){t=!1}return t},i._generateCapabilities=function(){if(null==i._capabilities){var t=document.createElement("audio");if(null==t.canPlayType)return null;if(null==i.context)if(window.AudioContext)i.context=new AudioContext;else{if(!window.webkitAudioContext)return null;i.context=new webkitAudioContext}i._compatibilitySetUp(),i.playEmptySound(),i._capabilities={panning:!0,volume:!0,tracks:-1};for(var e=createjs.Sound.SUPPORTED_EXTENSIONS,n=createjs.Sound.EXTENSION_MAP,s=0,r=e.length;r>s;s++){var o=e[s],a=n[o]||o;i._capabilities[o]="no"!=t.canPlayType("audio/"+o)&&""!=t.canPlayType("audio/"+o)||"no"!=t.canPlayType("audio/"+a)&&""!=t.canPlayType("audio/"+a)}i.context.destination.numberOfChannels<2&&(i._capabilities.panning=!1)}},i._compatibilitySetUp=function(){if(i._panningModel="equalpower",!i.context.createGain){i.context.createGain=i.context.createGainNode;var t=i.context.createBufferSource();t.__proto__.start=t.__proto__.noteGrainOn,t.__proto__.stop=t.__proto__.noteOff,i._panningModel=0}},e.toString=function(){return"[WebAudioPlugin]"},e._addPropsToClasses=function(){var t=this._soundInstanceClass;t.context=this.context,t.destinationNode=this.gainNode,t._panningModel=this._panningModel,this._loaderClass.context=this.context},e._updateVolume=function(){var t=createjs.Sound._masterMute?0:this._volume;t!=this.gainNode.gain.value&&(this.gainNode.gain.value=t)},createjs.WebAudioPlugin=createjs.promote(t,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){function t(){throw"HTMLAudioTagPool cannot be instantiated"}function e(){this._tags=[]}var i=t;i._tags={},i._tagPool=new e,i._tagUsed={},i.get=function(t){var e=i._tags[t];return null==e?(e=i._tags[t]=i._tagPool.get(),e.src=t):i._tagUsed[t]?(e=i._tagPool.get(),e.src=t):i._tagUsed[t]=!0,e},i.set=function(t,e){e==i._tags[t]?i._tagUsed[t]=!1:i._tagPool.set(e)},i.remove=function(t){var e=i._tags[t];return null==e?!1:(i._tagPool.set(e),delete i._tags[t],delete i._tagUsed[t],!0)},i.getDuration=function(t){var e=i._tags[t];return null==e?0:1e3*e.duration},createjs.HTMLAudioTagPool=t;var n=e.prototype;n.constructor=e,n.get=function(){var t;return t=0==this._tags.length?this._createTag():this._tags.pop(),null==t.parentNode&&document.body.appendChild(t),t},n.set=function(t){var e=createjs.indexOf(this._tags,t);-1==e&&(this._tags.src=null,this._tags.push(t))},n.toString=function(){return"[TagPool]"},n._createTag=function(){var t=document.createElement("audio");return t.autoplay=!1,t.preload="none",t}}(),this.createjs=this.createjs||{},function(){function t(t,e,i,n){this.AbstractSoundInstance_constructor(t,e,i,n),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),i?this._audioSpriteStopTime=.001*(e+i):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var e=createjs.extend(t,createjs.AbstractSoundInstance);e.setMasterVolume=function(){this._updateVolume()},e.setMasterMute=function(){this._updateVolume()},e.toString=function(){return"[HTMLAudioSoundInstance]"},e._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},e._handleCleanUp=function(){var t=this._playbackResource;if(null!=t){t.pause(),t.loop=!1,t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{t.currentTime=this._startTime}catch(e){}createjs.HTMLAudioTagPool.set(this.src,t),this._playbackResource=null}},e._beginPlaying=function(t){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(t)},e._handleSoundReady=function(){if(4!==this._playbackResource.readyState){var t=this._playbackResource;return t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),t.preload="auto",void t.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},e._handleTagReady=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},e._pause=function(){this._playbackResource.pause()},e._resume=function(){this._playbackResource.play()},e._updateVolume=function(){if(null!=this._playbackResource){var t=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;t!=this._playbackResource.volume&&(this._playbackResource.volume=t)}},e._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},e._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(t){this._handleSetPositionSeek(null)}},e._handleSetPositionSeek=function(){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._handleAudioSpriteLoop=function(){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},e._handleLoop=function(){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},e._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},createjs.HTMLAudioSoundInstance=createjs.promote(t,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){function t(){this.AbstractPlugin_constructor(),this.defaultNumChannels=2,this._capabilities=i._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var e=createjs.extend(t,createjs.AbstractPlugin),i=t;i.MAX_INSTANCES=30,i._AUDIO_READY="canplaythrough",i._AUDIO_ENDED="ended",i._AUDIO_SEEKED="seeked",i._AUDIO_STALLED="stalled",i._TIME_UPDATE="timeupdate",i._capabilities=null,i.isSupported=function(){return i._generateCapabilities(),null!=i._capabilities},i._generateCapabilities=function(){if(null==i._capabilities){var t=document.createElement("audio");if(null==t.canPlayType)return null;i._capabilities={panning:!1,volume:!0,tracks:-1};for(var e=createjs.Sound.SUPPORTED_EXTENSIONS,n=createjs.Sound.EXTENSION_MAP,s=0,r=e.length;r>s;s++){var o=e[s],a=n[o]||o;i._capabilities[o]="no"!=t.canPlayType("audio/"+o)&&""!=t.canPlayType("audio/"+o)||"no"!=t.canPlayType("audio/"+a)&&""!=t.canPlayType("audio/"+a)}}},e.register=function(t){var e=createjs.HTMLAudioTagPool.get(t.src),i=this.AbstractPlugin_register(t);return i.setTag(e),i},e.removeSound=function(t){this.AbstractPlugin_removeSound(t),createjs.HTMLAudioTagPool.remove(t)},e.create=function(t,e,i){var n=this.AbstractPlugin_create(t,e,i);return n.setPlaybackResource(null),n},e.toString=function(){return"[HTMLAudioPlugin]"},e.setVolume=e.getVolume=e.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(t,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){function t(t){this.AbstractLoader_constructor(t,!0,createjs.AbstractLoader.SOUND),this._media=null,this._loadTime=0,this._TIMER_FREQUENCY=100}var e=createjs.extend(t,createjs.AbstractLoader);e.load=function(){this._media=new Media(this._item.src,null,createjs.proxy(this._mediaErrorHandler,this)),this._media.seekTo(0),this._getMediaDuration()},e.toString=function(){return"[CordovaAudioLoader]"},e._mediaErrorHandler=function(){this._media.release(),this._sendError()},e._getMediaDuration=function(){this._result=1e3*this._media.getDuration(),this._result<0?(this._loadTime+=this._TIMER_FREQUENCY,this._loadTime>this._item.loadTimeout?this.handleEvent({type:"timeout"}):setTimeout(createjs.proxy(this._getMediaDuration,this),this._TIMER_FREQUENCY)):(this._media.release(),this._sendComplete())},createjs.CordovaAudioLoader=createjs.promote(t,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){function t(t,e,i,n){this.AbstractSoundInstance_constructor(t,e,i,n),this.playWhenScreenLocked=null,this._playStartTime=null,this._audioSpriteTimeout=null,this._audioSprite=!1,this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteComplete,this),this._mediaPlayFinishedHandler=createjs.proxy(this._handleSoundComplete,this),this._mediaErrorHandler=createjs.proxy(this._handleMediaError,this),this._mediaProgressHandler=createjs.proxy(this._handleMediaProgress,this),this._playbackResource=new Media(t,this._mediaPlayFinishedHandler,this._mediaErrorHandler,this._mediaProgressHandler),i?this._audioSprite=!0:this._setDurationFromSource()}var e=createjs.extend(t,createjs.AbstractSoundInstance);e.setMasterVolume=function(){this._updateVolume()},e.setMasterMute=function(){this._updateVolume()},e.destroy=function(){this.AbstractSoundInstance_destroy(),this._playbackResource.release()},e.getCurrentPosition=function(t,e){this._playbackResource.getCurrentPosition(t,e)},e.toString=function(){return"[CordovaAudioSoundInstance]"},e._handleMediaError=function(){clearTimeout(this.delayTimeoutId),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},e._handleMediaProgress=function(){},e._handleAudioSpriteComplete=function(){this._playbackResource.pause(),this._handleSoundComplete()},e._handleCleanUp=function(){clearTimeout(this._audioSpriteTimeout),this._playbackResource.pause()},e._handleSoundReady=function(){this._playbackResource.seekTo(this._startTime+this._position),this._audioSprite&&(this._audioSpriteTimeout=setTimeout(this._audioSpriteEndHandler,this._duration-this._position)),this._playbackResource.play({playAudioWhenScreenIsLocked:this.playWhenScreenLocked}),this._playStartTime=Date.now()},e._pause=function(){clearTimeout(this._audioSpriteTimeout),this._playbackResource.pause(),this._playStartTime&&(this._position=Date.now()-this._playStartTime,this._playStartTime=null),this._playbackResource.getCurrentPosition(createjs.proxy(this._updatePausePos,this))},e._updatePausePos=function(t){this._position=1e3*t-this._startTime,this._playStartTime&&(this._playStartTime=Date.now())},e._resume=function(){this._audioSprite&&(this._audioSpriteTimeout=setTimeout(this._audioSpriteEndHandler,this._duration-this._position)),this._playbackResource.play({playAudioWhenScreenIsLocked:this.playWhenScreenLocked}),this._playStartTime=Date.now()},e._handleStop=function(){clearTimeout(this._audioSpriteTimeout),this._playbackResource.pause(),this._playbackResource.seekTo(this._startTime),this._playStartTime&&(this._position=0,this._playStartTime=null)},e._updateVolume=function(){var t=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;this._playbackResource.setVolume(t)},e._calculateCurrentPosition=function(){return this._playStartTime&&(this._position=Date.now()-this._playStartTime+this._position,this._playStartTime=Date.now()),this._position},e._updatePosition=function(){this._playbackResource.seekTo(this._startTime+this._position),this._playStartTime=Date.now(),this._audioSprite&&(clearTimeout(this._audioSpriteTimeout),this._audioSpriteTimeout=setTimeout(this._audioSpriteEndHandler,this._duration-this._position))
},e._handleLoop=function(){this._handleSoundReady()},e._updateStartTime=function(){this._audioSprite=!0,this.playState==createjs.Sound.PLAY_SUCCEEDED},e._updateDuration=function(){this._audioSprite,this.playState==createjs.Sound.PLAY_SUCCEEDED&&(clearTimeout(this._audioSpriteTimeout),this._audioSpriteTimeout=setTimeout(this._audioSpriteEndHandler,this._duration-this.position))},e._setDurationFromSource=function(){this._duration=createjs.Sound.activePlugin.getSrcDuration(this.src)},createjs.CordovaAudioSoundInstance=createjs.promote(t,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){function t(){this.AbstractPlugin_constructor(),this._capabilities=i._capabilities,this._loaderClass=createjs.CordovaAudioLoader,this._soundInstanceClass=createjs.CordovaAudioSoundInstance,this._srcDurationHash={}}var e=createjs.extend(t,createjs.AbstractPlugin),i=t;i.playWhenScreenLocked=!1,i._capabilities=null,i.isSupported=function(){return i._generateCapabilities(),null!=i._capabilities},i._generateCapabilities=function(){if(null==i._capabilities&&(window.cordova||window.PhoneGap||window.phonegap)&&window.Media){var t=document.createElement("audio");if(null==t.canPlayType)return null;i._capabilities={panning:!1,volume:!0,tracks:-1};for(var e=createjs.Sound.SUPPORTED_EXTENSIONS,n=createjs.Sound.EXTENSION_MAP,s=0,r=e.length;r>s;s++){var o=e[s],a=n[o]||o;i._capabilities[o]="no"!=t.canPlayType("audio/"+o)&&""!=t.canPlayType("audio/"+o)||"no"!=t.canPlayType("audio/"+a)&&""!=t.canPlayType("audio/"+a)}}},e.create=function(t,e,i){var n=this.AbstractPlugin_create(t,e,i);return n.playWhenScreenLocked=this.playWhenScreenLocked,n},e.toString=function(){return"[CordovaAudioPlugin]"},e.setVolume=e.getVolume=e.setMute=null,e.getSrcDuration=function(t){return this._srcDurationHash[t]},e._handlePreloadComplete=function(t){var e=t.target.getItem().src;this._srcDurationHash[e]=t.result,this._audioSources[e]=t.result},e.removeSound=function(t){delete this._srcDurationHash[t],this.AbstractPlugin_removeSound(t)},createjs.CordovaAudioPlugin=createjs.promote(t,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){var t=createjs.CordovaAudioPlugin=createjs.CordovaAudioPlugin||{};t.version="NEXT",t.buildDate="Tue, 19 May 2015 17:26:59 GMT"}(),i("soundjs",function(t){return function(){var e;return e||t.createjs.Sound}}(this)),i("helpers/SoundController",["require","exports","module","soundjs"],function(t,e,i){function n(e){this.isApp=e,e||(this.Sound=t("soundjs")),this.mediasPlaying=[]}n.prototype.mediaError=function(t){alert("Media Error"),alert(JSON.stringify(t))},n.prototype.createSounds=function(t){var e=this;e.manifest=t;var i="./content/sounds/";if(t)if(e.isApp)t.forEach(function(t){var n=new Media(i+t.src,null,e.mediaError);n.setVolume(parseFloat(t.volume)),n.play({numberOfLoops:parseInt(t.loop)}),e.mediasPlaying.push(n)});else{e.Sound.alternateExtensions=["mp3"];var n=function(t){var n=e.manifest.filter(function(e){return t.src===i+e.src})[0];e.Sound.play(i+n.src,{loop:n.loop,volume:n.volume})};e.Sound.addEventListener("fileload",n),e.Sound.registerSounds(t,i)}},n.prototype.clearSounds=function(){this.isApp?(this.mediasPlaying.forEach(function(t){t.stop(),t.release()}),this.mediasPlaying=[]):this.Sound.removeAllSounds(),this.manifest=null},i.exports=n}),i("helpers/ParameterTransformer",["require","exports","module"],function(t,e,i){function n(t,e,i){this.model=e,this.timeKeeper=i,this.setParsedConfig(t)}n.prototype.constructor=n,n.prototype.setParsedConfig=function(t){this.parsedConfig=t,this.setInitialValues()},n.prototype.setInitialValues=function(){this.initialPosition=[this.parsedConfig.x,this.parsedConfig.y,this.parsedConfig.height],this.initialOrigin=[this.parsedConfig.xOrigin,this.parsedConfig.yOrigin,0],this.initialScale=[this.parsedConfig.scale*this.parsedConfig.xyRatio,this.parsedConfig.scale,1],this.initialSize=[this.parsedConfig.sizeX,this.parsedConfig.sizeY],this.initialRotate=[this.parsedConfig.xRotate,this.parsedConfig.yRotate,this.parsedConfig.zRotate],this.initialOpacity=this.parsedConfig.opacity},n.prototype.calculateTransform=function(){var t,e=this.timeKeeper.timePassed,i=0,n=0,s=0,r=0,o=0,a=1,u=1,h=1,c=0;if(this.parsedConfig.translate&&(i+=this.parsedConfig.translateFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.translateXSpeed,this.parsedConfig.translateX),n+=this.parsedConfig.translateFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.translateYSpeed,this.parsedConfig.translateY)),this.parsedConfig.accel&&(t=window.orientationController.orientationDifferenceAt(e),i+=t[1]*this.parsedConfig.accelAmount,n+=t[0]*this.parsedConfig.accelAmount),this.parsedConfig.accelRotate&&(t=window.orientationController.orientationDifferenceAt(e),s+=t[0]*this.parsedConfig.accelRotateAmount,r+=t[1]*this.parsedConfig.accelRotateAmount),this.parsedConfig.rotate&&(o=this.parsedConfig.rotateFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.rotateSpeed,1/this.parsedConfig.rotateAngle)),this.parsedConfig.skew&&(a=1+this.parsedConfig.skewFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.skewSpeedX,this.parsedConfig.skewAmountX),u=1+this.parsedConfig.skewFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.skewSpeedY,this.parsedConfig.skewAmountY)),this.parsedConfig.zoom&&(h=this.parsedConfig.zoomRelativeTranslate?1+this.parsedConfig.zoomFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.zoomSpeed,this.parsedConfig.zoomRelativeMultiplier/this.parsedConfig.translateY):1+this.parsedConfig.zoomFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.zoomSpeed,this.parsedConfig.zoomAmount)),this.parsedConfig.animation){var l=Math.floor(this.parsedConfig.animationFunction((e+this.parsedConfig.timeOffset)/this.parsedConfig.animationSpeed,this.parsedConfig.numFrames));n-=l*this.model.page.y*this.parsedConfig.scale}var p={rotate:[this.initialRotate[0]+s,this.initialRotate[1]+r,this.initialRotate[2]+o],scale:[this.initialScale[0]*h*a,this.initialScale[1]*h*u,this.initialScale[2]],position:[this.initialPosition[0]+i,this.initialPosition[1]+n,this.initialPosition[2]+c]};return p},n.prototype.createComponent=function(t){this.node=t;var e=this,i={onUpdate:function(){var i=e.calculateTransform();t.setRotation(i.rotate[0],i.rotate[1],i.rotate[2]),t.setScale(i.scale[0],i.scale[1],i.scale[2]),t.setPosition(i.position[0],i.position[1],i.position[2]),t.requestUpdate(this.id)}},n=t.addComponent(i);return i.id=n,n},i.exports=n}),i("helpers/MathFunctions",["require","exports","module"],function(t,e,i){function n(){}n.prototype.constructor=n,n.prototype.sinFunction=function(t,e){return Math.sin(t)*e},n.prototype.sinFunction.period=2*Math.PI,n.prototype.halfOneSinFunction=function(t,e){return(Math.sin(t)+1)/2*e},n.prototype.halfOneSinFunction.period=2*Math.PI,n.prototype.cosFunction=function(t,e){return(1-Math.cos(2*Math.PI*t))/2*e},n.prototype.cosFunction.period=1,n.prototype.absSinFunction=function(t,e){return-Math.abs(Math.sin(t))*e},n.prototype.absSinFunction.period=Math.PI,n.prototype.triangleFunction=function(t,e){return 2/Math.PI*Math.asin(Math.sin(t))*e},n.prototype.triangleFunction.period=2*Math.PI,n.prototype.sawToothFunction=function(t,e){return e*(t-Math.floor(t))},n.prototype.sawToothFunction.period=1,n.prototype.periodChangedFunction=function(t,e){var i=function(i,n){return t(e*i,n)};return i.period=t.period/e,i},n.prototype.cutFunction=function(t,e,i,n){var s=100/(i-e),r=this.periodChangedFunction(t,s),o=function(s,o){var a=n*e/100,u=n*i/100,h=s%n;return a>h?t(.001,o):h>u?t(.9999*n,o):r(h-a,o)};return o.period=t.period/s,o},i.exports=n}),i("helpers/ConfigParser",["require","exports","module","helpers/MathFunctions"],function(t,e,i){function n(){}var s=t("helpers/MathFunctions");n.prototype.constructor=n,n.prototype.parseConfig=function(t,e){var i={};return i.name=t.name,i.url=t.url,i.text=(t.text||"").replace(/"/g,"&quot;"),i.pageSpeed=parseFloat(e.page.speed)||1,i.numFrames=parseFloat(t.numFrames),i.opacity=parseFloat(t.opacity)||1,i.sizeX=parseFloat(t.sizeX),i.sizeY=parseFloat(t.sizeY),i.x=parseFloat(t.initialX),i.y=parseFloat(t.initialY),i.xRotate=parseFloat(t.initialRotateX)||0,i.yRotate=parseFloat(t.initialRotateY)||0,i.zRotate=parseFloat(t.initialRotateZ)||0,i.xOrigin=parseFloat(t.xOrigin)||0,i.yOrigin=parseFloat(t.yOrigin)||0,i.scale=parseFloat(t.scale),i.xyRatio=parseFloat(t.xyRatio),i.timeOffset=parseFloat(t.timeOffset),i.translateXSpeed=i.pageSpeed*parseFloat(t.translateXSpeed),i.translateYSpeed=i.pageSpeed*parseFloat(t.translateYSpeed),i.translateX=parseFloat(t.translateX),i.translateY=parseFloat(t.translateY),i.rotateSpeed=i.pageSpeed*parseFloat(t.rotateSpeed),i.rotateAngle=parseFloat(t.rotateAngle),i.skewSpeedX=i.pageSpeed*parseFloat(t.skewSpeedX),i.skewAmountX=parseFloat(t.skewAmountX),i.skewSpeedY=i.pageSpeed*parseFloat(t.skewSpeedY),i.skewAmountY=parseFloat(t.skewAmountY),i.zoomSpeed=i.pageSpeed*parseFloat(t.zoomSpeed),i.zoomAmount=parseFloat(t.zoomAmount),i.zoomCutStart=parseFloat(t.zoomCutStart),i.zoomCutEnd=parseFloat(t.zoomCutEnd),i.translateCutStart=parseFloat(t.translateCutStart),i.translateCutEnd=parseFloat(t.translateCutEnd),i.height=parseFloat(t.height),i.cameraBoundOffset=parseFloat(t.cameraBoundOffset),i.zoomRelativeMultiplier=parseFloat(t.zoomRelativeMultiplier),i.animationSpeed=i.pageSpeed*parseFloat(t.animationSpeed)||100,i.numFrames=parseFloat(t.numFrames),i.motionType=t.motionType,i.zoomType=t.zoomType,i.rotateType=t.rotateType,i.zoomTypeCut=t.zoomTypeCut,i.translateTypeCut=t.translateTypeCut,i.translateFunction=void 0,i.zoomFunction=void 0,i.rotateFunction=void 0,i.skewFunction=void 0,i.animationFunction=s.prototype.sawToothFunction,i.translate=t.translate,i.accel=t.accel,i.accelAmount=parseFloat(t.accelAmount)||1,i.accelRotate=t.accelRotate,i.accelRotateAmount=parseFloat(t.accelRotateAmount)||1,i.rotate=t.rotate,i.skew=t.skew,i.zoom=t.zoom,i.zoomRelativeTranslate=t.zoomRelativeTranslate,i.animation=t.animation,i.cameraBound=t.cameraBound,i.translateFunction="triangle"===i.motionType?s.prototype.triangleFunction:"sawtooth"===i.motionType?s.prototype.sawToothFunction:"cos"===i.motionType?s.prototype.cosFunction:s.prototype.sinFunction,i.zoomFunction="triangle"===i.zoomType?s.prototype.triangleFunction:"sin"===i.zoomType?s.prototype.sinFunction:"cos"===i.zoomType?s.prototype.cosFunction:s.prototype.sawToothFunction,i.rotateFunction="triangle"===i.rotateType?s.prototype.triangleFunction:"sawToothFunction"===i.rotateType?s.prototype.sawToothFunction:"cos"===i.rotateType?s.prototype.cosFunction:s.prototype.sinFunction,i.skewFunction=s.prototype.cosFunction,i.zoomTypeCut&&(i.zoomFunction=s.prototype.cutFunction(i.zoomFunction,i.zoomCutStart,i.zoomCutEnd,i.zoomFunction.period)),i.translateTypeCut&&(i.translateFunction=s.prototype.cutFunction(i.translateFunction,i.translateCutStart,i.translateCutEnd,i.translateFunction.period)),i},i.exports=n}),i("elements/Element",["require","exports","module","famous"],function(t,e,i){function n(t,e,i){var n=(i.surfaceClasses||"").trim();n=(n+" "+(e.myClasses||"")).trim(),n&&""!==n&&(e.classes=n.split(" ")),r.apply(this,[t,e])}var s=t("famous"),r=s.domRenderables.DOMElement;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},n.prototype.contentInserted=function(){},i.exports=n}),i("elements/RepeatingImage",["require","exports","module","elements/Element"],function(t,e,i){function n(t,e){var i={attributes:{},properties:{}};i.tagName="div",i.myClasses="repeating-image",i.properties={"background-image":"url('"+e.url+"')"},s.apply(this,[t,i,e])}var s=t("elements/Element");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},i.exports=n}),i("elements/HighlightingText",["require","exports","module","elements/Element","helpers/MathFunctions"],function(t,e,i){function n(t,e,i){var n=this;this.config=e,this.model=i,this.node=t;var r={attributes:{},properties:{}};this.textLines=e.text.split("\n"),this.currentLine=0,r.tagName="div",r.myClasses="overlay-text",r.content=this.createContent(-1),s.apply(this,[t,r,e]),this.updaterComponent={onUpdate:function(){n.needsUpdating&&n.updateContent(),n.updateHighlightText(),t.requestUpdate(this.id)}},this.updaterComponentID=t.addComponent(this.updaterComponent),this.updaterComponent.id=this.updaterComponentID,t.requestUpdate(this.updaterComponentID)}var s=t("elements/Element"),r=t("helpers/MathFunctions");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.updateHighlightText=function(){var t=parseFloat(Date.now()),e=parseFloat(this.config.timeOffset),i=parseFloat(this.model.page.speed)||1,n=(parseFloat(this.config.singSpeed)||1)*i,s=Math.floor(r.prototype.sawToothFunction((t+e)/n,this.textLines.length));s!==this.currentLine&&(this.currentLine=s,this.needsUpdating=!0)},n.prototype.updateContent=function(){var t=this.createContent(this.currentLine);this.setContent(t),this.needsUpdating=!1},n.prototype.setupGradientCSS=function(){var t=this.node.getAbsoluteSize()[0],e=t+80,i=e+80,n=i+80,s=2*t+240,r=t/270,o="-webkit-transform: translateZ(0);background-size: "+s+"px 3px;background-image: -webkit-linear-gradient(left, white 0px,white "+t+"px,rgb(53, 205, 247) "+e+"px,rgb(53, 205, 247) "+i+"px,white "+n+"px);-webkit-animation: stripes "+r+"s linear infinite;";return o},n.prototype.contentInserted=function(){self.needsUpdating=!0,this.updateContent()},n.prototype.createContent=function(t){var e=this,i=this.textLines.map(function(i,n){var s;return s=n===t?'<div class="highlight-text gradient-shadow" title="'+i+'"><div class="highlight-text-div" style="'+e.setupGradientCSS()+'">'+i+"</div></div>":'<div class="highlight-text gradient-shadow" title="'+i+'"><div class="highlight-text-div hightlight-inactive">'+i+"</div></div>"});return i.join("")},n.DEFAULT_OPTIONS={},i.exports=n}),i("elements/Image",["require","exports","module","elements/Element"],function(t,e,i){function n(t,e){var i={attributes:{},properties:{}};i.tagName="img",i.attributes={src:e.url},s.apply(this,[t,i,e])}var s=t("elements/Element");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},i.exports=n}),i("elements/PlainText",["require","exports","module","elements/Element"],function(t,e,i){function n(t,e){var i={attributes:{},properties:{}},n=(e.text||"").split("\n"),r=n.map(function(t){var e='<div class="highlight-text gradient-shadow" title="'+t+'"><div class="highlight-text-div hightlight-inactive">'+t+"</div></div>";return e});i.tagName="div",i.myClasses="overlay-text",i.content=r.join(""),s.apply(this,[t,i,e])}var s=t("elements/Element");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},i.exports=n}),i("elements/ChangingPlainText",["require","exports","module","elements/Element","helpers/MathFunctions"],function(t,e,i){function n(t,e,i){var n=this,o={attributes:{},properties:{}};this.textLines=(e.text||"").split("\n"),this.linesHtml=this.textLines.map(function(t){var e='<div class="highlight-text gradient-shadow" title="'+t+'"><div class="highlight-text-div hightlight-inactive">'+t+"</div></div>";return e}),o.tagName="div",o.myClasses="overlay-text",this.currentLine=0,o.content=this.linesHtml[0],s.apply(this,[t,o,e]),this.updaterComponent={onUpdate:function(){var s=parseFloat(Date.now()),o=parseFloat(e.timeOffset),a=parseFloat(i.page.speed)||1,u=(parseFloat(e.singSpeed)||1)*a,h=Math.floor(r.prototype.sawToothFunction((s+o)/u,n.textLines.length));h!==n.currentLine&&(n.currentLine=h,n.setContent(n.linesHtml[n.currentLine])),t.requestUpdate(this.id)}},this.updaterComponentID=t.addComponent(this.updaterComponent),this.updaterComponent.id=this.updaterComponentID,t.requestUpdate(this.updaterComponentID)}var s=t("elements/Element"),r=t("helpers/MathFunctions");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},i.exports=n}),i("elements/SingalongText",["require","exports","module","elements/Element","helpers/MathFunctions"],function(t,e,i){function n(t,e,i){var n=this;this.config=e,this.model=i;var r={attributes:{},properties:{}};this.textLines=e.text.split("\n"),this.currentLine=0,r.tagName="div",r.myClasses="overlay-text",r.content='<span class="highlight-text gradient-shadow singalong" title="'+this.textLines[this.currentLine]+'"><div class="highlight-text-div">'+this.textLines[this.currentLine]+"</div></span>",s.apply(this,[t,r,e]),this.updaterComponent={onUpdate:function(){n.needsUpdating&&n.updateContent(),n.updateHighlightText(),t.requestUpdate(this.id)}},this.updaterComponentID=t.addComponent(this.updaterComponent),this.updaterComponent.id=this.updaterComponentID,t.requestUpdate(this.updaterComponentID)}var s=t("elements/Element"),r=t("helpers/MathFunctions");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={},n.prototype.updateSingalongText=function(){var t=parseFloat(Date.now()),e=parseFloat(this.config.timeOffset),i=parseFloat(this.model.page.speed)||1,n=(parseFloat(this.config.singSpeed)||1)*i,s=Math.floor(r.prototype.sawToothFunction((t+e)/n,this.textLines.length));s!==this.currentLine&&(this.currentLine=s,this.surface.setContent('<div class="overlay-text"><span class="highlight-text gradient-shadow singalong" title="'+this.textLines[this.currentLine]+'"><div class="highlight-text-div">'+this.textLines[this.currentLine]+"</div></span></div>"),this.needsUpdating=!0)},n.prototype.updateContent=function(){this.surface._currentTarget&&(this.refreshGradient(),this.needsUpdating=!1)},n.prototype.refreshGradient=function(){var t=this.setupGradientCSS(0),e=self.surface._currentTarget.getElementsByClassName("highlight-text-div")[0];e.setAttribute("style",t)},n.prototype.setupGradientCSS=function(t){var e=self.surface._currentTarget.getElementsByClassName("highlight-text-div")[t],i=e.getBoundingClientRect().width,n=i+80,s=n+80,r=s+80,o=2*i+240,a=i/270,u="-webkit-transform: translateZ(0);background-size: "+o+"px 3px;background-image: -webkit-linear-gradient(left, white 0px,white "+i+"px,rgb(53, 205, 247) "+n+"px,rgb(53, 205, 247) "+s+"px,white "+r+"px);-webkit-animation: stripes "+a+"s linear infinite;";return u},n.prototype.contentInserted=function(){self.needsUpdating=!0,this.updateContent()},i.exports=n}),i("nodes/PopupNode",["require","exports","module","famous","helpers/ParameterTransformer","helpers/ConfigParser","elements/RepeatingImage","elements/HighlightingText","elements/Image","elements/PlainText","elements/ChangingPlainText","elements/SingalongText"],function(t,e,i){function n(){var t=this;this.parsedConfig=u.prototype.parseConfig(this.config,this.model),this.transformer=new a(this.parsedConfig,this.model,this.timeKeeper),this.setupInitialState(),t.transformComponentID=this.transformer.createComponent(t),t.requestUpdate(t.transformComponentID);var e;switch(t.config.surfaceType){case"highlight":e=c;break;case"plain":e=p;break;case"changingPlain":e=d;break;case"repeatingImage":e=h;break;case"singalong":e=f;break;default:e=l}this.domElement=new e(this,this.parsedConfig,this.model),this.refresherComponent={onUpdate:function(){t.config.configChanged&&(t.parsedConfig=u.prototype.parseConfig(t.config,t.model),t.setupInitialState(),t.transformer.setParsedConfig(t.parsedConfig),t.config.configChanged=!1),t.requestUpdate(this.id)}},this.refresherComponentID=this.addComponent(this.refresherComponent),this.refresherComponent.id=this.refresherComponentID,this.requestUpdate(this.refresherComponentID)}function s(t,e,i){o.apply(this,arguments),this.config=t,this.model=e,this.timeKeeper=i,n.call(this),this.contentInserted=function(){this.domElement.contentInserted()}}var r=t("famous"),o=r.core.Node,a=t("helpers/ParameterTransformer"),u=t("helpers/ConfigParser"),h=t("elements/RepeatingImage"),c=t("elements/HighlightingText"),l=t("elements/Image"),p=t("elements/PlainText"),d=t("elements/ChangingPlainText"),f=t("elements/SingalongText");s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.setupInitialState=function(){this.parsedConfig.sizeX&&this.parsedConfig.sizeY&&(this.setSizeMode("absolute","absolute"),this.setAbsoluteSize(this.transformer.initialSize[0],this.transformer.initialSize[1])),this.config.animation&&this.parsedConfig.numFrames&&this.setProportionalSize(1,this.parsedConfig.numFrames),this.setPosition(this.transformer.initialPosition[0],this.transformer.initialPosition[1],this.transformer.initialPosition[2]),this.setOrigin(this.transformer.initialOrigin[0],this.transformer.initialOrigin[1],this.transformer.initialOrigin[2]),this.setScale(this.transformer.initialScale[0],this.transformer.initialScale[1],this.transformer.initialScale[2]),this.setRotation(this.transformer.initialRotate[0],this.transformer.initialRotate[1],this.transformer.initialRotate[2]),this.setOpacity(this.transformer.initialOpacity)},i.exports=s}),i("nodes/PopupPageNode",["require","exports","module","famous","nodes/PopupNode","helpers/ParameterTransformer","helpers/ConfigParser","helpers/MathFunctions"],function(t,e,i){function n(){var t,e=this;this.popupNodes=[],this.cameraBoundNodes=[],this.topSceneRoot=this.topScene.addChild(),this.cameraBoundRoot=this.topSceneRoot.addChild(),this.popups.forEach(function(i){i.cameraBound?(t=new a(i,e.model,e),e.cameraBoundNodes.push(t),e.cameraBoundRoot.addChild(t)):(t=new a(i,e.model,e),e.popupNodes.push(t),e.addChild(t))})}function s(t,e,i){var s=this;o.apply(this,arguments),this.popups=t.popups,this.model=t,this.scene=e,this.topScene=i,this.timePassed=0,this.previousTime=0,window.timeKeeper=this,window.orientationController.setTimeKeeper(this),n.call(this),this.camera=new c(e),this.parsedConfig=h.prototype.parseConfig(t.camera,t),this.transformer=new u(this.parsedConfig,t,this),this.setupInitialState(),this.updaterComponent={onUpdate:function(e){if(!s.paused){var i=e-s.previousTime;s.timePassed=s.timePassed+i}if(s.previousTime=e,t.camera.configChanged&&(s.parsedConfig=h.prototype.parseConfig(t.camera,t),s.setupInitialState(),s.transformer.setParsedConfig(s.parsedConfig),t.camera.configChanged=!1),t.camera.perspectiveZoom){var n=parseFloat(t.camera.timeOffset),r=t.page.perspective-s.perspectiveFunction((s.timePassed+n)/s.perspectiveZoomSpeed,s.perspectiveZoomAmount);s.camera.setDepth(r)}s.requestUpdate(this.id)}},this.updaterComponentID=this.addComponent(this.updaterComponent),this.updaterComponent.id=this.updaterComponentID,this.requestUpdate(this.updaterComponentID),this.componentID=this.transformer.createComponent(this),this.requestUpdate(this.componentID)}var r=t("famous"),o=r.core.Node,a=t("nodes/PopupNode"),u=t("helpers/ParameterTransformer"),h=t("helpers/ConfigParser"),c=r.components.Camera,l=t("helpers/MathFunctions");s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.setupInitialState=function(){this.camera.setDepth(parseFloat(this.model.page.perspective)),this.model.camera.perspectiveZoom&&(this.pageSpeed=parseFloat(this.model.page.speed)||1,this.perspectiveZoomSpeed=this.pageSpeed*parseFloat(this.model.camera.perspectiveZoomSpeed),this.perspectiveZoomAmount=parseFloat(this.model.camera.perspectiveZoomAmount),this.perspectiveZoomCutStart=parseFloat(this.model.camera.perspectiveZoomCutStart),this.perspectiveZoomCutEnd=parseFloat(this.model.camera.perspectiveZoomCutEnd),this.perspectiveFunction="triangle"===this.model.camera.perspectiveZoomType?l.prototype.triangleFunction:"sawtooth"===this.model.camera.perspectiveZoomType?l.prototype.sawToothFunction:"cos"===this.model.camera.perspectiveZoomType?l.prototype.cosFunction:l.prototype.sinFunction,this.model.camera.perspectiveZoomCut&&(this.perspectiveFunction=l.prototype.cutFunction(this.perspectiveFunction,this.perspectiveZoomCutStart,this.perspectiveZoomCutEnd,this.perspectiveFunction.period))),this.setSizeMode("absolute","absolute"),this.setAbsoluteSize(parseFloat(this.model.page.x),parseFloat(this.model.page.y)),this.cameraBoundRoot.setSizeMode("absolute","absolute"),this.cameraBoundRoot.setAbsoluteSize(parseFloat(this.model.page.x),parseFloat(this.model.page.y)),this.setPosition(this.transformer.initialPosition[0],this.transformer.initialPosition[1],this.transformer.initialPosition[2]),this.setOrigin(this.transformer.initialOrigin[0],this.transformer.initialOrigin[1],this.transformer.initialOrigin[2]),this.setScale(this.transformer.initialScale[0],this.transformer.initialScale[1],this.transformer.initialScale[2])},s.prototype.contentInserted=function(){this.popupNodes.forEach(function(t){t.contentInserted()})},s.prototype.dismount=function(){this.cameraBoundRoot.dismount(),o.prototype.dismount.apply(this,arguments)},s.prototype.start=function(){this.initialTime=Date.now(),this.currentTime=0,this.lastTime=0},s.prototype.pause=function(){this.paused=!0},s.prototype.play=function(){this.paused=!1},s.prototype.setTime=function(t){this.timePassed=parseFloat(t)},i.exports=s}),i("nodes/PagerNode",["require","exports","module","famous"],function(t,e,i){function n(){r.apply(this,arguments)}var s=t("famous"),r=s.core.Node;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.showPage=function(t){this.addChild(t),this.currentContent=t},n.prototype.clearPage=function(){this.currentContent.dismount()},i.exports=n}),i("nodes/AppNode",["require","exports","module","famous","nodes/PopupPageNode","nodes/PagerNode"],function(t,e,i){function n(t,e){r.apply(this,arguments),t.addChild(this),this.pagerNode=new a,this.addChild(this.pagerNode),this.scene=t,this.topScene=e}var s=t("famous"),r=s.core.Node,o=t("nodes/PopupPageNode"),a=t("nodes/PagerNode");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.createAndShowPage=function(t){this.contentNode=new o(t,this.scene,this.topScene),this.pagerNode.showPage(this.contentNode)},n.prototype.clearPage=function(){this.pagerNode.clearPage()},n.DEFAULT_OPTIONS={},i.exports=n}),i("BlankyApp",["require","exports","module","famous","helpers/StatsTimer","helpers/OrientationController","helpers/SoundController","nodes/AppNode"],function(t,e,i){function n(t){this.isApp=t,a.init(),window.initialPageId="UHGPYzstxO",window.blanky=this;var e=a.createScene("#device-screen"),i=a.createScene("#top-screen");window.appNode=new u(e,i),window.orientationController=new r({timePassed:0}),window.orientationController.startListening(this),this.soundController=new o(t)}var s=t("famous"),r=(t("helpers/StatsTimer"),t("helpers/OrientationController")),o=t("helpers/SoundController"),a=(s.Clock,s.core.FamousEngine),u=t("nodes/AppNode");n.prototype.clearPage=function(){window.appNode.clearPage(),this.soundController.clearSounds()},n.prototype.loadPage=function(t){var e=window.pagesModel.pages.filter(function(e){return e.objectId===t})[0];window.pageModel=e,window.appNode.createAndShowPage(e),this.soundController.createSounds(window.pageModel.sounds)},i.exports=n}),!function(t){t.Parse=t.Parse||{},t.Parse.VERSION="js1.3.2"}(this),function(){var t=this,e=t._,i={},n=Array.prototype,s=Object.prototype,r=Function.prototype,o=n.push,a=n.slice,u=n.concat,h=s.toString,c=s.hasOwnProperty,l=n.forEach,p=n.map,d=n.reduce,f=n.reduceRight,m=n.filter,_=n.every,g=n.some,v=n.indexOf,y=n.lastIndexOf,b=Array.isArray,x=Object.keys,w=r.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.4.4";var S=E.each=E.forEach=function(t,e,n){if(null!=t)if(l&&t.forEach===l)t.forEach(e,n);else if(t.length===+t.length){for(var s=0,r=t.length;r>s;s++)if(e.call(n,t[s],s,t)===i)return}else for(var o in t)if(E.has(t,o)&&e.call(n,t[o],o,t)===i)return};E.map=E.collect=function(t,e,i){var n=[];return null==t?n:p&&t.map===p?t.map(e,i):(S(t,function(t,s,r){n[n.length]=e.call(i,t,s,r)}),n)};var T="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,i,n){var s=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return n&&(e=E.bind(e,n)),s?t.reduce(e,i):t.reduce(e);if(S(t,function(t,r,o){s?i=e.call(n,i,t,r,o):(i=t,s=!0)}),!s)throw new TypeError(T);return i},E.reduceRight=E.foldr=function(t,e,i,n){var s=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=E.bind(e,n)),s?t.reduceRight(e,i):t.reduceRight(e);var r=t.length;if(r!==+r){var o=E.keys(t);r=o.length}if(S(t,function(a,u,h){u=o?o[--r]:--r,s?i=e.call(n,i,t[u],u,h):(i=t[u],s=!0)}),!s)throw new TypeError(T);return i},E.find=E.detect=function(t,e,i){var n;return C(t,function(t,s,r){return e.call(i,t,s,r)?(n=t,!0):void 0}),n},E.filter=E.select=function(t,e,i){var n=[];return null==t?n:m&&t.filter===m?t.filter(e,i):(S(t,function(t,s,r){e.call(i,t,s,r)&&(n[n.length]=t)}),n)},E.reject=function(t,e,i){return E.filter(t,function(t,n,s){return!e.call(i,t,n,s)},i)},E.every=E.all=function(t,e,n){e||(e=E.identity);var s=!0;return null==t?s:_&&t.every===_?t.every(e,n):(S(t,function(t,r,o){return(s=s&&e.call(n,t,r,o))?void 0:i}),!!s)};var C=E.some=E.any=function(t,e,n){e||(e=E.identity);var s=!1;return null==t?s:g&&t.some===g?t.some(e,n):(S(t,function(t,r,o){return s||(s=e.call(n,t,r,o))?i:void 0}),!!s)};E.contains=E.include=function(t,e){return null==t?!1:v&&t.indexOf===v?-1!=t.indexOf(e):C(t,function(t){return t===e})},E.invoke=function(t,e){var i=a.call(arguments,2),n=E.isFunction(e);return E.map(t,function(t){return(n?e:t[e]).apply(t,i)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.where=function(t,e,i){return E.isEmpty(e)?i?null:[]:E[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,i){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return S(t,function(t,s,r){var o=e?e.call(i,t,s,r):t;o>=n.computed&&(n={value:t,computed:o})}),n.value},E.min=function(t,e,i){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return S(t,function(t,s,r){var o=e?e.call(i,t,s,r):t;o<n.computed&&(n={value:t,computed:o})}),n.value},E.shuffle=function(t){var e,i=0,n=[];return S(t,function(t){e=E.random(i++),n[i-1]=n[e],n[e]=t}),n};var A=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,i){var n=A(e);return E.pluck(E.map(t,function(t,e,s){return{value:t,index:e,criteria:n.call(i,t,e,s)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var P=function(t,e,i,n){var s={},r=A(e||E.identity);return S(t,function(e,o){var a=r.call(i,e,o,t);n(s,a,e)}),s};E.groupBy=function(t,e,i){return P(t,e,i,function(t,e,i){(E.has(t,e)?t[e]:t[e]=[]).push(i)})},E.countBy=function(t,e,i){return P(t,e,i,function(t,e){E.has(t,e)||(t[e]=0),t[e]++})},E.sortedIndex=function(t,e,i,n){i=null==i?E.identity:A(i);for(var s=i.call(n,e),r=0,o=t.length;o>r;){var a=r+o>>>1;i.call(n,t[a])<s?r=a+1:o=a}return r},E.toArray=function(t){return t?E.isArray(t)?a.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:a.call(t,0,e)},E.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},E.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var O=function(t,e,i){return S(t,function(t){E.isArray(t)?e?o.apply(i,t):O(t,e,i):i.push(t)}),i};E.flatten=function(t,e){return O(t,e,[])},E.without=function(t){return E.difference(t,a.call(arguments,1))},E.uniq=E.unique=function(t,e,i,n){E.isFunction(e)&&(n=i,i=e,e=!1);var s=i?E.map(t,i,n):t,r=[],o=[];return S(s,function(i,n){(e?n&&o[o.length-1]===i:E.contains(o,i))||(o.push(i),r.push(t[n]))
}),r},E.union=function(){return E.uniq(u.apply(n,arguments))},E.intersection=function(t){var e=a.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=u.apply(n,a.call(arguments,1));return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){for(var t=a.call(arguments),e=E.max(E.pluck(t,"length")),i=new Array(e),n=0;e>n;n++)i[n]=E.pluck(t,""+n);return i},E.object=function(t,e){if(null==t)return{};for(var i={},n=0,s=t.length;s>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},E.indexOf=function(t,e,i){if(null==t)return-1;var n=0,s=t.length;if(i){if("number"!=typeof i)return n=E.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,s+i):i}if(v&&t.indexOf===v)return t.indexOf(e,i);for(;s>n;n++)if(t[n]===e)return n;return-1},E.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(y&&t.lastIndexOf===y)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var s=n?i:t.length;s--;)if(t[s]===e)return s;return-1},E.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),s=0,r=new Array(n);n>s;)r[s++]=t,t+=i;return r},E.bind=function(t,e){if(t.bind===w&&w)return w.apply(t,a.call(arguments,1));var i=a.call(arguments,2);return function(){return t.apply(e,i.concat(a.call(arguments)))}},E.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},E.bindAll=function(t){var e=a.call(arguments,1);return 0===e.length&&(e=E.functions(t)),S(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var i={};return e||(e=E.identity),function(){var n=e.apply(this,arguments);return E.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},E.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(a.call(arguments,1)))},E.throttle=function(t,e){var i,n,s,r,o=0,a=function(){o=new Date,s=null,r=t.apply(i,n)};return function(){var u=new Date,h=e-(u-o);return i=this,n=arguments,0>=h?(clearTimeout(s),s=null,o=u,r=t.apply(i,n)):s||(s=setTimeout(a,h)),r}},E.debounce=function(t,e,i){var n,s;return function(){var r=this,o=arguments,a=function(){n=null,i||(s=t.apply(r,o))},u=i&&!n;return clearTimeout(n),n=setTimeout(a,e),u&&(s=t.apply(r,o)),s}},E.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},E.wrap=function(t,e){return function(){var i=[t];return o.apply(i,arguments),e.apply(this,i)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},E.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=x||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)E.has(t,i)&&(e[e.length]=i);return e},E.values=function(t){var e=[];for(var i in t)E.has(t,i)&&e.push(t[i]);return e},E.pairs=function(t){var e=[];for(var i in t)E.has(t,i)&&e.push([i,t[i]]);return e},E.invert=function(t){var e={};for(var i in t)E.has(t,i)&&(e[t[i]]=i);return e},E.functions=E.methods=function(t){var e=[];for(var i in t)E.isFunction(t[i])&&e.push(i);return e.sort()},E.extend=function(t){return S(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},E.pick=function(t){var e={},i=u.apply(n,a.call(arguments,1));return S(i,function(i){i in t&&(e[i]=t[i])}),e},E.omit=function(t){var e={},i=u.apply(n,a.call(arguments,1));for(var s in t)E.contains(i,s)||(e[s]=t[s]);return e},E.defaults=function(t){return S(a.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var R=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var s=h.call(t);if(s!=h.call(e))return!1;switch(s){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=i.length;r--;)if(i[r]==t)return n[r]==e;i.push(t),n.push(e);var o=0,a=!0;if("[object Array]"==s){if(o=t.length,a=o==e.length)for(;o--&&(a=R(t[o],e[o],i,n)););}else{var u=t.constructor,c=e.constructor;if(u!==c&&!(E.isFunction(u)&&u instanceof u&&E.isFunction(c)&&c instanceof c))return!1;for(var l in t)if(E.has(t,l)&&(o++,!(a=E.has(e,l)&&R(t[l],e[l],i,n))))break;if(a){for(l in e)if(E.has(e,l)&&!o--)break;a=!o}}return i.pop(),n.pop(),a};E.isEqual=function(t,e){return R(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=b||function(t){return"[object Array]"==h.call(t)},E.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){E["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(t){return"function"==typeof t}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==h.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return c.call(t,e)},E.noConflict=function(){return t._=e,this},E.identity=function(t){return t},E.times=function(t,e,i){for(var n=Array(t),s=0;t>s;s++)n[s]=e.call(i,s);return n},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};I.unescape=E.invert(I.escape);var M={escape:new RegExp("["+E.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(I.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(t){E[t]=function(e){return null==e?"":(""+e).replace(M[t],function(e){return I[t][e]})}}),E.result=function(t,e){if(null==t)return null;var i=t[e];return E.isFunction(i)?i.call(t):i},E.mixin=function(t){S(E.functions(t),function(e){var i=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),U.call(this,i.apply(E,t))}})};var D=0;E.uniqueId=function(t){var e=++D+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,i){var n;i=E.defaults({},i,E.templateSettings);var s=new RegExp([(i.escape||L).source,(i.interpolate||L).source,(i.evaluate||L).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(s,function(e,i,n,s,a){return o+=t.slice(r,a).replace(N,function(t){return"\\"+j[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),s&&(o+="';\n"+s+"\n__p+='"),r=a+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return n(e,E);var u=function(t){return n.call(this,t,E)};return u.source="function("+(i.variable||"obj")+"){\n"+o+"}",u},E.chain=function(t){return E(t).chain()};var U=function(t){return this._chain?E(t).chain():t};E.mixin(E),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];E.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],U.call(this,i)}}),S(["concat","join","slice"],function(t){var e=n[t];E.prototype[t]=function(){return U.call(this,e.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(t){t.Parse=t.Parse||{};var i=t.Parse;"undefined"!=typeof exports&&exports._?(i._=exports._.noConflict(),i.localStorage=e("localStorage"),i.XMLHttpRequest=e("xmlhttprequest").XMLHttpRequest,exports.Parse=i):(i._=_.noConflict(),"undefined"!=typeof localStorage&&(i.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(i.XMLHttpRequest=XMLHttpRequest)),"undefined"!=typeof $&&(i.$=$);var n=function(){},s=function(t,e,s){var r;return r=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},i._.extend(r,t),n.prototype=t.prototype,r.prototype=new n,e&&i._.extend(r.prototype,e),s&&i._.extend(r,s),r.prototype.constructor=r,r.__super__=t.prototype,r};i.serverURL="https://api.parse.com","undefined"!=typeof process&&process.versions&&process.versions.node&&(i._isNode=!0),i.initialize=function(t,e,n){if(n)throw"Parse.initialize() was passed a Master Key, which is only allowed from within Node.js.";i._initialize(t,e)},i._initialize=function(t,e,n){i.applicationId=t,i.javaScriptKey=e,i.masterKey=n,i._useMasterKey=!1},i._isNode&&(i.initialize=i._initialize,i.Cloud=i.Cloud||{},i.Cloud.useMasterKey=function(){i._useMasterKey=!0}),i._getParsePath=function(t){if(!i.applicationId)throw"You need to call Parse.initialize before using Parse.";if(t||(t=""),!i._.isString(t))throw"Tried to get a localStorage path that wasn't a String.";return"/"===t[0]&&(t=t.substring(1)),"Parse/"+i.applicationId+"/"+t},i._installationId=null,i._getInstallationId=function(){if(i._installationId)return i._installationId;var t=i._getParsePath("installationId");if(i._installationId=i.localStorage.getItem(t),!i._installationId||""===i._installationId){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};i._installationId=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),i.localStorage.setItem(t,i._installationId)}return i._installationId},i._parseDate=function(t){var e=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),i=e.exec(t);if(!i)return null;var n=i[1]||0,s=(i[2]||1)-1,r=i[3]||0,o=i[4]||0,a=i[5]||0,u=i[6]||0,h=i[8]||0;return new Date(Date.UTC(n,s,r,o,a,u,h))},i._ajaxIE8=function(t,e,n){var s=new i.Promise,r=new XDomainRequest;return r.onload=function(){var t;try{t=JSON.parse(r.responseText)}catch(e){s.reject(e)}t&&s.resolve(t)},r.onerror=r.ontimeout=function(){var t={responseText:JSON.stringify({code:i.Error.X_DOMAIN_REQUEST,error:"IE's XDomainRequest does not supply error info."})};s.reject(t)},r.onprogress=function(){},r.open(t,e),r.send(n),s},i._useXDomainRequest=function(){return"undefined"!=typeof XDomainRequest?"withCredentials"in new XMLHttpRequest?!1:!0:!1},i._ajax=function(t,e,n,s,r){var o={success:s,error:r};if(i._useXDomainRequest())return i._ajaxIE8(t,e,n)._thenRunCallbacks(o);var a=new i.Promise,u=!1,h=new i.XMLHttpRequest;return h.onreadystatechange=function(){if(4===h.readyState){if(u)return;if(u=!0,h.status>=200&&h.status<300){var t;try{t=JSON.parse(h.responseText)}catch(e){a.reject(e)}t&&a.resolve(t,h.status,h)}else a.reject(h)}},h.open(t,e,!0),h.setRequestHeader("Content-Type","text/plain"),i._isNode&&h.setRequestHeader("User-Agent","Parse/"+i.VERSION+" (NodeJS "+process.versions.node+")"),h.send(n),a._thenRunCallbacks(o)},i._extend=function(t,e){var i=s(this,t,e);return i.extend=this.extend,i},i._request=function(t){var e=t.route,n=t.className,s=t.objectId,r=t.method,o=t.useMasterKey,a=t.sessionToken,u=t.data;if(!i.applicationId)throw"You must specify your applicationId using Parse.initialize.";if(!i.javaScriptKey&&!i.masterKey)throw"You must specify a key using Parse.initialize.";if(!a){var h=i.User.current();h&&h._sessionToken&&(a=h._sessionToken)}if("batch"!==e&&"classes"!==e&&"events"!==e&&"files"!==e&&"functions"!==e&&"login"!==e&&"push"!==e&&"requestPasswordReset"!==e&&"rest_verify_analytics"!==e&&"users"!==e&&"jobs"!==e&&"config"!==e)throw"Bad route: '"+e+"'.";var c=i.serverURL;"/"!==c.charAt(c.length-1)&&(c+="/"),c+="1/"+e,n&&(c+="/"+n),s&&(c+="/"+s),u=i._.clone(u||{}),"POST"!==r&&(u._method=r,r="POST"),i._.isUndefined(o)&&(o=i._useMasterKey),u._ApplicationId=i.applicationId,o?u._MasterKey=i.masterKey:u._JavaScriptKey=i.javaScriptKey,u._ClientVersion=i.VERSION,u._InstallationId=i._getInstallationId(),a&&(u._SessionToken=a);var l=JSON.stringify(u);return i._ajax(r,c,l).then(null,function(t){var e;if(t&&t.responseText)try{var n=JSON.parse(t.responseText);e=new i.Error(n.code,n.error)}catch(s){e=new i.Error(i.Error.INVALID_JSON,"Received an error with invalid JSON from Parse: "+t.responseText)}else e=new i.Error(i.Error.CONNECTION_FAILED,"XMLHttpRequest failed: "+JSON.stringify(t));return i.Promise.error(e)})},i._getValue=function(t,e){return t&&t[e]?i._.isFunction(t[e])?t[e]():t[e]:null},i._encode=function(t,e,n){var s=i._;if(t instanceof i.Object){if(n)throw"Parse.Objects not allowed here";if(!e||s.include(e,t)||!t._hasData)return t._toPointer();if(!t.dirty())return e=e.concat(t),i._encode(t._toFullJSON(e),e,n);throw"Tried to save an object with a pointer to a new, unsaved object."}if(t instanceof i.ACL)return t.toJSON();if(s.isDate(t))return{__type:"Date",iso:t.toJSON()};if(t instanceof i.GeoPoint)return t.toJSON();if(s.isArray(t))return s.map(t,function(t){return i._encode(t,e,n)});if(s.isRegExp(t))return t.source;if(t instanceof i.Relation)return t.toJSON();if(t instanceof i.Op)return t.toJSON();if(t instanceof i.File){if(!t.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",name:t.name(),url:t.url()}}if(s.isObject(t)){var r={};return i._objectEach(t,function(t,s){r[s]=i._encode(t,e,n)}),r}return t},i._decode=function(t,e){var n=i._;if(!n.isObject(e))return e;if(n.isArray(e))return i._arrayEach(e,function(t,n){e[n]=i._decode(n,t)}),e;if(e instanceof i.Object)return e;if(e instanceof i.File)return e;if(e instanceof i.Op)return e;if(e.__op)return i.Op._decode(e);if("Pointer"===e.__type&&e.className){var s=i.Object._create(e.className);return s._finishFetch({objectId:e.objectId},!1),s}if("Object"===e.__type&&e.className){var r=e.className;delete e.__type,delete e.className;var o=i.Object._create(r);return o._finishFetch(e,!0),o}if("Date"===e.__type)return i._parseDate(e.iso);if("GeoPoint"===e.__type)return new i.GeoPoint({latitude:e.latitude,longitude:e.longitude});if("ACL"===t)return e instanceof i.ACL?e:new i.ACL(e);if("Relation"===e.__type){var a=new i.Relation(null,t);return a.targetClassName=e.className,a}if("File"===e.__type){var u=new i.File(e.name);return u._url=e.url,u}return i._objectEach(e,function(t,n){e[n]=i._decode(n,t)}),e},i._arrayEach=i._.each,i._traverse=function(t,e,n){if(t instanceof i.Object){if(n=n||[],i._.indexOf(n,t)>=0)return;return n.push(t),i._traverse(t.attributes,e,n),e(t)}return t instanceof i.Relation||t instanceof i.File?e(t):i._.isArray(t)?(i._.each(t,function(s,r){var o=i._traverse(s,e,n);o&&(t[r]=o)}),e(t)):i._.isObject(t)?(i._each(t,function(s,r){var o=i._traverse(s,e,n);o&&(t[r]=o)}),e(t)):e(t)},i._objectEach=i._each=function(t,e){var n=i._;n.isObject(t)?n.each(n.keys(t),function(i){e(t[i],i)}):n.each(t,e)},i._isNullOrUndefined=function(t){return i._.isNull(t)||i._.isUndefined(t)}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Analytics=e.Analytics||{},i.extend(e.Analytics,{track:function(t,n,s){if(t=t||"",t=t.replace(/^\s*/,""),t=t.replace(/\s*$/,""),0===t.length)throw"A name for the custom event must be provided";return i.each(n,function(t,e){if(!i.isString(e)||!i.isString(t))throw'track() dimensions expects keys and values of type "string".'}),s=s||{},e._request({route:"events",className:t,method:"POST",data:{dimensions:n}})._thenRunCallbacks(s)}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Config=function(){this.attributes={},this._escapedAttributes={}},e.Config.current=function(){if(e.Config._currentConfig)return e.Config._currentConfig;var t=e.localStorage.getItem(e._getParsePath(e.Config._CURRENT_CONFIG_KEY)),i=new e.Config;return t&&(i._finishFetch(JSON.parse(t)),e.Config._currentConfig=i),i},e.Config.get=function(t){t=t||{};var i=e._request({route:"config",method:"GET"});return i.then(function(t){if(!t||!t.params){var i=new e.Error(e.Error.INVALID_JSON,"Config JSON response invalid.");return e.Promise.error(i)}var n=new e.Config;return n._finishFetch(t),e.Config._currentConfig=n,n})._thenRunCallbacks(t)},e.Config.prototype={escape:function(t){var n=this._escapedAttributes[t];if(n)return n;var s,r=this.attributes[t];return s=e._isNullOrUndefined(r)?"":i.escape(r.toString()),this._escapedAttributes[t]=s,s},get:function(t){return this.attributes[t]},_finishFetch:function(t){this.attributes=e._decode(null,i.clone(t.params)),e.localStorage.setItem(e._getParsePath(e.Config._CURRENT_CONFIG_KEY),JSON.stringify(t))}},e.Config._currentConfig=null,e.Config._CURRENT_CONFIG_KEY="currentConfig"}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Error=function(t,e){this.code=t,this.message=e},i.extend(e.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,INVALID_EVENT_NAME:160,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252,AGGREGATE_ERROR:600,FILE_READ_ERROR:601,X_DOMAIN_REQUEST:602})}(this),function(){var t=this,e=t.Parse||(t.Parse={}),i=/\s+/,n=Array.prototype.slice;e.Events={on:function(t,e,n){var s,r,o,a,u;if(!e)return this;for(t=t.split(i),s=this._callbacks||(this._callbacks={}),r=t.shift();r;)u=s[r],o=u?u.tail:{},o.next=a={},o.context=n,o.callback=e,s[r]={tail:a,next:u?u.next:o},r=t.shift();return this},off:function(t,e,n){var s,r,o,a,u,h;if(r=this._callbacks){if(!(t||e||n))return delete this._callbacks,this;for(t=t?t.split(i):_.keys(r),s=t.shift();s;)if(o=r[s],delete r[s],o&&(e||n)){for(a=o.tail,o=o.next;o!==a;)u=o.callback,h=o.context,(e&&u!==e||n&&h!==n)&&this.on(s,u,h),o=o.next;s=t.shift()}else s=t.shift();return this}},trigger:function(t){var e,s,r,o,a,u,h;if(!(r=this._callbacks))return this;for(u=r.all,t=t.split(i),h=n.call(arguments,1),e=t.shift();e;){if(s=r[e])for(o=s.tail;(s=s.next)!==o;)s.callback.apply(s.context||this,h);if(s=u)for(o=s.tail,a=[e].concat(h);(s=s.next)!==o;)s.callback.apply(s.context||this,a);e=t.shift()}return this}},e.Events.bind=e.Events.on,e.Events.unbind=e.Events.off}.call(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.GeoPoint=function(t,n){i.isArray(t)?(e.GeoPoint._validate(t[0],t[1]),this.latitude=t[0],this.longitude=t[1]):i.isObject(t)?(e.GeoPoint._validate(t.latitude,t.longitude),this.latitude=t.latitude,this.longitude=t.longitude):i.isNumber(t)&&i.isNumber(n)?(e.GeoPoint._validate(t,n),this.latitude=t,this.longitude=n):(this.latitude=0,this.longitude=0);var s=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return s._latitude}),this.__defineGetter__("longitude",function(){return s._longitude}),this.__defineSetter__("latitude",function(t){e.GeoPoint._validate(t,s.longitude),s._latitude=t}),this.__defineSetter__("longitude",function(t){e.GeoPoint._validate(s.latitude,t),s._longitude=t}))},e.GeoPoint._validate=function(t,e){if(-90>t)throw"Parse.GeoPoint latitude "+t+" < -90.0.";if(t>90)throw"Parse.GeoPoint latitude "+t+" > 90.0.";if(-180>e)throw"Parse.GeoPoint longitude "+e+" < -180.0.";if(e>180)throw"Parse.GeoPoint longitude "+e+" > 180.0."},e.GeoPoint.current=function(t){var i=new e.Promise;return navigator.geolocation.getCurrentPosition(function(t){i.resolve(new e.GeoPoint({latitude:t.coords.latitude,longitude:t.coords.longitude}))},function(t){i.reject(t)}),i._thenRunCallbacks(t)},e.GeoPoint.prototype={toJSON:function(){return e.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(t){var e=Math.PI/180,i=this.latitude*e,n=this.longitude*e,s=t.latitude*e,r=t.longitude*e,o=i-s,a=n-r,u=Math.sin(o/2),h=Math.sin(a/2),c=u*u+Math.cos(i)*Math.cos(s)*h*h;return c=Math.min(1,c),2*Math.asin(Math.sqrt(c))},kilometersTo:function(t){return 6371*this.radiansTo(t)},milesTo:function(t){return 3958.8*this.radiansTo(t)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._,n="*";e.ACL=function(t){var n=this;if(n.permissionsById={},i.isObject(t))if(t instanceof e.User)n.setReadAccess(t,!0),n.setWriteAccess(t,!0);else{if(i.isFunction(t))throw"Parse.ACL() called with a function.  Did you forget ()?";e._objectEach(t,function(t,s){if(!i.isString(s))throw"Tried to create an ACL with an invalid userId.";n.permissionsById[s]={},e._objectEach(t,function(t,e){if("read"!==e&&"write"!==e)throw"Tried to create an ACL with an invalid permission type.";if(!i.isBoolean(t))throw"Tried to create an ACL with an invalid permission value.";n.permissionsById[s][e]=t})})}},e.ACL.prototype.toJSON=function(){return i.clone(this.permissionsById)},e.ACL.prototype._setAccess=function(t,n,s){if(n instanceof e.User?n=n.id:n instanceof e.Role&&(n="role:"+n.getName()),!i.isString(n))throw"userId must be a string.";if(!i.isBoolean(s))throw"allowed must be either true or false.";var r=this.permissionsById[n];if(!r){if(!s)return;r={},this.permissionsById[n]=r}s?this.permissionsById[n][t]=!0:(delete r[t],i.isEmpty(r)&&delete r[n])},e.ACL.prototype._getAccess=function(t,i){i instanceof e.User?i=i.id:i instanceof e.Role&&(i="role:"+i.getName());var n=this.permissionsById[i];return n&&n[t]?!0:!1},e.ACL.prototype.setReadAccess=function(t,e){this._setAccess("read",t,e)},e.ACL.prototype.getReadAccess=function(t){return this._getAccess("read",t)},e.ACL.prototype.setWriteAccess=function(t,e){this._setAccess("write",t,e)},e.ACL.prototype.getWriteAccess=function(t){return this._getAccess("write",t)},e.ACL.prototype.setPublicReadAccess=function(t){this.setReadAccess(n,t)},e.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(n)},e.ACL.prototype.setPublicWriteAccess=function(t){this.setWriteAccess(n,t)},e.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(n)},e.ACL.prototype.getRoleReadAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getReadAccess("role:"+t);throw"role must be a Parse.Role or a String"},e.ACL.prototype.getRoleWriteAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getWriteAccess("role:"+t);throw"role must be a Parse.Role or a String"},e.ACL.prototype.setRoleReadAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return void this.setReadAccess("role:"+t,n);throw"role must be a Parse.Role or a String"},e.ACL.prototype.setRoleWriteAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return void this.setWriteAccess("role:"+t,n);throw"role must be a Parse.Role or a String"}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Op=function(){this._initialize.apply(this,arguments)},e.Op.prototype={_initialize:function(){}},i.extend(e.Op,{_extend:e._extend,_opDecoderMap:{},_registerDecoder:function(t,i){e.Op._opDecoderMap[t]=i},_decode:function(t){var i=e.Op._opDecoderMap[t.__op];return i?i(t):void 0}}),e.Op._registerDecoder("Batch",function(t){var i=null;return e._arrayEach(t.ops,function(t){t=e.Op._decode(t),i=t._mergeWithPrevious(i)}),i}),e.Op.Set=e.Op._extend({_initialize:function(t){this._value=t},value:function(){return this._value},toJSON:function(){return e._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),e.Op._UNSET={},e.Op.Unset=e.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return e.Op._UNSET}}),e.Op._registerDecoder("Delete",function(){return new e.Op.Unset}),e.Op.Increment=e.Op._extend({_initialize:function(t){this._amount=t},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.amount());if(t instanceof e.Op.Set)return new e.Op.Set(t.value()+this.amount());if(t instanceof e.Op.Increment)return new e.Op.Increment(this.amount()+t.amount());throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t+this.amount():this.amount()}}),e.Op._registerDecoder("Increment",function(t){return new e.Op.Increment(t.amount)}),e.Op.Add=e.Op._extend({_initialize:function(t){this._objects=t},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Add)return new e.Op.Add(t.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t.concat(this.objects()):i.clone(this.objects())}}),e.Op._registerDecoder("Add",function(t){return new e.Op.Add(e._decode(void 0,t.objects))}),e.Op.AddUnique=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.AddUnique)return new e.Op.AddUnique(this._estimate(t.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.clone(t);return e._arrayEach(this.objects(),function(t){if(t instanceof e.Object&&t.id){var s=i.find(n,function(i){return i instanceof e.Object&&i.id===t.id});if(s){var r=i.indexOf(n,s);n[r]=t}else n.push(t)}else i.contains(n,t)||n.push(t)}),n}return i.clone(this.objects())}}),e.Op._registerDecoder("AddUnique",function(t){return new e.Op.AddUnique(e._decode(void 0,t.objects))}),e.Op.Remove=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return t;if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Remove)return new e.Op.Remove(i.union(t.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.difference(t,this.objects());return e._arrayEach(this.objects(),function(t){t instanceof e.Object&&t.id&&(n=i.reject(n,function(i){return i instanceof e.Object&&i.id===t.id}))}),n}return[]}}),e.Op._registerDecoder("Remove",function(t){return new e.Op.Remove(e._decode(void 0,t.objects))}),e.Op.Relation=e.Op._extend({_initialize:function(t,n){this._targetClassName=null;var s=this,r=function(t){if(t instanceof e.Object){if(!t.id)throw"You can't add an unsaved Parse.Object to a relation.";if(s._targetClassName||(s._targetClassName=t.className),s._targetClassName!==t.className)throw"Tried to create a Parse.Relation with 2 different types: "+s._targetClassName+" and "+t.className+".";return t.id}return t};this.relationsToAdd=i.uniq(i.map(t,r)),this.relationsToRemove=i.uniq(i.map(n,r))},added:function(){var t=this;return i.map(this.relationsToAdd,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},removed:function(){var t=this;return i.map(this.relationsToRemove,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},toJSON:function(){var t=null,e=null,n=this,s=function(t){return{__type:"Pointer",className:n._targetClassName,objectId:t}},r=null;return this.relationsToAdd.length>0&&(r=i.map(this.relationsToAdd,s),t={__op:"AddRelation",objects:r}),this.relationsToRemove.length>0&&(r=i.map(this.relationsToRemove,s),e={__op:"RemoveRelation",objects:r}),t&&e?{__op:"Batch",ops:[t,e]}:t||e||{}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)throw"You can't modify a relation after deleting it.";if(t instanceof e.Op.Relation){if(t._targetClassName&&t._targetClassName!==this._targetClassName)throw"Related object must be of class "+t._targetClassName+", but "+this._targetClassName+" was passed in.";var n=i.union(i.difference(t.relationsToAdd,this.relationsToRemove),this.relationsToAdd),s=i.union(i.difference(t.relationsToRemove,this.relationsToAdd),this.relationsToRemove),r=new e.Op.Relation(n,s);return r._targetClassName=this._targetClassName,r}throw"Op is invalid after previous op."}return this},_estimate:function(t,i,n){if(t){if(t instanceof e.Relation){if(this._targetClassName)if(t.targetClassName){if(t.targetClassName!==this._targetClassName)throw"Related object must be a "+t.targetClassName+", but a "+this._targetClassName+" was passed in."}else t.targetClassName=this._targetClassName;return t}throw"Op is invalid after previous op."}var s=new e.Relation(i,n);s.targetClassName=this._targetClassName}}),e.Op._registerDecoder("AddRelation",function(t){return new e.Op.Relation(e._decode(void 0,t.objects),[])}),e.Op._registerDecoder("RemoveRelation",function(t){return new e.Op.Relation([],e._decode(void 0,t.objects))})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Relation=function(t,e){this.parent=t,this.key=e,this.targetClassName=null},e.Relation.prototype={_ensureParentAndKey:function(t,e){if(this.parent=this.parent||t,this.key=this.key||e,this.parent!==t)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==e)throw"Internal Error. Relation retrieved from two different keys."},add:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation(t,[]);this.parent.set(this.key,n),this.targetClassName=n._targetClassName},remove:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation([],t);this.parent.set(this.key,n),this.targetClassName=n._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var t,i;return this.targetClassName?(t=e.Object._getSubclass(this.targetClassName),i=new e.Query(t)):(t=e.Object._getSubclass(this.parent.className),i=new e.Query(t),i._extraOptions.redirectClassNameForKey=this.key),i._addCondition("$relatedTo","object",this.parent._toPointer()),i._addCondition("$relatedTo","key",this.key),i}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},i.extend(e.Promise,{_isPromisesAPlusCompliant:!1,is:function(t){return t&&t.then&&i.isFunction(t.then)},as:function(){var t=new e.Promise;return t.resolve.apply(t,arguments),t},error:function(){var t=new e.Promise;return t.reject.apply(t,arguments),t},when:function(t){var i;i=t&&e._isNullOrUndefined(t.length)?arguments:t;
var n=i.length,s=!1,r=[],o=[];if(r.length=i.length,o.length=i.length,0===n)return e.Promise.as.apply(this,r);var a=new e.Promise,u=function(){n-=1,0===n&&(s?a.reject(o):a.resolve.apply(a,r))};return e._arrayEach(i,function(t,i){e.Promise.is(t)?t.then(function(t){r[i]=t,u()},function(t){o[i]=t,s=!0,u()}):(r[i]=t,u())}),a},_continueWhile:function(t,i){return t()?i().then(function(){return e.Promise._continueWhile(t,i)}):e.Promise.as()}}),i.extend(e.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var t=arguments;e._arrayEach(this._resolvedCallbacks,function(e){e.apply(this,t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(t){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=t,e._arrayEach(this._rejectedCallbacks,function(e){e(t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(t,i){var n=new e.Promise,s=function(){var i=arguments;if(t)if(e.Promise._isPromisesAPlusCompliant)try{i=[t.apply(this,i)]}catch(s){i=[e.Promise.error(s)]}else i=[t.apply(this,i)];1===i.length&&e.Promise.is(i[0])?i[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):n.resolve.apply(n,i)},r=function(t){var s=[];if(i){if(e.Promise._isPromisesAPlusCompliant)try{s=[i(t)]}catch(r){s=[e.Promise.error(r)]}else s=[i(t)];1===s.length&&e.Promise.is(s[0])?s[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):e.Promise._isPromisesAPlusCompliant?n.resolve.apply(n,s):n.reject(s[0])}else n.reject(t)},o=function(t){t.call()};e.Promise._isPromisesAPlusCompliant&&("undefined"!=typeof window&&window.setTimeout?o=function(t){window.setTimeout(t,0)}:"undefined"!=typeof process&&process.nextTick&&(o=function(t){process.nextTick(t)}));var a=this;return this._resolved?o(function(){s.apply(a,a._result)}):this._rejected?o(function(){r(a._error)}):(this._resolvedCallbacks.push(s),this._rejectedCallbacks.push(r)),n},always:function(t){return this.then(t,t)},done:function(t){return this.then(t)},fail:function(t){return this.then(null,t)},_thenRunCallbacks:function(t,n){var s;if(i.isFunction(t)){var r=t;s={success:function(t){r(t,null)},error:function(t){r(null,t)}}}else s=i.clone(t);return s=s||{},this.then(function(t){return s.success?s.success.apply(this,arguments):n&&n.trigger("sync",n,t,s),e.Promise.as.apply(e.Promise,arguments)},function(t){return s.error?i.isUndefined(n)?s.error(t):s.error(n,t):n&&n.trigger("error",n,t,s),e.Promise.error(t)})},_continueWith:function(t){return this.then(function(){return t(arguments,null)},function(e){return t(null,e)})}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._,n=function(t){if(26>t)return String.fromCharCode(65+t);if(52>t)return String.fromCharCode(97+(t-26));if(62>t)return String.fromCharCode(48+(t-52));if(62===t)return"+";if(63===t)return"/";throw"Tried to encode large digit "+t+" in base64."},s=function(t){var e=[];return e.length=Math.ceil(t.length/3),i.times(e.length,function(i){var s=t[3*i],r=t[3*i+1]||0,o=t[3*i+2]||0,a=3*i+1<t.length,u=3*i+2<t.length;e[i]=[n(63&s>>2),n(48&s<<4|15&r>>4),a?n(60&r<<2|3&o>>6):"=",u?n(63&o):"="].join("")}),e.join("")},r={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},o=function(t,i){var n=new e.Promise;if("undefined"==typeof FileReader)return e.Promise.error(new e.Error(e.Error.FILE_READ_ERROR,"Attempted to use a FileReader on an unsupported browser."));var s=new FileReader;return s.onloadend=function(){if(2!==s.readyState)return void n.reject(new e.Error(e.Error.FILE_READ_ERROR,"Error reading file."));var t=s.result,r=/^data:([^;]*);base64,(.*)$/.exec(t);return r?void n.resolve(r[2],i||r[1]):void n.reject(new e.Error(e.Error.FILE_READ_ERROR,"Unable to interpret data URL: "+t))},s.readAsDataURL(t),n};e.File=function(t,n,a){this._name=t;var u=/\.([^.]*)$/.exec(t);u&&(u=u[1].toLowerCase());var h=a||r[u]||"text/plain";if(i.isArray(n))this._source=e.Promise.as(s(n),h);else if(n&&n.base64){var c=/^data:([a-zA-Z]*\/[a-zA-Z+.-]*);(charset=[a-zA-Z0-9\-\/\s]*,)?base64,(\S+)/,l=c.exec(n.base64);this._source=l&&l.length>0?e.Promise.as(4===l.length?l[3]:l[2],l[1]):e.Promise.as(n.base64,h)}else if("undefined"!=typeof File&&n instanceof File)this._source=o(n,a);else if(i.isString(n))throw"Creating a Parse.File from a String is not yet supported."},e.File.prototype={name:function(){return this._name},url:function(){return this._url},save:function(t){t=t||{};var i=this;return i._previousSave||(i._previousSave=i._source.then(function(n,s){var r={base64:n,_ContentType:s};return e._request({route:"files",className:i._name,method:"POST",data:r,useMasterKey:t.useMasterKey})}).then(function(t){return i._name=t.name,i._url=t.url,i})),i._previousSave._thenRunCallbacks(t)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Object=function(t,n){if(i.isString(t))return e.Object._create.apply(this,arguments);t=t||{},n&&n.parse&&(t=this.parse(t));var s=e._getValue(this,"defaults");if(s&&(t=i.extend({},s,t)),n&&n.collection&&(this.collection=n.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=i.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(t,{silent:!0}))throw new Error("Can't create an invalid Parse.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=i.clone(this.attributes),this.initialize.apply(this,arguments)},e.Object.saveAll=function(t,i){return i=i||{},e.Object._deepSaveAsync(t,{useMasterKey:i.useMasterKey})._thenRunCallbacks(i)},e.Object.destroyAll=function(t,n){n=n||{};var s=function(t){t.trigger("destroy",t,t.collection,n)},r=[],o=function(t){var o=e.Promise.as();return t.length>0&&(o=o.then(function(){return e._request({route:"batch",method:"POST",useMasterKey:n.useMasterKey,data:{requests:i.map(t,function(t){return{method:"DELETE",path:"/1/classes/"+t.className+"/"+t.id}})}})}).then(function(i){e._arrayEach(t,function(t,o){if(i[o].success&&n.wait)s(t);else if(i[o].error){var a=new e.Error(i[o].error.code,i[o].error.error);a.object=t,r.push(a)}})})),o},a=e.Promise.as(),u=[];return e._arrayEach(t,function(e,i){if(e.id&&n.wait||s(e),e.id&&u.push(e),20===u.length||i+1===t.length){var r=u;u=[],a=a.then(function(){return o(r)})}}),a.then(function(){if(0===r.length)return!0;var t=new e.Error(e.Error.AGGREGATE_ERROR,"Error deleting an object in destroyAll");return t.errors=r,e.Promise.error(t)})._thenRunCallbacks(n)},e.Object.fetchAll=function(t,i){return e.Object._fetchAll(t,!0)._thenRunCallbacks(i)},e.Object.fetchAllIfNeeded=function(t,i){return e.Object._fetchAll(t,!1)._thenRunCallbacks(i)},i.extend(e.Object.prototype,e.Events,{_existed:!1,initialize:function(){},toJSON:function(){var t=this._toFullJSON();return e._arrayEach(["__type","className"],function(e){delete t[e]}),t},_toFullJSON:function(t){var n=i.clone(this.attributes);return e._objectEach(n,function(i,s){n[s]=e._encode(i,t)}),e._objectEach(this._operations,function(t,e){n[e]=t}),i.has(this,"id")&&(n.objectId=this.id),i.has(this,"createdAt")&&(n.createdAt=i.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),i.has(this,"updatedAt")&&(n.updatedAt=i.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),n.__type="Object",n.className=this.className,n},_refreshCache:function(){var t=this;t._refreshingCache||(t._refreshingCache=!0,e._objectEach(this.attributes,function(n,s){n instanceof e.Object?n._refreshCache():i.isObject(n)&&t._resetCacheForKey(s)&&t.set(s,new e.Op.Set(n),{silent:!0})}),delete t._refreshingCache)},dirty:function(t){this._refreshCache();var e=i.last(this._opSetQueue);return t?e[t]?!0:!1:this.id?i.keys(e).length>0?!0:!1:!0},dirtyKeys:function(){return i.keys(i.last(this._opSetQueue))},_toPointer:function(){if(!this.id)throw new Error("Can't serialize an unsaved Parse.Object");return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(t){return this.attributes[t]},relation:function(t){var i=this.get(t);if(i){if(!(i instanceof e.Relation))throw"Called relation() on non-relation field "+t;return i._ensureParentAndKey(this,t),i}return new e.Relation(this,t)},escape:function(t){var n=this._escapedAttributes[t];if(n)return n;var s,r=this.attributes[t];return s=e._isNullOrUndefined(r)?"":i.escape(r.toString()),this._escapedAttributes[t]=s,s},has:function(t){return!e._isNullOrUndefined(this.attributes[t])},_mergeMagicFields:function(t){var n=this,s=["id","objectId","createdAt","updatedAt"];e._arrayEach(s,function(s){t[s]&&("objectId"===s?n.id=t[s]:n[s]="createdAt"!==s&&"updatedAt"!==s||i.isDate(t[s])?t[s]:e._parseDate(t[s]),delete t[s])})},_copyServerData:function(t){var i={};e._objectEach(t,function(t,n){i[n]=e._decode(n,t)}),this._serverData=i,this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._rebuildAllEstimatedData()},_mergeFromObject:function(t){t&&(this.id=t.id,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this._copyServerData(t._serverData),this._hasData=!0)},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var t=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue);var n=i.first(this._opSetQueue);e._objectEach(t,function(e,i){var s=t[i],r=n[i];s&&r?n[i]=r._mergeWithPrevious(s):s&&(n[i]=s)}),this._saving=this._saving-1},_finishSave:function(t){var n={};e._traverse(this.attributes,function(t){t instanceof e.Object&&t.id&&t._hasData&&(n[t.id]=t)});var s=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue),this._applyOpSet(s,this._serverData),this._mergeMagicFields(t);var r=this;e._objectEach(t,function(t,i){r._serverData[i]=e._decode(i,t);var s=e._traverse(r._serverData[i],function(t){return t instanceof e.Object&&n[t.id]?n[t.id]:void 0});s&&(r._serverData[i]=s)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(t,e){this._opSetQueue=[{}],this._mergeMagicFields(t),this._copyServerData(t),this._hasData=e},_applyOpSet:function(t,i){var n=this;e._objectEach(t,function(t,s){i[s]=t._estimate(i[s],n,s),i[s]===e.Op._UNSET&&delete i[s]})},_resetCacheForKey:function(t){var n=this.attributes[t];if(!(!i.isObject(n)||n instanceof e.Object||n instanceof e.File)){n=n.toJSON?n.toJSON():n;var s=JSON.stringify(n);if(this._hashedJSON[t]!==s){var r=!!this._hashedJSON[t];return this._hashedJSON[t]=s,r}}return!1},_rebuildEstimatedDataForKey:function(t){var i=this;delete this.attributes[t],this._serverData[t]&&(this.attributes[t]=this._serverData[t]),e._arrayEach(this._opSetQueue,function(n){var s=n[t];s&&(i.attributes[t]=s._estimate(i.attributes[t],i,t),i.attributes[t]===e.Op._UNSET?delete i.attributes[t]:i._resetCacheForKey(t))})},_rebuildAllEstimatedData:function(){var t=this,n=i.clone(this.attributes);this.attributes=i.clone(this._serverData),e._arrayEach(this._opSetQueue,function(i){t._applyOpSet(i,t.attributes),e._objectEach(i,function(e,i){t._resetCacheForKey(i)})}),e._objectEach(n,function(e,i){t.attributes[i]!==e&&t.trigger("change:"+i,t,t.attributes[i],{})}),e._objectEach(this.attributes,function(e,s){i.has(n,s)||t.trigger("change:"+s,t,e,{})})},set:function(t,n,s){var r;if(i.isObject(t)||e._isNullOrUndefined(t)?(r=t,e._objectEach(r,function(t,i){r[i]=e._decode(i,t)}),s=n):(r={},r[t]=e._decode(t,n)),s=s||{},!r)return this;r instanceof e.Object&&(r=r.attributes),s.unset&&e._objectEach(r,function(t,i){r[i]=new e.Op.Unset});var o=i.clone(r),a=this;if(e._objectEach(o,function(t,i){t instanceof e.Op&&(o[i]=t._estimate(a.attributes[i],a,i),o[i]===e.Op._UNSET&&delete o[i])}),!this._validate(r,s))return!1;this._mergeMagicFields(r),s.changes={};var u=this._escapedAttributes;return this._previousAttributes||{},e._arrayEach(i.keys(r),function(t){var n=r[t];n instanceof e.Relation&&(n.parent=a),n instanceof e.Op||(n=new e.Op.Set(n));var o=!0;n instanceof e.Op.Set&&i.isEqual(a.attributes[t],n.value)&&(o=!1),o&&(delete u[t],s.silent?a._silent[t]=!0:s.changes[t]=!0);var h=i.last(a._opSetQueue);h[t]=n._mergeWithPrevious(h[t]),a._rebuildEstimatedDataForKey(t),o?(a.changed[t]=a.attributes[t],s.silent||(a._pending[t]=!0)):(delete a.changed[t],delete a._pending[t])}),s.silent||this.change(s),this},unset:function(t,e){return e=e||{},e.unset=!0,this.set(t,null,e)},increment:function(t,n){return(i.isUndefined(n)||i.isNull(n))&&(n=1),this.set(t,new e.Op.Increment(n))},add:function(t,i){return this.set(t,new e.Op.Add([i]))},addUnique:function(t,i){return this.set(t,new e.Op.AddUnique([i]))},remove:function(t,i){return this.set(t,new e.Op.Remove([i]))},op:function(t){return i.last(this._opSetQueue)[t]},clear:function(t){t=t||{},t.unset=!0;var e=i.extend(this.attributes,this._operations);return this.set(e,t)},_getSaveJSON:function(){var t=i.clone(i.first(this._opSetQueue));return e._objectEach(t,function(e,i){t[i]=e.toJSON()}),t},_canBeSerialized:function(){return e.Object._canBeSerializedAsValue(this.attributes)},fetch:function(t){var i=this;t=t||{};var n=e._request({method:"GET",route:"classes",className:this.className,objectId:this.id,useMasterKey:t.useMasterKey});return n.then(function(t,e,n){return i._finishFetch(i.parse(t,e,n),!0),i})._thenRunCallbacks(t,this)},save:function(t,n,s){var r,o,a;if(i.isObject(t)||e._isNullOrUndefined(t)?(r=t,a=n):(r={},r[t]=n,a=s),!a&&r){var u=i.reject(r,function(t,e){return i.include(["success","error","wait"],e)});if(0===u.length){var h=!0;if(i.has(r,"success")&&!i.isFunction(r.success)&&(h=!1),i.has(r,"error")&&!i.isFunction(r.error)&&(h=!1),h)return this.save(null,r)}}a=i.clone(a)||{},a.wait&&(o=i.clone(this.attributes));var c=i.clone(a)||{};c.wait&&(c.silent=!0);var l;if(c.error=function(t,e){l=e},r&&!this.set(r,c))return e.Promise.error(l)._thenRunCallbacks(a,this);var p=this;p._refreshCache();var d=[],f=[];return e.Object._findUnsavedChildren(p.attributes,d,f),d.length+f.length>0?e.Object._deepSaveAsync(this.attributes,{useMasterKey:a.useMasterKey}).then(function(){return p.save(null,a)},function(t){return e.Promise.error(t)._thenRunCallbacks(a,p)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||e.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var t=p.id?"PUT":"POST",n=p._getSaveJSON(),s="classes",u=p.className;"_User"!==p.className||p.id||(s="users",u=null);var h=e._request({route:s,className:u,objectId:p.id,method:t,useMasterKey:a.useMasterKey,data:n});return h=h.then(function(t,e,n){var s=p.parse(t,e,n);return a.wait&&(s=i.extend(r||{},s)),p._finishSave(s),a.wait&&p.set(o,c),p},function(t){return p._cancelSave(),e.Promise.error(t)})._thenRunCallbacks(a,p)}),this._allPreviousSaves)},destroy:function(t){t=t||{};var i=this,n=function(){i.trigger("destroy",i,i.collection,t)};if(!this.id)return n();t.wait||n();var s=e._request({route:"classes",className:this.className,objectId:this.id,method:"DELETE",useMasterKey:t.useMasterKey});return s.then(function(){return t.wait&&n(),i})._thenRunCallbacks(t,this)},parse:function(t,n){var s=i.clone(t);return i(["createdAt","updatedAt"]).each(function(t){s[t]&&(s[t]=e._parseDate(s[t]))}),s.updatedAt||(s.updatedAt=s.createdAt),n&&(this._existed=201!==n),s},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(t){t=t||{};var n=this._changing;this._changing=!0;var s=this;e._objectEach(this._silent,function(t){s._pending[t]=!0});var r=i.extend({},t.changes,this._silent);if(this._silent={},e._objectEach(r,function(e,i){s.trigger("change:"+i,s,s.get(i),t)}),n)return this;for(var o=function(t,e){s._pending[e]||s._silent[e]||delete s.changed[e]};!i.isEmpty(this._pending);)this._pending={},this.trigger("change",this,t),e._objectEach(this.changed,o),s._previousAttributes=i.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(t){return arguments.length?this.changed&&i.has(this.changed,t):!i.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var n={},s=this._previousAttributes;return e._objectEach(t,function(t,e){i.isEqual(s[e],t)||(n[e]=t)}),n},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(t){if(i.has(t,"ACL")&&!(t.ACL instanceof e.ACL))return new e.Error(e.Error.OTHER_CAUSE,"ACL must be a Parse.ACL.");var n=!0;return e._objectEach(t,function(t,e){/^[A-Za-z][0-9A-Za-z_]*$/.test(e)||(n=!1)}),n?!1:new e.Error(e.Error.INVALID_KEY_NAME)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(t,e){return this.set("ACL",t,e)}}),e.Object._getSubclass=function(t){if(!i.isString(t))throw"Parse.Object._getSubclass requires a string argument.";var n=e.Object._classMap[t];return n||(n=e.Object.extend(t),e.Object._classMap[t]=n),n},e.Object._create=function(t,i,n){var s=e.Object._getSubclass(t);return new s(i,n)},e.Object._toObjectIdArray=function(t,i){if(0===t.length)return e.Promise.as(t);for(var n,s=t[0].className,r=[],o=0;o<t.length;o++){var a=t[o];if(s!==a.className)return n=new e.Error(e.Error.INVALID_CLASS_NAME,"All objects should be of the same class"),e.Promise.error(n);if(!a.id)return n=new e.Error(e.Error.MISSING_OBJECT_ID,"All objects must have an ID"),e.Promise.error(n);i&&a._hasData||r.push(a.id)}return e.Promise.as(r)},e.Object._updateWithFetchedResults=function(t,i,n){var s={};e._arrayEach(i,function(t){s[t.id]=t});for(var r=0;r<t.length;r++){var o=t[r],a=s[o.id];if(!a&&n){var u=new e.Error(e.Error.OBJECT_NOT_FOUND,"All objects must exist on the server");return e.Promise.error(u)}o._mergeFromObject(a)}return e.Promise.as(t)},e.Object._fetchAll=function(t,i){if(0===t.length)return e.Promise.as(t);var n=!i;return e.Object._toObjectIdArray(t,n).then(function(i){var n=t[0].className,s=new e.Query(n);return s.containedIn("objectId",i),s.limit=i.length,s.find()}).then(function(n){return e.Object._updateWithFetchedResults(t,n,i)})},e.Object._classMap={},e.Object._extend=e._extend,e.Object.extend=function(t,n,s){if(!i.isString(t)){if(t&&i.has(t,"className"))return e.Object.extend(t.className,t,n);throw new Error("Parse.Object.extend's first argument should be the className.")}"User"===t&&e.User._performUserRewrite&&(t="_User"),n=n||{},n.className=t;var r=null;if(i.has(e.Object._classMap,t)){var o=e.Object._classMap[t];r=o._extend(n,s)}else r=this._extend(n,s);return r.extend=function(n){if(i.isString(n)||n&&i.has(n,"className"))return e.Object.extend.apply(r,arguments);var s=[t].concat(e._.toArray(arguments));return e.Object.extend.apply(r,s)},e.Object._classMap[t]=r,r},e.Object._findUnsavedChildren=function(t,i,n){e._traverse(t,function(t){return t instanceof e.Object?(t._refreshCache(),void(t.dirty()&&i.push(t))):t instanceof e.File?void(t.url()||n.push(t)):void 0})},e.Object._canBeSerializedAsValue=function(t){if(t instanceof e.Object)return!!t.id;if(t instanceof e.File)return!0;var n=!0;return i.isArray(t)?e._arrayEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}):i.isObject(t)&&e._objectEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}),n},e.Object._deepSaveAsync=function(t,n){var s=[],r=[];e.Object._findUnsavedChildren(t,s,r);var o=e.Promise.as();i.each(r,function(t){o=o.then(function(){return t.save(n)})});var a=i.uniq(s),u=i.uniq(a);return o.then(function(){return e.Promise._continueWhile(function(){return u.length>0},function(){var t=[],s=[];if(e._arrayEach(u,function(e){return t.length>20?void s.push(e):void(e._canBeSerialized()?t.push(e):s.push(e))}),u=s,0===t.length)return e.Promise.error(new e.Error(e.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var r=e.Promise.when(i.map(t,function(t){return t._allPreviousSaves||e.Promise.as()})),o=new e.Promise;return e._arrayEach(t,function(t){t._allPreviousSaves=o}),r._continueWith(function(){return e._request({route:"batch",method:"POST",useMasterKey:n.useMasterKey,data:{requests:i.map(t,function(t){var e=t._getSaveJSON(),i="POST",n="/1/classes/"+t.className;return t.id&&(n=n+"/"+t.id,i="PUT"),t._startSave(),{method:i,path:n,body:e}})}}).then(function(i,n,s){var r;return e._arrayEach(t,function(t,e){i[e].success?t._finishSave(t.parse(i[e].success,n,s)):(r=r||i[e].error,t._cancelSave())}),r?e.Promise.error(new e.Error(r.code,r.error)):void 0}).then(function(t){return o.resolve(t),t},function(t){return o.reject(t),e.Promise.error(t)})})})}).then(function(){return t})}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Role=e.Object.extend("_Role",{constructor:function(t,n){i.isString(t)&&n instanceof e.ACL?(e.Object.prototype.constructor.call(this,null,null),this.setName(t),this.setACL(n)):e.Object.prototype.constructor.call(this,t,n)},getName:function(){return this.get("name")},setName:function(t,e){return this.set("name",t,e)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(t,n){if("name"in t&&t.name!==this.getName()){var s=t.name;if(this.id&&this.id!==t.objectId)return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!i.isString(s))return new e.Error(e.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(s))return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return e.Object.prototype.validate?e.Object.prototype.validate.call(this,t,n):!1}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Collection=function(t,e){e=e||{},e.comparator&&(this.comparator=e.comparator),e.model&&(this.model=e.model),e.query&&(this.query=e.query),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})},i.extend(e.Collection.prototype,e.Events,{model:e.Object,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,n){var s,r,o,a,u,h,c={},l={};for(n=n||{},t=i.isArray(t)?t.slice():[t],s=0,o=t.length;o>s;s++){if(t[s]=this._prepareModel(t[s],n),a=t[s],!a)throw new Error("Can't add an invalid model to a collection");if(u=a.cid,c[u]||this._byCid[u])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(h=a.id,!e._isNullOrUndefined(h)&&(l[h]||this._byId[h]))throw new Error("Duplicate id: can't add the same model to a collection twice");l[h]=a,c[u]=a}for(s=0;o>s;s++)(a=t[s]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,a.id&&(this._byId[a.id]=a);if(this.length+=o,r=e._isNullOrUndefined(n.at)?this.models.length:n.at,this.models.splice.apply(this.models,[r,0].concat(t)),this.comparator&&this.sort({silent:!0}),n.silent)return this;for(s=0,o=this.models.length;o>s;s++)a=this.models[s],c[a.cid]&&(n.index=s,a.trigger("add",a,this,n));return this},remove:function(t,e){var n,s,r,o;for(e=e||{},t=i.isArray(t)?t.slice():[t],n=0,s=t.length;s>n;n++)o=this.getByCid(t[n])||this.get(t[n]),o&&(delete this._byId[o.id],delete this._byCid[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,e.silent||(e.index=r,o.trigger("remove",o,this,e)),this._removeReference(o));return this},get:function(t){return t&&this._byId[t.id||t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t=t||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=i.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return i.map(this.models,function(e){return e.get(t)})},reset:function(t,i){var n=this;return t=t||[],i=i||{},e._arrayEach(this.models,function(t){n._removeReference(t)}),this._reset(),this.add(t,{silent:!0,parse:i.parse}),i.silent||this.trigger("reset",this,i),this},fetch:function(t){t=i.clone(t)||{},void 0===t.parse&&(t.parse=!0);var n=this,s=this.query||new e.Query(this.model);return s.find({useMasterKey:t.useMasterKey}).then(function(e){return t.add?n.add(e,t):n.reset(e,t),n})._thenRunCallbacks(t,this)},create:function(t,e){var n=this;if(e=e?i.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||n.add(t,e);var s=e.success;return e.success=function(i,r){e.wait&&n.add(i,e),s?s(i,r):i.trigger("sync",t,r,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return i(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,i){if(t instanceof e.Object)t.collection||(t.collection=this);else{var n=t;i.collection=this,t=new this.model(n,i),t._validate(t.attributes,i)||(t=!1)}return t},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&"change:objectId"===t&&(delete this._byId[e.previous("objectId")],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];e._arrayEach(n,function(t){e.Collection.prototype[t]=function(){return i[t].apply(i,[this.models].concat(i.toArray(arguments)))}}),e.Collection.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.View=function(t){this.cid=i.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var n=/^(\S+)\s*(.*)$/,s=["model","collection","el","id","attributes","className","tagName"];i.extend(e.View.prototype,e.Events,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,i,n){var s=document.createElement(t);return i&&e.$(s).attr(i),n&&e.$(s).html(n),s},setElement:function(t,i){return this.$el=e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t=t||e._getValue(this,"events")){this.undelegateEvents();var s=this;e._objectEach(t,function(e,r){if(i.isFunction(e)||(e=s[t[r]]),!e)throw new Error('Event "'+t[r]+'" does not exist');
var o=r.match(n),a=o[1],u=o[2];e=i.bind(e,s),a+=".delegateEvents"+s.cid,""===u?s.$el.bind(a,e):s.$el.delegate(u,a,e)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=i.extend({},this.options,t));var e=this;i.each(s,function(i){t[i]&&(e[i]=t[i])}),this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=e._getValue(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),e.View.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.User=e.Object.extend("_User",{_isCurrentUser:!1,_mergeFromObject:function(t){t.getSessionToken()&&(this._sessionToken=t.getSessionToken()),e.User.__super__._mergeFromObject.call(this,t)},_mergeMagicFields:function(t){t.sessionToken&&(this._sessionToken=t.sessionToken,delete t.sessionToken),e.User.__super__._mergeMagicFields.call(this,t)},_cleanupAuthData:function(){if(this.isCurrent()){var t=this.get("authData");t&&e._objectEach(this.get("authData"),function(e,i){t[i]||delete t[i]})}},_synchronizeAllAuthData:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._synchronizeAuthData(e)})}},_synchronizeAuthData:function(t){if(this.isCurrent()){var n;i.isString(t)?(n=t,t=e.User._authProviders[n]):n=t.getAuthType();var s=this.get("authData");if(s&&t){var r=t.restoreAuthentication(s[n]);r||this._unlinkFrom(t)}}},_handleSaveResult:function(t){t&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(t||this.isCurrent())&&e.User._saveCurrentUser(this)},_linkWith:function(t,n){var s;if(i.isString(t)?(s=t,t=e.User._authProviders[t]):s=t.getAuthType(),i.has(n,"authData")){var r=this.get("authData")||{};r[s]=n.authData,this.set("authData",r);var o=i.clone(n)||{};return o.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save({authData:r},o)}var a=this,u=new e.Promise;return t.authenticate({success:function(t,e){a._linkWith(t,{authData:e,success:n.success,error:n.error}).then(function(){u.resolve(a)})},error:function(t,e){n.error&&n.error(a,e),u.reject(e)}}),u},_unlinkFrom:function(t,n){var s;i.isString(t)?(s=t,t=e.User._authProviders[t]):s=t.getAuthType();var r=i.clone(n),o=this;return r.authData=null,r.success=function(){o._synchronizeAuthData(t),n.success&&n.success.apply(this,arguments)},this._linkWith(t,r)},_isLinked:function(t){var e;e=i.isString(t)?t:t.getAuthType();var n=this.get("authData")||{};return!!n[e]},_logOutWithAll:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._logOutWith(e)})}},_logOutWith:function(t){this.isCurrent()&&(i.isString(t)&&(t=e.User._authProviders[t]),t&&t.deauthenticate&&t.deauthenticate())},signUp:function(t,n){var s;n=n||{};var r=t&&t.username||this.get("username");if(!r||""===r)return s=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),n&&n.error&&n.error(this,s),e.Promise.error(s);var o=t&&t.password||this.get("password");if(!o||""===o)return s=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),n&&n.error&&n.error(this,s),e.Promise.error(s);var a=i.clone(n);return a.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save(t,a)},logIn:function(t){var i=this;t=t||{};var n=e._request({route:"login",method:"GET",useMasterKey:t.useMasterKey,data:this.toJSON()});return n.then(function(t,e,n){var s=i.parse(t,e,n);return i._finishFetch(s),i._handleSaveResult(!0),i})._thenRunCallbacks(t,this)},save:function(t,n,s){var r,o;i.isObject(t)||i.isNull(t)||i.isUndefined(t)?(r=t,o=n):(r={},r[t]=n,o=s),o=o||{};var a=i.clone(o);return a.success=function(t){t._handleSaveResult(!1),o.success&&o.success.apply(this,arguments)},e.Object.prototype.save.call(this,r,a)},fetch:function(t){var n=t?i.clone(t):{};return n.success=function(e){e._handleSaveResult(!1),t&&t.success&&t.success.apply(this,arguments)},e.Object.prototype.fetch.call(this,n)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(t,e){return this.set("username",t,e)},setPassword:function(t,e){return this.set("password",t,e)},getEmail:function(){return this.get("email")},setEmail:function(t,e){return this.set("email",t,e)},authenticated:function(){return!!this._sessionToken&&e.User.current()&&e.User.current().id===this.id},getSessionToken:function(){return this._sessionToken}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},_performUserRewrite:!0,signUp:function(t,i,n,s){n=n||{},n.username=t,n.password=i;var r=e.Object._create("_User");return r.signUp(n,s)},logIn:function(t,i,n){var s=e.Object._create("_User");return s._finishFetch({username:t,password:i}),s.logIn(n)},become:function(t,i){i=i||{};var n=e.Object._create("_User");return e._request({route:"users",className:"me",method:"GET",useMasterKey:i.useMasterKey,sessionToken:t}).then(function(t,e,i){var s=n.parse(t,e,i);return n._finishFetch(s),n._handleSaveResult(!0),n})._thenRunCallbacks(i,n)},logOut:function(){null!==e.User._currentUser&&(e.User._currentUser._logOutWithAll(),e.User._currentUser._isCurrentUser=!1),e.User._currentUserMatchesDisk=!0,e.User._currentUser=null,e.localStorage.removeItem(e._getParsePath(e.User._CURRENT_USER_KEY))},requestPasswordReset:function(t,i){i=i||{};var n=e._request({route:"requestPasswordReset",method:"POST",useMasterKey:i.useMasterKey,data:{email:t}});return n._thenRunCallbacks(i)},current:function(){if(e.User._currentUser)return e.User._currentUser;if(e.User._currentUserMatchesDisk)return e.User._currentUser;e.User._currentUserMatchesDisk=!0;var t=e.localStorage.getItem(e._getParsePath(e.User._CURRENT_USER_KEY));if(!t)return null;e.User._currentUser=e.Object._create("_User"),e.User._currentUser._isCurrentUser=!0;var i=JSON.parse(t);return e.User._currentUser.id=i._id,delete i._id,e.User._currentUser._sessionToken=i._sessionToken,delete i._sessionToken,e.User._currentUser._finishFetch(i),e.User._currentUser._synchronizeAllAuthData(),e.User._currentUser._refreshCache(),e.User._currentUser._opSetQueue=[{}],e.User._currentUser},allowCustomUserClass:function(t){this._performUserRewrite=!t},_saveCurrentUser:function(t){e.User._currentUser!==t&&e.User.logOut(),t._isCurrentUser=!0,e.User._currentUser=t,e.User._currentUserMatchesDisk=!0;var i=t.toJSON();i._id=t.id,i._sessionToken=t._sessionToken,e.localStorage.setItem(e._getParsePath(e.User._CURRENT_USER_KEY),JSON.stringify(i))},_registerAuthenticationProvider:function(t){e.User._authProviders[t.getAuthType()]=t,e.User.current()&&e.User.current()._synchronizeAuthData(t.getAuthType())},_logInWith:function(t,i){var n=e.Object._create("_User");return n._linkWith(t,i)}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Query=function(t){i.isString(t)&&(t=e.Object._getSubclass(t)),this.objectClass=t,this.className=t.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},e.Query.or=function(){var t=i.toArray(arguments),n=null;e._arrayEach(t,function(t){if(i.isNull(n)&&(n=t.className),n!==t.className)throw"All queries must be for the same class"});var s=new e.Query(n);return s._orQuery(t),s},e.Query.prototype={get:function(t,n){var s=this;s.equalTo("objectId",t);var r={};return n&&i.has(n,"useMasterKey")&&(r={useMasterKey:n.useMasterKey}),s.first(r).then(function(t){if(t)return t;var i=new e.Error(e.Error.OBJECT_NOT_FOUND,"Object not found.");return e.Promise.error(i)})._thenRunCallbacks(n,null)},toJSON:function(){var t={where:this._where};return this._include.length>0&&(t.include=this._include.join(",")),this._select&&(t.keys=this._select.join(",")),this._limit>=0&&(t.limit=this._limit),this._skip>0&&(t.skip=this._skip),void 0!==this._order&&(t.order=this._order.join(",")),e._objectEach(this._extraOptions,function(e,i){t[i]=e}),t},find:function(t){var n=this;t=t||{};var s=e._request({route:"classes",className:this.className,method:"GET",useMasterKey:t.useMasterKey,data:this.toJSON()});return s.then(function(t){return i.map(t.results,function(i){var s;return s=t.className?new e.Object(t.className):new n.objectClass,s._finishFetch(i,!0),s})})._thenRunCallbacks(t)},count:function(t){var i=this;t=t||{};var n=this.toJSON();n.limit=0,n.count=1;var s=e._request({route:"classes",className:i.className,method:"GET",useMasterKey:t.useMasterKey,data:n});return s.then(function(t){return t.count})._thenRunCallbacks(t)},first:function(t){var n=this;t=t||{};var s=this.toJSON();s.limit=1;var r=e._request({route:"classes",className:this.className,method:"GET",useMasterKey:t.useMasterKey,data:s});return r.then(function(t){return i.map(t.results,function(i){var s;return s=t.className?new e.Object(t.className):new n.objectClass,s._finishFetch(i,!0),s})[0]})._thenRunCallbacks(t)},collection:function(t,n){return n=n||{},new e.Collection(t,i.extend(n,{model:this.objectClass,query:this}))},skip:function(t){return this._skip=t,this},limit:function(t){return this._limit=t,this},equalTo:function(t,n){return i.isUndefined(n)?this.doesNotExist(t):(this._where[t]=e._encode(n),this)},_addCondition:function(t,i,n){return this._where[t]||(this._where[t]={}),this._where[t][i]=e._encode(n),this},notEqualTo:function(t,e){return this._addCondition(t,"$ne",e),this},lessThan:function(t,e){return this._addCondition(t,"$lt",e),this},greaterThan:function(t,e){return this._addCondition(t,"$gt",e),this},lessThanOrEqualTo:function(t,e){return this._addCondition(t,"$lte",e),this},greaterThanOrEqualTo:function(t,e){return this._addCondition(t,"$gte",e),this},containedIn:function(t,e){return this._addCondition(t,"$in",e),this},notContainedIn:function(t,e){return this._addCondition(t,"$nin",e),this},containsAll:function(t,e){return this._addCondition(t,"$all",e),this},exists:function(t){return this._addCondition(t,"$exists",!0),this},doesNotExist:function(t){return this._addCondition(t,"$exists",!1),this},matches:function(t,e,i){return this._addCondition(t,"$regex",e),i||(i=""),e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),i&&i.length&&this._addCondition(t,"$options",i),this},matchesQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$inQuery",i),this},doesNotMatchQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$notInQuery",i),this},matchesKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$select",{key:e,query:n}),this},doesNotMatchKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$dontSelect",{key:e,query:n}),this},_orQuery:function(t){var e=i.map(t,function(t){return t.toJSON().where});return this._where.$or=e,this},_quote:function(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(t,e){return this._addCondition(t,"$regex",this._quote(e)),this},startsWith:function(t,e){return this._addCondition(t,"$regex","^"+this._quote(e)),this},endsWith:function(t,e){return this._addCondition(t,"$regex",this._quote(e)+"$"),this},ascending:function(){return this._order=[],this.addAscending.apply(this,arguments)},addAscending:function(){var t=this;return this._order||(this._order=[]),e._arrayEach(arguments,function(e){Array.isArray(e)&&(e=e.join()),t._order=t._order.concat(e.replace(/\s/g,"").split(","))}),this},descending:function(){return this._order=[],this.addDescending.apply(this,arguments)},addDescending:function(){var t=this;return this._order||(this._order=[]),e._arrayEach(arguments,function(e){Array.isArray(e)&&(e=e.join()),t._order=t._order.concat(i.map(e.replace(/\s/g,"").split(","),function(t){return"-"+t}))}),this},near:function(t,i){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),this._addCondition(t,"$nearSphere",i),this},withinRadians:function(t,e,i){return this.near(t,e),this._addCondition(t,"$maxDistance",i),this},withinMiles:function(t,e,i){return this.withinRadians(t,e,i/3958.8)},withinKilometers:function(t,e,i){return this.withinRadians(t,e,i/6371)},withinGeoBox:function(t,i,n){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),n instanceof e.GeoPoint||(n=new e.GeoPoint(n)),this._addCondition(t,"$within",{$box:[i,n]}),this},include:function(){var t=this;return e._arrayEach(arguments,function(e){i.isArray(e)?t._include=t._include.concat(e):t._include.push(e)}),this},select:function(){var t=this;return this._select=this._select||[],e._arrayEach(arguments,function(e){i.isArray(e)?t._select=t._select.concat(e):t._select.push(e)}),this},each:function(t,n){if(n=n||{},this._order||this._skip||this._limit>=0){var s="Cannot iterate on a query with sort, skip, or limit.";return e.Promise.error(s)._thenRunCallbacks(n)}new e.Promise;var r=new e.Query(this.objectClass);r._limit=n.batchSize||100,r._where=i.clone(this._where),r._include=i.clone(this._include),r.ascending("objectId");var o={};i.has(n,"useMasterKey")&&(o.useMasterKey=n.useMasterKey);var a=!1;return e.Promise._continueWhile(function(){return!a},function(){return r.find(o).then(function(i){var n=e.Promise.as();return e._.each(i,function(e){n=n.then(function(){return t(e)})}),n.then(function(){i.length>=r._limit?r.greaterThan("objectId",i[i.length-1].id):a=!0})})})._thenRunCallbacks(n)}}}(this),function(t){t.Parse=t.Parse||{};var e,i,n=t.Parse,s=n._,r=!1,o={authenticate:function(t){var i=this;FB.login(function(e){e.authResponse?t.success&&t.success(i,{id:e.authResponse.userID,access_token:e.authResponse.accessToken,expiration_date:new Date(1e3*e.authResponse.expiresIn+(new Date).getTime()).toJSON()}):t.error&&t.error(i,e)},{scope:e})},restoreAuthentication:function(t){if(t){var e={userID:t.id,accessToken:t.access_token,expiresIn:(n._parseDate(t.expiration_date).getTime()-(new Date).getTime())/1e3},r=s.clone(i);r.authResponse=e,r.status=!1;var o=FB.getAuthResponse();o&&o.userID!==e.userID&&FB.logout(),FB.init(r)}return!0},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null)}};n.FacebookUtils={init:function(t){if("undefined"==typeof FB)throw"The Facebook JavaScript SDK must be loaded before calling init.";if(i=s.clone(t)||{},i.status&&"undefined"!=typeof console){var e=console.warn||console.log||function(){};e.call(console,"The 'status' flag passed into FB.init, when set to true, can interfere with Parse Facebook integration, so it has been suppressed. Please call FB.getLoginStatus() explicitly if you require this behavior.")}i.status=!1,FB.init(i),n.User._registerAuthenticationProvider(o),r=!0},isLinked:function(t){return t._isLinked("facebook")},logIn:function(t,i){if(!t||s.isString(t)){if(!r)throw"You must initialize FacebookUtils before calling logIn.";return e=t,n.User._logInWith("facebook",i)}var o=s.clone(i)||{};return o.authData=t,n.User._logInWith("facebook",o)},link:function(t,i,n){if(!i||s.isString(i)){if(!r)throw"You must initialize FacebookUtils before calling link.";return e=i,t._linkWith("facebook",n)}var o=s.clone(n)||{};return o.authData=i,t._linkWith("facebook",o)},unlink:function(t,e){if(!r)throw"You must initialize FacebookUtils before calling unlink.";return t._unlinkFrom("facebook",e)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl")};var n=/^[#\/]/,s=/msie [\w.]+/;e.History.started=!1,i.extend(e.History.prototype,e.Events,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,i){if(e._isNullOrUndefined(t))if(this._hasPushState||i){t=window.location.pathname;var s=window.location.search;s&&(t+=s)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(n,"")},start:function(t){if(e.History.started)throw new Error("Parse.history has already been started");e.History.started=!0,this.options=i.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var r=this.getFragment(),o=document.documentMode,a=s.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);a&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?e.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?e.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=window.location,h=u.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&h&&u.hash&&(this.fragment=this.getHash().replace(n,""),window.history.replaceState({},document.title,u.protocol+"//"+u.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),e.History.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,i){if(!e.History.started)return!1;i&&i!==!0||(i={trigger:i});var s=(t||"").replace(n,"");if(this.fragment!==s){if(this._hasPushState){0!==s.indexOf(this.options.root)&&(s=this.options.root+s),this.fragment=s;var r=i.replace?"replaceState":"pushState";window.history[r]({},document.title,s)}else this._wantsHashChange?(this.fragment=s,this._updateHash(window.location,s,i.replace),this.iframe&&s!==this.getFragment(this.getHash(this.iframe))&&(i.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,s,i.replace))):window.location.assign(this.options.root+t);i.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,i){if(i){var n=t.toString().replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash=e}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Router=function(t){t=t||{},t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var n=/:\w+/g,s=/\*\w+/g,r=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;i.extend(e.Router.prototype,e.Events,{initialize:function(){},route:function(t,n,s){return e.history=e.history||new e.History,i.isRegExp(t)||(t=this._routeToRegExp(t)),s||(s=this[n]),e.history.route(t,i.bind(function(i){var r=this._extractParameters(t,i);s&&s.apply(this,r),this.trigger.apply(this,["route:"+n].concat(r)),e.history.trigger("route",this,n,r)},this)),this},navigate:function(t,i){e.history.navigate(t,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)this.routes.hasOwnProperty(e)&&t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(r,"\\$&").replace(n,"([^/]+)").replace(s,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),e.Router.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Cloud=e.Cloud||{},i.extend(e.Cloud,{run:function(t,i,n){n=n||{};var s=e._request({route:"functions",className:t,method:"POST",useMasterKey:n.useMasterKey,data:e._encode(i,null,!0)});return s.then(function(t){return e._decode(null,t).result})._thenRunCallbacks(n)}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse;e.Installation=e.Object.extend("_Installation"),e.Push=e.Push||{},e.Push.send=function(t,i){if(i=i||{},t.where&&(t.where=t.where.toJSON().where),t.push_time&&(t.push_time=t.push_time.toJSON()),t.expiration_time&&(t.expiration_time=t.expiration_time.toJSON()),t.expiration_time&&t.expiration_interval)throw"Both expiration_time and expiration_interval can't be set";var n=e._request({route:"push",method:"POST",data:t,useMasterKey:i.useMasterKey});return n._thenRunCallbacks(i)}}(this),i("parse",function(t){return function(){var e;return e||t.Parse}}(this)),function(){function t(t,i,n,s){return new e(t,i,n,s)}function e(t,e,i,s){this.options=s||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=i,this.objectPath=[],this.parse(),n(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function n(t){return"object"==typeof t&&null!==t}function s(t){throw new Error("[sightglass] "+t)}t.adapters={},e.tokenize=function(t,e,i){var n,s,r=[],o={i:i,path:""};for(n=0;n<t.length;n++)s=t.charAt(n),~e.indexOf(s)?(r.push(o),o={i:s,path:""}):o.path+=s;return r.push(o),r},e.prototype.parse=function(){var i,n,r=this.interfaces();r.length||s("Must define at least one adapter interface."),~r.indexOf(this.keypath[0])?(i=this.keypath[0],n=this.keypath.substr(1)):("undefined"==typeof(i=this.options.root||t.root)&&s("Must define a default root adapter."),n=this.keypath),this.tokens=e.tokenize(n,r,i),this.key=this.tokens.pop()},e.prototype.realize=function(){var t,e=this.obj,i=!1;return this.tokens.forEach(function(s,r){n(e)?("undefined"!=typeof this.objectPath[r]?e!==(t=this.objectPath[r])&&(this.set(!1,s,t,this.update.bind(this)),this.set(!0,s,e,this.update.bind(this)),this.objectPath[r]=e):(this.set(!0,s,e,this.update.bind(this)),this.objectPath[r]=e),e=this.get(s,e)):(i===!1&&(i=r),(t=this.objectPath[r])&&this.set(!1,s,t,this.update.bind(this)))},this),i!==!1&&this.objectPath.splice(i),e},e.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(n(this.target)&&this.set(!1,this.key,this.target,this.callback),n(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,this.value()!==e&&this.callback())},e.prototype.value=function(){return n(this.target)?this.get(this.key,this.target):void 0},e.prototype.setValue=function(t){n(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},e.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},e.prototype.set=function(t,e,i,n){var s=t?"observe":"unobserve";this.adapter(e)[s](i,e.path,n)},e.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(t.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},e.prototype.adapter=function(e){return this.options.adapters[e.i]||t.adapters[e.i]},e.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,i){(t=this.objectPath[i])&&this.set(!1,e,t,this.update.bind(this))},this),n(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof i&&i.amd?i("sightglass",[],function(){return this.sightglass=t}):this.sightglass=t}.call(this),function(){var t,n,s,r,o=function(t,e){return function(){return t.apply(e,arguments)}},a=[].slice,u={}.hasOwnProperty,h=function(t,e){function i(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},c=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};t={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,i){return this.call(t,e,i.view.models)},configure:function(e){var i,n,s,r;null==e&&(e={});for(s in e)if(r=e[s],"binders"===s||"components"===s||"formatters"===s||"adapters"===s)for(n in r)i=r[n],t[s][n]=i;else t["public"][s]=r},bind:function(e,i,n){var s;return null==i&&(i={}),null==n&&(n={}),s=new t.View(e,i,n),s.bind(),s}}},window.jQuery||window.$?(r="on"in jQuery.prototype?["on","off"]:["bind","unbind"],n=r[0],s=r[1],t.Util={bindEvent:function(t,e,i){return jQuery(t)[n](e,i)},unbindEvent:function(t,e,i){return jQuery(t)[s](e,i)},getInputValue:function(t){var e;return e=jQuery(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):t.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,i){return t.removeEventListener(e,i,!1)}:function(t,e,i){return t.detachEvent("on"+e,i)}}(),getInputValue:function(t){var e,i,n,s;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(s=[],i=0,n=t.length;n>i;i++)e=t[i],e.selected&&s.push(e.value);return s}return t.value}},t.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:isNaN(Number(t))===!1?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var i,n,s,r,o,a,u;for(a=[],r=t.length,i=0,n=0;r>n;){if(i=t.indexOf(e[0],n),0>i){a.push({type:this.types.text,value:t.slice(n)});break}if(i>0&&i>n&&a.push({type:this.types.text,value:t.slice(n,i)}),n=i+e[0].length,i=t.indexOf(e[1],n),0>i){o=t.slice(n-e[1].length),s=a[a.length-1],(null!=s?s.type:void 0)===this.types.text?s.value+=o:a.push({type:this.types.text,value:o});break}u=t.slice(n,i).trim(),a.push({type:this.types.binding,value:u}),n=i+e[1].length}return a},t}(),t.View=function(){function e(e,i,n){var s,r,a,u,h,c,l,p,d,f,m,_;for(this.els=e,this.models=i,null==n&&(n={}),this.update=o(this.update,this),this.publish=o(this.publish,this),this.sync=o(this.sync,this),this.unbind=o(this.unbind,this),this.bind=o(this.bind,this),this.select=o(this.select,this),this.build=o(this.build,this),this.componentRegExp=o(this.componentRegExp,this),this.bindingRegExp=o(this.bindingRegExp,this),this.options=o(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),d=t.extensions,h=0,l=d.length;l>h;h++){if(r=d[h],this[r]={},n[r]){f=n[r];for(s in f)a=f[s],this[r][s]=a}m=t["public"][r];for(s in m)a=m[s],null==(u=this[r])[s]&&(u[s]=a)}for(_=t.options,c=0,p=_.length;p>c;c++)r=_[c],this[r]=n[r]||t["public"][r];this.build()}return e.prototype.options=function(){var e,i,n,s,r;for(i={},r=t.extensions.concat(t.options),n=0,s=r.length;s>n;n++)e=r[n],i[e]=this[e];return i},e.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},e.prototype.componentRegExp=function(){return new RegExp("^"+this.prefix.toUpperCase()+"-")},e.prototype.build=function(){var e,i,n,s,r,o,a,u;for(this.bindings=[],e=this.bindingRegExp(),n=this.componentRegExp(),i=function(e){return function(i,n,s,r){var o,a,u,h,c,l,p;return c={},p=function(){var t,e,i,n;for(i=r.split("|"),n=[],t=0,e=i.length;e>t;t++)l=i[t],n.push(l.trim());return n}(),o=function(){var t,e,i,n;for(i=p.shift().split("<"),n=[],t=0,e=i.length;e>t;t++)a=i[t],n.push(a.trim());return n}(),h=o.shift(),c.formatters=p,(u=o.shift())&&(c.dependencies=u.split(/\s+/)),e.bindings.push(new t[i](e,n,s,h,c))}}(this),r=function(s){return function(o){var a,u,h,c,l,p,d,f,m,_,g,v,y,b,x,w,E,S,T,C,A,P,O,R,I,M,D,L;if(3===o.nodeType){if(m=t.TextTemplateParser,(p=s.templateDelimiters)&&(y=m.parse(o.data,p)).length&&(1!==y.length||y[0].type!==m.types.text)){for(w=0,C=y.length;C>w;w++)v=y[w],g=document.createTextNode(v.value),o.parentNode.insertBefore(g,o),1===v.type&&i("TextBinding",g,null,v.value);o.parentNode.removeChild(o)}}else if(1===o.nodeType)if(n.test(o.nodeName))b=o.nodeName.replace(n,"").toLowerCase(),s.bindings.push(new t.ComponentBinding(s,o,b));else{for(c="SCRIPT"===o.nodeName||"STYLE"===o.nodeName,R=o.attributes,E=0,A=R.length;A>E;E++)if(a=R[E],e.test(a.name)){if(b=a.name.replace(e,""),!(h=s.binders[b])){I=s.binders;for(d in I)x=I[d],"*"!==d&&-1!==d.indexOf("*")&&(_=new RegExp("^"+d.replace(/\*/g,".+")+"$"),_.test(b)&&(h=x))}h||(h=s.binders["*"]),h.block&&(c=!0,u=[a])}for(M=u||o.attributes,S=0,P=M.length;P>S;S++)a=M[S],e.test(a.name)&&(b=a.name.replace(e,""),i("Binding",o,b,a.value))}if(!c){for(D=function(){var t,e,i,n;for(i=o.childNodes,n=[],e=0,t=i.length;t>e;e++)f=i[e],n.push(f);return n}(),L=[],T=0,O=D.length;O>T;T++)l=D[T],L.push(r(l));return L}}}(this),u=this.els,o=0,a=u.length;a>o;o++)s=u[o],r(s);this.bindings.sort(function(t,e){var i,n;return((null!=(i=e.binder)?i.priority:void 0)||0)-((null!=(n=t.binder)?n.priority:void 0)||0)})},e.prototype.select=function(t){var e,i,n,s,r;for(s=this.bindings,r=[],i=0,n=s.length;n>i;i++)e=s[i],t(e)&&r.push(e);return r},e.prototype.bind=function(){var t,e,i,n,s;for(n=this.bindings,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.bind());return s},e.prototype.unbind=function(){var t,e,i,n,s;for(n=this.bindings,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.unbind());return s},e.prototype.sync=function(){var t,e,i,n,s;for(n=this.bindings,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.sync());return s},e.prototype.publish=function(){var t,e,i,n,s;for(n=this.select(function(t){return t.binder.publishes}),s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.publish());return s},e.prototype.update=function(t){var e,i,n,s,r,o,a;null==t&&(t={});for(i in t)n=t[i],this.models[i]=n;for(o=this.bindings,a=[],s=0,r=o.length;r>s;s++)e=o[s],a.push(e.update(t));return a},e}(),t.Binding=function(){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.getValue=o(this.getValue,this),this.update=o(this.update,this),this.unbind=o(this.unbind,this),this.bind=o(this.bind,this),this.publish=o(this.publish,this),this.sync=o(this.sync,this),this.set=o(this.set,this),this.eventHandler=o(this.eventHandler,this),this.formattedValue=o(this.formattedValue,this),this.parseTarget=o(this.parseTarget,this),this.observe=o(this.observe,this),this.setBinder=o(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return e.prototype.setBinder=function(){var t,e,i,n;if(!(this.binder=this.view.binders[this.type])){n=this.view.binders;for(t in n)i=n[t],"*"!==t&&-1!==t.indexOf("*")&&(e=new RegExp("^"+t.replace(/\*/g,".+")+"$"),e.test(this.type)&&(this.binder=i,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},e.prototype.observe=function(e,i,n){return t.sightglass(e,i,n,{root:this.view.rootInterface,adapters:this.view.adapters})},e.prototype.parseTarget=function(){var e;return e=t.TypeParser.parse(this.keypath),0===e.type?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},e.prototype.formattedValue=function(e){var i,n,s,r,o,u,h,c,l,p,d,f,m,_;for(_=this.formatters,r=p=0,f=_.length;f>p;r=++p){for(o=_[r],s=o.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),u=s.shift(),o=this.view.formatters[u],s=function(){var e,i,r;for(r=[],e=0,i=s.length;i>e;e++)n=s[e],r.push(t.TypeParser.parse(n));return r}(),c=[],i=d=0,m=s.length;m>d;i=++d)n=s[i],c.push(0===n.type?n.value:((l=this.formatterObservers)[r]||(l[r]={}),(h=this.formatterObservers[r][i])?void 0:(h=this.observe(this.view.models,n.value,this.sync),this.formatterObservers[r][i]=h),h.value()));
(null!=o?o.read:void 0)instanceof Function?e=o.read.apply(o,[e].concat(a.call(c))):o instanceof Function&&(e=o.apply(null,[e].concat(a.call(c))))}return e},e.prototype.eventHandler=function(t){var e,i;return i=(e=this).view.handler,function(n){return i.call(t,this,n,e)}},e.prototype.set=function(t){var e;return t=this.formattedValue(t instanceof Function&&!this.binder["function"]?t.call(this.model):t),null!=(e=this.binder.routine)?e.call(this,this.el,t):void 0},e.prototype.sync=function(){var t,e;return this.set(function(){var i,n,s,r,o,a,u;if(this.observer){if(this.model!==this.observer.target){for(o=this.dependencies,i=0,s=o.length;s>i;i++)e=o[i],e.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(a=this.options.dependencies)?a.length:void 0))for(u=this.options.dependencies,n=0,r=u.length;r>n;n++)t=u[n],e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},e.prototype.publish=function(){var t,e,i,n,s,r,o,u,h;if(this.observer){for(n=this.getValue(this.el),o=this.formatters.slice(0).reverse(),s=0,r=o.length;r>s;s++)e=o[s],t=e.split(/\s+/),i=t.shift(),(null!=(u=this.view.formatters[i])?u.publish:void 0)&&(n=(h=this.view.formatters[i]).publish.apply(h,[n].concat(a.call(t))));return this.observer.setValue(n)}},e.prototype.bind=function(){var t,e,i,n,s,r,o;if(this.parseTarget(),null!=(s=this.binder.bind)&&s.call(this,this.el),null!=this.model&&(null!=(r=this.options.dependencies)?r.length:void 0))for(o=this.options.dependencies,i=0,n=o.length;n>i;i++)t=o[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);return this.view.preloadData?this.sync():void 0},e.prototype.unbind=function(){var t,e,i,n,s,r,o,a,u,h;for(null!=(o=this.binder.unbind)&&o.call(this,this.el),null!=(a=this.observer)&&a.unobserve(),u=this.dependencies,s=0,r=u.length;r>s;s++)n=u[s],n.unobserve();this.dependencies=[],h=this.formatterObservers;for(i in h){e=h[i];for(t in e)n=e[t],n.unobserve()}return this.formatterObservers={}},e.prototype.update=function(t){var e,i;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,this.unbind(),null!=(i=this.binder.update)&&i.call(this,t),this.bind()},e.prototype.getValue=function(e){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,e):t.Util.getInputValue(e)},e}(),t.ComponentBinding=function(e){function i(t,e,i){var n,s,r,a,u;for(this.view=t,this.el=e,this.type=i,this.unbind=o(this.unbind,this),this.bind=o(this.bind,this),this.update=o(this.update,this),this.locals=o(this.locals,this),this.component=this.view.components[this.type],this.attributes={},this.inflections={},a=this.el.attributes||[],s=0,r=a.length;r>s;s++)n=a[s],u=n.name,c.call(this.component.attributes,u)>=0?this.attributes[n.name]=n.value:this.inflections[n.name]=n.value}return h(i,e),i.prototype.sync=function(){},i.prototype.locals=function(t){var e,i,n,s,r,o,a,u,h;null==t&&(t=this.view.models),r={},u=this.inflections;for(i in u)for(e=u[i],h=e.split("."),o=0,a=h.length;a>o;o++)s=h[o],r[i]=(r[i]||t)[s];for(i in t)n=t[i],null==r[i]&&(r[i]=n);return r},i.prototype.update=function(t){var e;return null!=(e=this.componentView)?e.update(this.locals(t)):void 0},i.prototype.bind=function(){var e,i;return null!=this.componentView?null!=(i=this.componentView)?i.bind():void 0:(e=this.component.build.call(this.attributes),(this.componentView=new t.View(e,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(e,this.el))},i.prototype.unbind=function(){var t;return null!=(t=this.componentView)?t.unbind():void 0},i}(t.Binding),t.TextBinding=function(t){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.sync=o(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return h(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(t.Binding),t["public"].binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t["public"].binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t["public"].binders.show=function(t,e){return t.style.display=e?"":"none"},t["public"].binders.hide=function(t,e){return t.style.display=e?"none":""},t["public"].binders.enabled=function(t,e){return t.disabled=!e},t["public"].binders.disabled=function(t,e){return t.disabled=!!e},t["public"].binders.checked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return t.checked="radio"===t.type?(null!=(i=t.value)?i.toString():void 0)===(null!=e?e.toString():void 0):!!e}},t["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return t.checked="radio"===t.type?(null!=(i=t.value)?i.toString():void 0)!==(null!=e?e.toString():void 0):!e}},t["public"].binders.value={publishes:!0,priority:2e3,bind:function(e){return this.event="SELECT"===e.tagName?"change":"input",t.Util.bindEvent(e,this.event,this.publish)},unbind:function(e){return t.Util.unbindEvent(e,this.event,this.publish)},routine:function(t,e){var i,n,s,r,o,a,u;if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(r=t.val())?r.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(u=[],n=0,s=t.length;s>n;n++)i=t[n],u.push(i.selected=(o=i.value,c.call(e,o)>=0));return u}}else if((null!=e?e.toString():void 0)!==(null!=(a=t.value)?a.toString():void 0))return t.value=null!=e?e:""}},t["public"].binders["if"]={block:!0,priority:3e3,bind:function(t){var e,i;return null==this.marker?(e=[this.view.prefix,this.type].join("-").replace("--","-"),i=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0},unbind:function(){var t;return null!=(t=this.nested)?t.unbind():void 0},routine:function(e,i){var n,s,r,o;if(!!i==!this.bound){if(i){r={},o=this.view.models;for(n in o)s=o[n],r[n]=s;return(this.nested||(this.nested=new t.View(e,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0}return e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t["public"].binders.unless={block:!0,priority:3e3,bind:function(e){return t["public"].binders["if"].bind.call(this,e)},unbind:function(){return t["public"].binders["if"].unbind.call(this)},routine:function(e,i){return t["public"].binders["if"].routine.call(this,e,!i)},update:function(e){return t["public"].binders["if"].update.call(this,e)}},t["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(e){return this.handler?t.Util.unbindEvent(e,this.args[0],this.handler):void 0},routine:function(e,i){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(i))}},t["public"].binders["each-*"]={block:!0,priority:3e3,bind:function(t){var e,i,n,s,r;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(r=this.iterated,n=0,s=r.length;s>n;n++)i=r[n],i.bind()},unbind:function(){var t,e,i,n,s;if(null!=this.iterated){for(n=this.iterated,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.unbind());return s}},routine:function(e,i){var n,s,r,o,a,u,h,c,l,p,d,f,m,_,g,v,y,b,x,w,E;if(h=this.args[0],i=i||[],this.iterated.length>i.length)for(b=Array(this.iterated.length-i.length),f=0,g=b.length;g>f;f++)r=b[f],d=this.iterated.pop(),d.unbind(),this.marker.parentNode.removeChild(d.els[0]);for(o=m=0,v=i.length;v>m;o=++m)if(u=i[o],s={index:o},s[h]=u,null==this.iterated[o]){x=this.view.models;for(a in x)u=x[a],null==s[a]&&(s[a]=u);l=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,c=this.view.options(),c.preloadData=!0,p=e.cloneNode(!0),d=new t.View(p,s,c),d.bind(),this.iterated.push(d),this.marker.parentNode.insertBefore(p,l.nextSibling)}else this.iterated[o].models[h]!==u&&this.iterated[o].update(s);if("OPTION"===e.nodeName){for(w=this.view.bindings,E=[],_=0,y=w.length;y>_;_++)n=w[_],E.push(n.el===this.marker.parentNode&&"value"===n.type?n.sync():void 0);return E}},update:function(t){var e,i,n,s,r,o,a,u;e={};for(i in t)n=t[i],i!==this.args[0]&&(e[i]=n);for(a=this.iterated,u=[],r=0,o=a.length;o>r;r++)s=a[r],u.push(s.update(e));return u}},t["public"].binders["class-*"]=function(t,e){var i;return i=" "+t.className+" ",!e==(-1!==i.indexOf(" "+this.args[0]+" "))?t.className=e?""+t.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim():void 0},t["public"].binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e;return t.hasOwnProperty(this.id)||(e=this.counter++,this.weakmap[e]={callbacks:{}},Object.defineProperty(t,this.id,{value:e})),this.weakmap[t[this.id]]},stubFunction:function(t,e){var i,n,s;return n=t[e],i=this.weakReference(t),s=this.weakmap,t[e]=function(){var e,r,o,a,u,h,c,l,p,d;a=n.apply(t,arguments),c=i.pointers;for(o in c)for(r=c[o],d=null!=(l=null!=(p=s[o])?p.callbacks[r]:void 0)?l:[],u=0,h=d.length;h>u;u++)(e=d[u])();return a}},observeMutations:function(t,e,i){var n,s,r,o,a,u;if(Array.isArray(t)){if(r=this.weakReference(t),null==r.pointers)for(r.pointers={},s=["push","pop","shift","unshift","sort","reverse","splice"],a=0,u=s.length;u>a;a++)n=s[a],this.stubFunction(t,n);if(null==(o=r.pointers)[e]&&(o[e]=[]),c.call(r.pointers[e],i)<0)return r.pointers[e].push(i)}},unobserveMutations:function(t,e,i){var n,s,r;return Array.isArray(t&&null!=t[this.id])&&(s=null!=(r=this.weakReference(t).pointers)?r[e]:void 0)&&(n=s.indexOf(i),n>=0)?s.splice(n,1):void 0},observe:function(t,e,i){var n,s;return n=this.weakReference(t).callbacks,null==n[e]&&(n[e]=[],s=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return s},set:function(r){return function(o){var a,u,h;if(o!==s){for(s=o,h=n[e].slice(),a=0,u=h.length;u>a;a++)i=h[a],c.call(n[e],i)>=0&&i();return r.observeMutations(o,t[r.id],e)}}}(this)})),c.call(n[e],i)<0&&n[e].push(i),this.observeMutations(t[e],t[this.id],e)},unobserve:function(t,e,i){var n,s;return n=this.weakmap[t[this.id]].callbacks[e],s=n.indexOf(i),s>=0&&n.splice(s,1),this.unobserveMutations(t[e],t[this.id],e)},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i}},t.factory=function(e){return t.sightglass=e,t["public"]._=t,t["public"]},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=t.factory(e("sightglass")):"function"==typeof i&&i.amd?i("rivets",["sightglass"],function(e){return this.rivets=t.factory(e)}):this.rivets=t.factory(sightglass)}.call(this),i("tool/animatortool",["require","exports","module","BlankyApp","parse","rivets"],function(t){var e=t("BlankyApp"),i=new e,n=t("parse");n.initialize("U0A3f3L3EHbQpF8Oig2zhlOasUF6PhJkTOQOvjoH","aNTIn2zXGxzAEl8BLOnHzuWvaOYySN5QqHPLgA1X");var s,r=n.Object.extend("Page"),o=t("rivets");o.binders.input={publishes:!0,routine:o.binders.value.routine,bind:function(t){var e=this;s=function(){e.publish(),e.model.configChanged=!0},t.addEventListener("input",s)},unbind:function(t){t.removeEventListener("input",s)}};var a=n.Collection.extend({model:r}),u=new a;u.comparator=function(t){return t.get("page").name};var h=this;u.fetch({success:function(t){var e={};e.pages=t.toJSON(),window.pagesModel=e;var i=window.pagesListView||o.bind(document.getElementById("editor-section"),e);window.pagesListView=i,window.pagesListView.unbind(),window.pagesListView.models=e,window.pagesListView.bind(),document.getElementById("page-chooser").value=window.initialPageId,h.loadPage(window.initialPageId)},error:function(){alert("error with fetching page list")}}),this.clearPage=function(){window.rivetsView.unbind(),i.clearPage()},this.loadPage=function(t){i.loadPage(t),window.saver.currentPageID=t;var e=window.rivetsView||o.bind(document.getElementById("edit-section"),window.pageModel);window.rivetsView=e,window.rivetsView.unbind(),window.rivetsView.models=window.pageModel,window.rivetsView.bind(),window.saver.model=window.pageModel,window.saver.Page=r,window.pageModel.editPopup=[window.pageModel.camera]};var c={};c.saveToParse=function(){var t=this,e=new this.Page;this.model.objectId=this.currentPageID,e.save(this.model,{success:function(){window.saver.model.objectId=t.currentPageID,alert("saved successfully!")}})},c.addNewPopup=function(){var t={accel:!1,accelAmount:"1",height:"1",initialX:"0",initialY:"0",name:"new",rotateAngle:"100",rotateSpeed:"2000",scale:"1",scaleX:"1",scaleY:"1",timeOffset:"0",timer:{initialTime:1419434956210},translate:!1,translateX:"0",translateXSpeed:"1000",translateY:"0",translateYSpeed:"1000",url:"",xyRatio:"1",zoomAmount:"0",zoomSpeed:"2000"};this.model.popups.push(t)},c.removePopup=function(){var t=this.model.editPopup[0],e=this.model.popups.indexOf(t);this.model.popups.splice(e,1),window.editChanger.changeEditing()},c.addFrame=function(){var t=this.model.editPopup[0];t.frames=t.frames||[],t.frames.push({url:""})},c.deleteFrame=function(t){var e=this.model.editPopup[0],i=t.parentElement.parentElement.children,n=[].slice.call(i),s=n.indexOf(t.parentElement)-1;e.frames.splice(s,1)},c.addSound=function(){this.model.sounds=this.model.sounds||[],this.model.sounds.push({name:"",url:""})},c.deleteSound=function(t){var e=t.parentElement.parentElement.children,i=[].slice.call(e),n=i.indexOf(t.parentElement)-1;this.model.sounds.splice(n,1)},c.dupePage=function(){var t=new this.Page;t.set("name","dup of "+this.model.name),t.set("device",this.model.device),t.set("popups",this.model.popups),t.set("camera",this.model.camera),t.set("page",this.model.page),t.set("sounds",this.model.sounds),t.save(null,{success:function(t){alert("Duplicate page created with objectId: "+t.id)},error:function(t,e){alert("Failed to create new page, with error code: "+e.message)}})},c.addNewPage=function(){var t=new this.Page,e={height:"0",initialX:"0",initialY:"0",motionType:"sine",name:"camera",rotateAngle:"100",rotateSpeed:"2000",scale:"1",timeOffset:"100",translate:!1,translateX:"0",translateXSpeed:"5000",translateY:"200",translateYSpeed:"18000",xyRatio:"1",zoomAmount:"0",zoomSpeed:"2000"},i={name:"new",x:"900",y:"1200"};t.set("name","new"),t.set("device","new"),t.set("popups",[]),t.set("camera",e),t.set("page",i),t.save(null,{success:function(t){alert("New page created with objectId: "+t.id)},error:function(t,e){alert("Failed to create new page, with error code: "+e.message)}})},window.saver=c;var l={};l.main=this,l.changePage=function(){var t=document.getElementById("page-chooser").value;this.main.clearPage(),this.main.loadPage(t)},window.pageChanger=l;var p={};p.main=this,p.pause=function(){var t=document.getElementById("pause-button");t.onclick=function(){window.timeController.play()},t.textContent="Play",window.timeKeeper.pause()},p.update=function(t){window.timeKeeper.setTime(t)},p.play=function(){var t=document.getElementById("pause-button");t.onclick=function(){window.timeController.pause()},t.textContent="Pause",window.timeKeeper.play()},window.timeController=p;var d={};d.main=this,d.changeEditing=function(){var t=document.querySelector('input[name="edit-chooser"]:checked').value;if("camera"!==t){var e=window.pageModel.popups.filter(function(e){return e.name===t?!0:!1});window.pageModel.editPopup=e}else window.pageModel.editPopup=[window.pageModel.camera]},window.editChanger=d}),e(["tool/animatortool"])}();